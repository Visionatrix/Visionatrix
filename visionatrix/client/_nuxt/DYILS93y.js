import{f as Y,N as S,W as dt,X as ol,Y as qt,Z as Et,S as ge,$ as Ze,a0 as _t,x as B,a1 as pe,a2 as et,a3 as Tt,a4 as sl,a5 as Ot,v as me,a6 as il,a7 as Qe,a8 as rl,F as Z,a9 as Ce,aa as it,ab as ut,ac as ul,ad as qe,ae as Ie,B as mt,af as dl,C as Me,_ as ft,c as O,o as d,a as k,D as Re,E as ze,n as le,H as pt,I as je,ag as $t,ah as wt,K as ct,J as Ee,ai as cl,aj as ml,ak as jt,al as kt,am as fl,an as pl,ao as Nt,ap as Ye,aq as Dt,ar as vl,p as t,as as gl,at as Ct,au as yl,av as It,aw as We,ax as Ne,g as ve,M as St,T as Pt,ay as Se,i as I,k as R,w,b as p,r as ce,m as re,d as D,P as X,az as hl,s as he,aA as bl,t as G,aB as vt,Q as Mt,j as Ge,q as Rt,z as wl,O as De,h as be,y as Wt,aC as Ht,l as Xe,aD as kl,aE as xl,aF as Gt,R as xt,aG as Xt,aH as Jt,aI as fe,aJ as Kt,aK as _l,aL as $l,aM as Cl,G as Il,aN as Qt,aO as Sl,A as Pl,aP as Ml}from"./DALul47G.js";import{b as gt,a as Rl,_ as Yt}from"./Bl_Ajnmu.js";import{t as Fl,u as Zt,_ as Te}from"./BdS5goKx.js";import{_ as Ul}from"./DH3S-v1t.js";import{_ as Oe}from"./ROrpHI3x.js";import{_ as Fe,a as Vl}from"./C2QV2fRR.js";import{_ as tt}from"./1r8bX7TI.js";import{a as Je,_ as el}from"./BbWRRfNu.js";import{_ as yt}from"./DKcNRORi.js";import{_ as zl}from"./OOcmZNF9.js";import{_ as Tl}from"./Bo08Frmm.js";const Ol={wrapper:"relative",container:"relative w-full flex overflow-x-auto snap-x snap-mandatory scroll-smooth",item:"flex flex-none snap-center",arrows:{wrapper:"flex items-center justify-between"},indicators:{wrapper:"absolute flex items-center justify-center gap-3 bottom-4 inset-x-0",base:"rounded-full h-3 w-3",active:"bg-primary-500 dark:bg-primary-400",inactive:"bg-gray-100 dark:bg-gray-800"},default:{prevButton:{color:"black",class:"rtl:[&_span:first-child]:rotate-180 absolute start-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-left-20-solid"},nextButton:{color:"black",class:"rtl:[&_span:last-child]:rotate-180 absolute end-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-right-20-solid"}}},jl={wrapper:"relative w-full flex items-center",base:"w-full absolute appearance-none cursor-pointer disabled:cursor-not-allowed disabled:bg-opacity-50 focus:outline-none peer group",rounded:"rounded-lg",background:"bg-transparent",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",progress:{base:"absolute pointer-events-none peer-disabled:bg-opacity-50",rounded:"rounded-s-lg",background:"bg-{color}-500 dark:bg-{color}-400",size:{"2xs":"h-px",xs:"h-0.5",sm:"h-1",md:"h-2",lg:"h-3",xl:"h-4","2xl":"h-5"}},thumb:{base:"[&::-webkit-slider-thumb]:relative [&::-moz-range-thumb]:relative [&::-webkit-slider-thumb]:z-[1] [&::-moz-range-thumb]:z-[1] [&::-webkit-slider-thumb]:appearance-none [&::-moz-range-thumb]:appearance-none [&::-webkit-slider-thumb]:rounded-full [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:border-0",color:"text-{color}-500 dark:text-{color}-400",background:"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:dark:bg-gray-900 [&::-moz-range-thumb]:bg-current",ring:"[&::-webkit-slider-thumb]:ring-2 [&::-webkit-slider-thumb]:ring-current",size:{"2xs":"[&::-webkit-slider-thumb]:h-1.5 [&::-moz-range-thumb]:h-1.5 [&::-webkit-slider-thumb]:w-1.5 [&::-moz-range-thumb]:w-1.5 [&::-webkit-slider-thumb]:mt-[-2.5px] [&::-moz-range-thumb]:mt-[-2.5px]",xs:"[&::-webkit-slider-thumb]:h-2 [&::-moz-range-thumb]:h-2 [&::-webkit-slider-thumb]:w-2 [&::-moz-range-thumb]:w-2 [&::-webkit-slider-thumb]:mt-[-3px] [&::-moz-range-thumb]:mt-[-3px]",sm:"[&::-webkit-slider-thumb]:h-3 [&::-moz-range-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-moz-range-thumb]:w-3 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",md:"[&::-webkit-slider-thumb]:h-4 [&::-moz-range-thumb]:h-4 [&::-webkit-slider-thumb]:w-4 [&::-moz-range-thumb]:w-4 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",lg:"[&::-webkit-slider-thumb]:h-5 [&::-moz-range-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 [&::-moz-range-thumb]:w-5 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",xl:"[&::-webkit-slider-thumb]:h-6 [&::-moz-range-thumb]:h-6 [&::-webkit-slider-thumb]:w-6 [&::-moz-range-thumb]:w-6 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1","2xl":"[&::-webkit-slider-thumb]:h-7 [&::-moz-range-thumb]:h-7 [&::-webkit-slider-thumb]:w-7 [&::-moz-range-thumb]:w-7 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1"}},track:{base:"[&::-webkit-slider-runnable-track]:group-disabled:bg-opacity-50 [&::-moz-range-track]:group-disabled:bg-opacity-50",background:"[&::-webkit-slider-runnable-track]:bg-gray-200 [&::-moz-range-track]:bg-gray-200 [&::-webkit-slider-runnable-track]:dark:bg-gray-700 [&::-moz-range-track]:dark:bg-gray-700",rounded:"[&::-webkit-slider-runnable-track]:rounded-lg [&::-moz-range-track]:rounded-lg",size:{"2xs":"[&::-webkit-slider-runnable-track]:h-px [&::-moz-range-track]:h-px",xs:"[&::-webkit-slider-runnable-track]:h-0.5 [&::-moz-range-track]:h-0.5",sm:"[&::-webkit-slider-runnable-track]:h-1 [&::-moz-range-track]:h-1",md:"[&::-webkit-slider-runnable-track]:h-2 [&::-moz-range-track]:h-2",lg:"[&::-webkit-slider-runnable-track]:h-3 [&::-moz-range-track]:h-3",xl:"[&::-webkit-slider-runnable-track]:h-4 [&::-moz-range-track]:h-4","2xl":"[&::-webkit-slider-runnable-track]:h-5 [&::-moz-range-track]:h-5"}},size:{"2xs":"h-1.5",xs:"h-2",sm:"h-3",md:"h-4",lg:"h-5",xl:"h-6","2xl":"h-7"},default:{size:"md",color:"primary"}},Nl={wrapper:"relative space-y-2",container:"relative w-full",base:"focus:outline-none",list:{base:"relative",background:"bg-gray-100 dark:bg-gray-800",rounded:"rounded-lg",shadow:"",padding:"p-1",height:"h-10",width:"w-full",marker:{wrapper:"absolute top-[4px] left-[4px] duration-200 ease-out focus:outline-none",base:"w-full h-full",background:"bg-white dark:bg-gray-900",rounded:"rounded-md",shadow:"shadow-sm"},tab:{base:"relative inline-flex items-center justify-center flex-shrink-0 w-full ui-focus-visible:outline-0 ui-focus-visible:ring-2 ui-focus-visible:ring-primary-500 dark:ui-focus-visible:ring-primary-400 ui-not-focus-visible:outline-none focus:outline-none disabled:cursor-not-allowed disabled:opacity-75 transition-colors duration-200 ease-out",background:"",active:"text-gray-900 dark:text-white",inactive:"text-gray-500 dark:text-gray-400",height:"h-8",padding:"px-3",size:"text-sm",font:"font-medium",rounded:"rounded-md",shadow:"",icon:"w-4 h-4 flex-shrink-0 me-2"}}};let Bl=Y({props:{onFocus:{type:Function,required:!0}},setup(e){let l=S(!0);return()=>l.value?dt(qt,{as:"button",type:"button",features:ol.Focusable,onFocus(n){n.preventDefault();let s,u=50;function o(){var i;if(u--<=0){s&&cancelAnimationFrame(s);return}if((i=e.onFocus)!=null&&i.call(e)){l.value=!1,cancelAnimationFrame(s);return}s=requestAnimationFrame(o)}s=requestAnimationFrame(o)}}):null}});var Ll=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(Ll||{}),Al=(e=>(e[e.Less=-1]="Less",e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e))(Al||{});let tl=Symbol("TabsContext");function lt(e){let l=_t(tl,null);if(l===null){let n=new Error(`<${e} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,lt),n}return l}let Ft=Symbol("TabsSSRContext"),ql=Y({name:"TabGroup",emits:{change:e=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(e,{slots:l,attrs:n,emit:s}){var u;let o=S((u=e.selectedIndex)!=null?u:e.defaultIndex),i=S([]),r=S([]),f=B(()=>e.selectedIndex!==null),_=B(()=>f.value?e.selectedIndex:o.value);function h(F){var T;let P=Qe(y.tabs.value,pe),m=Qe(y.panels.value,pe),g=P.filter(b=>{var U;return!((U=pe(b))!=null&&U.hasAttribute("disabled"))});if(F<0||F>P.length-1){let b=ut(o.value===null?0:Math.sign(F-o.value),{[-1]:()=>1,0:()=>ut(Math.sign(F),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),U=ut(b,{0:()=>P.indexOf(g[0]),1:()=>P.indexOf(g[g.length-1])});U!==-1&&(o.value=U),y.tabs.value=P,y.panels.value=m}else{let b=P.slice(0,F),U=[...P.slice(F),...b].find(v=>g.includes(v));if(!U)return;let $=(T=P.indexOf(U))!=null?T:y.selectedIndex.value;$===-1&&($=y.selectedIndex.value),o.value=$,y.tabs.value=P,y.panels.value=m}}let y={selectedIndex:B(()=>{var F,T;return(T=(F=o.value)!=null?F:e.defaultIndex)!=null?T:null}),orientation:B(()=>e.vertical?"vertical":"horizontal"),activation:B(()=>e.manual?"manual":"auto"),tabs:i,panels:r,setSelectedIndex(F){_.value!==F&&s("change",F),f.value||h(F)},registerTab(F){var T;if(i.value.includes(F))return;let P=i.value[o.value];if(i.value.push(F),i.value=Qe(i.value,pe),!f.value){let m=(T=i.value.indexOf(P))!=null?T:o.value;m!==-1&&(o.value=m)}},unregisterTab(F){let T=i.value.indexOf(F);T!==-1&&i.value.splice(T,1)},registerPanel(F){r.value.includes(F)||(r.value.push(F),r.value=Qe(r.value,pe))},unregisterPanel(F){let T=r.value.indexOf(F);T!==-1&&r.value.splice(T,1)}};Ot(tl,y);let M=S({tabs:[],panels:[]}),z=S(!1);ge(()=>{z.value=!0}),Ot(Ft,B(()=>z.value?null:M.value));let C=B(()=>e.selectedIndex);return ge(()=>{me([C],()=>{var F;return h((F=e.selectedIndex)!=null?F:e.defaultIndex)},{immediate:!0})}),il(()=>{if(!f.value||_.value==null||y.tabs.value.length<=0)return;let F=Qe(y.tabs.value,pe);F.some((T,P)=>pe(y.tabs.value[P])!==pe(T))&&y.setSelectedIndex(F.findIndex(T=>pe(T)===pe(y.tabs.value[_.value])))}),()=>{let F={selectedIndex:o.value};return dt(Z,[i.value.length<=0&&dt(Bl,{onFocus:()=>{for(let T of i.value){let P=pe(T);if((P==null?void 0:P.tabIndex)===0)return P.focus(),!0}return!1}}),et({theirProps:{...n,...rl(e,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:F,slots:l,attrs:n,name:"TabGroup"})])}}}),El=Y({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(e,{attrs:l,slots:n}){let s=lt("TabList");return()=>{let u={selectedIndex:s.selectedIndex.value},o={role:"tablist","aria-orientation":s.orientation.value};return et({ourProps:o,theirProps:e,slot:u,attrs:l,slots:n,name:"TabList"})}}}),Dl=Y({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:l,slots:n,expose:s}){var u;let o=(u=e.id)!=null?u:`headlessui-tabs-tab-${Et()}`,i=lt("Tab"),r=S(null);s({el:r,$el:r}),ge(()=>i.registerTab(r)),Ze(()=>i.unregisterTab(r));let f=_t(Ft),_=B(()=>{if(f.value){let m=f.value.tabs.indexOf(o);return m===-1?f.value.tabs.push(o)-1:m}return-1}),h=B(()=>{let m=i.tabs.value.indexOf(r);return m===-1?_.value:m}),y=B(()=>h.value===i.selectedIndex.value);function M(m){var g;let b=m();if(b===it.Success&&i.activation.value==="auto"){let U=(g=ul(r))==null?void 0:g.activeElement,$=i.tabs.value.findIndex(v=>pe(v)===U);$!==-1&&i.setSelectedIndex($)}return b}function z(m){let g=i.tabs.value.map(b=>pe(b)).filter(Boolean);if(m.key===Ce.Space||m.key===Ce.Enter){m.preventDefault(),m.stopPropagation(),i.setSelectedIndex(h.value);return}switch(m.key){case Ce.Home:case Ce.PageUp:return m.preventDefault(),m.stopPropagation(),M(()=>qe(g,Ie.First));case Ce.End:case Ce.PageDown:return m.preventDefault(),m.stopPropagation(),M(()=>qe(g,Ie.Last))}if(M(()=>ut(i.orientation.value,{vertical(){return m.key===Ce.ArrowUp?qe(g,Ie.Previous|Ie.WrapAround):m.key===Ce.ArrowDown?qe(g,Ie.Next|Ie.WrapAround):it.Error},horizontal(){return m.key===Ce.ArrowLeft?qe(g,Ie.Previous|Ie.WrapAround):m.key===Ce.ArrowRight?qe(g,Ie.Next|Ie.WrapAround):it.Error}}))===it.Success)return m.preventDefault()}let C=S(!1);function F(){var m;C.value||(C.value=!0,!e.disabled&&((m=pe(r))==null||m.focus({preventScroll:!0}),i.setSelectedIndex(h.value),Fl(()=>{C.value=!1})))}function T(m){m.preventDefault()}let P=sl(B(()=>({as:e.as,type:l.type})),r);return()=>{var m,g;let b={selected:y.value,disabled:(m=e.disabled)!=null?m:!1},{...U}=e,$={ref:r,onKeydown:z,onMousedown:T,onClick:F,id:o,role:"tab",type:P.value,"aria-controls":(g=pe(i.panels.value[h.value]))==null?void 0:g.id,"aria-selected":y.value,tabIndex:y.value?0:-1,disabled:e.disabled?!0:void 0};return et({ourProps:$,theirProps:U,slot:b,attrs:l,slots:n,name:"Tab"})}}}),Wl=Y({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(e,{slots:l,attrs:n}){let s=lt("TabPanels");return()=>{let u={selectedIndex:s.selectedIndex.value};return et({theirProps:e,ourProps:{},slot:u,attrs:n,slots:l,name:"TabPanels"})}}}),Hl=Y({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(e,{attrs:l,slots:n,expose:s}){var u;let o=(u=e.id)!=null?u:`headlessui-tabs-panel-${Et()}`,i=lt("TabPanel"),r=S(null);s({el:r,$el:r}),ge(()=>i.registerPanel(r)),Ze(()=>i.unregisterPanel(r));let f=_t(Ft),_=B(()=>{if(f.value){let M=f.value.panels.indexOf(o);return M===-1?f.value.panels.push(o)-1:M}return-1}),h=B(()=>{let M=i.panels.value.indexOf(r);return M===-1?_.value:M}),y=B(()=>h.value===i.selectedIndex.value);return()=>{var M;let z={selected:y.value},{tabIndex:C,...F}=e,T={ref:r,id:o,role:"tabpanel","aria-labelledby":(M=pe(i.tabs.value[h.value]))==null?void 0:M.id,tabIndex:y.value?C:-1};return!y.value&&e.unmount&&!e.static?dt(qt,{as:"span","aria-hidden":!0,...T}):et({ourProps:T,theirProps:F,slot:z,attrs:l,slots:n,features:Tt.Static|Tt.RenderStrategy,visible:y.value,name:"TabPanel"})}}});const Ve=mt(Me.ui.strategy,Me.ui.textarea,dl),Gl=Y({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys(Ve.size).includes(e)}},color:{type:String,default:()=>Ve.default.color,validator(e){return[...Me.ui.colors,...Object.keys(Ve.color)].includes(e)}},variant:{type:String,default:()=>Ve.default.variant,validator(e){return[...Object.keys(Ve.variant),...Object.values(Ve.color).flatMap(l=>Object.keys(l))].includes(e)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:l}){const{ui:n,attrs:s}=pt("textarea",je(e,"ui"),Ve,je(e,"class")),{emitFormBlur:u,emitFormInput:o,inputId:i,color:r,size:f,name:_}=Zt(e,Ve),h=S($t({},e.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),y=S(null),M=()=>{var g;e.autofocus&&((g=y.value)==null||g.focus())},z=()=>{if(e.autoresize){if(!y.value)return;y.value.rows=e.rows;const g=y.value.style.overflow;y.value.style.overflow="hidden";const b=window.getComputedStyle(y.value),U=Number.parseInt(b.paddingTop),$=Number.parseInt(b.paddingBottom),v=U+$,q=Number.parseInt(b.lineHeight),{scrollHeight:a}=y.value,c=(a-v)/q;c>e.rows&&(y.value.rows=e.maxrows?Math.min(c,e.maxrows):c),y.value.style.overflow=g}},C=g=>{h.value.trim&&(g=g.trim()),h.value.number&&(g=cl(g)),h.value.nullify&&(g||(g=null)),l("update:modelValue",g),o()},F=g=>{z(),h.value.lazy||C(g.target.value)},T=g=>{const b=g.target.value;l("change",b),h.value.lazy&&C(b),h.value.trim&&(g.target.value=b.trim())},P=g=>{l("blur",g),u()};ge(()=>{setTimeout(()=>{M()},e.autofocusDelay)}),me(()=>e.modelValue,()=>{wt(z)}),ge(()=>{setTimeout(()=>{M(),z()},100)});const m=B(()=>{var b,U;const g=((U=(b=n.value.color)==null?void 0:b[r.value])==null?void 0:U[e.variant])||n.value.variant[e.variant];return ct(Ee(n.value.base,n.value.form,n.value.rounded,n.value.placeholder,n.value.size[f.value],e.padded?n.value.padding[f.value]:"p-0",g==null?void 0:g.replaceAll("{color}",r.value),!e.resize&&"resize-none"),e.textareaClass)});return{ui:n,attrs:s,name:_,inputId:i,textarea:y,textareaClass:m,onInput:F,onChange:T,onBlur:P}}}),Xl=["id","value","name","rows","required","disabled","placeholder"];function Jl(e,l,n,s,u,o){return d(),O("div",{class:le(e.ui.wrapper)},[k("textarea",ze({id:e.inputId,ref:"textarea",value:e.modelValue,name:e.name,rows:e.rows,required:e.required,disabled:e.disabled,placeholder:e.placeholder,class:e.textareaClass},e.attrs,{onInput:l[0]||(l[0]=(...i)=>e.onInput&&e.onInput(...i)),onBlur:l[1]||(l[1]=(...i)=>e.onBlur&&e.onBlur(...i)),onChange:l[2]||(l[2]=(...i)=>e.onChange&&e.onChange(...i))}),null,16,Xl),Re(e.$slots,"default")],2)}const Ut=ft(Gl,[["render",Jl]]);async function Kl(e,l){return await Ql(l).catch(s=>(console.error("Failed to get image meta for "+l,s+""),{width:0,height:0,ratio:0}))}async function Ql(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((l,n)=>{const s=new Image;s.onload=()=>{const u={width:s.width,height:s.height,ratio:s.width/s.height};l(u)},s.onerror=u=>n(u),s.src=e})}function Bt(e){return l=>l?e[l]||l:e.missingValue}function Yl({formatter:e,keyMap:l,joinWith:n="/",valueMap:s}={}){e||(e=(o,i)=>`${o}=${i}`),l&&typeof l!="function"&&(l=Bt(l));const u=s||{};return Object.keys(u).forEach(o=>{typeof u[o]!="function"&&(u[o]=Bt(u[o]))}),(o={})=>Object.entries(o).filter(([r,f])=>typeof f<"u").map(([r,f])=>{const _=u[r];return typeof _=="function"&&(f=_(o[r])),r=typeof l=="function"?l(r):r,e(r,f)}).join(n)}function Pe(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return Number.parseInt(e,10)}function Zl(e=""){if(e===void 0||!e.length)return[];const l=new Set;for(const n of e.split(" ")){const s=Number.parseInt(n.replace("x",""));s&&l.add(s)}return Array.from(l)}function en(e){if(e.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function tn(e){const l={};if(typeof e=="string")for(const n of e.split(/[\s,]+/).filter(s=>s)){const s=n.split(":");s.length!==2?l["1px"]=s[0].trim():l[s[0].trim()]=s[1].trim()}else Object.assign(l,e);return l}function ln(e){const l={options:e},n=(u,o={})=>ll(l,u,o),s=(u,o={},i={})=>n(u,{...i,modifiers:$t(o,i.modifiers||{})}).url;for(const u in e.presets)s[u]=(o,i,r)=>s(o,i,{...e.presets[u],...r});return s.options=e,s.getImage=n,s.getMeta=(u,o)=>nn(l,u,o),s.getSizes=(u,o)=>sn(l,u,o),l.$img=s,s}async function nn(e,l,n){const s=ll(e,l,{...n});return typeof s.getMeta=="function"?await s.getMeta():await Kl(e,s.url)}function ll(e,l,n){var _,h;if(l&&typeof l!="string")throw new TypeError(`input must be a string (received ${typeof l}: ${JSON.stringify(l)})`);if(!l||l.startsWith("data:"))return{url:l};const{provider:s,defaults:u}=an(e,n.provider||e.options.provider),o=on(e,n.preset);if(l=jt(l)?l:ml(l),!s.supportsAlias){for(const y in e.options.alias)if(l.startsWith(y)){const M=e.options.alias[y];M&&(l=kt(M,l.slice(y.length)))}}if(s.validateDomains&&jt(l)){const y=fl(l).host;if(!e.options.domains.find(M=>M===y))return{url:l}}const i=$t(n,o,u);i.modifiers={...i.modifiers};const r=i.modifiers.format;(_=i.modifiers)!=null&&_.width&&(i.modifiers.width=Pe(i.modifiers.width)),(h=i.modifiers)!=null&&h.height&&(i.modifiers.height=Pe(i.modifiers.height));const f=s.getImage(l,i,e);return f.format=f.format||r||"",f}function an(e,l){const n=e.options.providers[l];if(!n)throw new Error("Unknown provider: "+l);return n}function on(e,l){if(!l)return{};if(!e.options.presets[l])throw new Error("Unknown preset: "+l);return e.options.presets[l]}function sn(e,l,n){var C,F,T,P,m;const s=Pe((C=n.modifiers)==null?void 0:C.width),u=Pe((F=n.modifiers)==null?void 0:F.height),o=tn(n.sizes),i=(T=n.densities)!=null&&T.trim()?Zl(n.densities.trim()):e.options.densities;en(i);const r=s&&u?u/s:0,f=[],_=[];if(Object.keys(o).length>=1){for(const g in o){const b=Lt(g,String(o[g]),u,r,e);if(b!==void 0){f.push({size:b.size,screenMaxWidth:b.screenMaxWidth,media:`(max-width: ${b.screenMaxWidth}px)`});for(const U of i)_.push({width:b._cWidth*U,src:At(e,l,n,b,U)})}}rn(f)}else for(const g of i){const b=Object.keys(o)[0];let U=b?Lt(b,String(o[b]),u,r,e):void 0;U===void 0&&(U={size:"",screenMaxWidth:0,_cWidth:(P=n.modifiers)==null?void 0:P.width,_cHeight:(m=n.modifiers)==null?void 0:m.height}),_.push({width:g,src:At(e,l,n,U,g)})}un(_);const h=_[_.length-1],y=f.length?f.map(g=>`${g.media?g.media+" ":""}${g.size}`).join(", "):void 0,M=y?"w":"x",z=_.map(g=>`${g.src} ${g.width}${M}`).join(", ");return{sizes:y,srcset:z,src:h==null?void 0:h.src}}function Lt(e,l,n,s,u){const o=u.options.screens&&u.options.screens[e]||Number.parseInt(e),i=l.endsWith("vw");if(!i&&/^\d+$/.test(l)&&(l=l+"px"),!i&&!l.endsWith("px"))return;let r=Number.parseInt(l);if(!o||!r)return;i&&(r=Math.round(r/100*o));const f=s?Math.round(r*s):n;return{size:l,screenMaxWidth:o,_cWidth:r,_cHeight:f}}function At(e,l,n,s,u){return e.$img(l,{...n.modifiers,width:s._cWidth?s._cWidth*u:void 0,height:s._cHeight?s._cHeight*u:void 0},n)}function rn(e){var n;e.sort((s,u)=>s.screenMaxWidth-u.screenMaxWidth);let l=null;for(let s=e.length-1;s>=0;s--){const u=e[s];u.media===l&&e.splice(s,1),l=u.media}for(let s=0;s<e.length;s++)e[s].media=((n=e[s+1])==null?void 0:n.media)||""}function un(e){e.sort((n,s)=>n.width-s.width);let l=null;for(let n=e.length-1;n>=0;n--){const s=e[n];s.width===l&&e.splice(n,1),l=s.width}}const dn=Yl({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,l)=>Nt(e)+"_"+Nt(l)}),cn=(e,{modifiers:l={},baseURL:n}={},s)=>{l.width&&l.height&&(l.resize=`${l.width}x${l.height}`,delete l.width,delete l.height);const u=dn(l)||"_";return n||(n=kt(s.options.nuxt.baseURL,"/_ipx")),{url:kt(n,u,pl(e))}},mn=!0,fn=!0,pn=Object.freeze(Object.defineProperty({__proto__:null,getImage:cn,supportsAlias:fn,validateDomains:mn},Symbol.toStringTag,{value:"Module"})),nl={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};nl.providers={ipxStatic:{provider:pn,defaults:{}}};const Vt=()=>{const e=Dt(),l=Ye();return l.$img||l._img||(l._img=ln({...nl,nuxt:{baseURL:e.app.baseURL},runtimeConfig:e}))};function vn(e){var l;(l=performance==null?void 0:performance.mark)==null||l.call(performance,"mark_feature_usage",{detail:{feature:e}})}const gn={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},yn=e=>{const l=B(()=>({provider:e.provider,preset:e.preset})),n=B(()=>({width:Pe(e.width),height:Pe(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding,nonce:e.nonce})),s=Vt(),u=B(()=>({...e.modifiers,width:Pe(e.width),height:Pe(e.height),format:e.format,quality:e.quality||s.options.quality,background:e.background,fit:e.fit}));return{options:l,attrs:n,modifiers:u}},hn={...gn,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},bn=["src"],Ue=Y({__name:"NuxtImg",props:hn,emits:["load","error"],setup(e,{emit:l}){const n=e,s=vl(),u=l,o=!1,i=Vt(),r=yn(n),f=S(!1),_=S(),h=B(()=>i.getSizes(n.src,{...r.options.value,sizes:n.sizes,densities:n.densities,modifiers:{...r.modifiers.value,width:Pe(n.width),height:Pe(n.height)}})),y=B(()=>{const P={...r.attrs.value,"data-nuxt-img":""};return(!n.placeholder||f.value)&&(P.sizes=h.value.sizes,P.srcset=h.value.srcset),P}),M=B(()=>{let P=n.placeholder;if(P===""&&(P=!0),!P||f.value)return!1;if(typeof P=="string")return P;const m=Array.isArray(P)?P:typeof P=="number"?[P,P]:[10,10];return i(n.src,{...r.modifiers.value,width:m[0],height:m[1],quality:m[2]||50,blur:m[3]||3},r.options.value)}),z=B(()=>n.sizes?h.value.src:i(n.src,r.modifiers.value,r.options.value)),C=B(()=>M.value?M.value:z.value),T=Ye().isHydrating;return ge(()=>{if(M.value||n.custom){const P=new Image;z.value&&(P.src=z.value),n.sizes&&(P.sizes=h.value.sizes||"",P.srcset=h.value.srcset),P.onload=m=>{f.value=!0,u("load",m)},P.onerror=m=>{u("error",m)},vn("nuxt-image");return}_.value&&(_.value.complete&&T&&(_.value.getAttribute("data-error")?u("error",new Event("error")):u("load",new Event("load"))),_.value.onload=P=>{u("load",P)},_.value.onerror=P=>{u("error",P)})}),(P,m)=>P.custom?Re(P.$slots,"default",gl(ze({key:1},{...t(o)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...y.value,...t(s)},isLoaded:f.value,src:C.value}))):(d(),O("img",ze({key:0,ref_key:"imgEl",ref:_,class:n.placeholder&&!f.value?n.placeholderClass:void 0},{...t(o)?{onerror:"this.setAttribute('data-error', 1)"}:{},...y.value,...t(s)},{src:C.value}),null,16,bn))}}),rt=mt(Me.ui.strategy,Me.ui.range,jl),wn=Y({inheritAttrs:!1,props:{modelValue:{type:Number,default:0},id:{type:String,default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},size:{type:String,default:null,validator(e){return Object.keys(rt.size).includes(e)}},color:{type:String,default:()=>rt.default.color,validator(e){return Me.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:l}){const{ui:n,attrs:s}=pt("range",je(e,"ui"),rt),{emitFormChange:u,inputId:o,color:i,size:r,name:f}=Zt(e,rt),_=B({get(){return e.modelValue},set(P){l("update:modelValue",P)}}),h=P=>{l("change",P.target.value),u()},y=B(()=>ct(Ee(n.value.wrapper,n.value.size[r.value]),e.class)),M=B(()=>ct(Ee(n.value.base,n.value.background,n.value.rounded,i.value&&n.value.ring.replaceAll("{color}",i.value),n.value.size[r.value]),e.inputClass)),z=B(()=>Ee(n.value.thumb.base,i.value&&n.value.thumb.color.replaceAll("{color}",i.value),n.value.thumb.ring,n.value.thumb.background,n.value.thumb.size[r.value])),C=B(()=>Ee(n.value.track.base,n.value.track.background,n.value.track.rounded,n.value.track.size[r.value])),F=B(()=>Ee(n.value.progress.base,n.value.progress.rounded,i.value&&n.value.progress.background.replaceAll("{color}",i.value),n.value.progress.size[r.value])),T=B(()=>{const{modelValue:P,min:m,max:g}=e;return{width:`${(Math.max(m,Math.min(P,g))-m)/(g-m)*100}%`}});return{ui:n,attrs:s,name:f,inputId:o,value:_,wrapperClass:y,inputClass:M,thumbClass:z,trackClass:C,progressClass:F,progressStyle:T,onChange:h}}}),kn=["id","name","min","max","disabled","step"];function xn(e,l,n,s,u,o){return d(),O("div",{class:le(e.wrapperClass)},[Ct(k("input",ze({id:e.inputId,ref:"input","onUpdate:modelValue":l[0]||(l[0]=i=>e.value=i),name:e.name,min:e.min,max:e.max,disabled:e.disabled,step:e.step,type:"range",class:[e.inputClass,e.thumbClass,e.trackClass]},e.attrs,{onChange:l[1]||(l[1]=(...i)=>e.onChange&&e.onChange(...i))}),null,16,kn),[[yl,e.value,void 0,{number:!0}]]),k("span",{class:le(e.progressClass),style:It(e.progressStyle)},null,6)],2)}const zt=ft(wn,[["render",xn]]),_n={class:"image-mask flex flex-col w-full"},$n={class:"canvas flex flex-col items-center justify-center mb-3 w-full"},Cn={class:"preview-over-original relative"},In={class:"actions flex items-center justify-center mb-3 mx-auto"},Sn={class:"options w-full max-w-[320px]"},Pn=Y({__name:"ImageInpaint",props:We({imageSrc:{type:String,required:!0}},{imageInpaintMask:{default:"",type:String},imageInpaintMaskModifiers:{},imageInpaintMaskData:{default:{},type:Object},imageInpaintMaskDataModifiers:{}}),emits:["update:imageInpaintMask","update:imageInpaintMaskData"],setup(e){const l=e,n=Ne(e,"imageInpaintMask"),s=Ne(e,"imageInpaintMaskData"),u=ve(),o=S(null),i=S(null),r=S(null),f=S(null),_=S(30),h=S([]),y=S({width:u.$state.outputMaxSize,height:u.$state.outputMaxSize}),M=S(null),z=S({x:0,y:0}),C=S({x:0,y:0,radius:_.value,fill:"rgba(255, 255, 255, 0.5)",stroke:null,strokeWidth:0,visible:!1}),F=S(5),T=S(!1),P=S([]),m=S([]);function g(){if(!o.value||!r.value){console.error("Could not get stage, image layer, or mask layer");return}const x=o.value.getNode(),V=f.value?f.value.width:x.width(),E=f.value?f.value.height:x.height(),K=document.createElement("canvas");K.width=V,K.height=E;const N=K.getContext("2d");if(!N){console.error("Could not get 2d context for mask canvas");return}N.fillStyle="black",N.fillRect(0,0,V,E);const Q=V/x.width(),W=E/x.height();N.fillStyle="white",h.value.forEach(ye=>{N.beginPath(),N.arc(ye.x*Q,ye.y*W,ye.radius*Math.max(Q,W),0,Math.PI*2,!0),N.closePath(),N.fill()});const ne=K.toDataURL("image/png",1);ne?(c(),n.value=ne,C.value.visible=!1,T.value=!1):console.error("Could not get data URI for masked image")}function b(x){const V=o.value.getNode();if(x.type.startsWith("touch")){const E=x.evt.touches[0]||x.evt.changedTouches[0];return{x:E.clientX-V.getContainer().offsetLeft,y:E.clientY-V.getContainer().offsetTop}}return V.getPointerPosition()}function U(x){x.type==="mousedown"&&x.evt.button!==0||(T.value=!0,z.value=b(x),a(),$(z.value))}function $(x){const V={x:x.x,y:x.y,radius:_.value,fill:"rgba(255, 255, 255, 1)"};h.value=h.value.filter(E=>!(v({x:E.x,y:E.y},x)+E.radius<=V.radius)),h.value.push(V)}function v(x,V){return Math.sqrt(Math.pow(V.x-x.x,2)+Math.pow(V.y-x.y,2))}function q(x){if(x.type.startsWith("touch")&&x.evt.preventDefault(),ke(x),!T.value)return;const V=b(x);v(z.value,b(x))>=F.value&&($(V),z.value=V)}function a(){P.value.push([...h.value]),m.value=[]}function c(){s.value={circles:[...h.value],brushRadius:_.value,undoStack:P.value,redoStack:m.value}}function j(){s.value!==null&&(h.value=s.value.circles||[],_.value=s.value.brushRadius||30,P.value=s.value.undoStack||[],m.value=s.value.redoStack||[])}function H(){P.value.length!==0&&(m.value.push([...h.value]),h.value=P.value.pop()||[])}function ee(){m.value.length!==0&&(P.value.push([...h.value]),h.value=m.value.pop()||[])}function ae(){T.value=!1}function se(){n.value=""}function ue(){a(),h.value=[],n.value=""}const te=B(()=>P.value.length>0),J=B(()=>m.value.length>0);function ke(x){const V=b(x);C.value.x=V.x,C.value.y=V.y}function xe(){C.value.visible=!1,T.value=!1}function de(){C.value.visible=!0,C.value.radius=_.value}function _e(){const x=new Image;x.src=l.imageSrc,x.onload=()=>{f.value=x,we(),L()}}function we(){if(!f.value)return;const x=window.innerWidth,V=window.innerHeight,E=f.value.width/f.value.height;let K,N;const Q=Math.min(x*.9,1200),W=Math.min(V*.8,u.outputMaxSize);E>Q/W?(K=Q,N=K/E):(N=W,K=N*E),y.value={width:Math.floor(K),height:Math.floor(N)},L()}function L(){const x=y.value.width,V=y.value.height,E=f.value.width,K=f.value.height,N=x/E,Q=V/K,W=Math.min(N,Q);M.value={x:0,y:0,width:E*W,height:K*W}}return St(()=>{_e(),j()}),ge(()=>{if(o.value){const x=o.value.getNode();x.on("touchstart",U),x.on("touchmove",q),x.on("touchend",ae),x.on("touchcancel",xe)}}),Pt(()=>{if(o.value){const x=o.value.getNode();x.off("touchstart"),x.off("touchmove"),x.off("touchend"),x.off("touchcancel")}c()}),(x,V)=>{const E=Ue,K=Se("v-image"),N=Se("v-layer"),Q=Se("v-circle"),W=Se("v-stage"),ne=re,ye=zt,Le=Oe;return d(),O("div",_n,[k("div",$n,[V[1]||(V[1]=k("p",{class:"text-sm my-2 text-slate-500"},"Select the target area for image inpaint",-1)),k("div",Cn,[e.imageSrc&&e.imageSrc!==""&&n.value!==""?(d(),I(E,{key:0,src:e.imageSrc,fit:"inside",width:t(y).width,height:t(y).height,draggable:"false",class:le({absolute:n.value!==""})},null,8,["src","width","height","class"])):R("",!0),n.value?(d(),I(E,{key:1,src:n.value,fit:"inside",width:t(y).width,height:t(y).height,draggable:"false",class:"opacity-50"},null,8,["src","width","height"])):R("",!0)]),n.value===""?(d(),I(W,{key:0,ref_key:"stageRef",ref:o,config:t(y),onMousedown:U,onMousemove:q,onMouseup:ae,onMouseleave:xe,onMouseenter:de},{default:w(()=>[p(N,{ref_key:"imageLayerRef",ref:i},{default:w(()=>[p(K,{image:t(f),config:t(y)},null,8,["image","config"])]),_:1},512),p(N,{ref_key:"maskLayerRef",ref:r},{default:w(()=>[(d(!0),O(Z,null,ce(t(h),($e,Ae)=>(d(),I(Q,{key:Ae,config:$e},null,8,["config"]))),128)),t(C).visible?(d(),I(Q,{key:0,config:t(C)},null,8,["config"])):R("",!0)]),_:1},512)]),_:1},8,["config"])):R("",!0)]),k("div",In,[p(ne,{class:"mr-2",size:"xs",icon:"i-heroicons-clipboard-document-check-16-solid",variant:"soft",disabled:t(h).length===0||n.value!=="",onClick:g},{default:w(()=>V[2]||(V[2]=[D(" Apply ")])),_:1},8,["disabled"]),p(ne,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-left-16-solid",variant:"soft",color:"cyan",disabled:!t(te)||n.value!=="",onClick:H},null,8,["disabled"]),p(ne,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-right-16-solid",variant:"soft",color:"cyan",disabled:!t(J)||n.value!=="",onClick:ee},null,8,["disabled"]),p(ne,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-turn-up-left-20-solid",variant:"soft",disabled:t(h).length===0&&n.value==="",color:"red",onClick:ue},{default:w(()=>V[3]||(V[3]=[D(" Reset ")])),_:1},8,["disabled"]),p(ne,{size:"xs",icon:"i-heroicons-pencil-solid",variant:"soft",disabled:n.value==="",color:"orange",onClick:se},{default:w(()=>V[4]||(V[4]=[D(" Edit ")])),_:1},8,["disabled"])]),k("div",Sn,[p(Le,{class:"mb-3 text-sm",hint:`value: ${t(_)}`,label:"Brush radius"},{default:w(()=>[p(ye,{modelValue:t(_),"onUpdate:modelValue":V[0]||(V[0]=$e=>X(_)?_.value=$e:null),min:1,max:100,size:"sm",class:"my-2",disabled:n.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["hint"])])])}}});function He(e={}){const{copy:l,isSupported:n}=hl(),s=he();function u(o,i={},r={}){n&&l(o).then(()=>{!i.title&&!i.description||s.add({...i,...e})},function(f){s.add({...r,description:r.description||f.message,...e})})}return{copy:u}}const Mn="0.05";function Rn(e,l){const n=parseFloat(e);if(isNaN(n))return e;const s=n+l;return s<0?"0":String(Number(s.toFixed(10)))}function Fn(e,l){let n=l,s=l,u=0,o=0;for(;n>=0&&(n--,!(e[n]==="("&&u===o));)e[n]==="("&&u++,e[n]===")"&&o++;if(n<0)return!1;for(u=0,o=0;s<e.length&&!(e[s]===")"&&u===o);)e[s]==="("&&u++,e[s]===")"&&o++,s++;return s===e.length?!1:{start:n+1,end:s}}function Un(e){const l=/^\((.*)\)$/,n=e.match(l),s=/:([+-]?(\d*\.)?\d+([eE][+-]?\d+)?)/,u=e.match(s);return n&&!u?`(${n[1]}:1.0)`:e}function al(e){const l=e.composedPath()[0],n=parseFloat(Mn);if(l.tagName!=="TEXTAREA"||!(e.key==="ArrowUp"||e.key==="ArrowDown")||!e.ctrlKey&&!e.metaKey)return;e.preventDefault();let s=l.selectionStart,u=l.selectionEnd,o=l.value.substring(s,u);if(!o){const f=Fn(l.value,s);if(f)s=f.start,u=f.end,o=l.value.substring(s,u);else{const _=" .,\\/!?%^*;:{}=-_`~()\r\n	";for(;!_.includes(l.value[s-1])&&s>0;)s--;for(;!_.includes(l.value[u])&&u<l.value.length;)u++;if(o=l.value.substring(s,u),!o)return}}o[o.length-1]===" "&&(o=o.substring(0,o.length-1),u-=1),l.value[s-1]==="("&&l.value[u]===")"&&(s-=1,u+=1,o=l.value.substring(s,u)),(o[0]!=="("||o[o.length-1]!==")")&&(o=`(${o})`),o=Un(o);const i=e.key==="ArrowUp"?n:-n,r=o.replace(/\((.*):(\d+(?:\.\d+)?)\)/,(f,_,h)=>(h=Rn(h,i),Number(h)==1?_:`(${_}:${h})`));return l.setRangeText(r,s,u,"select"),l.value}const Vn={key:0,class:"text-red-300"},zn={class:"flex items-center"},Tn={class:"p-2 max-w-48 max-h-48 not-italic"},On={class:"block font-medium text-gray-700 dark:text-gray-200"},jn={key:0,class:"flex items-center"},Nn={key:2,class:"flex flex-row flex-grow items-center justify-between"},Bn={key:3,class:"flex flex-row flex-grow items-center"},Ln={class:"sm:inline"},An={class:"preview-over-original relative"},qn={key:1,class:"text-red-300 text-sm"},En=Y({__name:"InputParam",props:{inputParam:{type:Object,required:!0},index:{type:Number,required:!0},inputParamsMap:{type:Array,required:!0},advanced:{type:Boolean,default:!1}},setup(e){const l=e,n=Dt(),s=bl(),u=B(()=>s.selectedFiles[l.inputParam.name]?s.selectedFiles[l.inputParam.name]:null),o=B(()=>{var c;return u.value?`${window.location.origin}/index.php/core/preview?fileId=${(c=u.value)==null?void 0:c.id}&mimeFallback=true&a=1`:""}),i=B(()=>u.value?u.value.source:"");me(u,a=>{a?(l.inputParamsMap[l.index][l.inputParam.name].value=a,l.inputParamsMap[l.index][l.inputParam.name].image_preview_url=i.value,l.inputParamsMap[l.index][l.inputParam.name].nc_file=!0):(l.inputParamsMap[l.index][l.inputParam.name].value=null,l.inputParamsMap[l.index][l.inputParam.name].image_preview_url="",l.inputParamsMap[l.index][l.inputParam.name].nc_file=!1)});const r=S(!1),f=S(null),_=S(""),h=S({width:0,height:0}),y=S(""),M=S({}),z=S(null),C=l.inputParamsMap[l.index][l.inputParam.name].source_input_name??"",F=l.inputParamsMap.findIndex(a=>{if(Object.keys(a)[0]===l.inputParamsMap[l.index][l.inputParam.name].source_input_name)return!0});function T(){try{const a=l.inputParamsMap.find(c=>{const j=Object.keys(c)[0];if(j===C)return c[j]});U(a[C].value)}catch{h.value.width=0,h.value.height=0}}ge(()=>{l.inputParam.type==="range_scale"&&T(),l.inputParam.type==="image-mask"&&me(y,a=>{const c=new File([y.value],`image-mask-${l.inputParam.name}.png`,{type:"image/png"});l.inputParamsMap[l.index][l.inputParam.name].value=c,l.inputParamsMap[l.index][l.inputParam.name].mask_applied=a!==""})}),l.inputParam.type==="range_scale"&&me(l.inputParamsMap,()=>{T()});function P(a){return a?URL.createObjectURL(a):""}function m(){URL.revokeObjectURL(_.value),_.value="",f.value&&(f.value.$refs.input.value=""),l.inputParamsMap[l.index][l.inputParam.name].value=null,l.inputParamsMap[l.index][l.inputParam.name].image_preview_url=""}function g(){URL.revokeObjectURL(y.value),y.value="",M.value={},l.inputParamsMap[l.index][l.inputParam.name].value=null,l.inputParamsMap[l.index][l.inputParam.name].mask_applied=!1}const b=B(()=>l.inputParam.type!=="bool"?l.inputParam.display_name:"");function U(a){if(!(a instanceof File)){h.value.width=0,h.value.height=0;return}const c=URL.createObjectURL(a),j=new Image;j.onload=function(){h.value.width=j.naturalWidth,h.value.height=j.naturalHeight,URL.revokeObjectURL(j.src)},j.src=c}const $=B(()=>{if(l.inputParam.type==="range_scale"){const a=l.inputParamsMap[l.index][l.inputParam.name].value;return`value: ${a}x (${h.value.width}x${h.value.height} -> ${(h.value.width*a).toFixed(0)}x${(h.value.height*a).toFixed(0)})`}return["range","range_scale"].includes(l.inputParam.type)?`value: ${l.inputParamsMap[l.index][l.inputParam.name].value}`:""}),v=S(null);function q(a){const c=al(a);c&&(l.inputParamsMap[l.index][l.inputParam.name].value=c)}return ge(()=>{l.inputParam.type==="text"&&v.value&&v.value.$refs.textarea.addEventListener("keydown",q),l.inputParam.type==="image-mask"&&(z.value=l.inputParamsMap[F][C],me(l.inputParamsMap[F][C],a=>{y.value="",M.value={},z.value=a}))}),Pt(()=>{URL.revokeObjectURL(_.value),URL.revokeObjectURL(y.value),s.removeSelectedFile(l.inputParam.name),l.inputParam.type==="text"&&v.value&&v.value.$refs.textarea.removeEventListener("keydown",q)}),(a,c)=>{var L,x;const j=re,H=Ge,ee=Mt,ae=Ut,se=Te,ue=Ul,te=Ue,J=Pn,ke=Fe,xe=tt,de=Je,_e=zt,we=Oe;return(((L=e.inputParam)==null?void 0:L.advanced)||!1)===e.advanced?(d(),I(we,{key:0,class:le(["mb-3",{italic:(x=e.inputParam)==null?void 0:x.dynamic_lora}]),help:t($)},{hint:w(()=>[e.inputParam.optional?R("",!0):(d(),O("span",Vn,"required"))]),label:w(()=>{var V;return[k("div",zn,[(V=e.inputParam)!=null&&V.dynamic_lora&&e.inputParam.trigger_words.length>0?(d(),I(ee,{key:0},{panel:w(()=>[k("div",Tn,[c[20]||(c[20]=k("h4",{class:"mb-2 text-center"},"Trigger words",-1)),(d(!0),O(Z,null,ce(e.inputParam.trigger_words,E=>(d(),I(H,{key:E,color:"violet",class:"mr-1 cursor-pointer",onClick:()=>{("useCopyToClipboard"in a?a.useCopyToClipboard:t(He))().copy(E),("useToast"in a?a.useToast:t(he))().add({title:"Clipboard",description:"Trigger word copied to clipboard",timeout:2e3})}},{default:w(()=>[D(G(E),1)]),_:2},1032,["onClick"]))),128))])]),default:w(()=>[p(j,{icon:"i-heroicons-information-circle",variant:"ghost",size:"xs",color:"gray",class:"mr-2"})]),_:1})):R("",!0),k("label",On,G(t(b)),1)])]}),default:w(()=>{var V,E,K,N,Q;return[e.inputParam.type==="text"?(d(),I(ae,{key:0,ref_key:"textareaInput",ref:v,size:"md",placeholder:e.inputParam.display_name,required:!e.inputParam.optional,resize:!0,label:e.inputParam.display_name,value:e.inputParamsMap[e.index][e.inputParam.name].value,autoresize:"",variant:"outline",onInput:c[0]||(c[0]=W=>{const ne=W.target;e.inputParamsMap[e.index][e.inputParam.name].value=ne.value})},null,8,["placeholder","required","label","value"])):R("",!0),e.inputParam.type==="number"?(d(),O(Z,{key:1},[e.inputParam.name==="seed"?(d(),O("div",jn,[e.inputParam.type==="number"?(d(),I(se,{key:0,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":c[1]||(c[1]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"])):R("",!0),p(j,{icon:"i-heroicons-arrow-path",color:"violet",variant:"outline",size:"xs",class:"ml-2",onClick:c[2]||(c[2]=()=>{e.inputParamsMap[e.index][e.inputParam.name].value=Math.floor(Math.random()*1e7)})})])):(d(),I(se,{key:1,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":c[3]||(c[3]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"]))],64)):R("",!0),e.inputParam.type==="image"?(d(),O("div",Nn,[p(se,{ref_key:"imageInput",ref:f,type:"file",accept:"image/*",class:"w-full",variant:"outline",color:"gray",disabled:t(u)!==null,label:e.inputParam.display_name,onChange:c[4]||(c[4]=W=>{console.debug("files",W);const ne=W==null?void 0:W[0];e.inputParamsMap[e.index][e.inputParam.name].value=ne,_.value=P(ne),e.inputParamsMap[e.index][e.inputParam.name].image_preview_url=t(_),t(u)!==null&&t(s).removeSelectedFile(e.inputParam.name),console.debug("inputParamsMap",e.inputParamsMap)})},null,8,["disabled","label"]),t(n).app.isNextcloudIntegration?(d(),I(ue,{key:0,class:"mx-2",orientation:"vertical",label:"OR"})):R("",!0),t(n).app.isNextcloudIntegration?(d(),I(j,{key:1,icon:"i-heroicons-cloud-arrow-down",variant:"outline",color:"blue",disabled:t(u)!==null||t(_)!=="",title:t(u)!==null?t(u).attributes.filename:"Choose from Nextcloud",onClick:c[5]||(c[5]=()=>{t(s).openNextcloudFilePicker(e.inputParam.name)})},{default:w(()=>c[21]||(c[21]=[D(" Choose from Nextcloud ")])),_:1},8,["disabled","title"])):R("",!0),t(o)!==""?(d(),O(Z,{key:2},[p(te,{src:t(o),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:c[6]||(c[6]=()=>{r.value=!0})},null,8,["src"]),p(j,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:c[7]||(c[7]=()=>{t(s).removeSelectedFile(e.inputParam.name),t(_)!==""&&m()})})],64)):t(_)!==""?(d(),O(Z,{key:3},[p(te,{src:t(y)?t(y):t(_),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:c[8]||(c[8]=()=>{r.value=!0})},null,8,["src"]),p(j,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:m})],64)):R("",!0)])):R("",!0),e.inputParam.type==="image-mask"?(d(),O("div",Bn,[t(z)?(d(),I(j,{key:0,icon:"i-heroicons-paint-brush-16-solid",class:"mr-2",color:"violet",variant:"outline",size:"xs",disabled:!((V=t(z))!=null&&V.value),onClick:c[9]||(c[9]=()=>{r.value=!0})},{default:w(()=>[k("span",Ln,G(t(y)!==""?"Edit mask":"Draw mask"),1)]),_:1},8,["disabled"])):R("",!0),k("div",An,[t(z)&&((E=t(z))!=null&&E.value)?(d(),I(te,{key:0,src:(K=t(z))==null?void 0:K.image_preview_url,class:le(["h-10 rounded-lg cursor-pointer",{absolute:t(y)!==""}]),onClick:c[10]||(c[10]=()=>{r.value=!0})},null,8,["src","class"])):R("",!0),t(y)?(d(),I(te,{key:1,src:t(y),class:"h-10 rounded-lg cursor-pointer opacity-50",onClick:c[11]||(c[11]=()=>{r.value=!0})},null,8,["src"])):R("",!0)]),!t(z)||t(z)&&!((N=t(z))!=null&&N.value)?(d(),O("span",qn," Select source image ")):R("",!0),t(y)?(d(),I(j,{key:2,icon:"i-heroicons-x-mark",variant:"outline",color:"violet",class:"ml-2",onClick:g})):R("",!0)])):R("",!0),e.inputParam.type==="image"||e.inputParam.type==="image-mask"?(d(),I(ke,{key:4,modelValue:t(r),"onUpdate:modelValue":c[16]||(c[16]=W=>X(r)?r.value=W:null),class:"z-[90] overflow-y-auto",transition:!1,fullscreen:""},{default:w(()=>{var W;return[p(j,{class:"absolute top-4 right-4 z-[100]",icon:"i-heroicons-x-mark",variant:"ghost",onClick:c[12]||(c[12]=()=>r.value=!1)}),e.inputParam.type==="image"?(d(),O("div",{key:0,class:"flex items-center justify-center w-full h-full p-4",onClick:c[13]||(c[13]=vt(()=>r.value=!1,["left"]))},[t(_)!==""?(d(),I(te,{key:0,class:"lg:h-full",fit:"contain",src:t(_)},null,8,["src"])):R("",!0),t(o)!==""?(d(),I(te,{key:1,class:"lg:h-full",fit:"inside",src:t(i)},null,8,["src"])):R("",!0)])):(d(),I(J,{key:1,ref:"imageInpaint","image-inpaint-mask":t(y),"onUpdate:imageInpaintMask":c[14]||(c[14]=ne=>X(y)?y.value=ne:null),"image-inpaint-mask-data":t(M),"onUpdate:imageInpaintMaskData":c[15]||(c[15]=ne=>X(M)?M.value=ne:null),class:"flex items-center justify-center w-full h-full p-4","image-src":(W=t(z))==null?void 0:W.image_preview_url},null,8,["image-inpaint-mask","image-inpaint-mask-data","image-src"]))]}),_:1},8,["modelValue"])):R("",!0),e.inputParam.type==="list"?(d(),I(xe,{key:5,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":c[17]||(c[17]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),placeholder:e.inputParam.display_name,options:Object.keys(e.inputParam.options)},null,8,["modelValue","placeholder","options"])):R("",!0),e.inputParam.type==="bool"?(d(),I(de,{key:6,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":c[18]||(c[18]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),label:(Q=e.inputParam)==null?void 0:Q.display_name},null,8,["modelValue","label"])):R("",!0),["range","range_scale"].includes(e.inputParam.type)?(d(),I(_e,{key:7,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":c[19]||(c[19]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),label:e.inputParam.display_name,size:"sm",min:e.inputParam.min,max:e.inputParam.max,step:e.inputParam.step},null,8,["modelValue","label","min","max","step"])):R("",!0)]}),_:1},8,["class","help"])):R("",!0)}}}),Dn={key:0,class:"heading"},Wn={key:1},Hn={key:0,class:"max-h-96 overflow-y-auto mt-5"},Gn={class:"heading"},Xn={key:0,class:"p-4"},Jn={key:0,class:"flex items-center w-full max-w-xs"},Kn=Y({__name:"InputParams",props:We({inputParamsMap:{type:Array,required:!0},additionalInputParamsMap:{type:Array,required:!1,default:[]},advanced:{type:Boolean,default:!1}},{profilingOptions:{default:{},type:Object},profilingOptionsModifiers:{},profilingEnabled:{default:!1,type:Boolean},profilingEnabledModifiers:{}}),emits:["update:profilingOptions","update:profilingEnabled"],setup(e){const l=e,n=ve(),s=Rt(),u=wl(),o=S(!l.advanced),i=Ne(e,"profilingOptions"),r=Ne(e,"profilingEnabled"),f=S(!0),_=B(()=>u.workers.map(h=>({value:h.worker_id,label:`${h.worker_id} (type: ${h.device_type}, vram_total: ${De(h.vram_total)})`})));return St(()=>{var y;if(!s.isAdmin)return;const h=localStorage.getItem(`profilingOptions_${(y=n.currentFlow)==null?void 0:y.name}`);h&&(i.value=JSON.parse(h)),u.fetchWorkersInfo().then(()=>{u.workers.find(z=>{var C;return z.worker_id===((C=i.value["X-WORKER-ID"])==null?void 0:C.value)})||(i.value["X-WORKER-ID"]=null)})}),(h,y)=>{const M=be,z=En,C=Je,F=tt,T=re,P=Te,m=Oe;return d(),O(Z,null,[e.advanced?(d(),O("div",Dn,[k("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:y[0]||(y[0]=()=>{o.value=!t(o)})},[p(M,{name:t(o)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",class:"mr-2"},null,8,["name"]),y[3]||(y[3]=D(" Advanced options "))])])):R("",!0),t(o)?(d(),O("div",Wn,[(d(!0),O(Z,null,ce(t(n).currentFlow.input_params,(g,b)=>(d(),I(z,{key:b,"input-params-map":e.inputParamsMap,index:b,"input-param":g,advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),(d(!0),O(Z,null,ce(e.additionalInputParamsMap,(g,b)=>(d(),I(z,{key:Object.keys(g)[0],"input-params-map":e.additionalInputParamsMap,index:b,"input-param":g[Object.keys(g)[0]],advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),t(s).isAdmin&&e.advanced?(d(),O("div",Hn,[k("div",Gn,[k("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:y[1]||(y[1]=()=>{f.value=!t(f)})},[p(M,{name:t(f)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),p(M,{name:"i-mdi-bug-outline",class:"mr-2"}),y[4]||(y[4]=D(" Execution settings "))])]),t(f)?R("",!0):(d(),O("div",Xn,[p(C,{modelValue:r.value,"onUpdate:modelValue":y[2]||(y[2]=g=>r.value=g),label:"Enable Execution settings",class:"mb-3"},null,8,["modelValue"]),(d(!0),O(Z,null,ce(Object.keys(i.value),g=>(d(),I(m,{key:g,label:g},{default:w(()=>[g==="X-WORKER-ID"?(d(),O("div",Jn,[p(F,{modelValue:i.value[g],"onUpdate:modelValue":b=>i.value[g]=b,options:t(_),placeholder:"Select worker",class:"w-full my-3"},null,8,["modelValue","onUpdate:modelValue","options"]),p(T,{icon:"i-heroicons-x-mark",variant:"outline",size:"sm",color:"orange",class:"ml-2",onClick:()=>i.value[g]=null},null,8,["onClick"]),p(T,{icon:"i-heroicons-arrow-path-solid",variant:"outline",size:"sm",color:"blue",class:"ml-2",onClick:()=>{t(u).fetchWorkersInfo().then(()=>{i.value[g]=t(_).find(b=>{var U;return b.value===((U=i.value[g])==null?void 0:U.value)})})}},null,8,["onClick"])])):(d(),I(P,{key:1,modelValue:i.value[g],"onUpdate:modelValue":b=>i.value[g]=b,placeholder:"Enter value",class:"my-3"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))]))])):R("",!0)])):R("",!0)],64)}}}),Qn={key:0,id:"prompt",class:"w-full my-10 lg:my-0 p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg"},Yn={class:"action flex items-center justify-end"},Zn=Y({__name:"Prompt",setup(e,{expose:l}){var U,$,v,q;const n=ve(),s=Rt();let u=localStorage.getItem(`input_params_map_${(U=n.currentFlow)==null?void 0:U.name}`);if(u){const a=JSON.parse(u);"flow_version"in a&&a.flow_version.split(".")[0]===(($=n.currentFlow)==null?void 0:$.version.split(".")[0])?u=a:(u=null,localStorage.removeItem(`input_params_map_${(v=n.currentFlow)==null?void 0:v.name}`))}const o=S(((q=n.currentFlow)==null?void 0:q.input_params.map(a=>{var c;if(a.type==="text")return{[a.name]:{value:u!==null&&u[a.name]?u[a.name]:a.default||"",type:a.type,optional:a.optional,advanced:a.advanced||!1,default:a.default||"",translatable:a.translatable||!1,dynamic_lora:a.dynamic_lora||!1,trigger_words:a.trigger_words||[]}};if(a.type==="number")return{[a.name]:{value:u!==null&&u[a.name]?u[a.name]:a.default||0,type:a.type,optional:a.optional,advanced:a.advanced||!1,default:a.default||0,dynamic_lora:a.dynamic_lora||!1,trigger_words:a.trigger_words||[]}};if(a.type==="image")return{[a.name]:{value:null,type:a.type,optional:a.optional,advanced:a.advanced||!1,dynamic_lora:a.dynamic_lora||!1,trigger_words:a.trigger_words||[]}};if(a.type==="image-mask")return{[a.name]:{value:null,type:a.type,optional:a.optional,advanced:a.advanced||!1,source_input_name:a.source_input_name||null,dynamic_lora:a.dynamic_lora||!1,trigger_words:a.trigger_words||[]}};if(a.type==="list")return{[a.name]:{value:u!==null&&u[a.name]?u[a.name]:a.default||Object.keys(a.options)[0]||"",type:a.type,optional:a.optional,options:a.options,advanced:a.advanced||!1,default:Object.keys(a.options)[0]||"",dynamic_lora:a.dynamic_lora||!1,trigger_words:a.trigger_words||[]}};if(a.type==="bool")return{[a.name]:{value:u!==null&&u[a.name]?u[a.name]:a.default||!1,type:a.type,optional:a.optional,advanced:a.advanced||!1,default:a.default||!1,dynamic_lora:a.dynamic_lora||!1,trigger_words:a.trigger_words||[]}};if(["range","range_scale"].includes(a.type)){const j={value:u!==null&&u[a.name]?u[a.name]:a.default||0,type:a.type,optional:a.optional,advanced:a.advanced||!1,min:a.min||0,max:a.max||100,step:a.step||1,default:a.default||0,dynamic_lora:a.dynamic_lora||!1,trigger_words:a.trigger_words||[]};if(a.type==="range_scale"&&(j.source_input_name=a.source_input_name||null,j.source_input_name===null||j.source_input_name==="")){const H=(c=n.currentFlow)==null?void 0:c.input_params.find(ee=>ee.type==="image"&&!ee.optional);H&&(j.source_input_name=H.name)}return{[a.name]:j}}}))||[]),i=S([]);n.currentFlow.is_seed_supported&&i.value.push({seed:{name:"seed",display_name:"Random seed",value:Math.floor(Math.random()*1e7),type:"number",optional:!0,advanced:!0,min:0,max:1e7}});const r=Wt(),f=S(n.currentFlow.is_translations_supported&&r.settingsMap.translations_provider.value.trim()!==""),_=S(n.currentFlow.is_surprise_me_supported&&r.settingsMap.llm_provider.value.trim()!==""),h=S(f.value);St(()=>{const a=localStorage.getItem("translatePrompt");a&&(h.value=JSON.parse(a))}),me(h,a=>{localStorage.setItem("translatePrompt",JSON.stringify(a))});function y(a){console.debug("Copy prompt inputs",a),Object.keys(a).forEach(j=>{const H=o.value.findIndex(ee=>Object.keys(ee)[0]===j);H!==-1&&(o.value[H][j].value=a[j].value)});const c=document.getElementById("prompt");c&&c.scrollIntoView({behavior:"smooth"})}l({copyPromptInputs:y}),o.value.forEach(a=>{const c=Object.keys(a)[0];["image","image-mask"].includes(a[c].type)||me(()=>a[c].value,()=>{var H,ee;const j={};o.value.forEach(ae=>{const se=Object.keys(ae)[0];j[se]=ae[se].value}),localStorage.setItem(`input_params_map_${(H=n.currentFlow)==null?void 0:H.name}`,JSON.stringify({...j,flow_version:(ee=n.currentFlow)==null?void 0:ee.version}))})});const M=B(()=>o.value.filter(a=>{const c=Object.keys(a)[0];return!["image","image-mask"].includes(a[c].type)}).some(a=>{const c=Object.keys(a)[0];return a[c].value!==a[c].default}));function z(){o.value.forEach(a=>{const c=Object.keys(a)[0];a[c].type==="text"?a[c].value=a[c].default||"":a[c].type==="number"?a[c].value=a[c].default||a[c].min||0:a[c].type==="list"?a[c].value=Object.keys(a[c].options)[0]||"":a[c].type==="bool"?a[c].value=a[c].default||!1:["range","range_scale"].includes(a[c].type)&&(a[c].value=a[c].default||a[c].min||0)})}const C=S(!1),F=S(1),T=S(!1),P=B(()=>o.value.every(a=>{var H,ee,ae,se;const c=Object.keys(a)[0];if(a[c].optional)return!0;const j=a[c].value;if(a[c].type==="text")return j!=="";if(a[c].type==="number")return j>=a[c].min&&j<=a[c].max;if(a[c].type==="list")return j!==""&&Object.keys(a[c].options).includes(j);if(a[c].type==="bool")return!0;if(a[c].type==="range")return j>=a[c].min&&j<=a[c].max;if(a[c].type==="range_scale")return j>=a[c].min&&j<=a[c].max;if(a[c].type==="image")return(H=a[c])!=null&&H.nc_file?!0:j instanceof File&&j.size>0;if(a[c].type==="image-mask")return(ee=a[c])!=null&&ee.nc_file?((ae=a[c])==null?void 0:ae.mask_applied)||!1:j instanceof File&&j.size>0&&(((se=a[c])==null?void 0:se.mask_applied)||!1)})),m=S({"X-WORKER-UNLOAD-MODELS":1,"X-WORKER-EXECUTION-PROFILER":1,"X-WORKER-ID":null}),g=S(!1);me(()=>m.value,()=>{var a;s.isAdmin&&localStorage.setItem(`profilingOptions_${(a=n.currentFlow)==null?void 0:a.name}`,JSON.stringify(m.value))},{deep:!0});function b(a=!1){C.value=!0;let c={};s.isAdmin&&g&&(c=Object.fromEntries(Object.entries(m).filter(([j,H])=>H!==null).map(([j,H])=>j==="X-WORKER-ID"?[j,H==null?void 0:H.value]:[j,H]))),n.runFlow(n.currentFlow,[...o.value,...i.value],F.value,f.value&&h.value,!1,null,a,c).finally(()=>{C.value=!1;const j=i.value.find(H=>Object.keys(H)[0]==="seed");j.seed.value=Number(j.seed.value)+F.value+1})}return(a,c)=>{const j=be,H=Kn,ee=Te,ae=Oe,se=Je,ue=re,te=Xe;return t(n).currentFlow?(d(),O("div",Qn,[k("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:c[0]||(c[0]=()=>{T.value=!t(T)})},[p(j,{name:t(T)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),c[11]||(c[11]=D(" Prompt "))]),Ct(k("div",null,[p(H,{"input-params-map":t(o),"onUpdate:inputParamsMap":c[1]||(c[1]=J=>X(o)?o.value=J:null),"additional-input-params-map":t(i),"onUpdate:additionalInputParamsMap":c[2]||(c[2]=J=>X(i)?i.value=J:null),advanced:!1},null,8,["input-params-map","additional-input-params-map"]),t(i).length>0?(d(),I(H,{key:0,"input-params-map":t(o),"onUpdate:inputParamsMap":c[3]||(c[3]=J=>X(o)?o.value=J:null),"additional-input-params-map":t(i),"onUpdate:additionalInputParamsMap":c[4]||(c[4]=J=>X(i)?i.value=J:null),"profiling-options":t(m),"onUpdate:profilingOptions":c[5]||(c[5]=J=>X(m)?m.value=J:null),"profiling-enabled":t(g),"onUpdate:profilingEnabled":c[6]||(c[6]=J=>X(g)?g.value=J:null),advanced:!0},null,8,["input-params-map","additional-input-params-map","profiling-options","profiling-enabled"])):R("",!0),t(n).currentFlow.is_count_supported?(d(),I(ae,{key:1,label:"Number of results"},{default:w(()=>[p(ee,{modelValue:t(F),"onUpdate:modelValue":c[7]||(c[7]=J=>X(F)?F.value=J:null),type:"number",min:"1",max:"50",label:"Batch size",class:"mb-3 max-w-fit flex justify-end"},null,8,["modelValue"])]),_:1})):R("",!0),t(f)?(d(),I(ae,{key:2,class:"my-3 flex justify-end"},{default:w(()=>[p(se,{modelValue:t(h),"onUpdate:modelValue":c[8]||(c[8]=J=>X(h)?h.value=J:null),label:"Translate prompt"},null,8,["modelValue"])]),_:1})):R("",!0),k("div",{class:le(["flex flex-col md:flex-row",{"justify-between":t(M),"justify-end":!t(M)}])},[t(M)?(d(),I(te,{key:0,text:"Reset input params values to defaults"},{default:w(()=>[p(ue,{icon:"i-heroicons-arrow-path-rounded-square",variant:"ghost",color:"amber",onClick:z},{default:w(()=>c[12]||(c[12]=[D(" Reset params ")])),_:1})]),_:1})):R("",!0),k("div",Yn,[t(_)?(d(),I(te,{key:0,text:"Randomize prompt based on your input"},{default:w(()=>[p(ue,{class:"mr-2",icon:"i-heroicons-gift",variant:"soft",color:"blue",loading:t(C),onClick:c[9]||(c[9]=()=>b(!0))},{default:w(()=>c[13]||(c[13]=[D(" Surprise me ")])),_:1},8,["loading"])]),_:1})):R("",!0),p(ue,{icon:"i-heroicons-sparkles-16-solid",variant:"outline",loading:t(C),disabled:!t(P),onClick:c[10]||(c[10]=()=>b(!1))},{default:w(()=>c[14]||(c[14]=[D(" Run prompt ")])),_:1},8,["loading","disabled"])])],2)],512),[[Ht,!t(T)]])])):R("",!0)}}}),ea=e=>{const l=S(0);function n(o){e.value.style.scrollSnapType="none",e.value.style.scrollBehavior="auto",l.value=o.pageX,window.addEventListener("mousemove",u),window.addEventListener("mouseup",s)}function s(){e.value.style.removeProperty("scroll-behavior"),e.value.style.removeProperty("scroll-snap-type"),e.value.style.removeProperty("pointer-events"),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",s)}function u(o){o.preventDefault(),e.value.style.pointerEvents="none";const i=o.pageX-l.value;l.value=o.pageX,e.value.scrollBy(-i,0)}ge(()=>{e.value&&e.value.addEventListener("mousedown",n)}),Ze(()=>{e.value&&e.value.removeEventListener("mousedown",n)})},bt=mt(Me.ui.strategy,Me.ui.carousel,Ol),ta=Y({components:{UButton:re},inheritAttrs:!1,props:{items:{type:Array,default:()=>[]},arrows:{type:Boolean,default:!1},indicators:{type:Boolean,default:!1},dir:{type:String,default:"ltr"},prevButton:{type:Object,default:()=>bt.default.prevButton},nextButton:{type:Object,default:()=>bt.default.nextButton},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:void 0}},setup(e,{expose:l}){const{ui:n,attrs:s}=pt("carousel",je(e,"ui"),bt,je(e,"class")),u=S(),o=S(0),{x:i}=kl(u,{behavior:"smooth"}),{width:r}=xl(u);ea(u),Gt(u,T=>{var m,g;const[P]=T;o.value=((g=(m=P==null?void 0:P.target)==null?void 0:m.firstElementChild)==null?void 0:g.clientWidth)||0});const f=B(()=>e.dir==="rtl"),_=B(()=>o.value?f.value?Math.round(-i.value/o.value)+1:Math.round(i.value/o.value)+1:0),h=B(()=>{if(!o.value)return 0;const T=Math.round(r.value/o.value);return e.items.length<=T?0:e.items.length-T+1}),y=B(()=>_.value<=1),M=B(()=>_.value===h.value);function z(){i.value+=f.value?-o.value:o.value}function C(){i.value-=f.value?-o.value:o.value}function F(T){i.value=(T-1)*o.value*(f.value?-1:1)}return l({pages:h,page:_,prev:C,next:z,select:F}),{ui:n,attrs:s,isFirst:y,isLast:M,carouselRef:u,pages:h,currentPage:_,onClickNext:z,onClickPrev:C,onClick:F,twMerge:ct}}}),la=["dir"],na=["role"],aa=["aria-selected","aria-label","onClick"];function oa(e,l,n,s,u,o){const i=re;return d(),O("div",ze({class:e.ui.wrapper},e.attrs,{dir:e.dir}),[k("div",{ref:"carouselRef",class:le([e.ui.container,"no-scrollbar"])},[(d(!0),O(Z,null,ce(e.items,(r,f)=>(d(),O("div",{key:f,class:le(e.ui.item),role:e.indicators?"tabpanel":null},[Re(e.$slots,"default",{item:r,index:f},void 0,!0)],10,na))),128))],2),e.arrows?(d(),O("div",{key:0,class:le(e.ui.arrows.wrapper)},[Re(e.$slots,"prev",{onClick:e.onClickPrev,disabled:e.isFirst},()=>{var r;return[e.prevButton?(d(),I(i,ze({key:0,disabled:e.isFirst},{...e.ui.default.prevButton,...e.prevButton},{class:e.twMerge(e.ui.default.prevButton.class,(r=e.prevButton)==null?void 0:r.class),"aria-label":"Prev",onClick:e.onClickPrev}),null,16,["disabled","class","onClick"])):R("",!0)]},!0),Re(e.$slots,"next",{onClick:e.onClickNext,disabled:e.isLast},()=>{var r;return[e.nextButton?(d(),I(i,ze({key:0,disabled:e.isLast},{...e.ui.default.nextButton,...e.nextButton},{class:e.twMerge(e.ui.default.nextButton.class,(r=e.nextButton)==null?void 0:r.class),"aria-label":"Next",onClick:e.onClickNext}),null,16,["disabled","class","onClick"])):R("",!0)]},!0)],2)):R("",!0),e.indicators?(d(),O("div",{key:1,role:"tablist",class:le(e.ui.indicators.wrapper)},[(d(!0),O(Z,null,ce(e.pages,r=>Re(e.$slots,"indicator",{key:r,onClick:e.onClick,active:r===e.currentPage,page:r},()=>[k("button",{type:"button",role:"tab","aria-selected":r===e.currentPage,class:le([e.ui.indicators.base,r===e.currentPage?e.ui.indicators.active:e.ui.indicators.inactive]),"aria-label":`set slide ${r}`,onClick:f=>e.onClick(r)},null,10,aa)],!0)),128))],2)):R("",!0)],16,la)}const Be=ft(ta,[["render",oa],["__scopeId","data-v-a3da86ff"]]),sa={class:"flex flex-col basis-full"},ia=Y({__name:"InputFiles",props:{running:{type:Object,required:!0}},setup(e){const l=Vt(),n=function(r,f){return`${Xt()}/tasks/inputs?task_id=${r}&input_index=${f}`},s=S(!1),u=S(""),o=S(0),i=S(!0);return(r,f)=>{var C,F,T,P,m;const _=be,h=Ue,y=Be,M=re,z=Fe;return e.running&&e.running.input_files&&((C=Object.keys(e.running.input_files))==null?void 0:C.length)>0?(d(),O("div",{key:0,class:le(["ml-2 mt-2 mb-5",{"mb-10":((F=Object.keys(e.running.input_files))==null?void 0:F.length)>1&&!t(i)}])},[k("h4",{class:"mb-3 font-bold cursor-pointer select-none flex items-center text-sm",onClick:f[0]||(f[0]=()=>i.value=!t(i))},[p(_,{name:t(i)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),k("span",null," Input files ("+G((T=Object.keys(e.running.input_files))==null?void 0:T.length)+") ",1)]),t(i)?R("",!0):(d(),O(Z,{key:0},[((P=Object.keys(e.running.input_files))==null?void 0:P.length)===1?(d(),I(h,{key:0,class:"mb-5 rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(l)(`${("buildBackendUrl"in r?r.buildBackendUrl:t(xt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:n(e.running.task_id,0),onClick:f[1]||(f[1]=()=>{u.value=n(e.running.task_id,0),o.value=0,s.value=!0})},null,8,["placeholder","src"])):R("",!0),((m=Object.keys(e.running.input_files))==null?void 0:m.length)>1?(d(),I(y,{key:1,items:Object.keys(e.running.input_files).map(g=>({task_id:e.running.task_id,index:g})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:""},{default:w(({item:g})=>[k("div",sa,[p(h,{class:"rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(l)(`${("buildBackendUrl"in r?r.buildBackendUrl:t(xt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:n(g.task_id,g.index),onClick:()=>{u.value=n(e.running.task_id,g.index),o.value=g.index,s.value=!0}},null,8,["placeholder","src","onClick"])])]),_:1},8,["items"])):R("",!0),p(z,{modelValue:t(s),"onUpdate:modelValue":f[4]||(f[4]=g=>X(s)?s.value=g:null),class:"z-[90]",transition:!1,fullscreen:""},{default:w(()=>[p(M,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:f[2]||(f[2]=()=>s.value=!1)}),k("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:f[3]||(f[3]=vt(()=>s.value=!1,["left"]))},[t(u)?(d(),I(h,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(u)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])],64))],2)):R("",!0)}}}),ra=Y({__name:"ErrorAlert",props:{running:{type:Object,required:!0}},setup(e){const l=ve(),n=S(!1);return(s,u)=>{const o=yt;return d(),I(o,{class:"mb-5",icon:"i-heroicons-exclamation-circle-16-solid",color:"red",variant:"soft",title:"Task failed",description:e.running.error,actions:[{variant:"outline",color:"yellow",label:"Restart",loading:t(n),icon:"i-heroicons-arrow-path",click:()=>{n.value=!0,t(l).restartFlow(e.running).finally(()=>{n.value=!1})}}]},null,8,["description","actions"])}}}),ua={class:"mb-5"},da={class:"text-sm mb-5 text-slate-500"},ca={class:"flex justify-between"},ma=Y({__name:"Item",props:{running:{type:Object,required:!0}},setup(e){const l=ve(),n=S(!1),s=S(!1);function u(o){return[[{label:"Comfy flow",labelClass:"text-blue-500",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500",click:()=>{var i;return l.downloadFlowComfy((i=l.currentFlow)==null?void 0:i.name,o.task_id)}}],[{label:`Raise priority ${o.priority>0?`(${o.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-up",iconClass:"bg-gray-500",disabled:o.priority===15||o.progress>0,click:()=>{s.value=!0,l.raiseQueuePriority(o).finally(()=>{s.value=!1})}},{label:`Lower priority ${o.priority>0?`(${o.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-down",iconClass:"bg-gray-500",disabled:o.priority===0||o.progress>0,click:()=>{s.value=!0,l.lowerQueuePriority(o).finally(()=>{s.value=!1})}},{label:`Reset priority ${o.priority>0?`(${o.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-path-rounded-square-solid",iconClass:"bg-gray-500",disabled:o.priority===0||o.progress>0,click:()=>{s.value=!0,l.resetQueuePriority(o).finally(()=>{s.value=!1})}}]]}return(o,i)=>{var M,z;const r=el,f=ia,_=ra,h=re,y=gt;return d(),O("div",ua,[p(r,{class:"mb-3",value:(M=e.running)==null?void 0:M.progress,indicator:"",color:e.running.error?"red":"green"},null,8,["value","color"]),k("p",da,G([`${(z=e.running)!=null&&z.priority&&e.running.priority>0?"["+e.running.priority+"] ":""}#${e.running.task_id}`,...Object.keys(e.running.input_params_mapped).filter(C=>e.running.input_params_mapped[C].value&&e.running.input_params_mapped[C].value!=="").map(C=>`${e.running.input_params_mapped[C].display_name}: ${e.running.input_params_mapped[C].value}`)].join(" | ")+`${e.running.execution_time?" | execution_time: "+e.running.execution_time.toFixed(2)+"s":""}`),1),p(f,{running:e.running},null,8,["running"]),e.running.error?(d(),I(_,{key:0,running:e.running},null,8,["running"])):R("",!0),k("div",ca,[p(h,{icon:e.running.progress>=0&&e.running.progress<100?"i-heroicons-stop":"i-heroicons-minus-circle",color:e.running.error?"red":"orange",variant:"outline",loading:t(n),onClick:i[0]||(i[0]=()=>{n.value=!0,t(l).cancelRunningFlow(e.running).finally(()=>{n.value=!1})})},{default:w(()=>[D(G(e.running.progress>=0&&e.running.progress<100?"Cancel":"Remove"),1)]),_:1},8,["icon","color","loading"]),p(y,{items:u(e.running),mode:"click",popper:{placement:"bottom-end"}},{default:w(()=>[p(h,{color:"blue",variant:"outline",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])])])}}}),fa={class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md mt-5 mb-10"},pa={class:"flex items-center justify-between mb-2"},va={key:0},ga={key:1,class:"text-red-400"},ya=Y({__name:"Queue",setup(e){const l=ve(),n=S(!0),s=S(!1);return(u,o)=>{var _,h,y,M,z,C,F,T,P;const i=be,r=re,f=ma;return d(),O("div",fa,[k("div",pa,[k("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center",onClick:o[0]||(o[0]=()=>{n.value=!t(n)})},[p(i,{name:t(n)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),k("span",null," Queue ("+G(t(l).flowsRunningByName((_=t(l).currentFlow)==null?void 0:_.name).length)+") ",1),t(l).flowsRunningByName((h=t(l).currentFlow)==null?void 0:h.name).length>0?(d(),O("span",va," - "+G(`${((M=t(l).flowsRunningByName((y=t(l).currentFlow)==null?void 0:y.name).filter(m=>m.progress>0)[0])==null?void 0:M.progress.toFixed(0))??0}%`),1)):R("",!0),t(l).flowsRunningByNameWithErrors((z=t(l))==null?void 0:z.currentFlow.name).length>0?(d(),O("span",ga," ("+G(t(l).flowsRunningByNameWithErrors((C=t(l).currentFlow)==null?void 0:C.name).length)+") ",1)):R("",!0)]),(F=t(l).currentFlow)!=null&&F.name&&t(l).flowsRunningByName((T=t(l).currentFlow)==null?void 0:T.name).length>0?(d(),I(r,{key:0,icon:"i-heroicons-stop",color:"orange",variant:"outline",loading:t(s),onClick:o[1]||(o[1]=()=>{var m;s.value=!0,t(l).cancelRunningFlows((m=t(l).currentFlow)==null?void 0:m.name).finally(()=>{s.value=!1})})},{default:w(()=>o[2]||(o[2]=[D(" Cancel all ")])),_:1},8,["loading"])):R("",!0)]),t(n)?R("",!0):(d(!0),O(Z,{key:0},ce(t(l).flowsRunningByName((P=t(l).currentFlow)==null?void 0:P.name),m=>(d(),I(f,{key:m.task_id,running:m},null,8,["running"]))),128))])}}}),ha=Y({__name:"ScrollToTop",props:{show:{type:Boolean,required:!0},target:{type:String,required:!0}},setup(e){const l=e;function n(){const s=document.getElementById(l.target);s&&s.scrollIntoView({behavior:"smooth"})}return(s,u)=>{const o=re;return e.show?(d(),I(o,{key:0,icon:"i-heroicons-arrow-small-up",color:"black",variant:"outline",onClick:n})):R("",!0)}}}),ba={class:"flex flex-col items-center mb-2 max-w-fit mx-auto z-0"},wa={class:"text-slate-500 text-center text-sm w-full mx-auto flex flex-wrap items-center justify-center md:justify-between"},ka={class:"toggles py-2"},xa={class:"mr-2 inline-flex items-center text-sm"},_a=["for"],$a={class:"mr-2 inline-flex items-center text-sm"},Ca=["for"],Ia={key:0,class:"flex items-center"},Sa=["title"],Pa=Y({__name:"Child",props:{flowResult:{type:Object,required:!0},outputsIndex:{type:Number,required:!1,default:()=>0},openImageModal:{type:Function,required:!0}},setup(e){const l=e,n=ve(),s=(m,g=null,b=!1)=>{if(m.child_tasks.length===0)return m;const U=m.child_tasks.findIndex($=>$.parent_task_node_id===g);return U!==-1?(b||(o.value=m),s(m.child_tasks[U],m.child_tasks[U].outputs[0].comfy_node_id,b)):m};function u(m,g,b=null){if(b!==null&&m.parent_task_node_id===b||Number(m.task_id)===g)return m;for(let U=0;U<m.child_tasks.length;U++)for(let $=0;$<m.child_tasks[U].outputs.length;$++){const v=u(m.child_tasks[U],g,m.child_tasks[U].outputs[$].comfy_node_id);if(v!==null)return v}return null}const o=S(l.flowResult),i=S(s(l.flowResult,l.flowResult.outputs[l.outputsIndex].comfy_node_id,!1));function r(m){var g;return[[{label:`${(g=n.flowByName((m==null?void 0:m.flow_name)??(m==null?void 0:m.name)))==null?void 0:g.display_name}#${m.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",click:()=>{l.openImageModal(fe({task_id:m.task_id,node_id:m.outputs.length>1?m.outputs[l.outputsIndex].comfy_node_id:m.outputs[0].comfy_node_id}))}}]]}function f(m){var b;const g=[[{label:`${(b=n.flowByName((m==null?void 0:m.flow_name)??(m==null?void 0:m.name)))==null?void 0:b.display_name}#${m.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",disabled:m.progress<100||m.error!=="",click:()=>{l.openImageModal(fe({task_id:m.task_id,node_id:m.outputs.length>1?m.outputs[l.outputsIndex].comfy_node_id:m.outputs[0].comfy_node_id}))}},{label:m.progress<100?"Cancel":"Delete",labelClass:m.progress<100?"text-orange-500":"text-red-500",icon:m.progress<100?"i-heroicons-stop":"i-heroicons-trash",iconClass:m.progress<100?"bg-orange-500":"bg-red-500",click:()=>{n.deleteFlowHistory(m.task_id).then(()=>{const U=u(l.flowResult,m.parent_task_id,m.parent_task_node_id);U&&(U.child_tasks=U.child_tasks.filter($=>Number($.task_id)!==Number(m.task_id))),C(!1,l.flowResult)})}}]];return m.progress<100&&(g[0][1]={label:`Progress: ${Math.ceil(m.progress)}% (${m.execution_time.toFixed(2)}s)`,labelClass:"text-blue-500",disabled:!0}),m.error!==""&&g[0].push({label:`Error: ${m.error}`,labelClass:"text-red-500",slot:"error",click:()=>{He().copy(m.error),he().add({title:"Clipboard",description:`Task #${m.task_id} error copied to clipboard`,timeout:2e3})}}),g}function _(){const m=o.value.parent_task_id;if(!m)return;const g=u(l.flowResult,m,o.value.parent_task_node_id);g&&(o.value=g)}function h(){if(o.value.child_tasks.length===0)return;const m=o.value.outputs.length>1?o.value.outputs[l.outputsIndex].comfy_node_id:o.value.outputs[0].comfy_node_id,g=o.value.child_tasks.find(b=>b.parent_task_node_id===m);g&&(o.value=g)}const y=B(()=>{if(o.value.child_tasks.length===0)return;const m=o.value.outputs.length>1?o.value.outputs[l.outputsIndex].comfy_node_id:o.value.outputs[0].comfy_node_id;return o.value.child_tasks.find(b=>b.parent_task_node_id===m).task_id!==i.value.task_id});function M(){const m=i.value.parent_task_id;if(!m)return;const g=u(l.flowResult,m,i.value.parent_task_node_id);g&&(i.value=g)}function z(){if(i.value.child_tasks.length===0)return;const m=Number(i.value.outputs[0].comfy_node_id),g=i.value.child_tasks.find(b=>Number(b.parent_task_node_id)===m);g&&(i.value=g)}function C(m=!1,g=null){m||(o.value=g),i.value=s(g,g==null?void 0:g.outputs[l.outputsIndex].comfy_node_id,m),F.value=!1}me(l.flowResult,m=>{C(!0,m)});const F=S(!1),T=S(!0),P=S(null);return me(F,m=>{m?(P.value=o.value,o.value=l.flowResult):P.value&&(o.value=P.value,i.value=Jt(P.value,l.outputsIndex,o.value.outputs.length>1?o.value.outputs[l.outputsIndex].comfy_node_id:o.value.outputs[0].comfy_node_id))}),(m,g)=>{const b=Ue,U=Se("ImgComparisonSlider"),$=Vl,v=re,q=gt,a=be,c=Xe;return d(),O("div",ba,[Ct(p(b,{class:"mb-2 rounded-lg cursor-pointer",height:t(n).outputMaxSize,width:t(n).outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(i).progress===100?t(i).task_id:e.flowResult.task_id,node_id:t(i).progress===100?t(i).outputs[0].comfy_node_id:e.flowResult.outputs[e.outputsIndex].comfy_node_id}),onClick:g[0]||(g[0]=j=>e.openImageModal(("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(i).task_id??e.flowResult.task_id,node_id:t(i).outputs[0].comfy_node_id??e.flowResult.outputs[e.outputsIndex].comfy_node_id})))},null,8,["height","width","src"]),[[Ht,!t(T)]]),t(T)?(d(),I(U,{key:0,class:"mb-2 mx-auto outline-none w-fit rounded-lg"},{default:w(()=>{var j,H,ee;return[p(b,{slot:"first",height:t(n).outputMaxSize,width:t(n).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(F)?e.flowResult.task_id:t(o).task_id,node_id:t(F)?e.flowResult.outputs[e.outputsIndex].comfy_node_id:t(o).parent_task_node_id!==null?(j=t(o))==null?void 0:j.outputs[0].comfy_node_id:((H=t(o))==null?void 0:H.outputs[e.outputsIndex].comfy_node_id)??((ee=t(o))==null?void 0:ee.outputs[0].comfy_node_id)})},null,8,["height","width","src"]),t(i)&&t(i).progress===100?(d(),I(b,{key:0,slot:"second",height:t(n).outputMaxSize,width:t(n).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(i).task_id,node_id:t(i).outputs[0].comfy_node_id})},null,8,["height","width","src"])):(d(),I(b,{key:1,slot:"second",height:t(n).outputMaxSize,width:t(n).outputMaxSize,fit:"cover",draggable:"false",src:`${("buildBackendUrl"in m?m.buildBackendUrl:t(xt))()}/vix_logo.png`},null,8,["height","width","src"]))]}),_:1})):R("",!0),k("div",wa,[k("div",ka,[k("div",xa,[p($,{id:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(T),"onUpdate:modelValue":g[1]||(g[1]=j=>X(T)?T.value=j:null),size:"xs",class:"mr-2"},null,8,["id","modelValue"]),k("label",{class:"cursor-pointer select-none",for:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`}," Comparison ",8,_a)]),k("div",$a,[p($,{id:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(F),"onUpdate:modelValue":g[2]||(g[2]=j=>X(F)?F.value=j:null),disabled:!t(T),size:"xs",class:"mr-2"},null,8,["id","modelValue","disabled"]),k("label",{class:"cursor-pointer select-none",for:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`}," Original ",8,Ca)])]),t(T)?(d(),O("div",Ia,[p(v,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(F)||t(o).parent_task_id===null,onClick:_},null,8,["disabled"]),p(q,{items:r(t(o)),mode:"click",popper:{placement:"top"}},{default:w(()=>[p(v,{variant:"link",color:"white",size:"xs"},{default:w(()=>[D(" #"+G(t(F)?e.flowResult.task_id:t(o).task_id),1)]),_:1})]),_:1},8,["items"]),p(v,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(F)||!t(y),onClick:h},null,8,["disabled"]),p(a,{class:"mx-3",name:"i-heroicons-arrows-right-left-16-solid"}),p(v,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:!u(l.flowResult,t(i).parent_task_id,t(i).parent_task_node_id)||t(i).parent_task_id===Number(t(o).task_id)||t(i).parent_task_id===null,onClick:M},null,8,["disabled"]),p(q,{items:f(t(i)),mode:"click",popper:{placement:"top"}},{error:w(({item:j})=>[k("div",{class:"text-red-500 truncate",title:j.label},G(j.label),9,Sa)]),default:w(()=>[p(v,{class:le({"text-blue-500":t(i).progress!==100&&t(i).error==="","text-red-500":t(i).error!==""}),variant:"link",color:"white",size:"xs"},{default:w(()=>[D(G(t(i).progress===100?"#"+t(i).task_id:Math.ceil(t(i).progress)+"%"),1)]),_:1},8,["class"])]),_:1},8,["items"]),p(v,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(i).child_tasks.length===0,onClick:z},null,8,["disabled"]),p(c,{class:"ml-3",text:"Reset comparison",popper:{placement:"top"}},{default:w(()=>[p(v,{icon:"i-heroicons-arrow-path-rounded-square-solid",size:"2xs",variant:"outline",color:"white",onClick:g[3]||(g[3]=()=>C(!1,e.flowResult))})]),_:1})])):R("",!0)])])}}}),Ma={class:"image-output"},Ra={class:"flex flex-col basis-full justify-between mx-2"},Fa=Y({__name:"Image",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const l=ve();return(n,s)=>{var f,_;const u=Pa,o=Ue,i=re,r=Be;return d(),O("div",Ma,[e.flowResult.outputs.length===1?(d(),O(Z,{key:0},[(f=e.flowResult)!=null&&f.child_tasks&&((_=e.flowResult)==null?void 0:_.child_tasks.length)>0?(d(),I(u,{key:0,"flow-result":e.flowResult,"open-image-modal":e.openImageModal},null,8,["flow-result","open-image-modal"])):e.flowResult.outputs.length===1?(d(),I(o,{key:1,class:"mb-2 mx-auto rounded-lg cursor-pointer",height:t(l).$state.outputMaxSize,width:t(l).$state.outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id}),onClick:s[0]||(s[0]=h=>e.openImageModal(("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})))},null,8,["height","width","src"])):R("",!0)],64)):e.flowResult.outputs.length>1?(d(),I(r,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((h,y)=>({task_id:e.flowResult.task_id,node_id:h.comfy_node_id,index:y})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:w(({item:h})=>{var y;return[k("div",Ra,[(y=e.flowResult)!=null&&y.child_tasks&&("hasChildTaskByParentTaskNodeId"in n?n.hasChildTaskByParentTaskNodeId:t(Kt))(e.flowResult,h.index,h.node_id)?(d(),I(u,{key:0,"flow-result":e.flowResult,"outputs-index":h.index,"open-image-modal":e.openImageModal},null,8,["flow-result","outputs-index","open-image-modal"])):(d(),I(o,{key:1,class:le(`mb-2 h-100 max-h-[${t(l).$state.outputMaxSize}px] mx-auto rounded-lg cursor-pointer`),draggable:"false",height:t(l).$state.outputMaxSize,width:t(l).$state.outputMaxSize,fit:"cover",loading:"lazy",src:("outputResultSrc"in n?n.outputResultSrc:t(fe))(h),onClick:M=>e.openImageModal(("outputResultSrc"in n?n.outputResultSrc:t(fe))(h))},null,8,["class","height","width","src","onClick"])),p(i,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,h.index)}},{default:w(()=>s[1]||(s[1]=[D(" Send to flow ")])),_:2},1032,["onClick"])])]}),_:1},8,["items"])):R("",!0)])}}}),Ua={class:"video-output"},Va=["width","height"],za=["src"],Ta={class:"flex flex-col basis-full justify-between mx-2"},Oa=["width","height"],ja=["src"],Na=Y({__name:"Video",props:{flowResult:{type:Object,required:!0}},setup(e){const l=ve();return(n,s)=>{const u=Be;return d(),O("div",Ua,[e.flowResult.outputs.length===1?(d(),O("video",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",style:{"max-height":"80vh"},width:t(l).$state.outputMaxSize,height:t(l).$state.outputMaxSize},[k("source",{src:("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,za)],8,Va)):e.flowResult.outputs.length>1?(d(),I(u,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((o,i)=>({task_id:e.flowResult.task_id,node_id:o.comfy_node_id,index:i})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:w(()=>[k("div",Ta,[k("video",{controls:"",class:"mb-2 mx-auto rounded-lg",width:t(l).$state.outputMaxSize,height:t(l).$state.outputMaxSize},[k("source",{src:("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,ja)],8,Oa)])]),_:1},8,["items"])):R("",!0)])}}}),Ba={class:"audio-output"},La=["src"],Aa={class:"flex flex-col basis-full justify-between mx-2"},qa=["src"],Ea=Y({__name:"Audio",props:{flowResult:{type:Object,required:!0}},setup(e){return(l,n)=>{const s=Be;return d(),O("div",Ba,[e.flowResult.outputs.length===1?(d(),O("audio",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in l?l.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,La)):e.flowResult.outputs.length>1?(d(),I(s,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((u,o)=>({task_id:e.flowResult.task_id,node_id:u.comfy_node_id,index:o})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:w(()=>[k("div",Aa,[k("audio",{controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in l?l.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,qa)])]),_:1},8,["items"])):R("",!0)])}}}),Da={class:"text-output"},Wa={key:0,class:"mb-2 mx-auto rounded-lg text-md p-4 pr-8 border border-slate-500 relative"},Ha=Y({__name:"Text",props:{flowResult:{type:Object,required:!0}},setup(e){const l=e,n=ve(),s=he(),u=S(!1),o=S({});function i(r,f){const{$apiFetch:_}=Ye(),h=fe({task_id:r.task_id,node_id:f.comfy_node_id});return _(h).then(y=>{o.value[f.comfy_node_id]=y}).catch(y=>{console.error(y)}).finally(()=>{u.value=!1})}return ge(()=>{Promise.all(l.flowResult.outputs.filter(r=>r.type==="text").map(r=>i(l.flowResult,r)))}),(r,f)=>{const _=re,h=Be;return d(),O("div",Da,[e.flowResult.outputs.length===1?(d(),O("div",Wa,[t(u)?R("",!0):(d(),I(_,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:f[0]||(f[0]=()=>{("useCopyToClipboard"in r?r.useCopyToClipboard:t(He))().copy(t(o)[e.flowResult.outputs[0].comfy_node_id]),t(s).add({title:"Clipboard",description:"Text copied to clipboard"})})})),k("p",null,G(t(u)?"Loading...":t(o)[e.flowResult.outputs[0].comfy_node_id]),1)])):e.flowResult.outputs.length>1?(d(),I(h,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((y,M)=>({task_id:e.flowResult.task_id,node_id:y.comfy_node_id,index:M})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:"",arrows:""},{default:w(({item:y})=>[k("div",{class:"mb-2 mx-2 rounded-lg text-md p-4 border border-slate-500 shadow-sm overflow-y-auto relative",style:It({"max-height":Math.ceil(t(n).$state.outputMaxSize/2)+"px"})},[t(u)?R("",!0):(d(),I(_,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:()=>{("useCopyToClipboard"in r?r.useCopyToClipboard:t(He))().copy(t(o)[y.node_id]),t(s).add({title:"Clipboard",description:"Text copied to clipboard"})}},null,8,["onClick"])),k("p",null,G(t(u)?"Loading...":t(o)[y.node_id]),1)],4)]),_:1},8,["items"])):R("",!0)])}}}),Ga={class:"w-full h-full p-4"},Xa={class:"mt-4 max-h-96 overflow-y-auto text-sm whitespace-pre-wrap"},Ja=Y({__name:"Params",props:{flowResult:{type:Object,required:!0}},setup(e){const l=e,n=S(!1),s=B(()=>["#"+l.flowResult.task_id,...Object.keys(l.flowResult.input_params_mapped).filter(r=>l.flowResult.input_params_mapped[r].value&&l.flowResult.input_params_mapped[r].value!=="").map(r=>n.value&&l.flowResult.translated_input_params_mapped&&l.flowResult.translated_input_params_mapped[r]?`${l.flowResult.input_params_mapped[r].display_name}: ${l.flowResult.translated_input_params_mapped[r].value}`:`${l.flowResult.input_params_mapped[r].display_name}: ${l.flowResult.input_params_mapped[r].value}`)].join(" | ")+`${l.flowResult.execution_time?" | execution_time: "+l.flowResult.execution_time.toFixed(2)+"s":""}`);Ze(()=>{l.flowResult.showInputFiles=!1,l.flowResult.showExecutionDetailsModal=!1});const u=B(()=>l.flowResult.execution_details&&l.flowResult.extra_flags!==null),o=B(()=>{const r={unload_models:l.flowResult.extra_flags.unload_models,max_memory_usage:l.flowResult.execution_details.max_memory_usage,disable_smart_memory:l.flowResult.execution_details.disable_smart_memory,vram_state:l.flowResult.execution_details.vram_state};return JSON.stringify(r,null,"	")});function i(){const r={extra_flags:l.flowResult.extra_flags,execution_details:l.flowResult.execution_details},f=new Blob([JSON.stringify(r,null,"	")],{type:"application/json"}),_=URL.createObjectURL(f),h=document.createElement("a");h.href=_,h.download=`${l.flowResult.task_id}_execution_details.json`,h.click(),window.URL.revokeObjectURL(_)}return(r,f)=>{const _=re,h=Fe,y=Xe,M=Ge,z=be;return d(),O(Z,null,[t(u)?(d(),I(h,{key:0,modelValue:e.flowResult.showExecutionDetailsModal,"onUpdate:modelValue":f[2]||(f[2]=C=>e.flowResult.showExecutionDetailsModal=C)},{default:w(()=>[p(_,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:f[0]||(f[0]=()=>e.flowResult.showExecutionDetailsModal=!1)}),k("div",Ga,[f[6]||(f[6]=k("h3",{class:"text-center font-bold"}," Execution details ",-1)),k("div",Xa,G(t(o)),1),p(_,{class:"mt-3",icon:"i-heroicons-arrow-down-tray-20-solid",variant:"outline",size:"xs",color:"gray",onClick:f[1]||(f[1]=()=>i())},{default:w(()=>f[5]||(f[5]=[D(" Download raw details ")])),_:1})])]),_:1},8,["modelValue"])):R("",!0),e.flowResult.translated_input_params_mapped&&Object.keys(e.flowResult.translated_input_params_mapped).length>0?(d(),I(y,{key:1,text:t(n)?"Hide translated input params":"Show translated input params",popper:{placement:"top"}},{default:w(()=>[p(_,{class:"mb-2 mr-2",color:"white",size:"xs",variant:"outline",icon:"i-heroicons-language-solid",onClick:f[3]||(f[3]=()=>{n.value=!t(n)})})]),_:1},8,["text"])):R("",!0),(d(!0),O(Z,null,ce(t(s).split("|"),C=>(d(),I(M,{key:C,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer",variant:"soft",color:"gray",onClick:()=>{const F=("useCopyToClipboard"in r?r.useCopyToClipboard:t(He))(),T=C.indexOf(":"),P=C.substring(T+1).trim();F.copy(P),("useToast"in r?r.useToast:t(he))().add({title:"Clipboard",description:`${C.split(":")[0].trim()} copied to clipboard`,timeout:2e3})}},{default:w(()=>[D(G(C),1)]),_:2},1032,["onClick"]))),128)),e.flowResult.input_files.length>0?(d(),I(M,{key:2,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer select-none",variant:"subtle",color:"sky",onClick:f[4]||(f[4]=()=>{e.flowResult.showInputFiles=!e.flowResult.showInputFiles})},{default:w(()=>[p(z,{name:e.flowResult.showInputFiles?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-1"},null,8,["name"]),p(z,{name:"i-heroicons-document-solid",class:"mr-1"}),D(" "+G(`input_files: ${e.flowResult.input_files.length}`),1)]),_:1})):R("",!0)],64)}}}),Ka={key:0,class:le("w-full p-1")},Qa={class:"flex flex-col basis-full justify-between mx-2"},Ya=Y({__name:"InputFiles",props:{flowResult:{type:Object,required:!0}},setup(e){const l=ve(),n=(i,r)=>`${Xt()}/tasks/inputs?task_id=${i}&input_index=${r}`,s=S(!1),u=S(""),o=S(0);return(i,r)=>{var M,z;const f=Ue,_=Be,h=re,y=Fe;return e.flowResult.showInputFiles?(d(),O("div",Ka,[((M=Object.keys(e.flowResult.input_files))==null?void 0:M.length)===1?(d(),I(f,{key:0,class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(l).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",src:n(e.flowResult.task_id,0),onClick:r[0]||(r[0]=()=>{u.value=n(e.flowResult.task_id,0),o.value=0,s.value=!0})},null,8,["class","src"])):R("",!0),((z=Object.keys(e.flowResult.input_files))==null?void 0:z.length)>1?(d(),I(_,{key:1,items:Object.keys(e.flowResult.input_files).map(C=>({task_id:e.flowResult.task_id,index:C})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 my-2"}},page:1,indicators:""},{default:w(({item:C})=>[k("div",Qa,[p(f,{class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(l).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",draggable:"false",src:n(C.task_id,C.index),onClick:()=>{u.value=n(e.flowResult.task_id,C.index),o.value=C.index,s.value=!0}},null,8,["class","src","onClick"])])]),_:1},8,["items"])):R("",!0),p(y,{modelValue:t(s),"onUpdate:modelValue":r[3]||(r[3]=C=>X(s)?s.value=C:null),class:"z-[90]",transition:!1,fullscreen:""},{default:w(()=>[p(h,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:r[1]||(r[1]=()=>s.value=!1)}),k("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:r[2]||(r[2]=vt(()=>s.value=!1,["left"]))},[t(u)?(d(),I(f,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(u)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])])):R("",!0)}}}),Za={key:0,class:"text-red-300"},eo={class:"flex items-center"},to={class:"p-2 max-w-48 max-h-48 not-italic"},lo={class:"block font-medium text-gray-700 dark:text-gray-200"},no={key:0,class:"flex items-center"},ao=Y({__name:"InputParam",props:{inputParam:{type:Object,required:!0},index:{type:Number,required:!0},inputParamsMap:{type:Array,required:!0},advanced:{type:Boolean,default:!1}},setup(e){const l=e,n=B(()=>l.inputParam.type!=="bool"?l.inputParam.display_name:""),s=B(()=>["range"].includes(l.inputParam.type)?`value: ${l.inputParamsMap[l.index][l.inputParam.name].value}`:""),u=S(null);function o(i){const r=al(i);r&&(l.inputParamsMap[l.index][l.inputParam.name].value=r)}return ge(()=>{l.inputParam.type==="text"&&u.value&&u.value.$refs.textarea.addEventListener("keydown",o)}),Pt(()=>{l.inputParam.type==="text"&&u.value&&u.value.$refs.textarea.removeEventListener("keydown",o)}),(i,r)=>{var P,m;const f=re,_=Ge,h=Mt,y=Ut,M=Te,z=tt,C=Je,F=zt,T=Oe;return(((P=e.inputParam)==null?void 0:P.advanced)||!1)===e.advanced&&!["image","image-mask","range_scale"].includes(e.inputParam.type)?(d(),I(T,{key:0,class:le(["mb-3",{italic:(m=e.inputParam)==null?void 0:m.dynamic_lora}]),help:t(s)},{hint:w(()=>[e.inputParam.optional?R("",!0):(d(),O("span",Za,"required"))]),label:w(()=>{var g;return[k("div",eo,[(g=e.inputParam)!=null&&g.dynamic_lora&&e.inputParam.trigger_words.length>0?(d(),I(h,{key:0},{panel:w(()=>[k("div",to,[r[7]||(r[7]=k("h4",{class:"mb-2 text-center"},"Trigger words",-1)),(d(!0),O(Z,null,ce(e.inputParam.trigger_words,b=>(d(),I(_,{key:b,color:"violet",class:"mr-1 cursor-pointer",onClick:()=>{("useCopyToClipboard"in i?i.useCopyToClipboard:t(He))().copy(b),("useToast"in i?i.useToast:t(he))().add({title:"Clipboard",description:"Trigger word copied to clipboard",timeout:2e3})}},{default:w(()=>[D(G(b),1)]),_:2},1032,["onClick"]))),128))])]),default:w(()=>[p(f,{icon:"i-heroicons-information-circle",variant:"ghost",size:"xs",color:"gray",class:"mr-2"})]),_:1})):R("",!0),k("label",lo,G(t(n)),1)])]}),default:w(()=>{var g;return[e.inputParam.type==="text"?(d(),I(y,{key:0,ref_key:"textareaInput",ref:u,size:"md",placeholder:e.inputParam.display_name,required:!e.inputParam.optional,resize:!0,label:e.inputParam.display_name,value:e.inputParamsMap[e.index][e.inputParam.name].value,autoresize:"",variant:"outline",onInput:r[0]||(r[0]=b=>{const U=b.target;e.inputParamsMap[e.index][e.inputParam.name].value=U.value})},null,8,["placeholder","required","label","value"])):R("",!0),e.inputParam.type==="number"?(d(),O(Z,{key:1},[e.inputParam.name==="seed"?(d(),O("div",no,[e.inputParam.type==="number"?(d(),I(M,{key:0,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":r[1]||(r[1]=b=>e.inputParamsMap[e.index][e.inputParam.name].value=b),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"])):R("",!0),p(f,{icon:"i-heroicons-arrow-path",color:"violet",variant:"outline",size:"xs",class:"ml-2",onClick:r[2]||(r[2]=()=>{e.inputParamsMap[e.index][e.inputParam.name].value=Math.floor(Math.random()*1e7)})})])):(d(),I(M,{key:1,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":r[3]||(r[3]=b=>e.inputParamsMap[e.index][e.inputParam.name].value=b),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"]))],64)):R("",!0),e.inputParam.type==="list"?(d(),I(z,{key:2,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":r[4]||(r[4]=b=>e.inputParamsMap[e.index][e.inputParam.name].value=b),placeholder:e.inputParam.display_name,options:Object.keys(e.inputParam.options)},null,8,["modelValue","placeholder","options"])):R("",!0),e.inputParam.type==="bool"?(d(),I(C,{key:3,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":r[5]||(r[5]=b=>e.inputParamsMap[e.index][e.inputParam.name].value=b),label:(g=e.inputParam)==null?void 0:g.display_name},null,8,["modelValue","label"])):R("",!0),["range","range_scale"].includes(e.inputParam.type)?(d(),I(F,{key:4,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":r[6]||(r[6]=b=>e.inputParamsMap[e.index][e.inputParam.name].value=b),label:e.inputParam.display_name,size:"sm",min:e.inputParam.min,max:e.inputParam.max,step:e.inputParam.step},null,8,["modelValue","label","min","max","step"])):R("",!0)]}),_:1},8,["class","help"])):R("",!0)}}}),oo={key:0,class:"heading"},so={key:1},io=Y({__name:"Params",props:{inputParamsMap:{type:Array,required:!0},additionalInputParamsMap:{type:Array,required:!1,default:[]},advanced:{type:Boolean,default:!1},flow:{type:Object,required:!0}},setup(e){const l=S(!0);return(n,s)=>{const u=be,o=yt,i=ao;return d(),O(Z,null,[e.advanced?(d(),O("div",oo,[k("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:s[0]||(s[0]=()=>{l.value=!t(l)})},[p(u,{name:t(l)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",class:"mr-2"},null,8,["name"]),s[1]||(s[1]=D(" Advanced options "))])])):R("",!0),t(l)?(d(),O("div",so,[e.flow.input_params.filter(r=>(r.advanced||!1)===e.advanced&&!["image","image-mask","range_scale"].includes(r.type)).length===0?(d(),I(o,{key:0,type:"info",class:"mb-3",variant:"soft",color:"cyan",title:e.advanced?"No advanced input params to adjust":"No input params to adjust"},null,8,["title"])):R("",!0),(d(!0),O(Z,null,ce(e.flow.input_params,(r,f)=>(d(),I(i,{key:f,"input-params-map":e.inputParamsMap,index:f,"input-param":r,advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),(d(!0),O(Z,null,ce(e.additionalInputParamsMap,(r,f)=>(d(),I(i,{key:Object.keys(r)[0],"input-params-map":e.additionalInputParamsMap,index:f,"input-param":r[Object.keys(r)[0]],advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128))])):R("",!0)],64)}}}),ro=mt(Me.ui.strategy,Me.ui.tabs,Nl),uo=Y({components:{UIcon:be,HTabGroup:ql,HTabList:El,HTab:Dl,HTabPanels:Wl,HTabPanel:Hl},inheritAttrs:!1,props:{modelValue:{type:Number,default:void 0},orientation:{type:String,default:"horizontal",validator:e=>["horizontal","vertical"].includes(e)},defaultIndex:{type:Number,default:0},items:{type:Array,default:()=>[]},unmount:{type:Boolean,default:!1},content:{type:Boolean,default:!0},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:l}){const{ui:n,attrs:s}=pt("tabs",je(e,"ui"),ro,je(e,"class")),u=S(),o=S([]),i=S(),r=S(e.modelValue||e.defaultIndex);function f(h){var M;const y=(M=o.value[h])==null?void 0:M.$el;y&&i.value&&(i.value.style.top=`${y.offsetTop}px`,i.value.style.left=`${y.offsetLeft}px`,i.value.style.width=`${y.offsetWidth}px`,i.value.style.height=`${y.offsetHeight}px`)}function _(h){r.value=h,l("change",h),e.modelValue!==void 0&&l("update:modelValue",r.value),f(r.value)}return Gt(u,()=>{f(r.value)}),me(()=>e.modelValue,h=>{r.value=h,f(r.value)}),me(()=>e.items,async()=>{await wt(),f(r.value)},{deep:!0}),ge(async()=>{await wt(),f(r.value)}),_l(()=>$l()),{ui:n,attrs:s,listRef:u,itemRefs:o,markerRef:i,selectedIndex:r,onChange:_}}}),co=["aria-label"],mo={class:"truncate"};function fo(e,l,n,s,u,o){const i=be,r=Se("HTab"),f=Se("HTabList"),_=Se("HTabPanel"),h=Se("HTabPanels"),y=Se("HTabGroup");return d(),I(y,ze({vertical:e.orientation==="vertical","selected-index":e.selectedIndex,as:"div",class:e.ui.wrapper},e.attrs,{onChange:e.onChange}),{default:w(()=>[p(f,{ref:"listRef",class:le([e.ui.list.base,e.ui.list.background,e.ui.list.rounded,e.ui.list.shadow,e.ui.list.padding,e.ui.list.width,e.orientation==="horizontal"&&e.ui.list.height,e.orientation==="horizontal"&&"inline-grid items-center"]),style:It([e.orientation==="horizontal"&&`grid-template-columns: repeat(${e.items.length}, minmax(0, 1fr))`])},{default:w(()=>[k("div",{ref:"markerRef",class:le(e.ui.list.marker.wrapper)},[k("div",{class:le([e.ui.list.marker.base,e.ui.list.marker.background,e.ui.list.marker.rounded,e.ui.list.marker.shadow])},null,2)],2),(d(!0),O(Z,null,ce(e.items,(M,z)=>(d(),I(r,{key:z,ref_for:!0,ref:"itemRefs",disabled:M.disabled,as:"template"},{default:w(({selected:C,disabled:F})=>[k("button",{"aria-label":M.ariaLabel,class:le([e.ui.list.tab.base,e.ui.list.tab.background,e.ui.list.tab.height,e.ui.list.tab.padding,e.ui.list.tab.size,e.ui.list.tab.font,e.ui.list.tab.rounded,e.ui.list.tab.shadow,C?e.ui.list.tab.active:e.ui.list.tab.inactive])},[Re(e.$slots,"icon",{item:M,index:z,selected:C,disabled:F},()=>[M.icon?(d(),I(i,{key:0,name:M.icon,class:le(e.ui.list.tab.icon)},null,8,["name","class"])):R("",!0)]),Re(e.$slots,"default",{item:M,index:z,selected:C,disabled:F},()=>[k("span",mo,G(M.label),1)])],10,co)]),_:2},1032,["disabled"]))),128))]),_:3},8,["class","style"]),e.content?(d(),I(h,{key:0,class:le(e.ui.container)},{default:w(()=>[(d(!0),O(Z,null,ce(e.items,(M,z)=>(d(),I(_,{key:z,class:le(e.ui.base),unmount:e.unmount},{default:w(({selected:C})=>[Re(e.$slots,M.slot||"item",{item:M,index:z,selected:C},()=>[D(G(M.content),1)])]),_:2},1032,["class","unmount"]))),128))]),_:3},8,["class"])):R("",!0)]),_:3},16,["vertical","selected-index","class","onChange"])}const po=ft(uo,[["render",fo]]),vo={class:"p-4"},go={class:"text-center mb-4"},yo={class:"text-lg"},ho={key:0,class:"text-sm text-slate-500"},bo={class:"text-md text-center text-red-500 mb-4"},wo={key:1},ko={class:"flex justify-center mb-4"},xo={key:0,class:"text-sm text-slate-500 text-center mb-4"},_o={class:"flex items-center justify-between"},$o=Y({__name:"Modal",props:We({flowResult:{type:Object,required:!1,default:()=>null},outputImgSrc:{type:String,required:!0},outputParamIndex:{type:Number,required:!0},inputParamsMapped:{type:Object,required:!0},isChildTask:{type:Boolean,required:!1,default:!1},translatePrompt:{type:Boolean,required:!1,default:!1}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:We(["update:show"],["update:show"]),setup(e,{emit:l}){const n=e,s=Ne(e,"show"),u=[{key:"send-to-flow-output",label:"Send to flow"},{key:"send-to-flow-params",label:"Edit params",description:"Edit prompt params before sending to sub-flow"}],o=S(0),i=ve(),r=he(),f=B(()=>i.sub_flows.map(b=>({value:b.name,label:`${b.display_name} - ${b.description}`}))),_=S(f.value[0]||""),h=S({}),y=S([]),M=B(()=>y.value.every(b=>{if(!b||Object.keys(b).length===0)return!0;const U=Object.keys(b)[0],$=b[U];return $.optional?!0:$.type==="text"?$.value!=="":!0}));me(()=>_.value,b=>{z(b)});function z(b){h.value=i.sub_flows.find(U=>U.name===b.value),h.value&&(y.value=h.value.input_params.reduce((U,$)=>{if(["image","image-mask","range_scale"].includes($.type))return U.push({}),U;const v={[$.name]:{value:null,display_name:$.display_name,type:$.type,optional:$.optional,advanced:$.advanced||!1,default:$.default||"",dynamic_lora:$.dynamic_lora||!1,trigger_words:$.trigger_words||[]}};return $.type==="text"?(v[$.name].value=$.default||"",v[$.name].translatable=$.translatable||!1):$.type==="number"||$.type==="range"?(v[$.name].value=$.default||0,v[$.name].min=$.min||0,v[$.name].max=$.max||100,v[$.name].step=$.step||1):$.type==="list"?(v[$.name].value=Object.keys($.options)[0]||"",v[$.name].default=Object.keys($.options)[0]||""):$.type==="bool"&&(v[$.name].default=$.default||!1),U.push(v),U},[]),m.value=1)}const C=S(!1),F=l;function T(){console.debug("[Send to flow]: ",_.value);const b=i.sub_flows.find($=>$.name===_.value.value&&$.display_name===_.value.label.split(" - ")[0]);if(console.debug("[Send to flow]: targetFlow",b),!b){he().add({title:`Target sub-flow "${_.value.value}" not found`,description:"Please, verify the target sub-flow is installed and available and try again",timeout:5e3});return}if(!M.value){he().add({title:"Missing required input params",description:"Please, fill in all required input params before sending to sub-flow",timeout:5e3}),o.value=1;return}const U=b.input_params.reduce(($,v)=>{const q={};let a=y.value.find(c=>Object.keys(c)[0]===v.name);return a=a?a[v.name].value:null,v.type==="text"?q[v.name]={value:a??(v.default||""),type:v.type}:v.type==="number"?q[v.name]={value:a??(v.default||0),type:v.type}:v.type==="image"?q[v.name]={value:JSON.stringify({task_id:n.flowResult.task_id,node_id:n.flowResult.outputs.length>1?n.flowResult.outputs[n.outputParamIndex].comfy_node_id:n.flowResult.outputs[0].comfy_node_id})||"",type:v.type}:v.type==="list"?q[v.name]={value:a??(v.default||Object.keys(v.options)[0]||""),type:v.type,options:v.options}:v.type==="bool"?q[v.name]={value:a??(v.default||!1),type:v.type}:["range","range_scale"].includes(v.type)&&(q[v.name]={value:a??(v.default||0),type:v.type}),$.push(q),$},[]);console.debug("[Send to flow]: input_params_map",U),C.value=!0,i.runFlow(b,U,m.value,n.translatePrompt,P.value,P.value?Number(n.flowResult.task_id):null).then(()=>{r.add({title:"Task sent to sub-flow",description:`Task ${n.flowResult.task_id} sent to sub-flow ${_.value.value}`,timeout:5e3})}).finally(()=>{C.value=!1,F("update:show",!1)})}const P=S(!1),m=S(1),g=B(()=>{var b;return n.flowResult.progress===100&&((b=n.flowResult)==null?void 0:b.error)===""});return me(()=>m.value,b=>{b>1&&P.value&&(P.value=!1)}),ge(()=>{var U,$;const b=n.flowResult?(($=(U=n==null?void 0:n.flowResult)==null?void 0:U.outputs[n.outputParamIndex])==null?void 0:$.type)??"image":"image";i.fetchSubFlows(b).then(()=>{_.value=f.value[0]||"",z(_.value)}),P.value=!1}),(b,U)=>{const $=tt,v=Ue,q=yt,a=io,c=Te,j=Oe,H=Je,ee=Xe,ae=re,se=po,ue=Fe;return d(),I(ue,{modelValue:s.value,"onUpdate:modelValue":U[6]||(U[6]=te=>s.value=te),transition:!1},{default:w(()=>[k("div",vo,[p(se,{modelValue:t(o),"onUpdate:modelValue":U[5]||(U[5]=te=>X(o)?o.value=te:null),items:u,class:"w-full"},{item:w(({item:te})=>[k("div",go,[k("h2",yo,G(te.label),1),te.description?(d(),O("p",ho,G(te.description),1)):R("",!0)]),k("p",bo,[t(f).length>0?(d(),I($,{key:0,modelValue:t(_),"onUpdate:modelValue":U[0]||(U[0]=J=>X(_)?_.value=J:null),class:"w-full",searchable:"",size:"lg",options:t(f)},null,8,["modelValue","options"])):(d(),O("span",wo,"No sub-flows available"))]),te.key==="send-to-flow-output"?(d(),O(Z,{key:0},[k("div",ko,[t(g)?(d(),I(v,{key:0,src:e.outputImgSrc,class:"w-1/2 rounded-lg",draggable:!1},null,8,["src"])):(d(),I(q,{key:1,color:"orange",icon:"i-heroicons-exclamation-circle-solid",title:`Task is still running (${Math.ceil(e.flowResult.progress)}%, ${e.flowResult.execution_time.toFixed(2)}s)`,description:e.flowResult.error!==""?e.flowResult.error:""},null,8,["title","description"]))]),e.inputParamsMapped?(d(),O("p",xo,G(["#"+e.flowResult.task_id,...Object.keys(e.inputParamsMapped).filter(J=>e.inputParamsMapped[J].value!=="").map(J=>`${e.inputParamsMapped[J].display_name}: ${e.inputParamsMapped[J].value}`)].join(" | ")),1)):R("",!0)],64)):R("",!0),te.key==="send-to-flow-params"?(d(),O(Z,{key:1},[t(y).length>0?(d(),I(a,{key:0,"input-params-map":t(y),"onUpdate:inputParamsMap":U[1]||(U[1]=J=>X(y)?y.value=J:null),flow:t(h),advanced:!1},null,8,["input-params-map","flow"])):R("",!0),t(y).length>0?(d(),I(a,{key:1,"input-params-map":t(y),"onUpdate:inputParamsMap":U[2]||(U[2]=J=>X(y)?y.value=J:null),flow:t(h),advanced:!0},null,8,["input-params-map","flow"])):R("",!0),t(y).length===0?(d(),I(q,{key:2,class:"mb-4",title:"No input params",description:"No input params available for selected sub-flow",variant:"soft",color:"primary"})):R("",!0)],64)):R("",!0),e.isChildTask?(d(),I(q,{key:2,class:"mb-4",icon:"i-heroicons-exclamation-circle-solid",title:"Child task",description:"The latest child task is always used as input for sub-flow"})):R("",!0),t(h)&&t(h).is_count_supported?(d(),I(j,{key:3,label:"Number of results"},{default:w(()=>[p(c,{modelValue:t(m),"onUpdate:modelValue":U[3]||(U[3]=J=>X(m)?m.value=J:null),type:"number",min:"1",max:"50",label:"Batch size",class:"mb-3 max-w-fit flex justify-end"},null,8,["modelValue"])]),_:1})):R("",!0),k("div",_o,[p(ee,{text:t(m)>1?"Multiple number of results is not supported for child tasks":""},{default:w(()=>[p(H,{modelValue:t(P),"onUpdate:modelValue":U[4]||(U[4]=J=>X(P)?P.value=J:null),label:"Bind as child task",disabled:t(m)>1},null,8,["modelValue","disabled"])]),_:1},8,["text"]),p(ae,{icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",variant:"outline",loading:t(C),disabled:t(f).length===0||e.isChildTask&&!t(g),onClick:T},{default:w(()=>U[7]||(U[7]=[D(" Send ")])),_:1},8,["loading","disabled"])])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}}),Co={class:"flex flex-col md:flex-row items-center justify-center mb-5 sticky top-1 z-[10]"},Io={class:"flex items-center justify-center"},So={class:"p-4"},Po={class:"text-md text-center text-red-500 mb-4"},Mo={class:"flex justify-center"},Ro={key:0,class:"results overflow-auto"},Fo=["id"],Uo={class:"text-sm text-slate-500 text-center mb-1"},Vo={class:"w-5/6 mx-auto flex flex-wrap items-center justify-center"},zo={class:"w-full flex justify-center items-center"},To={key:1,class:"text-center text-slate-500"},Oo=Y({__name:"Output",emits:["copy-prompt-inputs"],setup(e,{emit:l}){const n=ve(),s=B(()=>{var a;return n.flowResultsByName((a=n.currentFlow)==null?void 0:a.name).length>0||!1}),u=B(()=>{var a;return n.flowResultsByName((a=n.currentFlow)==null?void 0:a.name)||[]}),o=B(()=>n.$state.resultsPageSize);me(u,()=>{u.value.length<=n.$state.resultsPageSize?n.$state.resultsPage=1:n.$state.resultsPage>Math.ceil(u.value.length/n.$state.resultsPageSize)&&(n.$state.resultsPage=Math.ceil(u.value.length/n.$state.resultsPageSize))}),me(o,()=>{u.value.length<=n.$state.resultsPageSize?n.$state.resultsPage=1:n.$state.resultsPage>Math.ceil(u.value.length/n.$state.resultsPageSize)&&(n.$state.resultsPage=Math.ceil(u.value.length/n.$state.resultsPageSize)),n.saveUserOptions()}),Ze(()=>{n.$state.flow_results_filter="",n.$state.resultsPage=1});const i=l;function r(a){i("copy-prompt-inputs",a.input_params_mapped)}function f(a){C.value=a,z.value=!0}const _=S(null),h=S(!1);window.addEventListener("scroll",()=>{var a;h.value=window.scrollY>(((a=_.value)==null?void 0:a.offsetTop)+window.screen.height||0)});const y=B(()=>n.$state.resultsPage);me(y,()=>{const a=document.getElementById("output-container");a&&a.scrollIntoView({behavior:"smooth"})});const M=S(!1),z=S(!1),C=S(""),F=S(!1),T=S(!1),P=S(!1),m=S(""),g=S(null),b=S({}),U=S(0),$=S(!1);function v(a,c=0){if(a.child_tasks.length===0||!Kt(a,c,a.outputs[c].comfy_node_id))g.value=a,m.value=fe({task_id:a.task_id,node_id:a.outputs[c].comfy_node_id}),b.value=a.input_params_mapped,$.value=!1;else{const j=Jt(a,c,a.outputs[c].comfy_node_id);g.value=j,b.value=a.input_params_mapped,m.value=fe({task_id:j.task_id,node_id:j.outputs[0].comfy_node_id}),$.value=!0}U.value=c,P.value=!0}function q(a){var ee;const c=a.extra_flags!==null&&((ee=a==null?void 0:a.extra_flags)==null?void 0:ee.profiler_execution),j=[{label:"Comfy flow",labelClass:"text-blue-500 text-sm",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500 h-4 w-4",click:()=>{var ae;return n.downloadFlowComfy((ae=n.currentFlow)==null?void 0:ae.name,a.task_id)}}];c&&j.push({label:"Execution details",labelClass:"text-orange-500 text-sm",icon:"i-mdi-bug",iconClass:"bg-orange-500 h-4 w-4",click:()=>{a.execution_details?a.showExecutionDetailsModal=!0:n.fetchTaskHistoryItem(a.task_id).then(ae=>{a.execution_details=ae.execution_details,a.showExecutionDetailsModal=!0})}});const H=[[{label:"Use params",labelClass:"text-cyan-500 text-sm",icon:"i-heroicons-document-duplicate-16-solid",iconClass:"bg-cyan-500 h-4 w-4",click:()=>r(a)}],j];return a.outputs.length===1&&a.outputs.every(ae=>ae.type==="image")&&H.splice(1,0,[{label:"Send to flow",labelClass:"text-violet-500 text-sm",icon:"i-heroicons-arrow-uturn-up-solid",iconClass:"bg-violet-500 h-4 w-4",click:()=>{v(a)}}]),H}return(a,c)=>{var K;const j=ha,H=be,ee=Te,ae=Rl,se=zl,ue=re,te=gt,J=Ge,ke=Fe,xe=Fa,de=Na,_e=Ea,we=Ha,L=Ja,x=Ya,V=$o,E=Ue;return d(),O("div",{id:"output-container",ref_key:"outputContainer",ref:_,class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md my-10"},[p(j,{show:t(h),class:"fixed bottom-5 right-5",target:"output-container"},null,8,["show"]),k("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:c[0]||(c[0]=()=>{M.value=!t(M)})},[p(H,{name:t(M)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),D(" Output ("+G(t(u).filter(N=>N.parent_task_id===null).length)+") ",1)]),t(M)?R("",!0):(d(),O(Z,{key:0},[k("div",Co,[p(ee,{modelValue:t(n).$state.flow_results_filter,"onUpdate:modelValue":c[1]||(c[1]=N=>t(n).$state.flow_results_filter=N),icon:"i-heroicons-magnifying-glass-20-solid",color:"white",class:"md:mr-3",label:"Filter by prompt",trailing:!0,placeholder:"Filter results by prompt"},null,8,["modelValue"]),t(u).filter(N=>N.parent_task_id===null).length>t(n).$state.resultsPageSize?(d(),I(ae,{key:0,modelValue:t(n).$state.resultsPage,"onUpdate:modelValue":c[2]||(c[2]=N=>t(n).$state.resultsPage=N),class:"my-1 md:my-0","page-count":t(n).$state.resultsPageSize,total:t(u).filter(N=>N.parent_task_id===null).length,"show-first":"","show-last":""},null,8,["modelValue","page-count","total"])):R("",!0),k("div",Io,[p(se,{modelValue:t(n).resultsPageSize,"onUpdate:modelValue":c[3]||(c[3]=N=>t(n).resultsPageSize=N),class:"md:mx-3 w-fit mr-3",options:[5,10,20,50,100],label:"Results per page"},null,8,["modelValue"]),p(te,{items:[[{label:"Delete all results",labelClass:"text-red-500",icon:"i-heroicons-trash",iconClass:"dark:text-red-500 text-red-500",click:()=>F.value=!0}]],mode:"click",label:"Options",popper:{placement:"bottom-end"}},{default:w(()=>[p(ue,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])]),p(ke,{modelValue:t(F),"onUpdate:modelValue":c[6]||(c[6]=N=>X(F)?F.value=N:null),class:"z-[90]",transition:!1},{default:w(()=>[k("div",So,[c[15]||(c[15]=k("p",{class:"text-lg text-center mb-4"},"Are you sure you want to delete all results?",-1)),k("p",Po,[c[11]||(c[11]=D(" All history and images of ")),p(J,{class:"mx-1",color:"orange",variant:"outline"},{default:w(()=>[D(G(t(n).currentFlow.display_name),1)]),_:1}),c[12]||(c[12]=D(" will be deleted. "))]),k("div",Mo,[p(ue,{class:"mr-2",color:"red",variant:"outline",loading:t(T),onClick:c[4]||(c[4]=()=>{var N;T.value=!0,t(n).deleteFlowResults((N=t(n).currentFlow)==null?void 0:N.name).then(()=>{T.value=!1,F.value=!1})})},{default:w(()=>c[13]||(c[13]=[D(" Yes ")])),_:1},8,["loading"]),p(ue,{variant:"outline",onClick:c[5]||(c[5]=()=>F.value=!1)},{default:w(()=>c[14]||(c[14]=[D("No")])),_:1})])])]),_:1},8,["modelValue"])]),t(s)?(d(),O("div",Ro,[(d(!0),O(Z,null,ce(t(n).flowResultsByNamePaginated((K=t(n).currentFlow)==null?void 0:K.name),N=>(d(),O("div",{id:"task_id_"+N.task_id,key:N.task_id,class:"flex flex-col justify-center mx-auto mb-5"},[N.outputs.some(Q=>["image","image-animated"].includes(Q.type))?(d(),I(xe,{key:0,"flow-result":N,"handle-send-to-flow":v,"open-image-modal":f},null,8,["flow-result"])):N.outputs.some(Q=>Q.type==="video")?(d(),I(de,{key:1,"flow-result":N},null,8,["flow-result"])):N.outputs.some(Q=>Q.type==="audio")?(d(),I(_e,{key:2,"flow-result":N},null,8,["flow-result"])):N.outputs.some(Q=>Q.type==="text")?(d(),I(we,{key:3,"flow-result":N},null,8,["flow-result"])):R("",!0),k("div",Uo,[k("div",Vo,[p(L,{"flow-result":N},null,8,["flow-result"])])]),p(x,{"flow-result":N},null,8,["flow-result"]),k("div",zo,[p(ue,{class:"mr-3",color:"red",icon:"i-heroicons-trash",variant:"outline",size:"xs",onClick:()=>t(n).deleteFlowHistory(N.task_id)},{default:w(()=>c[16]||(c[16]=[D(" Delete ")])),_:2},1032,["onClick"]),p(te,{items:q(N),mode:"click",popper:{placement:"bottom-start"}},{default:w(()=>[p(ue,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid",size:"xs"})]),_:2},1032,["items"])])],8,Fo))),128)),p(V,{show:t(P),"onUpdate:show":c[7]||(c[7]=N=>X(P)?P.value=N:null),"flow-result":t(g),"output-img-src":t(m),"output-param-index":t(U),"input-params-mapped":t(b),"is-child-task":t($)},null,8,["show","flow-result","output-img-src","output-param-index","input-params-mapped","is-child-task"])])):(d(),O("p",To," No output results available "))],64)),p(ke,{modelValue:t(z),"onUpdate:modelValue":c[10]||(c[10]=N=>X(z)?z.value=N:null),class:"z-[90]",transition:!1,fullscreen:""},{default:w(()=>[p(ue,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:c[8]||(c[8]=()=>z.value=!1)}),k("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:c[9]||(c[9]=vt(()=>z.value=!1,["left"]))},[t(C)?(d(),I(E,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",src:t(C)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])],512)}}}),jo=Cl("civitAiStore",{actions:{fetchFlowLoras(e,l,n=50,s=null){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:u}=Ye();let i=`https://civitai.com/api/v1/models?baseModels=${e.lora_connect_points[Object.keys(e.lora_connect_points)[0]].base_model_type}&types=LORA&limit=${n}`;s&&(s.includes(window.location.hostname)&&(s=s.replace(window.location.hostname,"civitai.com")),i=s);const r=`/other/proxy?target=${encodeURIComponent(i)}`;return u(r,{method:"GET",headers:{Authentication:"Bearer "+l,Accept:"application/json"}})},fetchFlowLorasByHash(e,l,n){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:s}=Ye(),u=`https://civitai.com/api/v1/model-versions/by-hash/${n}`,o=`/other/proxy?target=${encodeURIComponent(u)}`;return s(o,{method:"GET",headers:{Authentication:"Bearer "+l,Accept:"application/json"}})}}}),No={class:"p-4 overflow-y-auto relative"},Bo={key:1},Lo={class:"flex flex-col justify-between w-full md:flex-row md:gap-4 md:items-center lg:items-start"},Ao={class:"flex flex-col gap-2 lg:flex-row md:justify-end items-start w-full"},qo={class:"flex flex-col md:flex-row flex-wrap gap-2 justify-between items-center w-full px-4 py-3"},Eo={class:"flex items-center gap-1.5"},Do={class:"flex gap-1.5 items-center"},Wo={class:"flex items-center h-5"},Ho=["checked","indeterminate","onChange"],Go={key:0,class:"flex items-center h-5"},Xo=["checked","onChange"],Jo=["href"],Ko=["innerHTML"],Qo={class:"p-4 max-h-64 max-w-xl overflow-y-auto"},Yo={key:0},Zo={class:"flex items-center"},es={class:"flex items-center"},ts={key:0,class:"flex justify-center space-x-2 w-full"},ls={key:1,controls:"",width:256,height:256},ns=["src"],as={class:"flex justify-end"},os=Y({__name:"LoraSelectorModal",props:We({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const l=e,n=Ne(e,"show"),s=he(),u=ve(),o=Wt(),i=jo(),r=S(!1),f=S({items:[],metadata:{}}),_=B(()=>o.settingsMap.civitai_auth_token.value!==""),h=B(()=>o.settingsMap.civitai_auth_token.value||""),y=[{key:"name",label:"Name",sortable:!0,class:""},{key:"description",label:"Description",sortable:!1,class:""},{key:"trigger_words",label:"Trigger words",sortable:!1,class:""},{key:"nsfw",label:"NSFW",sortable:!1,class:""},{key:"statsDownloadCount",label:"Download count",sortable:!1,class:""},{key:"statsThumbsUpCount",label:"Thumbs up",sortable:!1,class:""},{key:"modelVersion",label:"Model version",sortable:!1,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}],M=S([]),z=S({openedRows:[],row:{}}),C=S(""),F=()=>{C.value=""},T=B(()=>{var x;let L=((x=f.value)==null?void 0:x.items)||[];return C.value&&(L=L.filter(V=>V.name.toLowerCase().includes(C.value.toLowerCase()))),L.forEach(V=>{!P.value[V.id]&&(V==null?void 0:V.modelVersions.length)>0&&(P.value[V.id]=V==null?void 0:V.modelVersions[0].name);const E=Object.keys(de.value);V.modelVersions.forEach(K=>{E.includes(K.files[0].hashes.SHA256.toLowerCase())&&de.value[K.files[0].hashes.SHA256.toLowerCase()]!==null&&(P.value[V.id]=K.name,V.currentFlowLora=!0,M.value.includes(V)||M.value.push(V))})}),L}),P=S({});function m(L){var x;return((x=L.modelVersions.find(V=>V.name===P.value[L.id]))==null?void 0:x.images)||L.modelVersions[0].images||[]}function g(L){var x;return((x=L.modelVersions.find(V=>V.name===P.value[L.id]))==null?void 0:x.trainedWords)||L.modelVersions[0].trainedWords||[]}const b=S(!0),U=S(""),$=S(l.flow.display_name),v=S(l.flow.description),q=S(l.flow.license),a=S(l.flow.required_memory_gb||0),c=S(l.flow.version);function j(){const L=Object.keys(l.flow.lora_connect_points)[0],V=l.flow.lora_connect_points[L].connected_loras.filter(N=>de.value[N.hash]!==null).map(N=>({display_name:N.display_name,model_url:N.url,strength_model:N.strength_model})),E={[L]:[]};b.value&&E[L].push(...V);const K=M.value.reduce((N,Q)=>{const W=Q.modelVersions.find(ye=>ye.name===P.value[Q.id]);if(!W||de.value[W.files[0].hashes.SHA256.toLowerCase()])return N;const ne={strength_model:1,model_url:W.downloadUrl,display_name:Q.name};return N.push(ne),N},[]);return E[L].push(...K),console.debug("[DEBUG] newFlowConnectionPoints: ",E),E}function H(L){const x=L.modelVersions.find(K=>K.name===P.value[L.id]);if(!x)return;const V=x.files[0].hashes.SHA256.toLowerCase();de.value[V]&&(de.value[V]=null);const E=M.value.indexOf(L);E!==-1&&M.value.splice(E,1),L.currentFlowLora=!1}const ee=B(()=>u.flows.find(L=>L.name===U.value)),ae=B(()=>/^[a-z0-9_-]+$/i.test(U.value)),se=B(()=>U.value!==""&&ae&&!ee.value),ue=B(()=>U.value===""?"Flow name is required.":ae.value?ee.value?"Flow name already exists.":"":"Flow name can only contain letters, numbers, dashes and underscores."),te=B(()=>M.value.filter(L=>!de.value[L.modelVersions[0].files[0].hashes.SHA256.toLowerCase()]).length!==0),J=B(()=>te.value&&se.value&&$.value!==""&&v.value!==""),ke=B(()=>te.value?se.value?$.value===""?"Please provide a display name.":v.value===""?"Please provide a description.":"":"Please provide a valid flow name.":"No LoRAs selected");function xe(){if(M.value.length===0){s.add({title:"No LoRAs selected",description:"Please select at least one LoRA to apply and install."});return}const L={new_name:U.value,new_display_name:$.value,new_description:v.value,new_license:q.value,new_required_memory_gb:a.value,new_version:c.value,new_lora_connection_points:j()};console.debug("[DEBUG] Clone flow params: ",L),r.value=!0,u.cloneFlow(l.flow,L).then(()=>{u.fetchFlows();const x=Qt();s.add({title:"Flow clone applied",actions:[{label:"View flow",click:()=>{x.push("/workflows/"+U.value)}}]})}).catch(x=>{console.error("Error applying and installing flow: ",x.message||"Unknown error"),s.add({title:"Error applying and installing flow",description:"An error occurred while applying and installing the flow. See the console for more details."})}).finally(()=>{r.value=!1})}const de=S({});function _e(){const L=l.flow.lora_connect_points[Object.keys(l.flow.lora_connect_points)[0]].connected_loras;console.debug("Flow LORAs: ",L),Promise.all(L.map(x=>{var V;return(V=i.fetchFlowLorasByHash(l.flow,h.value,x.hash))==null?void 0:V.then(E=>(x.hash in de.value||(de.value[x.hash]=E),E))})).then(()=>{console.debug("Fetched flow LORAs info: ",de.value)}).catch(x=>{console.error("Error fetching flow LORAs info: ",x),s.add({title:"Error fetching flow LORAs info",description:"An error occurred while fetching LoRAs info for the flow. See the console for more details."})})}function we(L=!1){var V;if(!l.flow||!h.value)return;r.value=!0,L||_e();let x=null;return L&&((V=f.value.metadata)!=null&&V.nextPage)&&(x=f.value.metadata.nextPage),i.fetchFlowLoras(l.flow,h.value,50,x).then(E=>{console.debug('Fetched flow "'+l.flow.name+'" loras: ',E);const K=l.flow.lora_connect_points[Object.keys(l.flow.lora_connect_points)[0]].base_model_type,N=E.items.reduce((Q,W)=>(W.modelVersions=W.modelVersions.filter(ne=>ne.baseModel===K),W.modelVersions.length>0&&(f.value.items.find(ne=>ne.id===W.id)||Q.push(W)),Q),[]);return N.length===0&&s.add({title:"No more supported LoRAs",description:"No supported LoRAs available for the flow."}),f.value.items.push(...N),f.value.metadata=E.metadata,E}).catch(E=>{console.error('Error fetching flow "'+l.flow.name+'" loras: ',E),s.add({title:'Error fetching flow "'+l.flow.name+'" loras',description:"An error occurred while fetching LoRAs for the flow. See the console for more details."})}).finally(()=>{r.value=!1})}return(L,x)=>{const V=re,E=Il,K=yt,N=Te,Q=Oe,W=Je,ne=Xe,ye=Mt,Le=Ge,$e=be,Ae=tt,nt=Ue,at=Be,ot=Tl,st=Yt,oe=Fe;return d(),I(oe,{modelValue:n.value,"onUpdate:modelValue":x[15]||(x[15]=A=>n.value=A),fullscreen:""},{default:w(()=>[k("div",No,[p(V,{class:"absolute top-3 right-3",icon:"i-heroicons-x-mark",variant:"ghost",onClick:x[0]||(x[0]=()=>n.value=!1)}),x[22]||(x[22]=k("h2",{class:"text-xl font-bold"},"Modify flow",-1)),x[23]||(x[23]=k("p",{class:"text-sm text-slate-500 my-2"}," Select LoRAs to modify the flow. New Flow will be created and installed with selected LoRAs. ",-1)),t(_)?(d(),O("div",Bo,[k("div",Lo,[p(V,{class:"my-1",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",loading:t(r),onClick:x[1]||(x[1]=()=>{f.value={items:[],metadata:{}},de.value={},F(),we()})},{default:w(()=>x[17]||(x[17]=[D(" Fetch LoRAs models from CivitAI ")])),_:1},8,["loading"]),k("div",Ao,[p(Q,{label:"New flow name",class:"flex justify-center flex-col w-full",error:t(ue)},{default:w(()=>[p(N,{modelValue:t(U),"onUpdate:modelValue":x[2]||(x[2]=A=>X(U)?U.value=A:null),type:"text",placeholder:"unique_flow_name",onInput:x[3]||(x[3]=A=>{A.target.value=A.target.value.toLowerCase(),U.value=A.target.value.toLowerCase()})},null,8,["modelValue"])]),_:1},8,["error"]),p(Q,{label:"New display name",class:"flex justify-center flex-col w-full",error:t($)!==""?"":"Display name is required."},{default:w(()=>[p(N,{modelValue:t($),"onUpdate:modelValue":x[4]||(x[4]=A=>X($)?$.value=A:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),p(Q,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(N,{modelValue:t(v),"onUpdate:modelValue":x[5]||(x[5]=A=>X(v)?v.value=A:null),type:"text",placeholder:"Description"},null,8,["modelValue"])]),_:1}),p(Q,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(N,{modelValue:t(q),"onUpdate:modelValue":x[6]||(x[6]=A=>X(q)?q.value=A:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),p(Q,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(N,{modelValue:t(a),"onUpdate:modelValue":x[7]||(x[7]=A=>X(a)?a.value=A:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),p(Q,{label:"Version",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(N,{modelValue:t(c),"onUpdate:modelValue":x[8]||(x[8]=A=>X(c)?c.value=A:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})])]),p(st,{class:"w-full",ui:{base:"",ring:"",divide:"divide-y divide-gray-200 dark:divide-gray-700",header:{padding:"px-4 py-5"},body:{padding:"",base:"divide-y divide-gray-200 dark:divide-gray-700"},footer:{padding:"p-4"}}},{footer:w(()=>[k("div",as,[p(V,{class:"mr-2",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",color:"blue",disabled:t(f).items.length===0||t(f).items.length>0&&!t(f).metadata.nextPage,loading:t(r),onClick:x[14]||(x[14]=()=>{we(!0)})},{default:w(()=>x[21]||(x[21]=[D(" Load more ")])),_:1},8,["disabled","loading"])])]),default:w(()=>[k("div",qo,[k("div",Eo,[p(N,{modelValue:t(C),"onUpdate:modelValue":x[9]||(x[9]=A=>X(C)?C.value=A:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:"Filter by name..."},null,8,["modelValue"])]),k("div",Do,[t(te)?(d(),I(W,{key:0,modelValue:t(b),"onUpdate:modelValue":x[10]||(x[10]=A=>X(b)?b.value=A:null),label:"Keep previous LoRAs",class:"mr-2"},null,8,["modelValue"])):R("",!0),t(te)?(d(),I(V,{key:1,variant:"outline",icon:"i-heroicons-x-circle",color:"orange",class:"mr-2",onClick:x[11]||(x[11]=()=>t(M).splice(0))},{default:w(()=>x[18]||(x[18]=[D(" Clear selection ")])),_:1})):R("",!0),p(ne,{text:t(ke)},{default:w(()=>[p(V,{variant:"outline",icon:"i-heroicons-check-16-solid",disabled:!t(J),loading:t(r),onClick:xe},{default:w(()=>x[19]||(x[19]=[D(" Apply and install ")])),_:1},8,["disabled","loading"])]),_:1},8,["text"])])]),p(ot,{modelValue:t(M),"onUpdate:modelValue":x[12]||(x[12]=A=>X(M)?M.value=A:null),expand:t(z),"onUpdate:expand":x[13]||(x[13]=A=>X(z)?z.value=A:null),columns:y,rows:t(T),loading:t(r),ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10",tr:{base:"dark:hover:bg-slate-800"}}},{caption:w(()=>x[20]||(x[20]=[k("caption",{class:"text-slate-500 text-sm py-1"},"Only supported LORAs for the basic model type are listed",-1)])),"select-header":w(({indeterminate:A,checked:ie,change:Ke})=>[k("div",Wo,[k("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:ie,indeterminate:A&&t(te),onChange:ht=>Ke(ht.target.checked)},null,40,Ho)])]),"select-data":w(({checked:A,change:ie,row:Ke})=>[Ke!=null&&Ke.currentFlowLora?R("",!0):(d(),O("div",Go,[k("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:A,onChange:ht=>ie(ht.target.checked)},null,40,Xo)]))]),"name-data":w(({row:A})=>[k("a",{href:`https://civitai.com/models/${A.id}`,target:"_blank",class:"text-blue-500 underline"},G(A.name),9,Jo)]),"description-data":w(({row:A})=>[p(ye,null,{panel:w(()=>[k("div",{class:"model-description p-4 max-h-64 max-w-xl overflow-y-auto",innerHTML:A.description},null,8,Ko)]),default:w(()=>[p(V,{color:"white",label:"Description","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:2},1024)]),"trigger_words-data":w(({row:A})=>[p(ye,null,{panel:w(()=>[k("div",Qo,[g(A).length===0?(d(),O("p",Yo,"No trigger words available for this model version.")):(d(!0),O(Z,{key:1},ce(g(A),ie=>(d(),I(Le,{key:ie,class:"flex flex-wrap gap-3 my-1 whitespace-normal",label:ie,color:"white",variant:"outline"},null,8,["label"]))),128))])]),default:w(()=>[p(V,{color:"white",label:`Trigger words (${g(A).length})`,"trailing-icon":"i-heroicons-chevron-down-20-solid"},null,8,["label"])]),_:2},1024)]),"nsfw-data":w(({row:A})=>[p(ne,{text:`NSFW level: ${A.nsfwLevel}`,class:"pl-4"},{default:w(()=>[p($e,{name:A.nsfw?"i-heroicons-x-circle":"i-heroicons-check-circle",class:le({"text-red-500":A.nsfw,"text-green-500":!A.nsfw})},null,8,["name","class"])]),_:2},1032,["text"])]),"statsThumbsUpCount-data":w(({row:A})=>[k("div",Zo,[p($e,{name:"i-heroicons-hand-thumb-up-solid",class:"text-green-500 mr-1"}),k("span",null,G(A.stats.thumbsUpCount),1)])]),"statsDownloadCount-data":w(({row:A})=>[k("div",es,[p($e,{name:"i-heroicons-arrow-down-circle",class:"text-blue-500 mr-1"}),k("span",null,G(A.stats.downloadCount),1)])]),"modelVersion-data":w(({row:A})=>[p(Ae,{modelValue:t(P)[A.id],"onUpdate:modelValue":ie=>t(P)[A.id]=ie,options:A.modelVersions.map(ie=>ie.name)},null,8,["modelValue","onUpdate:modelValue","options"])]),"actions-data":w(({row:A})=>[A!=null&&A.currentFlowLora?(d(),I(ne,{key:1,text:"Remove previously selected LoRA"},{default:w(()=>[p(V,{icon:"i-heroicons-minus-16-solid",variant:"outline",color:"orange",onClick:ie=>H(A)},null,8,["onClick"])]),_:2},1024)):(d(),I(V,{key:0,icon:t(M).includes(A)?"i-heroicons-check-16-solid":"i-heroicons-plus-16-solid",variant:"outline",color:t(M).includes(A)?"green":"white",onClick:()=>{if(t(M).includes(A)){t(M).splice(t(M).indexOf(A),1);return}t(M).push(A)}},null,8,["icon","color","onClick"]))]),expand:w(({row:A})=>[m(A).length>0?(d(),O("div",ts,[p(at,{class:"my-3",items:m(A).map(ie=>({id:ie.id,url:ie.url,type:(ie==null?void 0:ie.type)||"image"})),ui:{item:"mx-1"}},{default:w(({item:ie})=>[ie.type==="image"?(d(),I(nt,{key:0,src:ie.url,height:256,width:256,loading:"lazy",draggable:"false"},null,8,["src"])):(d(),O("video",ls,[k("source",{src:ie.url},null,8,ns)]))]),_:2},1032,["items"])])):(d(),I(K,{key:1,title:"No images",description:"No images available for this model version.",variant:"soft",color:"amber"}))]),_:1},8,["modelValue","expand","rows","loading"])]),_:1})])):(d(),I(K,{key:0,class:"my-4",title:"CivitAI token missing",description:"Please add a CivitAI token in the settings to use this feature.",variant:"soft",color:"red"},{actions:w(()=>[p(E,{to:"/settings"},{default:w(()=>[p(V,{class:"lg:px-3 py-2",icon:"i-heroicons-arrow-top-right-on-square-16-solid",variant:"link",color:"white"},{default:w(()=>x[16]||(x[16]=[D(" Go to Settings ")])),_:1})]),_:1})]),_:1}))])]),_:1},8,["modelValue"])}}}),ss={class:"p-4 overflow-y-auto relative"},is={class:"flex flex-col gap-2 mt-3"},rs={class:"flex justify-end mt-3"},us=Y({__name:"EditMetadataModal",props:We({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const l=e,n=Ne(e,"show"),s=ve(),u=he(),o=S(!1),i=S(l.flow.display_name),r=S(l.flow.description),f=S(l.flow.license),_=S(l.flow.required_memory_gb||0),h=S(l.flow.version),y=B(()=>i.value!==""&&r.value!=="");function M(){o.value=!0,s.updateFlowMetadata(l.flow,{display_name:i.value,description:r.value,license:f.value,required_memory_gb:_.value,version:h.value}).then(()=>{n.value=!1,u.add({title:"Flow metadata updated",description:"Flow metadata has been updated successfully."})}).catch(z=>{console.debug("Failed to update flow metadata:",z),u.add({title:"Flow metadata update failed",description:(z==null?void 0:z.details)??"Failed to update flow metadata. Please try again."})}).finally(()=>{o.value=!1})}return(z,C)=>{const F=Te,T=Oe,P=Ut,m=re,g=Fe;return d(),I(g,{modelValue:n.value,"onUpdate:modelValue":C[6]||(C[6]=b=>n.value=b)},{default:w(()=>[k("div",ss,[C[9]||(C[9]=k("h2",{class:"font-bold"},"Edit flow metadata",-1)),k("div",is,[p(T,{label:"New display name",class:"flex justify-center flex-col w-full",error:t(i)!==""?"":"Display name is required."},{default:w(()=>[p(F,{modelValue:t(i),"onUpdate:modelValue":C[0]||(C[0]=b=>X(i)?i.value=b:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),p(T,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(P,{modelValue:t(r),"onUpdate:modelValue":C[1]||(C[1]=b=>X(r)?r.value=b:null),placeholder:"Description"},null,8,["modelValue"])]),_:1}),p(T,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(F,{modelValue:t(f),"onUpdate:modelValue":C[2]||(C[2]=b=>X(f)?f.value=b:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),p(T,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(F,{modelValue:t(_),"onUpdate:modelValue":C[3]||(C[3]=b=>X(_)?_.value=b:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),p(T,{label:"Version",class:"flex justify-center flex-col w-full"},{default:w(()=>[p(F,{modelValue:t(h),"onUpdate:modelValue":C[4]||(C[4]=b=>X(h)?h.value=b:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})]),k("div",rs,[p(m,{class:"mr-2",variant:"soft",color:"white",onClick:C[5]||(C[5]=b=>n.value=!1)},{default:w(()=>C[7]||(C[7]=[D(" Cancel ")])),_:1}),p(m,{variant:"soft",color:"primary",loading:t(o),disabled:!t(y),onClick:M},{default:w(()=>C[8]||(C[8]=[D(" Save ")])),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])}}}),ds={class:"flex flex-col lg:flex-row flex-grow items-start w-full"},cs={class:"card-wrapper w-full lg:pr-5"},ms={key:0,class:"p-0 text-sm"},fs={class:"flex flex-row items-center text-slate-400 mb-2"},ps={class:"flex flex-row flex-wrap items-center text-md mb-2"},vs=["href"],gs={class:"flex flex-row items-center text-md mb-2"},ys=["href"],hs={key:1},bs={class:"flex flex-row items-center text-md mb-2"},ws={key:0},ks={class:"flex flex-row items-center text-md mb-2"},xs={key:0,class:"flex flex-row flex-wrap items-center text-md mb-2"},_s=["href"],$s={key:1},Cs={class:"flex flex-row items-center mb-2"},Is={key:1,class:"flex flex-row flex-wrap items-center text-md"},Ss={key:0,class:"flex justify-end"},Ps={class:"flex flex-row items-center justify-center text-sm mr-2"},Ms={key:1},Rs={class:"text-sm flex justify-end"},Fs={class:"flex flex-row items-center justify-center text-sm mr-3"},Us={key:0,class:"text-right"},Vs={class:"prompt-wrapper w-full"},zs={class:"flex items-center justify-between"},Ts={class:"pb-2"},Os={class:"flex justify-end items-center"},Xs=Y({__name:"[name]",setup(e){const l=Sl(),n=ve(),s=he();n.setCurrentFlow(l.params.name);const u=B(()=>n.flowInstallingByName(l.params.name)),o=B(()=>{var $;return u.value&&(($=u.value)==null?void 0:$.progress)<100||!1}),i=S(!1),r=B(()=>{var $;return u.value?"error"in u.value&&(($=u.value)==null?void 0:$.error)!==""?`${u.value.progress.toFixed(0)}% Error setting up`:`${u.value.progress.toFixed(0)}% Setting up`:"Setup flow"}),f=S(!1),_=S(!1),h=S(!1),y=S(!1),M=B(()=>{var v,q;const $=[[{label:"Export flow",icon:"i-heroicons-arrow-down-on-square-stack",click:()=>{n.fetchFlowDetails(n.currentFlow).then(a=>{console.debug("[DEBUG] Flow details for export: ",a);const c=new Blob([JSON.stringify(a==null?void 0:a.flow_comfy)],{type:"application/json"}),j=window.URL.createObjectURL(c),H=document.createElement("a");H.href=j,H.download=`${n.currentFlow.name}.json`,H.click(),window.URL.revokeObjectURL(j)}).catch(a=>{console.debug("Failed to fetch flow details for export: ",a),s.add({title:"Failed to export flow",description:(a==null?void 0:a.details)||"Failed to fetch flow details for export"})})}}],[{label:"Delete flow",icon:"i-heroicons-trash",click:C}]];return m.isAdmin&&$[0].unshift({label:"Edit metadata",icon:"i-heroicons-pencil-square",click:()=>{y.value=!0}}),((v=n==null?void 0:n.currentFlow)==null?void 0:v.new_version_available)!==""&&$[0].unshift({label:`Update to ${n.currentFlow.new_version_available}`,icon:"i-heroicons-arrow-path",click:()=>{n.updateFlow(n.currentFlow)}}),(q=n==null?void 0:n.currentFlow)!=null&&q.lora_connect_points&&Object.keys(n.currentFlow.lora_connect_points).length>0&&$[0].unshift({label:"Modify flow",icon:"i-heroicons-plus-circle",click:()=>{h.value=!0}}),$});function z($,v=!1){f.value=!0,n.deleteFlow($).then(()=>{v&&Qt().push("/")}).finally(()=>{f.value=!1,_.value=!1})}function C(){var v;const $=((v=n.currentFlow)==null?void 0:v.private)||!1;if($){_.value=!0;return}z(n.currentFlow,$)}const F=S(!1),T=S(null),P=function($){var v;(v=T.value)==null||v.copyPromptInputs($)},m=Rt(),g=B(()=>{var $;return($=n.currentFlow)==null?void 0:$.models.filter(v=>v.installed).reduce((v,q)=>v+(q==null?void 0:q.file_size)||0,0)}),b=B(()=>{var $;return($=n.currentFlow)==null?void 0:$.models.reduce((v,q)=>v+(q==null?void 0:q.file_size)||0,0)}),U=B(()=>!g.value&&!b.value?"":g.value===b.value?` - ${De(b.value)}`:` - ${De(g.value)} / ${De(b.value)}`);return($,v)=>{const q=be,a=Xe,c=Ge,j=re,H=gt,ee=Yt,ae=Zn,se=ya,ue=Oo,te=el,J=Fe,ke=os,xe=us,de=Pl;return d(),I(de,null,{default:w(()=>{var _e,we;return[!t(n).loading.flows_available&&!t(n).loading.flows_installed&&t(n).currentFlow&&!t(n).$state.loading.tasks_history?(d(),O(Z,{key:0},[k("div",ds,[k("div",cs,[p(ee,{as:"div",class:"w-full mb-5"},Ml({header:w(()=>{var L,x;return[k("h2",{class:"text-xl font-bold cursor-pointer select-none flex items-center",onClick:v[0]||(v[0]=()=>{F.value=!t(F)})},[(L=t(n).currentFlow)!=null&&L.private?(d(),I(a,{key:0,text:"This flow is local, manually added"},{default:w(()=>{var V;return[p(q,{name:"i-heroicons-lock-closed",class:le(["mr-2",{"text-stone-500":!((V=t(n).currentFlow)!=null&&V.is_supported_by_workers)}])},null,8,["class"])]}),_:1})):R("",!0),p(q,{name:t(F)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),p(a,{text:(x=t(n).currentFlow)!=null&&x.is_supported_by_workers?"":"No workers capable of running this flow",popper:{placement:"top"}},{default:w(()=>{var V,E;return[k("span",{class:le({"text-stone-500":!((V=t(n).currentFlow)!=null&&V.is_supported_by_workers)})},G((E=t(n).currentFlow)==null?void 0:E.display_name),3)]}),_:1},8,["text"])])]}),default:w(()=>{var L,x,V,E,K,N,Q,W,ne,ye,Le,$e,Ae,nt,at,ot,st;return[t(F)?R("",!0):(d(),O("div",ms,[k("p",fs,G((L=t(n).currentFlow)==null?void 0:L.description),1),k("p",ps,[p(q,{name:"i-heroicons-user-16-solid",class:"mr-1"}),v[10]||(v[10]=k("b",null,"Author:",-1)),v[11]||(v[11]=D(" ")),k("a",{class:"hover:underline text-md",href:(x=t(n).currentFlow)==null?void 0:x.homepage,rel:"noopener",target:"_blank"},G((V=t(n).currentFlow)==null?void 0:V.author),9,vs)]),k("p",gs,[p(q,{name:"i-heroicons-document-text",class:"mr-1"}),(E=t(n).currentFlow)!=null&&E.documentation?(d(),O("a",{key:0,class:"hover:underline",href:(K=t(n).currentFlow)==null?void 0:K.documentation,rel:"noopener",target:"_blank"}," Documentation ",8,ys)):(d(),O("span",hs,"No documentation"))]),k("p",bs,[p(q,{name:"i-heroicons-clock",class:"mr-1"}),v[12]||(v[12]=k("b",null,"Version:",-1)),v[13]||(v[13]=D(" ")),k("span",null,G((N=t(n).currentFlow)==null?void 0:N.version),1),((Q=t(n).currentFlow)==null?void 0:Q.new_version_available)!==""?(d(),O("span",ws," (new version available: "+G((W=t(n).currentFlow)==null?void 0:W.new_version_available)+") ",1)):R("",!0)]),k("p",ks,[p(q,{name:"i-heroicons-tag",class:"mr-1"}),v[14]||(v[14]=k("b",null,"Tags:",-1)),v[15]||(v[15]=D(" ")),((ne=t(n).currentFlow)==null?void 0:ne.tags.length)>0?(d(!0),O(Z,{key:0},ce((ye=t(n).currentFlow)==null?void 0:ye.tags,oe=>(d(),I(c,{key:oe,label:oe,color:"white",variant:"solid",class:"m-1"},null,8,["label"]))),128)):(d(),I(c,{key:1,label:"No tags",color:"white",variant:"solid",class:"m-1"}))]),(($e=(Le=t(n).currentFlow)==null?void 0:Le.models)==null?void 0:$e.length)>0?(d(),O("p",xs,[p(q,{name:"i-heroicons-arrow-down-on-square-stack",class:"mr-1"}),p(a,{text:t(b)-t(g)>0?`${("formatBytes"in $?$.formatBytes:t(De))(t(b)-t(g))} to download`:"All models installed",popper:{placement:"top"}},{default:w(()=>{var oe;return[k("b",null,"Models ("+G((oe=t(n).currentFlow)==null?void 0:oe.models.length)+G(t(U))+"):",1),v[16]||(v[16]=D(" "))]}),_:1},8,["text"]),(d(!0),O(Z,null,ce((Ae=t(n).currentFlow)==null?void 0:Ae.models,oe=>(d(),I(c,{key:oe.name,class:"m-1",color:"white",variant:"solid"},{default:w(()=>[p(a,{text:oe.installed?"Model installed":"Model not installed"},{default:w(()=>[p(q,{name:oe.installed?"i-heroicons-check-circle-20-solid":"i-heroicons-x-mark-20-solid",class:le(oe.installed?"text-green-500":"text-orange-500")},null,8,["name","class"])]),_:2},1032,["text"]),oe.gated?(d(),I(a,{key:0,text:"Gated model, requires auth token for download",popper:{placement:"top"}},{default:w(()=>[p(q,{name:"i-heroicons-key",class:"mr-1"})]),_:1})):R("",!0),k("a",{class:"hover:underline underline-offset-4",href:oe.homepage,rel:"noopener",target:"_blank"},G(oe.name),9,_s),oe.file_size?(d(),O("span",$s," ("+G(("formatBytes"in $?$.formatBytes:t(De))(oe.file_size))+") ",1)):R("",!0)]),_:2},1024))),128))])):R("",!0),k("p",Cs,[p(q,{name:"i-mdi-help-network-outline",class:"mr-1"}),v[19]||(v[19]=k("b",null,"Platforms:",-1)),v[20]||(v[20]=D(" ")),p(a,{text:"Linux"},{default:w(()=>[p(q,{name:"i-mdi-linux",class:"mr-1"})]),_:1}),p(a,{text:"Microsoft Windows"},{default:w(()=>[p(q,{name:"i-mdi-microsoft-windows",class:"mr-1"})]),_:1}),t(n).currentFlow.is_macos_supported?(d(),I(a,{key:0,text:"macOS"},{default:w(()=>[p(q,{name:"i-mdi-apple",class:"mr-1"})]),_:1})):R("",!0),(nt=t(n).currentFlow)!=null&&nt.required_memory_gb?(d(),I(a,{key:1,class:"flex flex-row items-center",text:"Required VRAM memory (GB)"},{default:w(()=>{var oe;return[v[17]||(v[17]=D(" (")),p(q,{name:"i-mdi-memory",class:"mr-1"}),k("span",null,G((oe=t(n).currentFlow)==null?void 0:oe.required_memory_gb)+" GB",1),v[18]||(v[18]=D(") "))]}),_:1})):R("",!0)]),((ot=(at=t(n).currentFlow)==null?void 0:at.requires)==null?void 0:ot.length)>0?(d(),O("p",Is,[v[21]||(v[21]=k("b",null,"Requires:",-1)),v[22]||(v[22]=D(" ")),(d(!0),O(Z,null,ce((st=t(n).currentFlow)==null?void 0:st.requires,oe=>(d(),I(c,{key:oe,class:"m-1",color:"yellow",variant:"outline"},{default:w(()=>[D(G(oe),1)]),_:2},1024))),128))])):R("",!0)]))]}),_:2},[t(F)?void 0:{name:"footer",fn:w(()=>{var L,x;return[t(m).isAdmin?(d(),O("div",Ss,[k("div",Ps,[p(q,{name:t(n).isFlowInstalled(t(l).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),k("span",{class:le({"text-green-500":t(n).isFlowInstalled(t(l).params.name),"text-red-500":!t(n).isFlowInstalled(t(l).params.name),"text-stone-500":t(n).isFlowInstalled(t(l).params.name)&&!((L=t(n).currentFlow)!=null&&L.is_supported_by_workers)})},G(t(n).isFlowInstalled(t(l).params.name)?(x=t(n).currentFlow)!=null&&x.is_supported_by_workers?"Installed":"Installed (no workers)":"Not installed"),3)]),t(n).isFlowInstalled(t(l).params.name)?R("",!0):(d(),I(a,{key:0,text:"Setup flow dependencies and configure it in ComfyUI",popper:{placement:"top"},"open-delay":500},{default:w(()=>[p(j,{icon:"i-heroicons-arrow-down-tray",class:"mx-3",color:"primary",variant:"outline",loading:t(o),onClick:v[1]||(v[1]=()=>t(n).setupFlow(t(n).currentFlow))},{default:w(()=>[D(G(t(r)),1)]),_:1},8,["loading"])]),_:1})),!t(n).isFlowInstalled(t(l).params.name)&&t(o)?(d(),I(a,{key:1,text:"Cancel flow installation",popper:{placement:"top"},"open-delay":500},{default:w(()=>[p(j,{icon:"i-heroicons-stop",variant:"outline",color:"orange",loading:t(i),onClick:v[2]||(v[2]=()=>{i.value=!0,t(n).cancelFlowSetup(t(n).currentFlow).then(()=>{i.value=!1})})},{default:w(()=>v[23]||(v[23]=[D(" Cancel ")])),_:1},8,["loading"])]),_:1})):R("",!0),t(n).isFlowInstalled(t(l).params.name)?(d(),I(H,{key:2,items:t(M),mode:"click",label:"Actions",popper:{placement:"bottom-end"}},{default:w(()=>[p(j,{color:"white",label:"Actions","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:1},8,["items"])):R("",!0)])):(d(),O("div",Ms,[k("div",Rs,[k("div",Fs,[p(q,{name:t(n).isFlowInstalled(t(l).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),k("span",{class:le({"text-green-500":t(n).isFlowInstalled(t(l).params.name),"text-red-500":!t(n).isFlowInstalled(t(l).params.name)})},G(t(n).isFlowInstalled(t(l).params.name)?"Installed":"Not installed"),3)]),t(n).isFlowInstalled(t(l).params.name)?R("",!0):(d(),O("div",Us,v[24]||(v[24]=[k("p",{class:"text-orange-500"},"Only admin can manage workflows.",-1),k("span",{class:"text-slate-500"},"Ask your admin to setup this workflow",-1)])))])]))]}),key:"0"}]),1024)]),k("div",Vs,[!t(f)&&t(n).isFlowInstalled(t(l).params.name)?(d(),I(ae,{key:0,ref_key:"workflowPrompt",ref:T},null,512)):R("",!0)])]),!t(f)&&t(n).isFlowInstalled(t(l).params.name)?(d(),I(se,{key:0})):R("",!0),!t(f)&&t(n).isFlowInstalled(t(l).params.name)||t(n).flowResultsByName(t(l).params.name).length>0?(d(),I(ue,{key:1,onCopyPromptInputs:v[3]||(v[3]=L=>P(L))})):R("",!0)],64)):(d(),I(te,{key:1,class:"mb-3"})),p(J,{modelValue:t(_),"onUpdate:modelValue":v[7]||(v[7]=L=>X(_)?_.value=L:null),"prevent-close":""},{default:w(()=>[p(ee,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:w(()=>[k("div",zs,[v[25]||(v[25]=k("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Confirm workflow deletion ",-1)),p(j,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:v[4]||(v[4]=L=>_.value=!1)})])]),default:w(()=>{var L;return[k("p",Ts,[v[26]||(v[26]=D(" Are you sure you want to delete the ")),v[27]||(v[27]=k("b",null,"private",-1)),v[28]||(v[28]=D(" workflow ")),k("b",null,G((L=t(n).currentFlow)==null?void 0:L.display_name),1),v[29]||(v[29]=D("? "))]),k("div",Os,[p(j,{icon:"i-heroicons-x-mark-16-solid",variant:"outline",color:"green",class:"mr-2",onClick:v[5]||(v[5]=x=>_.value=!1)},{default:w(()=>v[30]||(v[30]=[D(" Cancel ")])),_:1}),p(j,{icon:"i-heroicons-trash",variant:"outline",color:"red",onClick:v[6]||(v[6]=x=>{var V;return z(t(n).currentFlow,((V=t(n).currentFlow)==null?void 0:V.private)||!1)})},{default:w(()=>v[31]||(v[31]=[D(" Delete ")])),_:1})])]}),_:1})]),_:1},8,["modelValue"]),t(m).isAdmin&&((_e=t(n))!=null&&_e.currentFlow)?(d(),I(ke,{key:2,show:t(h),"onUpdate:show":v[8]||(v[8]=L=>X(h)?h.value=L:null),flow:t(n).currentFlow},null,8,["show","flow"])):R("",!0),t(m).isAdmin&&((we=t(n))!=null&&we.currentFlow)?(d(),I(xe,{key:3,show:t(y),"onUpdate:show":v[9]||(v[9]=L=>X(y)?y.value=L:null),flow:t(n).currentFlow},null,8,["show","flow"])):R("",!0)]}),_:1})}}});export{Xs as default};
