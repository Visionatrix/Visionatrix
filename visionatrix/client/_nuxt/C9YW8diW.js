import{A as ot,W as Nt,B as Ce,_ as at,f as oe,c as j,o as r,a as w,C as Oe,D as Re,n as le,G as st,H as Be,M as R,X as it,S as Se,s as we,Y as Bt,v as L,J as Je,I as ze,Z as Lt,$ as At,a0 as ft,a1 as nt,a2 as qt,a3 as Et,a4 as pt,a5 as Le,a6 as wt,a7 as Dt,p as t,a8 as Wt,a9 as rt,aa as Ht,ab as yt,ac as Ae,ad as je,g as fe,L as Qe,T as bt,ae as Ne,i as S,k as P,w as k,b as m,F as se,r as ve,m as ue,d as D,O as Q,af as Gt,q as Me,ag as Xt,t as X,ah as Ke,P as kt,j as Ee,Q as ut,y as Jt,N as Ve,h as xe,x as xt,ai as _t,l as De,aj as dt,ak as Qt,al as Kt,am as Yt,R as lt,an as $t,ao as Ct,ap as me,aq as St,ar as Zt,E as en,as as It,at as tn,z as nn,au as ln}from"./BKXcbEGb.js";import{b as Ye,a as on,_ as Rt}from"./CWHdM2Vj.js";import{u as Mt,_ as We}from"./DAXnJBN6.js";import{_ as an}from"./FMtmkhQW.js";import{_ as He}from"./D3TYDqrQ.js";import{_ as Ie,a as sn}from"./DmhHvJLJ.js";import{_ as Ze}from"./79SSFOpF.js";import{a as Ge,_ as Ft}from"./Cg-eLkN3.js";import{_ as ct}from"./DK-as9ws.js";import{_ as rn}from"./BDNYNU54.js";import{_ as un}from"./B8MkUAF6.js";const dn={wrapper:"relative",container:"relative w-full flex overflow-x-auto snap-x snap-mandatory scroll-smooth",item:"flex flex-none snap-center",arrows:{wrapper:"flex items-center justify-between"},indicators:{wrapper:"absolute flex items-center justify-center gap-3 bottom-4 inset-x-0",base:"rounded-full h-3 w-3",active:"bg-primary-500 dark:bg-primary-400",inactive:"bg-gray-100 dark:bg-gray-800"},default:{prevButton:{color:"black",class:"rtl:[&_span:first-child]:rotate-180 absolute start-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-left-20-solid"},nextButton:{color:"black",class:"rtl:[&_span:last-child]:rotate-180 absolute end-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-right-20-solid"}}},cn={wrapper:"relative w-full flex items-center",base:"w-full absolute appearance-none cursor-pointer disabled:cursor-not-allowed disabled:bg-opacity-50 focus:outline-none peer group",rounded:"rounded-lg",background:"bg-transparent",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",progress:{base:"absolute pointer-events-none peer-disabled:bg-opacity-50",rounded:"rounded-s-lg",background:"bg-{color}-500 dark:bg-{color}-400",size:{"2xs":"h-px",xs:"h-0.5",sm:"h-1",md:"h-2",lg:"h-3",xl:"h-4","2xl":"h-5"}},thumb:{base:"[&::-webkit-slider-thumb]:relative [&::-moz-range-thumb]:relative [&::-webkit-slider-thumb]:z-[1] [&::-moz-range-thumb]:z-[1] [&::-webkit-slider-thumb]:appearance-none [&::-moz-range-thumb]:appearance-none [&::-webkit-slider-thumb]:rounded-full [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:border-0",color:"text-{color}-500 dark:text-{color}-400",background:"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:dark:bg-gray-900 [&::-moz-range-thumb]:bg-current",ring:"[&::-webkit-slider-thumb]:ring-2 [&::-webkit-slider-thumb]:ring-current",size:{"2xs":"[&::-webkit-slider-thumb]:h-1.5 [&::-moz-range-thumb]:h-1.5 [&::-webkit-slider-thumb]:w-1.5 [&::-moz-range-thumb]:w-1.5 [&::-webkit-slider-thumb]:mt-[-2.5px] [&::-moz-range-thumb]:mt-[-2.5px]",xs:"[&::-webkit-slider-thumb]:h-2 [&::-moz-range-thumb]:h-2 [&::-webkit-slider-thumb]:w-2 [&::-moz-range-thumb]:w-2 [&::-webkit-slider-thumb]:mt-[-3px] [&::-moz-range-thumb]:mt-[-3px]",sm:"[&::-webkit-slider-thumb]:h-3 [&::-moz-range-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-moz-range-thumb]:w-3 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",md:"[&::-webkit-slider-thumb]:h-4 [&::-moz-range-thumb]:h-4 [&::-webkit-slider-thumb]:w-4 [&::-moz-range-thumb]:w-4 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",lg:"[&::-webkit-slider-thumb]:h-5 [&::-moz-range-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 [&::-moz-range-thumb]:w-5 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",xl:"[&::-webkit-slider-thumb]:h-6 [&::-moz-range-thumb]:h-6 [&::-webkit-slider-thumb]:w-6 [&::-moz-range-thumb]:w-6 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1","2xl":"[&::-webkit-slider-thumb]:h-7 [&::-moz-range-thumb]:h-7 [&::-webkit-slider-thumb]:w-7 [&::-moz-range-thumb]:w-7 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1"}},track:{base:"[&::-webkit-slider-runnable-track]:group-disabled:bg-opacity-50 [&::-moz-range-track]:group-disabled:bg-opacity-50",background:"[&::-webkit-slider-runnable-track]:bg-gray-200 [&::-moz-range-track]:bg-gray-200 [&::-webkit-slider-runnable-track]:dark:bg-gray-700 [&::-moz-range-track]:dark:bg-gray-700",rounded:"[&::-webkit-slider-runnable-track]:rounded-lg [&::-moz-range-track]:rounded-lg",size:{"2xs":"[&::-webkit-slider-runnable-track]:h-px [&::-moz-range-track]:h-px",xs:"[&::-webkit-slider-runnable-track]:h-0.5 [&::-moz-range-track]:h-0.5",sm:"[&::-webkit-slider-runnable-track]:h-1 [&::-moz-range-track]:h-1",md:"[&::-webkit-slider-runnable-track]:h-2 [&::-moz-range-track]:h-2",lg:"[&::-webkit-slider-runnable-track]:h-3 [&::-moz-range-track]:h-3",xl:"[&::-webkit-slider-runnable-track]:h-4 [&::-moz-range-track]:h-4","2xl":"[&::-webkit-slider-runnable-track]:h-5 [&::-moz-range-track]:h-5"}},size:{"2xs":"h-1.5",xs:"h-2",sm:"h-3",md:"h-4",lg:"h-5",xl:"h-6","2xl":"h-7"},default:{size:"md",color:"primary"}},$e=ot(Ce.ui.strategy,Ce.ui.textarea,Nt),mn=oe({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys($e.size).includes(e)}},color:{type:String,default:()=>$e.default.color,validator(e){return[...Ce.ui.colors,...Object.keys($e.color)].includes(e)}},variant:{type:String,default:()=>$e.default.variant,validator(e){return[...Object.keys($e.variant),...Object.values($e.color).flatMap(n=>Object.keys(n))].includes(e)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:n}){const{ui:l,attrs:a}=st("textarea",Be(e,"ui"),$e,Be(e,"class")),{emitFormBlur:i,emitFormInput:o,inputId:u,color:d,size:f,name:$}=Mt(e,$e),b=R(it({},e.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),_=R(null),F=()=>{var h;e.autofocus&&((h=_.value)==null||h.focus())},U=()=>{if(e.autoresize){if(!_.value)return;_.value.rows=e.rows;const h=_.value.style.overflow;_.value.style.overflow="hidden";const x=window.getComputedStyle(_.value),p=Number.parseInt(x.paddingTop),B=Number.parseInt(x.paddingBottom),s=p+B,C=Number.parseInt(x.lineHeight),{scrollHeight:y}=_.value,g=(y-s)/C;g>e.rows&&(_.value.rows=e.maxrows?Math.min(g,e.maxrows):g),_.value.style.overflow=h}},I=h=>{b.value.trim&&(h=h.trim()),b.value.number&&(h=Lt(h)),b.value.nullify&&(h||(h=null)),n("update:modelValue",h),o()},O=h=>{U(),b.value.lazy||I(h.target.value)},N=h=>{const x=h.target.value;n("change",x),b.value.lazy&&I(x),b.value.trim&&(h.target.value=x.trim())},M=h=>{n("blur",h),i()};Se(()=>{setTimeout(()=>{F()},e.autofocusDelay)}),we(()=>e.modelValue,()=>{Bt(U)}),Se(()=>{setTimeout(()=>{F(),U()},100)});const c=L(()=>{var x,p;const h=((p=(x=l.value.color)==null?void 0:x[d.value])==null?void 0:p[e.variant])||l.value.variant[e.variant];return Je(ze(l.value.base,l.value.form,l.value.rounded,l.value.placeholder,l.value.size[f.value],e.padded?l.value.padding[f.value]:"p-0",h==null?void 0:h.replaceAll("{color}",d.value),!e.resize&&"resize-none"),e.textareaClass)});return{ui:l,attrs:a,name:$,inputId:u,textarea:_,textareaClass:c,onInput:O,onChange:N,onBlur:M}}}),fn=["id","value","name","rows","required","disabled","placeholder"];function pn(e,n,l,a,i,o){return r(),j("div",{class:le(e.ui.wrapper)},[w("textarea",Re({id:e.inputId,ref:"textarea",value:e.modelValue,name:e.name,rows:e.rows,required:e.required,disabled:e.disabled,placeholder:e.placeholder,class:e.textareaClass},e.attrs,{onInput:n[0]||(n[0]=(...u)=>e.onInput&&e.onInput(...u)),onBlur:n[1]||(n[1]=(...u)=>e.onBlur&&e.onBlur(...u)),onChange:n[2]||(n[2]=(...u)=>e.onChange&&e.onChange(...u))}),null,16,fn),Oe(e.$slots,"default")],2)}const gn=at(mn,[["render",pn]]);async function vn(e,n){return await hn(n).catch(a=>(console.error("Failed to get image meta for "+n,a+""),{width:0,height:0,ratio:0}))}async function hn(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((n,l)=>{const a=new Image;a.onload=()=>{const i={width:a.width,height:a.height,ratio:a.width/a.height};n(i)},a.onerror=i=>l(i),a.src=e})}function gt(e){return n=>n?e[n]||n:e.missingValue}function wn({formatter:e,keyMap:n,joinWith:l="/",valueMap:a}={}){e||(e=(o,u)=>`${o}=${u}`),n&&typeof n!="function"&&(n=gt(n));const i=a||{};return Object.keys(i).forEach(o=>{typeof i[o]!="function"&&(i[o]=gt(i[o]))}),(o={})=>Object.entries(o).filter(([d,f])=>typeof f<"u").map(([d,f])=>{const $=i[d];return typeof $=="function"&&(f=$(o[d])),d=typeof n=="function"?n(d):d,e(d,f)}).join(l)}function ke(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return Number.parseInt(e,10)}function yn(e=""){if(e===void 0||!e.length)return[];const n=new Set;for(const l of e.split(" ")){const a=Number.parseInt(l.replace("x",""));a&&n.add(a)}return Array.from(n)}function bn(e){if(e.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function kn(e){const n={};if(typeof e=="string")for(const l of e.split(/[\s,]+/).filter(a=>a)){const a=l.split(":");a.length!==2?n["1px"]=a[0].trim():n[a[0].trim()]=a[1].trim()}else Object.assign(n,e);return n}function xn(e){const n={options:e},l=(i,o={})=>Pt(n,i,o),a=(i,o={},u={})=>l(i,{...u,modifiers:it(o,u.modifiers||{})}).url;for(const i in e.presets)a[i]=(o,u,d)=>a(o,u,{...e.presets[i],...d});return a.options=e,a.getImage=l,a.getMeta=(i,o)=>_n(n,i,o),a.getSizes=(i,o)=>Sn(n,i,o),n.$img=a,a}async function _n(e,n,l){const a=Pt(e,n,{...l});return typeof a.getMeta=="function"?await a.getMeta():await vn(e,a.url)}function Pt(e,n,l){var $,b;if(n&&typeof n!="string")throw new TypeError(`input must be a string (received ${typeof n}: ${JSON.stringify(n)})`);if(!n||n.startsWith("data:"))return{url:n};const{provider:a,defaults:i}=$n(e,l.provider||e.options.provider),o=Cn(e,l.preset);if(n=ft(n)?n:At(n),!a.supportsAlias){for(const _ in e.options.alias)if(n.startsWith(_)){const F=e.options.alias[_];F&&(n=nt(F,n.slice(_.length)))}}if(a.validateDomains&&ft(n)){const _=qt(n).host;if(!e.options.domains.find(F=>F===_))return{url:n}}const u=it(l,o,i);u.modifiers={...u.modifiers};const d=u.modifiers.format;($=u.modifiers)!=null&&$.width&&(u.modifiers.width=ke(u.modifiers.width)),(b=u.modifiers)!=null&&b.height&&(u.modifiers.height=ke(u.modifiers.height));const f=a.getImage(n,u,e);return f.format=f.format||d||"",f}function $n(e,n){const l=e.options.providers[n];if(!l)throw new Error("Unknown provider: "+n);return l}function Cn(e,n){if(!n)return{};if(!e.options.presets[n])throw new Error("Unknown preset: "+n);return e.options.presets[n]}function Sn(e,n,l){var I,O,N,M,c;const a=ke((I=l.modifiers)==null?void 0:I.width),i=ke((O=l.modifiers)==null?void 0:O.height),o=kn(l.sizes),u=(N=l.densities)!=null&&N.trim()?yn(l.densities.trim()):e.options.densities;bn(u);const d=a&&i?i/a:0,f=[],$=[];if(Object.keys(o).length>=1){for(const h in o){const x=vt(h,String(o[h]),i,d,e);if(x!==void 0){f.push({size:x.size,screenMaxWidth:x.screenMaxWidth,media:`(max-width: ${x.screenMaxWidth}px)`});for(const p of u)$.push({width:x._cWidth*p,src:ht(e,n,l,x,p)})}}In(f)}else for(const h of u){const x=Object.keys(o)[0];let p=x?vt(x,String(o[x]),i,d,e):void 0;p===void 0&&(p={size:"",screenMaxWidth:0,_cWidth:(M=l.modifiers)==null?void 0:M.width,_cHeight:(c=l.modifiers)==null?void 0:c.height}),$.push({width:h,src:ht(e,n,l,p,h)})}Rn($);const b=$[$.length-1],_=f.length?f.map(h=>`${h.media?h.media+" ":""}${h.size}`).join(", "):void 0,F=_?"w":"x",U=$.map(h=>`${h.src} ${h.width}${F}`).join(", ");return{sizes:_,srcset:U,src:b==null?void 0:b.src}}function vt(e,n,l,a,i){const o=i.options.screens&&i.options.screens[e]||Number.parseInt(e),u=n.endsWith("vw");if(!u&&/^\d+$/.test(n)&&(n=n+"px"),!u&&!n.endsWith("px"))return;let d=Number.parseInt(n);if(!o||!d)return;u&&(d=Math.round(d/100*o));const f=a?Math.round(d*a):l;return{size:n,screenMaxWidth:o,_cWidth:d,_cHeight:f}}function ht(e,n,l,a,i){return e.$img(n,{...l.modifiers,width:a._cWidth?a._cWidth*i:void 0,height:a._cHeight?a._cHeight*i:void 0},l)}function In(e){var l;e.sort((a,i)=>a.screenMaxWidth-i.screenMaxWidth);let n=null;for(let a=e.length-1;a>=0;a--){const i=e[a];i.media===n&&e.splice(a,1),n=i.media}for(let a=0;a<e.length;a++)e[a].media=((l=e[a+1])==null?void 0:l.media)||""}function Rn(e){e.sort((l,a)=>l.width-a.width);let n=null;for(let l=e.length-1;l>=0;l--){const a=e[l];a.width===n&&e.splice(l,1),n=a.width}}const Mn=wn({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,n)=>pt(e)+"_"+pt(n)}),Fn=(e,{modifiers:n={},baseURL:l}={},a)=>{n.width&&n.height&&(n.resize=`${n.width}x${n.height}`,delete n.width,delete n.height);const i=Mn(n)||"_";return l||(l=nt(a.options.nuxt.baseURL,"/_ipx")),{url:nt(l,i,Et(e))}},Pn=!0,Un=!0,zn=Object.freeze(Object.defineProperty({__proto__:null,getImage:Fn,supportsAlias:Un,validateDomains:Pn},Symbol.toStringTag,{value:"Module"})),Ut={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};Ut.providers={ipxStatic:{provider:zn,defaults:{}}};const mt=()=>{const e=wt(),n=Le();return n.$img||n._img||(n._img=xn({...Ut,nuxt:{baseURL:e.app.baseURL},runtimeConfig:e}))};function Vn(e){var n;(n=performance==null?void 0:performance.mark)==null||n.call(performance,"mark_feature_usage",{detail:{feature:e}})}const On={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},jn=e=>{const n=L(()=>({provider:e.provider,preset:e.preset})),l=L(()=>({width:ke(e.width),height:ke(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding,nonce:e.nonce})),a=mt(),i=L(()=>({...e.modifiers,width:ke(e.width),height:ke(e.height),format:e.format,quality:e.quality||a.options.quality,background:e.background,fit:e.fit}));return{options:n,attrs:l,modifiers:i}},Tn={...On,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},Nn=["src"],_e=oe({__name:"NuxtImg",props:Tn,emits:["load","error"],setup(e,{emit:n}){const l=e,a=Dt(),i=n,o=!1,u=mt(),d=jn(l),f=R(!1),$=R(),b=L(()=>u.getSizes(l.src,{...d.options.value,sizes:l.sizes,densities:l.densities,modifiers:{...d.modifiers.value,width:ke(l.width),height:ke(l.height)}})),_=L(()=>{const M={...d.attrs.value,"data-nuxt-img":""};return(!l.placeholder||f.value)&&(M.sizes=b.value.sizes,M.srcset=b.value.srcset),M}),F=L(()=>{let M=l.placeholder;if(M===""&&(M=!0),!M||f.value)return!1;if(typeof M=="string")return M;const c=Array.isArray(M)?M:typeof M=="number"?[M,M]:[10,10];return u(l.src,{...d.modifiers.value,width:c[0],height:c[1],quality:c[2]||50,blur:c[3]||3},d.options.value)}),U=L(()=>l.sizes?b.value.src:u(l.src,d.modifiers.value,d.options.value)),I=L(()=>F.value?F.value:U.value),N=Le().isHydrating;return Se(()=>{if(F.value||l.custom){const M=new Image;U.value&&(M.src=U.value),l.sizes&&(M.sizes=b.value.sizes||"",M.srcset=b.value.srcset),M.onload=c=>{f.value=!0,i("load",c)},M.onerror=c=>{i("error",c)},Vn("nuxt-image");return}$.value&&($.value.complete&&N&&($.value.getAttribute("data-error")?i("error",new Event("error")):i("load",new Event("load"))),$.value.onload=M=>{i("load",M)},$.value.onerror=M=>{i("error",M)})}),(M,c)=>M.custom?Oe(M.$slots,"default",Wt(Re({key:1},{...t(o)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{..._.value,...t(a)},isLoaded:f.value,src:I.value}))):(r(),j("img",Re({key:0,ref_key:"imgEl",ref:$,class:l.placeholder&&!f.value?l.placeholderClass:void 0},{...t(o)?{onerror:"this.setAttribute('data-error', 1)"}:{},..._.value,...t(a)},{src:I.value}),null,16,Nn))}}),Xe=ot(Ce.ui.strategy,Ce.ui.range,cn),Bn=oe({inheritAttrs:!1,props:{modelValue:{type:Number,default:0},id:{type:String,default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},size:{type:String,default:null,validator(e){return Object.keys(Xe.size).includes(e)}},color:{type:String,default:()=>Xe.default.color,validator(e){return Ce.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:n}){const{ui:l,attrs:a}=st("range",Be(e,"ui"),Xe),{emitFormChange:i,inputId:o,color:u,size:d,name:f}=Mt(e,Xe),$=L({get(){return e.modelValue},set(M){n("update:modelValue",M)}}),b=M=>{n("change",M.target.value),i()},_=L(()=>Je(ze(l.value.wrapper,l.value.size[d.value]),e.class)),F=L(()=>Je(ze(l.value.base,l.value.background,l.value.rounded,u.value&&l.value.ring.replaceAll("{color}",u.value),l.value.size[d.value]),e.inputClass)),U=L(()=>ze(l.value.thumb.base,u.value&&l.value.thumb.color.replaceAll("{color}",u.value),l.value.thumb.ring,l.value.thumb.background,l.value.thumb.size[d.value])),I=L(()=>ze(l.value.track.base,l.value.track.background,l.value.track.rounded,l.value.track.size[d.value])),O=L(()=>ze(l.value.progress.base,l.value.progress.rounded,u.value&&l.value.progress.background.replaceAll("{color}",u.value),l.value.progress.size[d.value])),N=L(()=>{const{modelValue:M,min:c,max:h}=e;return{width:`${(Math.max(c,Math.min(M,h))-c)/(h-c)*100}%`}});return{ui:l,attrs:a,name:f,inputId:o,value:$,wrapperClass:_,inputClass:F,thumbClass:U,trackClass:I,progressClass:O,progressStyle:N,onChange:b}}}),Ln=["id","name","min","max","disabled","step"];function An(e,n,l,a,i,o){return r(),j("div",{class:le(e.wrapperClass)},[rt(w("input",Re({id:e.inputId,ref:"input","onUpdate:modelValue":n[0]||(n[0]=u=>e.value=u),name:e.name,min:e.min,max:e.max,disabled:e.disabled,step:e.step,type:"range",class:[e.inputClass,e.thumbClass,e.trackClass]},e.attrs,{onChange:n[1]||(n[1]=(...u)=>e.onChange&&e.onChange(...u))}),null,16,Ln),[[Ht,e.value,void 0,{number:!0}]]),w("span",{class:le(e.progressClass),style:yt(e.progressStyle)},null,6)],2)}const zt=at(Bn,[["render",An]]),qn={class:"image-mask flex flex-col w-full"},En={class:"canvas flex flex-col items-center justify-center mb-3 w-full"},Dn={class:"preview-over-original relative"},Wn={class:"actions flex items-center justify-center mb-3 mx-auto"},Hn={class:"options w-full max-w-[320px]"},Gn=oe({__name:"ImageInpaint",props:Ae({imageSrc:{type:String,required:!0}},{imageInpaintMask:{default:"",type:String},imageInpaintMaskModifiers:{},imageInpaintMaskData:{default:{},type:Object},imageInpaintMaskDataModifiers:{}}),emits:["update:imageInpaintMask","update:imageInpaintMaskData"],setup(e){const n=e,l=je(e,"imageInpaintMask"),a=je(e,"imageInpaintMaskData"),i=fe(),o=R(null),u=R(null),d=R(null),f=R(null),$=R(30),b=R([]),_=R({width:i.$state.outputMaxSize,height:i.$state.outputMaxSize}),F=R(null),U=R({x:0,y:0}),I=R({x:0,y:0,radius:$.value,fill:"rgba(255, 255, 255, 0.5)",stroke:null,strokeWidth:0,visible:!1}),O=R(5),N=R(!1),M=R([]),c=R([]);function h(){if(!o.value||!d.value){console.error("Could not get stage, image layer, or mask layer");return}const v=o.value.getNode(),z=f.value?f.value.width:v.width(),q=f.value?f.value.height:v.height(),H=document.createElement("canvas");H.width=z,H.height=q;const V=H.getContext("2d");if(!V){console.error("Could not get 2d context for mask canvas");return}V.fillStyle="black",V.fillRect(0,0,z,q);const G=z/v.width(),W=q/v.height();V.fillStyle="white",b.value.forEach(he=>{V.beginPath(),V.arc(he.x*G,he.y*W,he.radius*Math.max(G,W),0,Math.PI*2,!0),V.closePath(),V.fill()});const K=H.toDataURL("image/png",1);K?(g(),l.value=K,I.value.visible=!1,N.value=!1):console.error("Could not get data URI for masked image")}function x(v){const z=o.value.getNode();if(v.type.startsWith("touch")){const q=v.evt.touches[0]||v.evt.changedTouches[0];return{x:q.clientX-z.getContainer().offsetLeft,y:q.clientY-z.getContainer().offsetTop}}return z.getPointerPosition()}function p(v){v.type==="mousedown"&&v.evt.button!==0||(N.value=!0,U.value=x(v),y(),B(U.value))}function B(v){const z={x:v.x,y:v.y,radius:$.value,fill:"rgba(255, 255, 255, 1)"};b.value=b.value.filter(q=>!(s({x:q.x,y:q.y},v)+q.radius<=z.radius)),b.value.push(z)}function s(v,z){return Math.sqrt(Math.pow(z.x-v.x,2)+Math.pow(z.y-v.y,2))}function C(v){if(v.type.startsWith("touch")&&v.evt.preventDefault(),ye(v),!N.value)return;const z=x(v);s(U.value,x(v))>=O.value&&(B(z),U.value=z)}function y(){M.value.push([...b.value]),c.value=[]}function g(){a.value={circles:[...b.value],brushRadius:$.value,undoStack:M.value,redoStack:c.value}}function A(){a.value!==null&&(b.value=a.value.circles||[],$.value=a.value.brushRadius||30,M.value=a.value.undoStack||[],c.value=a.value.redoStack||[])}function te(){M.value.length!==0&&(c.value.push([...b.value]),b.value=M.value.pop()||[])}function ne(){c.value.length!==0&&(M.value.push([...b.value]),b.value=c.value.pop()||[])}function ie(){N.value=!1}function pe(){l.value=""}function J(){y(),b.value=[],l.value=""}const Z=L(()=>M.value.length>0),ce=L(()=>c.value.length>0);function ye(v){const z=x(v);I.value.x=z.x,I.value.y=z.y}function ee(){I.value.visible=!1,N.value=!1}function Y(){I.value.visible=!0,I.value.radius=$.value}function de(){const v=new Image;v.src=n.imageSrc,v.onload=()=>{f.value=v,ge(),E()}}function ge(){if(!f.value)return;const v=window.innerWidth,z=window.innerHeight,q=f.value.width/f.value.height;let H,V;const G=Math.min(v*.9,1200),W=Math.min(z*.8,i.outputMaxSize);q>G/W?(H=G,V=H/q):(V=W,H=V*q),_.value={width:Math.floor(H),height:Math.floor(V)},E()}function E(){const v=_.value.width,z=_.value.height,q=f.value.width,H=f.value.height,V=v/q,G=z/H,W=Math.min(V,G);F.value={x:0,y:0,width:q*W,height:H*W}}return Qe(()=>{de(),A()}),Se(()=>{if(o.value){const v=o.value.getNode();v.on("touchstart",p),v.on("touchmove",C),v.on("touchend",ie),v.on("touchcancel",ee)}}),bt(()=>{if(o.value){const v=o.value.getNode();v.off("touchstart"),v.off("touchmove"),v.off("touchend"),v.off("touchcancel")}g()}),(v,z)=>{const q=_e,H=Ne("v-image"),V=Ne("v-layer"),G=Ne("v-circle"),W=Ne("v-stage"),K=ue,he=zt,Pe=He;return r(),j("div",qn,[w("div",En,[z[1]||(z[1]=w("p",{class:"text-sm my-2 text-slate-500"},"Select the target area for image inpaint",-1)),w("div",Dn,[e.imageSrc&&e.imageSrc!==""&&l.value!==""?(r(),S(q,{key:0,src:e.imageSrc,fit:"inside",width:t(_).width,height:t(_).height,draggable:"false",class:le({absolute:l.value!==""})},null,8,["src","width","height","class"])):P("",!0),l.value?(r(),S(q,{key:1,src:l.value,fit:"inside",width:t(_).width,height:t(_).height,draggable:"false",class:"opacity-50"},null,8,["src","width","height"])):P("",!0)]),l.value===""?(r(),S(W,{key:0,ref_key:"stageRef",ref:o,config:t(_),onMousedown:p,onMousemove:C,onMouseup:ie,onMouseleave:ee,onMouseenter:Y},{default:k(()=>[m(V,{ref_key:"imageLayerRef",ref:u},{default:k(()=>[m(H,{image:t(f),config:t(_)},null,8,["image","config"])]),_:1},512),m(V,{ref_key:"maskLayerRef",ref:d},{default:k(()=>[(r(!0),j(se,null,ve(t(b),(be,Ue)=>(r(),S(G,{key:Ue,config:be},null,8,["config"]))),128)),t(I).visible?(r(),S(G,{key:0,config:t(I)},null,8,["config"])):P("",!0)]),_:1},512)]),_:1},8,["config"])):P("",!0)]),w("div",Wn,[m(K,{class:"mr-2",size:"xs",icon:"i-heroicons-clipboard-document-check-16-solid",variant:"soft",disabled:t(b).length===0||l.value!=="",onClick:h},{default:k(()=>z[2]||(z[2]=[D(" Apply ")])),_:1},8,["disabled"]),m(K,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-left-16-solid",variant:"soft",color:"cyan",disabled:!t(Z)||l.value!=="",onClick:te},null,8,["disabled"]),m(K,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-right-16-solid",variant:"soft",color:"cyan",disabled:!t(ce)||l.value!=="",onClick:ne},null,8,["disabled"]),m(K,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-turn-up-left-20-solid",variant:"soft",disabled:t(b).length===0&&l.value==="",color:"red",onClick:J},{default:k(()=>z[3]||(z[3]=[D(" Reset ")])),_:1},8,["disabled"]),m(K,{size:"xs",icon:"i-heroicons-pencil-solid",variant:"soft",disabled:l.value==="",color:"orange",onClick:pe},{default:k(()=>z[4]||(z[4]=[D(" Edit ")])),_:1},8,["disabled"])]),w("div",Hn,[m(Pe,{class:"mb-3 text-sm",hint:`value: ${t($)}`,label:"Brush radius"},{default:k(()=>[m(he,{modelValue:t($),"onUpdate:modelValue":z[0]||(z[0]=be=>Q($)?$.value=be:null),min:1,max:100,size:"sm",class:"my-2",disabled:l.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["hint"])])])}}});function qe(e={}){const{copy:n,isSupported:l}=Gt(),a=Me();function i(o,u={},d={}){l&&n(o).then(()=>{!u.title&&!u.description||a.add({...u,...e})},function(f){a.add({...d,description:d.description||f.message,...e})})}return{copy:i}}const Xn="0.05";function Jn(e,n){const l=parseFloat(e);if(isNaN(l))return e;const a=l+n;return a<0?"0":String(Number(a.toFixed(10)))}function Qn(e,n){let l=n,a=n,i=0,o=0;for(;l>=0&&(l--,!(e[l]==="("&&i===o));)e[l]==="("&&i++,e[l]===")"&&o++;if(l<0)return!1;for(i=0,o=0;a<e.length&&!(e[a]===")"&&i===o);)e[a]==="("&&i++,e[a]===")"&&o++,a++;return a===e.length?!1:{start:l+1,end:a}}function Kn(e){const n=/^\((.*)\)$/,l=e.match(n),a=/:([+-]?(\d*\.)?\d+([eE][+-]?\d+)?)/,i=e.match(a);return l&&!i?`(${l[1]}:1.0)`:e}function Yn(e){const n=e.composedPath()[0],l=parseFloat(Xn);if(n.tagName!=="TEXTAREA"||!(e.key==="ArrowUp"||e.key==="ArrowDown")||!e.ctrlKey&&!e.metaKey)return;e.preventDefault();let a=n.selectionStart,i=n.selectionEnd,o=n.value.substring(a,i);if(!o){const f=Qn(n.value,a);if(f)a=f.start,i=f.end,o=n.value.substring(a,i);else{const $=" .,\\/!?%^*;:{}=-_`~()\r\n	";for(;!$.includes(n.value[a-1])&&a>0;)a--;for(;!$.includes(n.value[i])&&i<n.value.length;)i++;if(o=n.value.substring(a,i),!o)return}}o[o.length-1]===" "&&(o=o.substring(0,o.length-1),i-=1),n.value[a-1]==="("&&n.value[i]===")"&&(a-=1,i+=1,o=n.value.substring(a,i)),(o[0]!=="("||o[o.length-1]!==")")&&(o=`(${o})`),o=Kn(o);const u=e.key==="ArrowUp"?l:-l,d=o.replace(/\((.*):(\d+(?:\.\d+)?)\)/,(f,$,b)=>(b=Jn(b,u),Number(b)==1?$:`(${$}:${b})`));return n.setRangeText(d,a,i,"select"),n.value}const Zn={key:0,class:"text-red-300"},el={class:"flex items-center"},tl={class:"p-2 max-w-48 max-h-48 not-italic"},nl={class:"block font-medium text-gray-700 dark:text-gray-200"},ll={key:0,class:"flex items-center"},ol={key:2,class:"flex flex-row flex-grow items-center justify-between"},al={key:3,class:"flex flex-row flex-grow items-center"},sl={class:"sm:inline"},il={class:"preview-over-original relative"},rl={key:1,class:"text-red-300 text-sm"},ul=oe({__name:"InputParam",props:{inputParam:{type:Object,required:!0},index:{type:Number,required:!0},inputParamsMap:{type:Array,required:!0},advanced:{type:Boolean,default:!1}},setup(e){const n=e,l=wt(),a=Xt(),i=L(()=>a.selectedFiles[n.inputParam.name]?a.selectedFiles[n.inputParam.name]:null),o=L(()=>{var g;return i.value?`${window.location.origin}/index.php/core/preview?fileId=${(g=i.value)==null?void 0:g.id}&mimeFallback=true&a=1`:""}),u=L(()=>i.value?i.value.source:"");we(i,y=>{y?(n.inputParamsMap[n.index][n.inputParam.name].value=y,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url=u.value,n.inputParamsMap[n.index][n.inputParam.name].nc_file=!0):(n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url="",n.inputParamsMap[n.index][n.inputParam.name].nc_file=!1)});const d=R(!1),f=R(null),$=R(""),b=R({width:0,height:0}),_=R(""),F=R({}),U=R(null),I=n.inputParamsMap[n.index][n.inputParam.name].source_input_name,O=n.inputParamsMap.findIndex(y=>{if(Object.keys(y)[0]===n.inputParamsMap[n.index][n.inputParam.name].source_input_name)return!0});function N(){try{const y=n.inputParamsMap.find(g=>{const A=Object.keys(g)[0];if(A===I)return g[A]});p(y[I].value)}catch{b.value.width=0,b.value.height=0}}Se(()=>{n.inputParam.type==="range_scale"&&N(),n.inputParam.type==="image-mask"&&we(_,y=>{const g=new File([_.value],`image-mask-${n.inputParam.name}.png`,{type:"image/png"});n.inputParamsMap[n.index][n.inputParam.name].value=g,n.inputParamsMap[n.index][n.inputParam.name].mask_applied=y!==""})}),n.inputParam.type==="range_scale"&&we(n.inputParamsMap,()=>{N()});function M(y){return y?URL.createObjectURL(y):""}function c(){URL.revokeObjectURL($.value),$.value="",f.value&&(f.value.$refs.input.value=""),n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url=""}function h(){URL.revokeObjectURL(_.value),_.value="",F.value={},n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].mask_applied=!1}const x=L(()=>n.inputParam.type!=="bool"?n.inputParam.display_name:"");function p(y){if(!(y instanceof File)){b.value.width=0,b.value.height=0;return}const g=URL.createObjectURL(y),A=new Image;A.onload=function(){b.value.width=A.naturalWidth,b.value.height=A.naturalHeight,URL.revokeObjectURL(A.src)},A.src=g}const B=L(()=>{if(n.inputParam.type==="range_scale"){const y=n.inputParamsMap[n.index][n.inputParam.name].value;return`value: ${y}x (${b.value.width}x${b.value.height} -> ${(b.value.width*y).toFixed(0)}x${(b.value.height*y).toFixed(0)})`}return["range","range_scale"].includes(n.inputParam.type)?`value: ${n.inputParamsMap[n.index][n.inputParam.name].value}`:""}),s=R(null);function C(y){const g=Yn(y);g&&(n.inputParamsMap[n.index][n.inputParam.name].value=g)}return Se(()=>{n.inputParam.type==="text"&&s.value&&s.value.$refs.textarea.addEventListener("keydown",C),n.inputParam.type==="image-mask"&&(U.value=n.inputParamsMap[O][I],we(n.inputParamsMap[O][I],y=>{_.value="",F.value={},U.value=y}))}),bt(()=>{URL.revokeObjectURL($.value),URL.revokeObjectURL(_.value),a.removeSelectedFile(n.inputParam.name),n.inputParam.type==="text"&&s.value&&s.value.$refs.textarea.removeEventListener("keydown",C)}),(y,g)=>{var E,v;const A=ue,te=Ee,ne=kt,ie=gn,pe=We,J=an,Z=_e,ce=Gn,ye=Ie,ee=Ze,Y=Ge,de=zt,ge=He;return(((E=e.inputParam)==null?void 0:E.advanced)||!1)===e.advanced?(r(),S(ge,{key:0,class:le(["mb-3",{italic:(v=e.inputParam)==null?void 0:v.dynamic_lora}]),help:t(B)},{hint:k(()=>[e.inputParam.optional?P("",!0):(r(),j("span",Zn,"required"))]),label:k(()=>{var z;return[w("div",el,[(z=e.inputParam)!=null&&z.dynamic_lora&&e.inputParam.trigger_words.length>0?(r(),S(ne,{key:0},{panel:k(()=>[w("div",tl,[g[20]||(g[20]=w("h4",{class:"mb-2 text-center"},"Trigger words",-1)),(r(!0),j(se,null,ve(e.inputParam.trigger_words,q=>(r(),S(te,{key:q,color:"violet",class:"mr-1 cursor-pointer",onClick:()=>{("useCopyToClipboard"in y?y.useCopyToClipboard:t(qe))().copy(q),("useToast"in y?y.useToast:t(Me))().add({title:"Clipboard",description:"Trigger word copied to clipboard",timeout:2e3})}},{default:k(()=>[D(X(q),1)]),_:2},1032,["onClick"]))),128))])]),default:k(()=>[m(A,{icon:"i-heroicons-information-circle",variant:"ghost",size:"xs",color:"gray",class:"mr-2"})]),_:1})):P("",!0),w("label",nl,X(t(x)),1)])]}),default:k(()=>{var z,q,H,V,G;return[e.inputParam.type==="text"?(r(),S(ie,{key:0,ref_key:"textareaInput",ref:s,size:"md",placeholder:e.inputParam.display_name,required:!e.inputParam.optional,resize:!0,label:e.inputParam.display_name,value:e.inputParamsMap[e.index][e.inputParam.name].value,autoresize:"",variant:"outline",onInput:g[0]||(g[0]=W=>{const K=W.target;e.inputParamsMap[e.index][e.inputParam.name].value=K.value})},null,8,["placeholder","required","label","value"])):P("",!0),e.inputParam.type==="number"?(r(),j(se,{key:1},[e.inputParam.name==="seed"?(r(),j("div",ll,[e.inputParam.type==="number"?(r(),S(pe,{key:0,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":g[1]||(g[1]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"])):P("",!0),m(A,{icon:"i-heroicons-arrow-path",color:"violet",variant:"outline",size:"xs",class:"ml-2",onClick:g[2]||(g[2]=()=>{e.inputParamsMap[e.index][e.inputParam.name].value=Math.floor(Math.random()*1e7)})})])):(r(),S(pe,{key:1,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":g[3]||(g[3]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"]))],64)):P("",!0),e.inputParam.type==="image"?(r(),j("div",ol,[m(pe,{ref_key:"imageInput",ref:f,type:"file",accept:"image/*",class:"w-full",variant:"outline",color:"gray",disabled:t(i)!==null,label:e.inputParam.display_name,onChange:g[4]||(g[4]=W=>{console.debug("files",W);const K=W==null?void 0:W[0];e.inputParamsMap[e.index][e.inputParam.name].value=K,$.value=M(K),e.inputParamsMap[e.index][e.inputParam.name].image_preview_url=t($),t(i)!==null&&t(a).removeSelectedFile(e.inputParam.name),console.debug("inputParamsMap",e.inputParamsMap)})},null,8,["disabled","label"]),t(l).app.isNextcloudIntegration?(r(),S(J,{key:0,class:"mx-2",orientation:"vertical",label:"OR"})):P("",!0),t(l).app.isNextcloudIntegration?(r(),S(A,{key:1,icon:"i-heroicons-cloud-arrow-down",variant:"outline",color:"blue",disabled:t(i)!==null||t($)!=="",title:t(i)!==null?t(i).attributes.filename:"Choose from Nextcloud",onClick:g[5]||(g[5]=()=>{t(a).openNextcloudFilePicker(e.inputParam.name)})},{default:k(()=>g[21]||(g[21]=[D(" Choose from Nextcloud ")])),_:1},8,["disabled","title"])):P("",!0),t(o)!==""?(r(),j(se,{key:2},[m(Z,{src:t(o),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:g[6]||(g[6]=()=>{d.value=!0})},null,8,["src"]),m(A,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:g[7]||(g[7]=()=>{t(a).removeSelectedFile(e.inputParam.name),t($)!==""&&c()})})],64)):t($)!==""?(r(),j(se,{key:3},[m(Z,{src:t(_)?t(_):t($),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:g[8]||(g[8]=()=>{d.value=!0})},null,8,["src"]),m(A,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:c})],64)):P("",!0)])):P("",!0),e.inputParam.type==="image-mask"?(r(),j("div",al,[t(U)?(r(),S(A,{key:0,icon:"i-heroicons-paint-brush-16-solid",class:"mr-2",color:"violet",variant:"outline",size:"xs",disabled:!((z=t(U))!=null&&z.value),onClick:g[9]||(g[9]=()=>{d.value=!0})},{default:k(()=>[w("span",sl,X(t(_)!==""?"Edit mask":"Draw mask"),1)]),_:1},8,["disabled"])):P("",!0),w("div",il,[t(U)&&((q=t(U))!=null&&q.value)?(r(),S(Z,{key:0,src:(H=t(U))==null?void 0:H.image_preview_url,class:le(["h-10 rounded-lg cursor-pointer",{absolute:t(_)!==""}]),onClick:g[10]||(g[10]=()=>{d.value=!0})},null,8,["src","class"])):P("",!0),t(_)?(r(),S(Z,{key:1,src:t(_),class:"h-10 rounded-lg cursor-pointer opacity-50",onClick:g[11]||(g[11]=()=>{d.value=!0})},null,8,["src"])):P("",!0)]),!t(U)||t(U)&&!((V=t(U))!=null&&V.value)?(r(),j("span",rl," Select source image ")):P("",!0),t(_)?(r(),S(A,{key:2,icon:"i-heroicons-x-mark",variant:"outline",color:"violet",class:"ml-2",onClick:h})):P("",!0)])):P("",!0),e.inputParam.type==="image"||e.inputParam.type==="image-mask"?(r(),S(ye,{key:4,modelValue:t(d),"onUpdate:modelValue":g[16]||(g[16]=W=>Q(d)?d.value=W:null),class:"z-[90] overflow-y-auto",transition:!1,fullscreen:""},{default:k(()=>{var W;return[m(A,{class:"absolute top-4 right-4 z-[100]",icon:"i-heroicons-x-mark",variant:"ghost",onClick:g[12]||(g[12]=()=>d.value=!1)}),e.inputParam.type==="image"?(r(),j("div",{key:0,class:"flex items-center justify-center w-full h-full p-4",onClick:g[13]||(g[13]=Ke(()=>d.value=!1,["left"]))},[t($)!==""?(r(),S(Z,{key:0,class:"lg:h-full",fit:"contain",src:t($)},null,8,["src"])):P("",!0),t(o)!==""?(r(),S(Z,{key:1,class:"lg:h-full",fit:"inside",src:t(u)},null,8,["src"])):P("",!0)])):(r(),S(ce,{key:1,ref:"imageInpaint","image-inpaint-mask":t(_),"onUpdate:imageInpaintMask":g[14]||(g[14]=K=>Q(_)?_.value=K:null),"image-inpaint-mask-data":t(F),"onUpdate:imageInpaintMaskData":g[15]||(g[15]=K=>Q(F)?F.value=K:null),class:"flex items-center justify-center w-full h-full p-4","image-src":(W=t(U))==null?void 0:W.image_preview_url},null,8,["image-inpaint-mask","image-inpaint-mask-data","image-src"]))]}),_:1},8,["modelValue"])):P("",!0),e.inputParam.type==="list"?(r(),S(ee,{key:5,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":g[17]||(g[17]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),placeholder:e.inputParam.display_name,options:Object.keys(e.inputParam.options)},null,8,["modelValue","placeholder","options"])):P("",!0),e.inputParam.type==="bool"?(r(),S(Y,{key:6,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":g[18]||(g[18]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),label:(G=e.inputParam)==null?void 0:G.display_name},null,8,["modelValue","label"])):P("",!0),["range","range_scale"].includes(e.inputParam.type)?(r(),S(de,{key:7,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":g[19]||(g[19]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),label:e.inputParam.display_name,size:"sm",min:e.inputParam.min,max:e.inputParam.max,step:e.inputParam.step},null,8,["modelValue","label","min","max","step"])):P("",!0)]}),_:1},8,["class","help"])):P("",!0)}}}),dl={key:0,class:"heading"},cl={key:1},ml={key:0,class:"max-h-96 overflow-y-auto mt-5"},fl={class:"heading"},pl={key:0,class:"p-4"},gl={key:0,class:"flex items-center w-full max-w-xs"},vl=oe({__name:"InputParams",props:Ae({inputParamsMap:{type:Array,required:!0},additionalInputParamsMap:{type:Array,required:!1,default:[]},advanced:{type:Boolean,default:!1}},{profilingOptions:{default:{},type:Object},profilingOptionsModifiers:{},profilingEnabled:{default:!1,type:Boolean},profilingEnabledModifiers:{}}),emits:["update:profilingOptions","update:profilingEnabled"],setup(e){const n=e,l=fe(),a=ut(),i=Jt(),o=R(!n.advanced),u=je(e,"profilingOptions"),d=je(e,"profilingEnabled"),f=R(!0),$=L(()=>i.workers.map(b=>({value:b.worker_id,label:`${b.worker_id} (type: ${b.device_type}, vram_total: ${Ve(b.vram_total)})`})));return Qe(()=>{var _;if(!a.isAdmin)return;const b=localStorage.getItem(`profilingOptions_${(_=l.currentFlow)==null?void 0:_.name}`);b&&(u.value=JSON.parse(b)),i.fetchWorkersInfo().then(()=>{i.workers.find(U=>{var I;return U.worker_id===((I=u.value["X-WORKER-ID"])==null?void 0:I.value)})||(u.value["X-WORKER-ID"]=null)})}),(b,_)=>{const F=xe,U=ul,I=Ge,O=Ze,N=ue,M=We,c=He;return r(),j(se,null,[e.advanced?(r(),j("div",dl,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:_[0]||(_[0]=()=>{o.value=!t(o)})},[m(F,{name:t(o)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",class:"mr-2"},null,8,["name"]),_[3]||(_[3]=D(" Advanced options "))])])):P("",!0),t(o)?(r(),j("div",cl,[(r(!0),j(se,null,ve(t(l).currentFlow.input_params,(h,x)=>(r(),S(U,{key:x,"input-params-map":e.inputParamsMap,index:x,"input-param":h,advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),(r(!0),j(se,null,ve(e.additionalInputParamsMap,(h,x)=>(r(),S(U,{key:Object.keys(h)[0],"input-params-map":e.additionalInputParamsMap,index:x,"input-param":h[Object.keys(h)[0]],advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),t(a).isAdmin&&e.advanced?(r(),j("div",ml,[w("div",fl,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:_[1]||(_[1]=()=>{f.value=!t(f)})},[m(F,{name:t(f)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),m(F,{name:"i-mdi-bug-outline",class:"mr-2"}),_[4]||(_[4]=D(" Execution settings "))])]),t(f)?P("",!0):(r(),j("div",pl,[m(I,{modelValue:d.value,"onUpdate:modelValue":_[2]||(_[2]=h=>d.value=h),label:"Enable Execution settings",class:"mb-3"},null,8,["modelValue"]),(r(!0),j(se,null,ve(Object.keys(u.value),h=>(r(),S(c,{key:h,label:h},{default:k(()=>[h==="X-WORKER-ID"?(r(),j("div",gl,[m(O,{modelValue:u.value[h],"onUpdate:modelValue":x=>u.value[h]=x,options:t($),placeholder:"Select worker",class:"w-full my-3"},null,8,["modelValue","onUpdate:modelValue","options"]),m(N,{icon:"i-heroicons-x-mark",variant:"outline",size:"sm",color:"orange",class:"ml-2",onClick:()=>u.value[h]=null},null,8,["onClick"]),m(N,{icon:"i-heroicons-arrow-path-solid",variant:"outline",size:"sm",color:"blue",class:"ml-2",onClick:()=>{t(i).fetchWorkersInfo().then(()=>{u.value[h]=t($).find(x=>{var p;return x.value===((p=u.value[h])==null?void 0:p.value)})})}},null,8,["onClick"])])):(r(),S(M,{key:1,modelValue:u.value[h],"onUpdate:modelValue":x=>u.value[h]=x,placeholder:"Enter value",class:"my-3"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))]))])):P("",!0)])):P("",!0)],64)}}}),hl={key:0,id:"prompt",class:"w-full my-10 lg:my-0 p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg"},wl={class:"action flex items-center"},yl=oe({__name:"Prompt",setup(e,{expose:n}){var h,x,p,B;const l=fe(),a=ut();let i=localStorage.getItem(`input_params_map_${(h=l.currentFlow)==null?void 0:h.name}`);if(i){const s=JSON.parse(i);"flow_version"in s&&s.flow_version.split(".")[0]===((x=l.currentFlow)==null?void 0:x.version.split(".")[0])?i=s:(i=null,localStorage.removeItem(`input_params_map_${(p=l.currentFlow)==null?void 0:p.name}`))}const o=R(((B=l.currentFlow)==null?void 0:B.input_params.map(s=>{var C;if(s.type==="text")return{[s.name]:{value:i!==null&&i[s.name]?i[s.name]:s.default||"",type:s.type,optional:s.optional,advanced:s.advanced||!1,default:s.default||"",translatable:s.translatable||!1,dynamic_lora:s.dynamic_lora||!1,trigger_words:s.trigger_words||[]}};if(s.type==="number")return{[s.name]:{value:i!==null&&i[s.name]?i[s.name]:s.default||0,type:s.type,optional:s.optional,advanced:s.advanced||!1,default:s.default||0,dynamic_lora:s.dynamic_lora||!1,trigger_words:s.trigger_words||[]}};if(s.type==="image")return{[s.name]:{value:null,type:s.type,optional:s.optional,advanced:s.advanced||!1,dynamic_lora:s.dynamic_lora||!1,trigger_words:s.trigger_words||[]}};if(s.type==="image-mask")return{[s.name]:{value:null,type:s.type,optional:s.optional,advanced:s.advanced||!1,source_input_name:s.source_input_name||null,dynamic_lora:s.dynamic_lora||!1,trigger_words:s.trigger_words||[]}};if(s.type==="list")return{[s.name]:{value:i!==null&&i[s.name]?i[s.name]:s.default||Object.keys(s.options)[0]||"",type:s.type,optional:s.optional,options:s.options,advanced:s.advanced||!1,default:Object.keys(s.options)[0]||"",dynamic_lora:s.dynamic_lora||!1,trigger_words:s.trigger_words||[]}};if(s.type==="bool")return{[s.name]:{value:i!==null&&i[s.name]?i[s.name]:s.default||!1,type:s.type,optional:s.optional,advanced:s.advanced||!1,default:s.default||!1,dynamic_lora:s.dynamic_lora||!1,trigger_words:s.trigger_words||[]}};if(["range","range_scale"].includes(s.type)){const y={value:i!==null&&i[s.name]?i[s.name]:s.default||0,type:s.type,optional:s.optional,advanced:s.advanced||!1,min:s.min||0,max:s.max||100,step:s.step||1,default:s.default||0,dynamic_lora:s.dynamic_lora||!1,trigger_words:s.trigger_words||[]};if(s.type==="range_scale"&&(y.source_input_name=s.source_input_name||null,y.source_input_name===null||y.source_input_name==="")){const g=(C=l.currentFlow)==null?void 0:C.input_params.find(A=>A.type==="image"&&!A.optional);g&&(y.source_input_name=g.name)}return{[s.name]:y}}}))||[]),u=R([]);l.currentFlow.is_seed_supported&&u.value.push({seed:{name:"seed",display_name:"Random seed",value:Math.floor(Math.random()*1e7),type:"number",optional:!0,advanced:!0,min:0,max:1e7}});const d=xt(),f=R(l.currentFlow.is_translations_supported&&d.settingsMap.translations_provider.value.trim()!==""),$=R(f.value);Qe(()=>{const s=localStorage.getItem("translatePrompt");s&&($.value=JSON.parse(s))}),we($,s=>{localStorage.setItem("translatePrompt",JSON.stringify(s))});function b(s){console.debug("Copy prompt inputs",s),Object.keys(s).forEach(y=>{const g=o.value.findIndex(A=>Object.keys(A)[0]===y);g!==-1&&(o.value[g][y].value=s[y].value)});const C=document.getElementById("prompt");C&&C.scrollIntoView({behavior:"smooth"})}n({copyPromptInputs:b}),o.value.forEach(s=>{const C=Object.keys(s)[0];["image","image-mask"].includes(s[C].type)||we(()=>s[C].value,()=>{var g,A;const y={};o.value.forEach(te=>{const ne=Object.keys(te)[0];y[ne]=te[ne].value}),localStorage.setItem(`input_params_map_${(g=l.currentFlow)==null?void 0:g.name}`,JSON.stringify({...y,flow_version:(A=l.currentFlow)==null?void 0:A.version}))})});const _=L(()=>o.value.filter(s=>{const C=Object.keys(s)[0];return!["image","image-mask"].includes(s[C].type)}).some(s=>{const C=Object.keys(s)[0];return s[C].value!==s[C].default}));function F(){o.value.forEach(s=>{const C=Object.keys(s)[0];s[C].type==="text"?s[C].value=s[C].default||"":s[C].type==="number"?s[C].value=s[C].default||s[C].min||0:s[C].type==="list"?s[C].value=Object.keys(s[C].options)[0]||"":s[C].type==="bool"?s[C].value=s[C].default||!1:["range","range_scale"].includes(s[C].type)&&(s[C].value=s[C].default||s[C].min||0)})}const U=R(!1),I=R(1),O=R(!1),N=L(()=>o.value.every(s=>{var g,A,te,ne;const C=Object.keys(s)[0];if(s[C].optional)return!0;const y=s[C].value;if(s[C].type==="text")return y!=="";if(s[C].type==="number")return y>=s[C].min&&y<=s[C].max;if(s[C].type==="list")return y!==""&&Object.keys(s[C].options).includes(y);if(s[C].type==="bool")return!0;if(s[C].type==="range")return y>=s[C].min&&y<=s[C].max;if(s[C].type==="range_scale")return y>=s[C].min&&y<=s[C].max;if(s[C].type==="image")return(g=s[C])!=null&&g.nc_file?!0:y instanceof File&&y.size>0;if(s[C].type==="image-mask")return(A=s[C])!=null&&A.nc_file?((te=s[C])==null?void 0:te.mask_applied)||!1:y instanceof File&&y.size>0&&(((ne=s[C])==null?void 0:ne.mask_applied)||!1)})),M=R({"X-WORKER-UNLOAD-MODELS":1,"X-WORKER-EXECUTION-PROFILER":1,"X-WORKER-ID":null}),c=R(!1);return we(()=>M.value,()=>{var s;a.isAdmin&&localStorage.setItem(`profilingOptions_${(s=l.currentFlow)==null?void 0:s.name}`,JSON.stringify(M.value))},{deep:!0}),(s,C)=>{const y=xe,g=vl,A=We,te=He,ne=Ge,ie=ue,pe=De;return t(l).currentFlow?(r(),j("div",hl,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:C[0]||(C[0]=()=>{O.value=!t(O)})},[m(y,{name:t(O)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),C[10]||(C[10]=D(" Prompt "))]),rt(w("div",null,[m(g,{"input-params-map":t(o),"onUpdate:inputParamsMap":C[1]||(C[1]=J=>Q(o)?o.value=J:null),"additional-input-params-map":t(u),"onUpdate:additionalInputParamsMap":C[2]||(C[2]=J=>Q(u)?u.value=J:null),advanced:!1},null,8,["input-params-map","additional-input-params-map"]),t(u).length>0?(r(),S(g,{key:0,"input-params-map":t(o),"onUpdate:inputParamsMap":C[3]||(C[3]=J=>Q(o)?o.value=J:null),"additional-input-params-map":t(u),"onUpdate:additionalInputParamsMap":C[4]||(C[4]=J=>Q(u)?u.value=J:null),"profiling-options":t(M),"onUpdate:profilingOptions":C[5]||(C[5]=J=>Q(M)?M.value=J:null),"profiling-enabled":t(c),"onUpdate:profilingEnabled":C[6]||(C[6]=J=>Q(c)?c.value=J:null),advanced:!0},null,8,["input-params-map","additional-input-params-map","profiling-options","profiling-enabled"])):P("",!0),t(l).currentFlow.is_count_supported?(r(),S(te,{key:1,label:"Number of results"},{default:k(()=>[m(A,{modelValue:t(I),"onUpdate:modelValue":C[7]||(C[7]=J=>Q(I)?I.value=J:null),type:"number",min:"1",max:"50",label:"Batch size",class:"mb-3 max-w-fit flex justify-end"},null,8,["modelValue"])]),_:1})):P("",!0),t(f)?(r(),S(te,{key:2,class:"my-3 flex justify-end"},{default:k(()=>[m(ne,{modelValue:t($),"onUpdate:modelValue":C[8]||(C[8]=J=>Q($)?$.value=J:null),label:"Translate prompt"},null,8,["modelValue"])]),_:1})):P("",!0),w("div",{class:le(["flex",{"justify-between":t(_),"justify-end":!t(_)}])},[t(_)?(r(),S(pe,{key:0,text:"Reset input params values to defaults"},{default:k(()=>[m(ie,{icon:"i-heroicons-arrow-path-rounded-square",variant:"ghost",color:"amber",onClick:F},{default:k(()=>C[11]||(C[11]=[D(" Reset params ")])),_:1})]),_:1})):P("",!0),w("div",wl,[m(ie,{icon:"i-heroicons-sparkles-16-solid",variant:"outline",loading:t(U),disabled:!t(N),onClick:C[9]||(C[9]=()=>{U.value=!0;let J={};t(a).isAdmin&&t(c)&&(J=Object.fromEntries(Object.entries(t(M)).filter(([Z,ce])=>ce!==null).map(([Z,ce])=>Z==="X-WORKER-ID"?[Z,ce==null?void 0:ce.value]:[Z,ce]))),t(l).runFlow(t(l).currentFlow,[...t(o),...t(u)],t(I),t(f)&&t($),!1,null,J).finally(()=>{U.value=!1;const Z=t(u).find(ce=>Object.keys(ce)[0]==="seed");Z.seed.value=Number(Z.seed.value)+t(I)+1})})},{default:k(()=>C[12]||(C[12]=[D(" Run prompt ")])),_:1},8,["loading","disabled"])])],2)],512),[[_t,!t(O)]])])):P("",!0)}}}),bl=e=>{const n=R(0);function l(o){e.value.style.scrollSnapType="none",e.value.style.scrollBehavior="auto",n.value=o.pageX,window.addEventListener("mousemove",i),window.addEventListener("mouseup",a)}function a(){e.value.style.removeProperty("scroll-behavior"),e.value.style.removeProperty("scroll-snap-type"),e.value.style.removeProperty("pointer-events"),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",a)}function i(o){o.preventDefault(),e.value.style.pointerEvents="none";const u=o.pageX-n.value;n.value=o.pageX,e.value.scrollBy(-u,0)}Se(()=>{e.value&&e.value.addEventListener("mousedown",l)}),dt(()=>{e.value&&e.value.removeEventListener("mousedown",l)})},tt=ot(Ce.ui.strategy,Ce.ui.carousel,dn),kl=oe({components:{UButton:ue},inheritAttrs:!1,props:{items:{type:Array,default:()=>[]},arrows:{type:Boolean,default:!1},indicators:{type:Boolean,default:!1},dir:{type:String,default:"ltr"},prevButton:{type:Object,default:()=>tt.default.prevButton},nextButton:{type:Object,default:()=>tt.default.nextButton},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:void 0}},setup(e,{expose:n}){const{ui:l,attrs:a}=st("carousel",Be(e,"ui"),tt,Be(e,"class")),i=R(),o=R(0),{x:u}=Qt(i,{behavior:"smooth"}),{width:d}=Kt(i);bl(i),Yt(i,N=>{var c,h;const[M]=N;o.value=((h=(c=M==null?void 0:M.target)==null?void 0:c.firstElementChild)==null?void 0:h.clientWidth)||0});const f=L(()=>e.dir==="rtl"),$=L(()=>o.value?f.value?Math.round(-u.value/o.value)+1:Math.round(u.value/o.value)+1:0),b=L(()=>{if(!o.value)return 0;const N=Math.round(d.value/o.value);return e.items.length<=N?0:e.items.length-N+1}),_=L(()=>$.value<=1),F=L(()=>$.value===b.value);function U(){u.value+=f.value?-o.value:o.value}function I(){u.value-=f.value?-o.value:o.value}function O(N){u.value=(N-1)*o.value*(f.value?-1:1)}return n({pages:b,page:$,prev:I,next:U,select:O}),{ui:l,attrs:a,isFirst:_,isLast:F,carouselRef:i,pages:b,currentPage:$,onClickNext:U,onClickPrev:I,onClick:O,twMerge:Je}}}),xl=["dir"],_l=["role"],$l=["aria-selected","aria-label","onClick"];function Cl(e,n,l,a,i,o){const u=ue;return r(),j("div",Re({class:e.ui.wrapper},e.attrs,{dir:e.dir}),[w("div",{ref:"carouselRef",class:le([e.ui.container,"no-scrollbar"])},[(r(!0),j(se,null,ve(e.items,(d,f)=>(r(),j("div",{key:f,class:le(e.ui.item),role:e.indicators?"tabpanel":null},[Oe(e.$slots,"default",{item:d,index:f},void 0,!0)],10,_l))),128))],2),e.arrows?(r(),j("div",{key:0,class:le(e.ui.arrows.wrapper)},[Oe(e.$slots,"prev",{onClick:e.onClickPrev,disabled:e.isFirst},()=>{var d;return[e.prevButton?(r(),S(u,Re({key:0,disabled:e.isFirst},{...e.ui.default.prevButton,...e.prevButton},{class:e.twMerge(e.ui.default.prevButton.class,(d=e.prevButton)==null?void 0:d.class),"aria-label":"Prev",onClick:e.onClickPrev}),null,16,["disabled","class","onClick"])):P("",!0)]},!0),Oe(e.$slots,"next",{onClick:e.onClickNext,disabled:e.isLast},()=>{var d;return[e.nextButton?(r(),S(u,Re({key:0,disabled:e.isLast},{...e.ui.default.nextButton,...e.nextButton},{class:e.twMerge(e.ui.default.nextButton.class,(d=e.nextButton)==null?void 0:d.class),"aria-label":"Next",onClick:e.onClickNext}),null,16,["disabled","class","onClick"])):P("",!0)]},!0)],2)):P("",!0),e.indicators?(r(),j("div",{key:1,role:"tablist",class:le(e.ui.indicators.wrapper)},[(r(!0),j(se,null,ve(e.pages,d=>Oe(e.$slots,"indicator",{key:d,onClick:e.onClick,active:d===e.currentPage,page:d},()=>[w("button",{type:"button",role:"tab","aria-selected":d===e.currentPage,class:le([e.ui.indicators.base,d===e.currentPage?e.ui.indicators.active:e.ui.indicators.inactive]),"aria-label":`set slide ${d}`,onClick:f=>e.onClick(d)},null,10,$l)],!0)),128))],2)):P("",!0)],16,xl)}const Fe=at(kl,[["render",Cl],["__scopeId","data-v-a3da86ff"]]),Sl={class:"flex flex-col basis-full"},Il=oe({__name:"InputFiles",props:{running:{type:Object,required:!0}},setup(e){const n=mt(),l=function(d,f){return`${$t()}/tasks/inputs?task_id=${d}&input_index=${f}`},a=R(!1),i=R(""),o=R(0),u=R(!0);return(d,f)=>{var I,O,N,M,c;const $=xe,b=_e,_=Fe,F=ue,U=Ie;return e.running&&e.running.input_files&&((I=Object.keys(e.running.input_files))==null?void 0:I.length)>0?(r(),j("div",{key:0,class:le(["ml-2 mt-2 mb-5",{"mb-10":((O=Object.keys(e.running.input_files))==null?void 0:O.length)>1&&!t(u)}])},[w("h4",{class:"mb-3 font-bold cursor-pointer select-none flex items-center text-sm",onClick:f[0]||(f[0]=()=>u.value=!t(u))},[m($,{name:t(u)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Input files ("+X((N=Object.keys(e.running.input_files))==null?void 0:N.length)+") ",1)]),t(u)?P("",!0):(r(),j(se,{key:0},[((M=Object.keys(e.running.input_files))==null?void 0:M.length)===1?(r(),S(b,{key:0,class:"mb-5 rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(n)(`${("buildBackendUrl"in d?d.buildBackendUrl:t(lt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:l(e.running.task_id,0),onClick:f[1]||(f[1]=()=>{i.value=l(e.running.task_id,0),o.value=0,a.value=!0})},null,8,["placeholder","src"])):P("",!0),((c=Object.keys(e.running.input_files))==null?void 0:c.length)>1?(r(),S(_,{key:1,items:Object.keys(e.running.input_files).map(h=>({task_id:e.running.task_id,index:h})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:""},{default:k(({item:h})=>[w("div",Sl,[m(b,{class:"rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(n)(`${("buildBackendUrl"in d?d.buildBackendUrl:t(lt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:l(h.task_id,h.index),onClick:()=>{i.value=l(e.running.task_id,h.index),o.value=h.index,a.value=!0}},null,8,["placeholder","src","onClick"])])]),_:1},8,["items"])):P("",!0),m(U,{modelValue:t(a),"onUpdate:modelValue":f[4]||(f[4]=h=>Q(a)?a.value=h:null),class:"z-[90]",transition:!1,fullscreen:""},{default:k(()=>[m(F,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:f[2]||(f[2]=()=>a.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:f[3]||(f[3]=Ke(()=>a.value=!1,["left"]))},[t(i)?(r(),S(b,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(i)},null,8,["src"])):P("",!0)])]),_:1},8,["modelValue"])],64))],2)):P("",!0)}}}),Rl=oe({__name:"ErrorAlert",props:{running:{type:Object,required:!0}},setup(e){const n=fe(),l=R(!1);return(a,i)=>{const o=ct;return r(),S(o,{class:"mb-5",icon:"i-heroicons-exclamation-circle-16-solid",color:"red",variant:"soft",title:"Task failed",description:e.running.error,actions:[{variant:"outline",color:"yellow",label:"Restart",loading:t(l),icon:"i-heroicons-arrow-path",click:()=>{l.value=!0,t(n).restartFlow(e.running).finally(()=>{l.value=!1})}}]},null,8,["description","actions"])}}}),Ml={class:"mb-5"},Fl={class:"text-sm mb-5 text-slate-500"},Pl={class:"flex justify-between"},Ul=oe({__name:"Item",props:{running:{type:Object,required:!0}},setup(e){const n=fe(),l=R(!1),a=R(!1);function i(o){return[[{label:"Comfy flow",labelClass:"text-blue-500",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500",click:()=>{var u;return n.downloadFlowComfy((u=n.currentFlow)==null?void 0:u.name,o.task_id)}}],[{label:`Raise priority ${o.priority>0?`(${o.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-up",iconClass:"bg-gray-500",disabled:o.priority===15||o.progress>0,click:()=>{a.value=!0,n.raiseQueuePriority(o).finally(()=>{a.value=!1})}},{label:`Lower priority ${o.priority>0?`(${o.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-down",iconClass:"bg-gray-500",disabled:o.priority===0||o.progress>0,click:()=>{a.value=!0,n.lowerQueuePriority(o).finally(()=>{a.value=!1})}},{label:`Reset priority ${o.priority>0?`(${o.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-path-rounded-square-solid",iconClass:"bg-gray-500",disabled:o.priority===0||o.progress>0,click:()=>{a.value=!0,n.resetQueuePriority(o).finally(()=>{a.value=!1})}}]]}return(o,u)=>{var F,U;const d=Ft,f=Il,$=Rl,b=ue,_=Ye;return r(),j("div",Ml,[m(d,{class:"mb-3",value:(F=e.running)==null?void 0:F.progress,indicator:"",color:e.running.error?"red":"green"},null,8,["value","color"]),w("p",Fl,X([`${(U=e.running)!=null&&U.priority&&e.running.priority>0?"["+e.running.priority+"] ":""}#${e.running.task_id}`,...Object.keys(e.running.input_params_mapped).filter(I=>e.running.input_params_mapped[I].value&&e.running.input_params_mapped[I].value!=="").map(I=>`${e.running.input_params_mapped[I].display_name}: ${e.running.input_params_mapped[I].value}`)].join(" | ")+`${e.running.execution_time?" | execution_time: "+e.running.execution_time.toFixed(2)+"s":""}`),1),m(f,{running:e.running},null,8,["running"]),e.running.error?(r(),S($,{key:0,running:e.running},null,8,["running"])):P("",!0),w("div",Pl,[m(b,{icon:e.running.progress>=0&&e.running.progress<100?"i-heroicons-stop":"i-heroicons-minus-circle",color:e.running.error?"red":"orange",variant:"outline",loading:t(l),onClick:u[0]||(u[0]=()=>{l.value=!0,t(n).cancelRunningFlow(e.running).finally(()=>{l.value=!1})})},{default:k(()=>[D(X(e.running.progress>=0&&e.running.progress<100?"Cancel":"Remove"),1)]),_:1},8,["icon","color","loading"]),m(_,{items:i(e.running),mode:"click",popper:{placement:"bottom-end"}},{default:k(()=>[m(b,{color:"blue",variant:"outline",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])])])}}}),zl={class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md mt-5 mb-10"},Vl={class:"flex items-center justify-between mb-2"},Ol={key:0},jl={key:1,class:"text-red-400"},Tl=oe({__name:"Queue",setup(e){const n=fe(),l=R(!0),a=R(!1);return(i,o)=>{var $,b,_,F,U,I,O,N,M;const u=xe,d=ue,f=Ul;return r(),j("div",zl,[w("div",Vl,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center",onClick:o[0]||(o[0]=()=>{l.value=!t(l)})},[m(u,{name:t(l)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Queue ("+X(t(n).flowsRunningByName(($=t(n).currentFlow)==null?void 0:$.name).length)+") ",1),t(n).flowsRunningByName((b=t(n).currentFlow)==null?void 0:b.name).length>0?(r(),j("span",Ol,"  - "+X(`${((F=t(n).flowsRunningByName((_=t(n).currentFlow)==null?void 0:_.name).filter(c=>c.progress>0)[0])==null?void 0:F.progress.toFixed(0))??0}%`),1)):P("",!0),t(n).flowsRunningByNameWithErrors((U=t(n))==null?void 0:U.currentFlow.name).length>0?(r(),j("span",jl,"  ("+X(t(n).flowsRunningByNameWithErrors((I=t(n).currentFlow)==null?void 0:I.name).length)+") ",1)):P("",!0)]),(O=t(n).currentFlow)!=null&&O.name&&t(n).flowsRunningByName((N=t(n).currentFlow)==null?void 0:N.name).length>0?(r(),S(d,{key:0,icon:"i-heroicons-stop",color:"orange",variant:"outline",loading:t(a),onClick:o[1]||(o[1]=()=>{var c;a.value=!0,t(n).cancelRunningFlows((c=t(n).currentFlow)==null?void 0:c.name).finally(()=>{a.value=!1})})},{default:k(()=>o[2]||(o[2]=[D(" Cancel all ")])),_:1},8,["loading"])):P("",!0)]),t(l)?P("",!0):(r(!0),j(se,{key:0},ve(t(n).flowsRunningByName((M=t(n).currentFlow)==null?void 0:M.name),c=>(r(),S(f,{key:c.task_id,running:c},null,8,["running"]))),128))])}}}),Nl=oe({__name:"ScrollToTop",props:{show:{type:Boolean,required:!0},target:{type:String,required:!0}},setup(e){const n=e;function l(){const a=document.getElementById(n.target);a&&a.scrollIntoView({behavior:"smooth"})}return(a,i)=>{const o=ue;return e.show?(r(),S(o,{key:0,icon:"i-heroicons-arrow-small-up",color:"black",variant:"outline",onClick:l})):P("",!0)}}}),Bl={class:"flex flex-col items-center mb-2 max-w-fit mx-auto z-0"},Ll={class:"text-slate-500 text-center text-sm w-full mx-auto flex flex-wrap items-center justify-center md:justify-between"},Al={class:"toggles py-2"},ql={class:"mr-2 inline-flex items-center text-sm"},El=["for"],Dl={class:"mr-2 inline-flex items-center text-sm"},Wl=["for"],Hl={key:0,class:"flex items-center"},Gl=["title"],Xl=oe({__name:"Child",props:{flowResult:{type:Object,required:!0},outputsIndex:{type:Number,required:!1,default:()=>0},openImageModal:{type:Function,required:!0}},setup(e){const n=e,l=fe(),a=(c,h=null,x=!1)=>{if(c.child_tasks.length===0)return c;const p=c.child_tasks.findIndex(B=>B.parent_task_node_id===h);return p!==-1?(x||(o.value=c),a(c.child_tasks[p],c.child_tasks[p].outputs[0].comfy_node_id,x)):c};function i(c,h,x=null){if(x!==null&&c.parent_task_node_id===x||Number(c.task_id)===h)return c;for(let p=0;p<c.child_tasks.length;p++)for(let B=0;B<c.child_tasks[p].outputs.length;B++){const s=i(c.child_tasks[p],h,c.child_tasks[p].outputs[B].comfy_node_id);if(s!==null)return s}return null}const o=R(n.flowResult),u=R(a(n.flowResult,n.flowResult.outputs[n.outputsIndex].comfy_node_id,!1));function d(c){var h;return[[{label:`${(h=l.flowByName((c==null?void 0:c.flow_name)??(c==null?void 0:c.name)))==null?void 0:h.display_name}#${c.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",click:()=>{n.openImageModal(me({task_id:c.task_id,node_id:c.outputs.length>1?c.outputs[n.outputsIndex].comfy_node_id:c.outputs[0].comfy_node_id}))}}]]}function f(c){var x;const h=[[{label:`${(x=l.flowByName((c==null?void 0:c.flow_name)??(c==null?void 0:c.name)))==null?void 0:x.display_name}#${c.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",disabled:c.progress<100||c.error!=="",click:()=>{n.openImageModal(me({task_id:c.task_id,node_id:c.outputs.length>1?c.outputs[n.outputsIndex].comfy_node_id:c.outputs[0].comfy_node_id}))}},{label:c.progress<100?"Cancel":"Delete",labelClass:c.progress<100?"text-orange-500":"text-red-500",icon:c.progress<100?"i-heroicons-stop":"i-heroicons-trash",iconClass:c.progress<100?"bg-orange-500":"bg-red-500",click:()=>{l.deleteFlowHistory(c.task_id).then(()=>{const p=i(n.flowResult,c.parent_task_id,c.parent_task_node_id);p&&(p.child_tasks=p.child_tasks.filter(B=>Number(B.task_id)!==Number(c.task_id))),I(!1,n.flowResult)})}}]];return c.progress<100&&(h[0][1]={label:`Progress: ${Math.ceil(c.progress)}% (${c.execution_time.toFixed(2)}s)`,labelClass:"text-blue-500",disabled:!0}),c.error!==""&&h[0].push({label:`Error: ${c.error}`,labelClass:"text-red-500",slot:"error",click:()=>{qe().copy(c.error),Me().add({title:"Clipboard",description:`Task #${c.task_id} error copied to clipboard`,timeout:2e3})}}),h}function $(){const c=o.value.parent_task_id;if(!c)return;const h=i(n.flowResult,c,o.value.parent_task_node_id);h&&(o.value=h)}function b(){if(o.value.child_tasks.length===0)return;const c=o.value.outputs.length>1?o.value.outputs[n.outputsIndex].comfy_node_id:o.value.outputs[0].comfy_node_id,h=o.value.child_tasks.find(x=>x.parent_task_node_id===c);h&&(o.value=h)}const _=L(()=>{if(o.value.child_tasks.length===0)return;const c=o.value.outputs.length>1?o.value.outputs[n.outputsIndex].comfy_node_id:o.value.outputs[0].comfy_node_id;return o.value.child_tasks.find(x=>x.parent_task_node_id===c).task_id!==u.value.task_id});function F(){const c=u.value.parent_task_id;if(!c)return;const h=i(n.flowResult,c,u.value.parent_task_node_id);h&&(u.value=h)}function U(){if(u.value.child_tasks.length===0)return;const c=Number(u.value.outputs[0].comfy_node_id),h=u.value.child_tasks.find(x=>Number(x.parent_task_node_id)===c);h&&(u.value=h)}function I(c=!1,h=null){c||(o.value=h),u.value=a(h,h==null?void 0:h.outputs[n.outputsIndex].comfy_node_id,c),O.value=!1}we(n.flowResult,c=>{I(!0,c)});const O=R(!1),N=R(!0),M=R(null);return we(O,c=>{c?(M.value=o.value,o.value=n.flowResult):M.value&&(o.value=M.value,u.value=Ct(M.value,n.outputsIndex,o.value.outputs.length>1?o.value.outputs[n.outputsIndex].comfy_node_id:o.value.outputs[0].comfy_node_id))}),(c,h)=>{const x=_e,p=Ne("ImgComparisonSlider"),B=sn,s=ue,C=Ye,y=xe,g=De;return r(),j("div",Bl,[rt(m(x,{class:"mb-2 rounded-lg cursor-pointer",height:t(l).outputMaxSize,width:t(l).outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(u).progress===100?t(u).task_id:e.flowResult.task_id,node_id:t(u).progress===100?t(u).outputs[0].comfy_node_id:e.flowResult.outputs[e.outputsIndex].comfy_node_id}),onClick:h[0]||(h[0]=A=>e.openImageModal(("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(u).task_id??e.flowResult.task_id,node_id:t(u).outputs[0].comfy_node_id??e.flowResult.outputs[e.outputsIndex].comfy_node_id})))},null,8,["height","width","src"]),[[_t,!t(N)]]),t(N)?(r(),S(p,{key:0,class:"mb-2 mx-auto outline-none w-fit rounded-lg"},{default:k(()=>{var A,te,ne;return[m(x,{slot:"first",height:t(l).outputMaxSize,width:t(l).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(O)?e.flowResult.task_id:t(o).task_id,node_id:t(O)?e.flowResult.outputs[e.outputsIndex].comfy_node_id:t(o).parent_task_node_id!==null?(A=t(o))==null?void 0:A.outputs[0].comfy_node_id:((te=t(o))==null?void 0:te.outputs[e.outputsIndex].comfy_node_id)??((ne=t(o))==null?void 0:ne.outputs[0].comfy_node_id)})},null,8,["height","width","src"]),t(u)&&t(u).progress===100?(r(),S(x,{key:0,slot:"second",height:t(l).outputMaxSize,width:t(l).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(u).task_id,node_id:t(u).outputs[0].comfy_node_id})},null,8,["height","width","src"])):(r(),S(x,{key:1,slot:"second",height:t(l).outputMaxSize,width:t(l).outputMaxSize,fit:"cover",draggable:"false",src:`${("buildBackendUrl"in c?c.buildBackendUrl:t(lt))()}/vix_logo.png`},null,8,["height","width","src"]))]}),_:1})):P("",!0),w("div",Ll,[w("div",Al,[w("div",ql,[m(B,{id:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(N),"onUpdate:modelValue":h[1]||(h[1]=A=>Q(N)?N.value=A:null),size:"xs",class:"mr-2"},null,8,["id","modelValue"]),w("label",{class:"cursor-pointer select-none",for:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`}," Comparison ",8,El)]),w("div",Dl,[m(B,{id:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(O),"onUpdate:modelValue":h[2]||(h[2]=A=>Q(O)?O.value=A:null),disabled:!t(N),size:"xs",class:"mr-2"},null,8,["id","modelValue","disabled"]),w("label",{class:"cursor-pointer select-none",for:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`}," Original ",8,Wl)])]),t(N)?(r(),j("div",Hl,[m(s,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(O)||t(o).parent_task_id===null,onClick:$},null,8,["disabled"]),m(C,{items:d(t(o)),mode:"click",popper:{placement:"top"}},{default:k(()=>[m(s,{variant:"link",color:"white",size:"xs"},{default:k(()=>[D(" #"+X(t(O)?e.flowResult.task_id:t(o).task_id),1)]),_:1})]),_:1},8,["items"]),m(s,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(O)||!t(_),onClick:b},null,8,["disabled"]),m(y,{class:"mx-3",name:"i-heroicons-arrows-right-left-16-solid"}),m(s,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:!i(n.flowResult,t(u).parent_task_id,t(u).parent_task_node_id)||t(u).parent_task_id===Number(t(o).task_id)||t(u).parent_task_id===null,onClick:F},null,8,["disabled"]),m(C,{items:f(t(u)),mode:"click",popper:{placement:"top"}},{error:k(({item:A})=>[w("div",{class:"text-red-500 truncate",title:A.label},X(A.label),9,Gl)]),default:k(()=>[m(s,{class:le({"text-blue-500":t(u).progress!==100&&t(u).error==="","text-red-500":t(u).error!==""}),variant:"link",color:"white",size:"xs"},{default:k(()=>[D(X(t(u).progress===100?"#"+t(u).task_id:Math.ceil(t(u).progress)+"%"),1)]),_:1},8,["class"])]),_:1},8,["items"]),m(s,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(u).child_tasks.length===0,onClick:U},null,8,["disabled"]),m(g,{class:"ml-3",text:"Reset comparison",popper:{placement:"top"}},{default:k(()=>[m(s,{icon:"i-heroicons-arrow-path-rounded-square-solid",size:"2xs",variant:"outline",color:"white",onClick:h[3]||(h[3]=()=>I(!1,e.flowResult))})]),_:1})])):P("",!0)])])}}}),Jl={class:"image-output"},Ql={class:"flex flex-col basis-full justify-between mx-2"},Kl=oe({__name:"Image",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const n=fe();return(l,a)=>{var f,$;const i=Xl,o=_e,u=ue,d=Fe;return r(),j("div",Jl,[e.flowResult.outputs.length===1?(r(),j(se,{key:0},[(f=e.flowResult)!=null&&f.child_tasks&&(($=e.flowResult)==null?void 0:$.child_tasks.length)>0?(r(),S(i,{key:0,"flow-result":e.flowResult,"open-image-modal":e.openImageModal},null,8,["flow-result","open-image-modal"])):e.flowResult.outputs.length===1?(r(),S(o,{key:1,class:"mb-2 mx-auto rounded-lg cursor-pointer",height:t(n).$state.outputMaxSize,width:t(n).$state.outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in l?l.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id}),onClick:a[0]||(a[0]=b=>e.openImageModal(("outputResultSrc"in l?l.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})))},null,8,["height","width","src"])):P("",!0)],64)):e.flowResult.outputs.length>1?(r(),S(d,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((b,_)=>({task_id:e.flowResult.task_id,node_id:b.comfy_node_id,index:_})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:k(({item:b})=>{var _;return[w("div",Ql,[(_=e.flowResult)!=null&&_.child_tasks&&("hasChildTaskByParentTaskNodeId"in l?l.hasChildTaskByParentTaskNodeId:t(St))(e.flowResult,b.index,b.node_id)?(r(),S(i,{key:0,"flow-result":e.flowResult,"outputs-index":b.index,"open-image-modal":e.openImageModal},null,8,["flow-result","outputs-index","open-image-modal"])):(r(),S(o,{key:1,class:le(`mb-2 h-100 max-h-[${t(n).$state.outputMaxSize}px] mx-auto rounded-lg cursor-pointer`),draggable:"false",height:t(n).$state.outputMaxSize,width:t(n).$state.outputMaxSize,fit:"cover",loading:"lazy",src:("outputResultSrc"in l?l.outputResultSrc:t(me))(b),onClick:F=>e.openImageModal(("outputResultSrc"in l?l.outputResultSrc:t(me))(b))},null,8,["class","height","width","src","onClick"])),m(u,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,b.index)}},{default:k(()=>a[1]||(a[1]=[D(" Send to flow ")])),_:2},1032,["onClick"])])]}),_:1},8,["items"])):P("",!0)])}}}),Yl={class:"video-output"},Zl=["width","height"],eo=["src"],to={class:"flex flex-col basis-full justify-between mx-2"},no=["width","height"],lo=["src"],oo=oe({__name:"Video",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const n=fe();return(l,a)=>{const i=ue,o=Fe;return r(),j("div",Yl,[e.flowResult.outputs.length===1?(r(),j("video",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",style:{"max-height":"80vh"},width:t(n).$state.outputMaxSize,height:t(n).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in l?l.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,eo)],8,Zl)):e.flowResult.outputs.length>1?(r(),S(o,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((u,d)=>({task_id:e.flowResult.task_id,node_id:u.comfy_node_id,index:d})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:k(({item:u})=>[w("div",to,[w("video",{controls:"",class:"mb-2 mx-auto rounded-lg",width:t(n).$state.outputMaxSize,height:t(n).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in l?l.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,lo)],8,no),m(i,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,u.index)}},{default:k(()=>a[0]||(a[0]=[D(" Send to flow ")])),_:2},1032,["onClick"])])]),_:1},8,["items"])):P("",!0)])}}}),ao={class:"audio-output"},so=["src"],io={class:"flex flex-col basis-full justify-between mx-2"},ro=["src"],uo=oe({__name:"Audio",props:{flowResult:{type:Object,required:!0}},setup(e){return(n,l)=>{const a=Fe;return r(),j("div",ao,[e.flowResult.outputs.length===1?(r(),j("audio",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in n?n.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,so)):e.flowResult.outputs.length>1?(r(),S(a,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((i,o)=>({task_id:e.flowResult.task_id,node_id:i.comfy_node_id,index:o})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:k(()=>[w("div",io,[w("audio",{controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in n?n.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,ro)])]),_:1},8,["items"])):P("",!0)])}}}),co={class:"text-output"},mo={key:0,class:"mb-2 mx-auto rounded-lg text-md p-4 pr-8 border border-slate-500 relative"},fo=oe({__name:"Text",props:{flowResult:{type:Object,required:!0}},setup(e){const n=e,l=fe(),a=Me(),i=R(!1),o=R({});function u(d,f){const{$apiFetch:$}=Le(),b=me({task_id:d.task_id,node_id:f.comfy_node_id});return $(b).then(_=>{o.value[f.comfy_node_id]=_}).catch(_=>{console.error(_)}).finally(()=>{i.value=!1})}return Se(()=>{Promise.all(n.flowResult.outputs.filter(d=>d.type==="text").map(d=>u(n.flowResult,d)))}),(d,f)=>{const $=ue,b=Fe;return r(),j("div",co,[e.flowResult.outputs.length===1?(r(),j("div",mo,[t(i)?P("",!0):(r(),S($,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:f[0]||(f[0]=()=>{("useCopyToClipboard"in d?d.useCopyToClipboard:t(qe))().copy(t(o)[e.flowResult.outputs[0].comfy_node_id]),t(a).add({title:"Clipboard",description:"Text copied to clipboard"})})})),w("p",null,X(t(i)?"Loading...":t(o)[e.flowResult.outputs[0].comfy_node_id]),1)])):e.flowResult.outputs.length>1?(r(),S(b,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((_,F)=>({task_id:e.flowResult.task_id,node_id:_.comfy_node_id,index:F})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:"",arrows:""},{default:k(({item:_})=>[w("div",{class:"mb-2 mx-2 rounded-lg text-md p-4 border border-slate-500 shadow-sm overflow-y-auto relative",style:yt({"max-height":Math.ceil(t(l).$state.outputMaxSize/2)+"px"})},[t(i)?P("",!0):(r(),S($,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:()=>{("useCopyToClipboard"in d?d.useCopyToClipboard:t(qe))().copy(t(o)[_.node_id]),t(a).add({title:"Clipboard",description:"Text copied to clipboard"})}},null,8,["onClick"])),w("p",null,X(t(i)?"Loading...":t(o)[_.node_id]),1)],4)]),_:1},8,["items"])):P("",!0)])}}}),po={class:"w-full h-full p-4"},go={class:"mt-4 max-h-96 overflow-y-auto text-sm whitespace-pre-wrap"},vo=oe({__name:"Params",props:{flowResult:{type:Object,required:!0}},setup(e){const n=e,l=R(!1),a=L(()=>["#"+n.flowResult.task_id,...Object.keys(n.flowResult.input_params_mapped).filter(d=>n.flowResult.input_params_mapped[d].value&&n.flowResult.input_params_mapped[d].value!=="").map(d=>l.value&&n.flowResult.translated_input_params_mapped&&n.flowResult.translated_input_params_mapped[d]?`${n.flowResult.input_params_mapped[d].display_name}: ${n.flowResult.translated_input_params_mapped[d].value}`:`${n.flowResult.input_params_mapped[d].display_name}: ${n.flowResult.input_params_mapped[d].value}`)].join(" | ")+`${n.flowResult.execution_time?" | execution_time: "+n.flowResult.execution_time.toFixed(2)+"s":""}`);dt(()=>{n.flowResult.showInputFiles=!1,n.flowResult.showExecutionDetailsModal=!1});const i=L(()=>n.flowResult.execution_details&&n.flowResult.extra_flags!==null),o=L(()=>{const d={unload_models:n.flowResult.extra_flags.unload_models,max_memory_usage:n.flowResult.execution_details.max_memory_usage,disable_smart_memory:n.flowResult.execution_details.disable_smart_memory,vram_state:n.flowResult.execution_details.vram_state};return JSON.stringify(d,null,"	")});function u(){const d={extra_flags:n.flowResult.extra_flags,execution_details:n.flowResult.execution_details},f=new Blob([JSON.stringify(d,null,"	")],{type:"application/json"}),$=URL.createObjectURL(f),b=document.createElement("a");b.href=$,b.download=`${n.flowResult.task_id}_execution_details.json`,b.click(),window.URL.revokeObjectURL($)}return(d,f)=>{const $=ue,b=Ie,_=De,F=Ee,U=xe;return r(),j(se,null,[t(i)?(r(),S(b,{key:0,modelValue:e.flowResult.showExecutionDetailsModal,"onUpdate:modelValue":f[2]||(f[2]=I=>e.flowResult.showExecutionDetailsModal=I)},{default:k(()=>[m($,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:f[0]||(f[0]=()=>e.flowResult.showExecutionDetailsModal=!1)}),w("div",po,[f[6]||(f[6]=w("h3",{class:"text-center font-bold"}," Execution details ",-1)),w("div",go,X(t(o)),1),m($,{class:"mt-3",icon:"i-heroicons-arrow-down-tray-20-solid",variant:"outline",size:"xs",color:"gray",onClick:f[1]||(f[1]=()=>u())},{default:k(()=>f[5]||(f[5]=[D(" Download raw details ")])),_:1})])]),_:1},8,["modelValue"])):P("",!0),e.flowResult.translated_input_params_mapped&&Object.keys(e.flowResult.translated_input_params_mapped).length>0?(r(),S(_,{key:1,text:t(l)?"Hide translated input params":"Show translated input params",popper:{placement:"top"}},{default:k(()=>[m($,{class:"mb-2 mr-2",color:"white",size:"xs",variant:"outline",icon:"i-heroicons-language-solid",onClick:f[3]||(f[3]=()=>{l.value=!t(l)})})]),_:1},8,["text"])):P("",!0),(r(!0),j(se,null,ve(t(a).split("|"),I=>(r(),S(F,{key:I,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer",variant:"soft",color:"gray",onClick:()=>{("useCopyToClipboard"in d?d.useCopyToClipboard:t(qe))().copy(I.split(":")[1].trim()),("useToast"in d?d.useToast:t(Me))().add({title:"Clipboard",description:`${I.split(":")[0].trim()} copied to clipboard`,timeout:2e3})}},{default:k(()=>[D(X(I),1)]),_:2},1032,["onClick"]))),128)),e.flowResult.input_files.length>0?(r(),S(F,{key:2,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer select-none",variant:"subtle",color:"sky",onClick:f[4]||(f[4]=()=>{e.flowResult.showInputFiles=!e.flowResult.showInputFiles})},{default:k(()=>[m(U,{name:e.flowResult.showInputFiles?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-1"},null,8,["name"]),m(U,{name:"i-heroicons-document-solid",class:"mr-1"}),D(" "+X(`input_files: ${e.flowResult.input_files.length}`),1)]),_:1})):P("",!0)],64)}}}),ho={key:0,class:le("w-full p-1")},wo={class:"flex flex-col basis-full justify-between mx-2"},yo=oe({__name:"InputFiles",props:{flowResult:{type:Object,required:!0}},setup(e){const n=fe(),l=(u,d)=>`${$t()}/tasks/inputs?task_id=${u}&input_index=${d}`,a=R(!1),i=R(""),o=R(0);return(u,d)=>{var F,U;const f=_e,$=Fe,b=ue,_=Ie;return e.flowResult.showInputFiles?(r(),j("div",ho,[((F=Object.keys(e.flowResult.input_files))==null?void 0:F.length)===1?(r(),S(f,{key:0,class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(n).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",src:l(e.flowResult.task_id,0),onClick:d[0]||(d[0]=()=>{i.value=l(e.flowResult.task_id,0),o.value=0,a.value=!0})},null,8,["class","src"])):P("",!0),((U=Object.keys(e.flowResult.input_files))==null?void 0:U.length)>1?(r(),S($,{key:1,items:Object.keys(e.flowResult.input_files).map(I=>({task_id:e.flowResult.task_id,index:I})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 my-2"}},page:1,indicators:""},{default:k(({item:I})=>[w("div",wo,[m(f,{class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(n).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",draggable:"false",src:l(I.task_id,I.index),onClick:()=>{i.value=l(e.flowResult.task_id,I.index),o.value=I.index,a.value=!0}},null,8,["class","src","onClick"])])]),_:1},8,["items"])):P("",!0),m(_,{modelValue:t(a),"onUpdate:modelValue":d[3]||(d[3]=I=>Q(a)?a.value=I:null),class:"z-[90]",transition:!1,fullscreen:""},{default:k(()=>[m(b,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:d[1]||(d[1]=()=>a.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:d[2]||(d[2]=Ke(()=>a.value=!1,["left"]))},[t(i)?(r(),S(f,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(i)},null,8,["src"])):P("",!0)])]),_:1},8,["modelValue"])])):P("",!0)}}}),bo={class:"p-4"},ko={class:"flex justify-center mb-4"},xo={key:0,class:"text-sm text-slate-500 text-center mb-4"},_o={class:"text-md text-center text-red-500 mb-4"},$o={key:1},Co={class:"flex items-center justify-between"},So=oe({__name:"SendToFlowModal",props:Ae({flowResult:{type:Object,required:!1,default:()=>null},outputImgSrc:{type:String,required:!0},outputParamIndex:{type:Number,required:!0},inputParamsMapped:{type:Object,required:!0},isChildTask:{type:Boolean,required:!1,default:!1},translatePrompt:{type:Boolean,required:!1,default:!1}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:Ae(["update:show"],["update:show"]),setup(e,{emit:n}){const l=e,a=je(e,"show"),i=fe(),o=L(()=>i.sub_flows.map(F=>({value:F.name,label:`${F.display_name} - ${F.description}`}))),u=R(o.value[0]||""),d=R(!1),f=n;function $(){console.debug("[Send to flow]: ",u.value);const F=i.sub_flows.find(I=>I.name===u.value.value&&I.display_name===u.value.label.split(" - ")[0]);if(console.debug("[Send to flow]: targetFlow",F),!F){Me().add({title:`Target sub-flow "${u.value.value}" not found`,description:"Please, verify the target sub-flow is installed and available and try again",timeout:5e3});return}const U=F.input_params.reduce((I,O)=>{const N={};return O.type==="text"?N[O.name]={value:O.default||"",type:O.type}:O.type==="number"?N[O.name]={value:O.default||0,type:O.type}:O.type==="image"?N[O.name]={value:JSON.stringify({task_id:l.flowResult.task_id,node_id:l.flowResult.outputs.length>1?l.flowResult.outputs[l.outputParamIndex].comfy_node_id:l.flowResult.outputs[0].comfy_node_id})||"",type:O.type}:O.type==="list"?N[O.name]={value:O.default||Object.keys(O.options)[0]||"",type:O.type,options:O.options}:O.type==="bool"?N[O.name]={value:O.default||!1,type:O.type}:["range","range_scale"].includes(O.type)&&(N[O.name]={value:O.default||0,type:O.type}),I.push(N),I},[]);console.debug("[Send to flow]: input_params_map",U),d.value=!0,i.runFlow(F,U,1,l.translatePrompt,b.value,b.value?Number(l.flowResult.task_id):null).finally(()=>{d.value=!1,f("update:show",!1)})}const b=R(!1),_=L(()=>{var F;return l.flowResult.progress===100&&((F=l.flowResult)==null?void 0:F.error)===""});return Qe(()=>{var U,I;const F=l.flowResult?((I=(U=l==null?void 0:l.flowResult)==null?void 0:U.outputs[l.outputParamIndex])==null?void 0:I.type)??"image":"image";i.fetchSubFlows(F).then(()=>{u.value=o.value[0]||""}),b.value=!1}),(F,U)=>{const I=_e,O=ct,N=Ze,M=Ge,c=ue,h=Ie;return r(),S(h,{modelValue:a.value,"onUpdate:modelValue":U[2]||(U[2]=x=>a.value=x),class:"z-[90]",transition:!1},{default:k(()=>[w("div",bo,[U[4]||(U[4]=w("h2",{class:"text-lg text-center mb-4"},"Send to flow",-1)),w("div",ko,[t(_)?(r(),S(I,{key:0,src:e.outputImgSrc,class:"w-1/2 rounded-lg",draggable:!1},null,8,["src"])):(r(),S(O,{key:1,color:"orange",icon:"i-heroicons-exclamation-circle-solid",title:`Task is still running (${Math.ceil(e.flowResult.progress)}%, ${e.flowResult.execution_time.toFixed(2)}s)`,description:e.flowResult.error!==""?e.flowResult.error:""},null,8,["title","description"]))]),e.inputParamsMapped?(r(),j("p",xo,X(["#"+e.flowResult.task_id,...Object.keys(e.inputParamsMapped).filter(x=>e.inputParamsMapped[x].value!=="").map(x=>`${e.inputParamsMapped[x].display_name}: ${e.inputParamsMapped[x].value}`)].join(" | ")),1)):P("",!0),w("p",_o,[t(o).length>0?(r(),S(N,{key:0,modelValue:t(u),"onUpdate:modelValue":U[0]||(U[0]=x=>Q(u)?u.value=x:null),class:"w-full",size:"lg",options:t(o)},null,8,["modelValue","options"])):(r(),j("span",$o,"No sub-flows available"))]),e.isChildTask?(r(),S(O,{key:1,class:"mb-4",icon:"i-heroicons-exclamation-circle-solid",title:"Child task",description:"The latest child task is always used as input for sub-flow"})):P("",!0),w("div",Co,[m(M,{modelValue:t(b),"onUpdate:modelValue":U[1]||(U[1]=x=>Q(b)?b.value=x:null),label:"Bind as child task"},null,8,["modelValue"]),m(c,{icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",variant:"outline",loading:t(d),disabled:t(o).length===0||e.isChildTask&&!t(_),onClick:$},{default:k(()=>U[3]||(U[3]=[D(" Send ")])),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])}}}),Io={class:"flex flex-col md:flex-row items-center justify-center mb-5 sticky top-1 z-[10]"},Ro={class:"flex items-center justify-center"},Mo={class:"p-4"},Fo={class:"text-md text-center text-red-500 mb-4"},Po={class:"flex justify-center"},Uo={key:0,class:"results overflow-auto"},zo=["id"],Vo={class:"text-sm text-slate-500 text-center mb-1"},Oo={class:"w-5/6 mx-auto flex flex-wrap items-center justify-center"},jo={class:"w-full flex justify-center items-center"},To={key:1,class:"text-center text-slate-500"},No=oe({__name:"Output",emits:["copy-prompt-inputs"],setup(e,{emit:n}){const l=fe(),a=L(()=>{var y;return l.flowResultsByName((y=l.currentFlow)==null?void 0:y.name).length>0||!1}),i=L(()=>{var y;return l.flowResultsByName((y=l.currentFlow)==null?void 0:y.name)||[]}),o=L(()=>l.$state.resultsPageSize);we(i,()=>{i.value.length<=l.$state.resultsPageSize?l.$state.resultsPage=1:l.$state.resultsPage>Math.ceil(i.value.length/l.$state.resultsPageSize)&&(l.$state.resultsPage=Math.ceil(i.value.length/l.$state.resultsPageSize))}),we(o,()=>{i.value.length<=l.$state.resultsPageSize?l.$state.resultsPage=1:l.$state.resultsPage>Math.ceil(i.value.length/l.$state.resultsPageSize)&&(l.$state.resultsPage=Math.ceil(i.value.length/l.$state.resultsPageSize)),l.saveUserOptions()}),dt(()=>{l.$state.flow_results_filter="",l.$state.resultsPage=1});const u=n;function d(y){u("copy-prompt-inputs",y.input_params_mapped)}function f(y){I.value=y,U.value=!0}const $=R(null),b=R(!1);window.addEventListener("scroll",()=>{var y;b.value=window.scrollY>(((y=$.value)==null?void 0:y.offsetTop)+window.screen.height||0)});const _=L(()=>l.$state.resultsPage);we(_,()=>{const y=document.getElementById("output-container");y&&y.scrollIntoView({behavior:"smooth"})});const F=R(!1),U=R(!1),I=R(""),O=R(!1),N=R(!1),M=R(!1),c=R(""),h=R(null),x=R({}),p=R(0),B=R(!1);function s(y,g=0){if(y.child_tasks.length===0||!St(y,g,y.outputs[g].comfy_node_id))h.value=y,c.value=me({task_id:y.task_id,node_id:y.outputs[g].comfy_node_id}),x.value=y.input_params_mapped,B.value=!1;else{const A=Ct(y,g,y.outputs[g].comfy_node_id);h.value=A,x.value=y.input_params_mapped,c.value=me({task_id:A.task_id,node_id:A.outputs[0].comfy_node_id}),B.value=!0}p.value=g,M.value=!0}function C(y){var ne;const g=y.extra_flags!==null&&((ne=y==null?void 0:y.extra_flags)==null?void 0:ne.profiler_execution),A=[{label:"Comfy flow",labelClass:"text-blue-500 text-sm",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500 h-4 w-4",click:()=>{var ie;return l.downloadFlowComfy((ie=l.currentFlow)==null?void 0:ie.name,y.task_id)}}];g&&A.push({label:"Execution details",labelClass:"text-orange-500 text-sm",icon:"i-mdi-bug",iconClass:"bg-orange-500 h-4 w-4",click:()=>{y.execution_details?y.showExecutionDetailsModal=!0:l.fetchTaskHistoryItem(y.task_id).then(ie=>{y.execution_details=ie.execution_details,y.showExecutionDetailsModal=!0})}});const te=[[{label:"Use params",labelClass:"text-cyan-500 text-sm",icon:"i-heroicons-document-duplicate-16-solid",iconClass:"bg-cyan-500 h-4 w-4",click:()=>d(y)}],A];return y.outputs.length===1&&y.outputs.every(ie=>ie.type==="image")&&te.splice(1,0,[{label:"Send to flow",labelClass:"text-violet-500 text-sm",icon:"i-heroicons-arrow-uturn-up-solid",iconClass:"bg-violet-500 h-4 w-4",click:()=>{s(y)}}]),te}return(y,g)=>{var H;const A=Nl,te=xe,ne=We,ie=on,pe=rn,J=ue,Z=Ye,ce=Ee,ye=Ie,ee=Kl,Y=oo,de=uo,ge=fo,E=vo,v=yo,z=So,q=_e;return r(),j("div",{id:"output-container",ref_key:"outputContainer",ref:$,class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md my-10"},[m(A,{show:t(b),class:"fixed bottom-5 right-5",target:"output-container"},null,8,["show"]),w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:g[0]||(g[0]=()=>{F.value=!t(F)})},[m(te,{name:t(F)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),D(" Output ("+X(t(i).filter(V=>V.parent_task_id===null).length)+") ",1)]),t(F)?P("",!0):(r(),j(se,{key:0},[w("div",Io,[m(ne,{modelValue:t(l).$state.flow_results_filter,"onUpdate:modelValue":g[1]||(g[1]=V=>t(l).$state.flow_results_filter=V),icon:"i-heroicons-magnifying-glass-20-solid",color:"white",class:"md:mr-3",label:"Filter by prompt",trailing:!0,placeholder:"Filter results by prompt"},null,8,["modelValue"]),t(i).filter(V=>V.parent_task_id===null).length>t(l).$state.resultsPageSize?(r(),S(ie,{key:0,modelValue:t(l).$state.resultsPage,"onUpdate:modelValue":g[2]||(g[2]=V=>t(l).$state.resultsPage=V),class:"my-1 md:my-0","page-count":t(l).$state.resultsPageSize,total:t(i).filter(V=>V.parent_task_id===null).length,"show-first":"","show-last":""},null,8,["modelValue","page-count","total"])):P("",!0),w("div",Ro,[m(pe,{modelValue:t(l).resultsPageSize,"onUpdate:modelValue":g[3]||(g[3]=V=>t(l).resultsPageSize=V),class:"md:mx-3 w-fit mr-3",options:[5,10,20,50,100],label:"Results per page"},null,8,["modelValue"]),m(Z,{items:[[{label:"Delete all results",labelClass:"text-red-500",icon:"i-heroicons-trash",iconClass:"dark:text-red-500 text-red-500",click:()=>O.value=!0}]],mode:"click",label:"Options",popper:{placement:"bottom-end"}},{default:k(()=>[m(J,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])]),m(ye,{modelValue:t(O),"onUpdate:modelValue":g[6]||(g[6]=V=>Q(O)?O.value=V:null),class:"z-[90]",transition:!1},{default:k(()=>[w("div",Mo,[g[15]||(g[15]=w("p",{class:"text-lg text-center mb-4"},"Are you sure you want to delete all results?",-1)),w("p",Fo,[g[11]||(g[11]=D(" All history and images of ")),m(ce,{class:"mx-1",color:"orange",variant:"outline"},{default:k(()=>[D(X(t(l).currentFlow.display_name),1)]),_:1}),g[12]||(g[12]=D(" will be deleted. "))]),w("div",Po,[m(J,{class:"mr-2",color:"red",variant:"outline",loading:t(N),onClick:g[4]||(g[4]=()=>{var V;N.value=!0,t(l).deleteFlowResults((V=t(l).currentFlow)==null?void 0:V.name).then(()=>{N.value=!1,O.value=!1})})},{default:k(()=>g[13]||(g[13]=[D(" Yes ")])),_:1},8,["loading"]),m(J,{variant:"outline",onClick:g[5]||(g[5]=()=>O.value=!1)},{default:k(()=>g[14]||(g[14]=[D("No")])),_:1})])])]),_:1},8,["modelValue"])]),t(a)?(r(),j("div",Uo,[(r(!0),j(se,null,ve(t(l).flowResultsByNamePaginated((H=t(l).currentFlow)==null?void 0:H.name),V=>(r(),j("div",{id:"task_id_"+V.task_id,key:V.task_id,class:"flex flex-col justify-center mx-auto mb-5"},[V.outputs.some(G=>["image","image-animated"].includes(G.type))?(r(),S(ee,{key:0,"flow-result":V,"handle-send-to-flow":s,"open-image-modal":f},null,8,["flow-result"])):V.outputs.some(G=>G.type==="video")?(r(),S(Y,{key:1,"flow-result":V,"handle-send-to-flow":s,"open-image-modal":f},null,8,["flow-result"])):V.outputs.some(G=>G.type==="audio")?(r(),S(de,{key:2,"flow-result":V},null,8,["flow-result"])):V.outputs.some(G=>G.type==="text")?(r(),S(ge,{key:3,"flow-result":V},null,8,["flow-result"])):P("",!0),w("div",Vo,[w("div",Oo,[m(E,{"flow-result":V},null,8,["flow-result"])])]),m(v,{"flow-result":V},null,8,["flow-result"]),w("div",jo,[m(J,{class:"mr-3",color:"red",icon:"i-heroicons-trash",variant:"outline",size:"xs",onClick:()=>t(l).deleteFlowHistory(V.task_id)},{default:k(()=>g[16]||(g[16]=[D(" Delete ")])),_:2},1032,["onClick"]),m(Z,{items:C(V),mode:"click",popper:{placement:"bottom-start"}},{default:k(()=>[m(J,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid",size:"xs"})]),_:2},1032,["items"])])],8,zo))),128)),m(z,{show:t(M),"onUpdate:show":g[7]||(g[7]=V=>Q(M)?M.value=V:null),"flow-result":t(h),"output-img-src":t(c),"output-param-index":t(p),"input-params-mapped":t(x),"is-child-task":t(B)},null,8,["show","flow-result","output-img-src","output-param-index","input-params-mapped","is-child-task"])])):(r(),j("p",To," No output results available "))],64)),m(ye,{modelValue:t(U),"onUpdate:modelValue":g[10]||(g[10]=V=>Q(U)?U.value=V:null),class:"z-[90]",transition:!1,fullscreen:""},{default:k(()=>[m(J,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:g[8]||(g[8]=()=>U.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:g[9]||(g[9]=Ke(()=>U.value=!1,["left"]))},[t(I)?(r(),S(q,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",src:t(I)},null,8,["src"])):P("",!0)])]),_:1},8,["modelValue"])],512)}}}),Bo=Zt("civitAiStore",{actions:{fetchFlowLoras(e,n,l=50,a=null){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:i}=Le();let u=`https://civitai.com/api/v1/models?baseModels=${e.lora_connect_points[Object.keys(e.lora_connect_points)[0]].base_model_type}&types=LORA&limit=${l}`;a&&(a.includes(window.location.hostname)&&(a=a.replace(window.location.hostname,"civitai.com")),u=a);const d=`/other/proxy?target=${encodeURIComponent(u)}`;return i(d,{method:"GET",headers:{Authentication:"Bearer "+n,Accept:"application/json"}})},fetchFlowLorasByHash(e,n,l){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:a}=Le(),i=`https://civitai.com/api/v1/model-versions/by-hash/${l}`,o=`/other/proxy?target=${encodeURIComponent(i)}`;return a(o,{method:"GET",headers:{Authentication:"Bearer "+n,Accept:"application/json"}})}}}),Lo={class:"p-4 overflow-y-auto relative"},Ao={key:1},qo={class:"flex flex-col justify-between w-full md:flex-row md:gap-4 md:items-center lg:items-start"},Eo={class:"flex flex-col gap-2 lg:flex-row md:justify-end items-start w-full"},Do={class:"flex flex-col md:flex-row flex-wrap gap-2 justify-between items-center w-full px-4 py-3"},Wo={class:"flex items-center gap-1.5"},Ho={class:"flex gap-1.5 items-center"},Go={class:"flex items-center h-5"},Xo=["checked","indeterminate","onChange"],Jo={key:0,class:"flex items-center h-5"},Qo=["checked","onChange"],Ko=["href"],Yo=["innerHTML"],Zo={class:"p-4 max-h-64 max-w-xl overflow-y-auto"},ea={key:0},ta={class:"flex items-center"},na={class:"flex items-center"},la={key:0,class:"flex justify-center space-x-2 w-full"},oa={key:1,controls:"",width:256,height:256},aa=["src"],sa={class:"flex justify-end"},ia=oe({__name:"LoraSelectorModal",props:Ae({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const n=e,l=je(e,"show"),a=Me(),i=fe(),o=xt(),u=Bo(),d=R(!1),f=R({items:[],metadata:{}}),$=L(()=>o.settingsMap.civitai_auth_token.value!==""),b=L(()=>o.settingsMap.civitai_auth_token.value||""),_=[{key:"name",label:"Name",sortable:!0,class:""},{key:"description",label:"Description",sortable:!1,class:""},{key:"trigger_words",label:"Trigger words",sortable:!1,class:""},{key:"nsfw",label:"NSFW",sortable:!1,class:""},{key:"statsDownloadCount",label:"Download count",sortable:!1,class:""},{key:"statsThumbsUpCount",label:"Thumbs up",sortable:!1,class:""},{key:"modelVersion",label:"Model version",sortable:!1,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}],F=R([]),U=R({openedRows:[],row:{}}),I=R(""),O=()=>{I.value=""},N=L(()=>{var v;let E=((v=f.value)==null?void 0:v.items)||[];return I.value&&(E=E.filter(z=>z.name.toLowerCase().includes(I.value.toLowerCase()))),E.forEach(z=>{!M.value[z.id]&&(z==null?void 0:z.modelVersions.length)>0&&(M.value[z.id]=z==null?void 0:z.modelVersions[0].name);const q=Object.keys(Y.value);z.modelVersions.forEach(H=>{q.includes(H.files[0].hashes.SHA256.toLowerCase())&&Y.value[H.files[0].hashes.SHA256.toLowerCase()]!==null&&(M.value[z.id]=H.name,z.currentFlowLora=!0,F.value.includes(z)||F.value.push(z))})}),E}),M=R({});function c(E){var v;return((v=E.modelVersions.find(z=>z.name===M.value[E.id]))==null?void 0:v.images)||E.modelVersions[0].images||[]}function h(E){var v;return((v=E.modelVersions.find(z=>z.name===M.value[E.id]))==null?void 0:v.trainedWords)||E.modelVersions[0].trainedWords||[]}const x=R(!0),p=R(""),B=R(n.flow.display_name),s=R(n.flow.description),C=R(n.flow.license),y=R(n.flow.required_memory_gb||0),g=R(n.flow.version);function A(){const E=Object.keys(n.flow.lora_connect_points)[0],z=n.flow.lora_connect_points[E].connected_loras.filter(V=>Y.value[V.hash]!==null).map(V=>({display_name:V.display_name,model_url:V.url,strength_model:V.strength_model})),q={[E]:[]};x.value&&q[E].push(...z);const H=F.value.reduce((V,G)=>{const W=G.modelVersions.find(he=>he.name===M.value[G.id]);if(!W||Y.value[W.files[0].hashes.SHA256.toLowerCase()])return V;const K={strength_model:1,model_url:W.downloadUrl,display_name:G.name};return V.push(K),V},[]);return q[E].push(...H),console.debug("[DEBUG] newFlowConnectionPoints: ",q),q}function te(E){const v=E.modelVersions.find(H=>H.name===M.value[E.id]);if(!v)return;const z=v.files[0].hashes.SHA256.toLowerCase();Y.value[z]&&(Y.value[z]=null);const q=F.value.indexOf(E);q!==-1&&F.value.splice(q,1),E.currentFlowLora=!1}const ne=L(()=>i.flows.find(E=>E.name===p.value)),ie=L(()=>/^[a-z0-9_-]+$/i.test(p.value)),pe=L(()=>p.value!==""&&ie&&!ne.value),J=L(()=>p.value===""?"Flow name is required.":ie.value?ne.value?"Flow name already exists.":"":"Flow name can only contain letters, numbers, dashes and underscores."),Z=L(()=>F.value.filter(E=>!Y.value[E.modelVersions[0].files[0].hashes.SHA256.toLowerCase()]).length!==0),ce=L(()=>Z.value&&pe.value&&B.value!==""&&s.value!==""),ye=L(()=>Z.value?pe.value?B.value===""?"Please provide a display name.":s.value===""?"Please provide a description.":"":"Please provide a valid flow name.":"No LoRAs selected");function ee(){if(F.value.length===0){a.add({title:"No LoRAs selected",description:"Please select at least one LoRA to apply and install."});return}const E={new_name:p.value,new_display_name:B.value,new_description:s.value,new_license:C.value,new_required_memory_gb:y.value,new_version:g.value,new_lora_connection_points:A()};console.debug("[DEBUG] Clone flow params: ",E),d.value=!0,i.cloneFlow(n.flow,E).then(()=>{i.fetchFlows();const v=It();a.add({title:"Flow clone applied",actions:[{label:"View flow",click:()=>{v.push("/workflows/"+p.value)}}]})}).catch(v=>{console.error("Error applying and installing flow: ",v.message||"Unknown error"),a.add({title:"Error applying and installing flow",description:"An error occurred while applying and installing the flow. See the console for more details."})}).finally(()=>{d.value=!1})}const Y=R({});function de(){const E=n.flow.lora_connect_points[Object.keys(n.flow.lora_connect_points)[0]].connected_loras;console.debug("Flow LORAs: ",E),Promise.all(E.map(v=>{var z;return(z=u.fetchFlowLorasByHash(n.flow,b.value,v.hash))==null?void 0:z.then(q=>(v.hash in Y.value||(Y.value[v.hash]=q),q))})).then(()=>{console.debug("Fetched flow LORAs info: ",Y.value)}).catch(v=>{console.error("Error fetching flow LORAs info: ",v),a.add({title:"Error fetching flow LORAs info",description:"An error occurred while fetching LoRAs info for the flow. See the console for more details."})})}function ge(E=!1){var z;if(!n.flow||!b.value)return;d.value=!0,E||de();let v=null;return E&&((z=f.value.metadata)!=null&&z.nextPage)&&(v=f.value.metadata.nextPage),u.fetchFlowLoras(n.flow,b.value,50,v).then(q=>{console.debug('Fetched flow "'+n.flow.name+'" loras: ',q);const H=n.flow.lora_connect_points[Object.keys(n.flow.lora_connect_points)[0]].base_model_type,V=q.items.reduce((G,W)=>(W.modelVersions=W.modelVersions.filter(K=>K.baseModel===H),W.modelVersions.length>0&&(f.value.items.find(K=>K.id===W.id)||G.push(W)),G),[]);return V.length===0&&a.add({title:"No more supported LoRAs",description:"No supported LoRAs available for the flow."}),f.value.items.push(...V),f.value.metadata=q.metadata,q}).catch(q=>{console.error('Error fetching flow "'+n.flow.name+'" loras: ',q),a.add({title:'Error fetching flow "'+n.flow.name+'" loras',description:"An error occurred while fetching LoRAs for the flow. See the console for more details."})}).finally(()=>{d.value=!1})}return(E,v)=>{const z=ue,q=en,H=ct,V=We,G=He,W=Ge,K=De,he=kt,Pe=Ee,be=xe,Ue=Ze,ae=_e,Vt=Fe,Ot=un,jt=Rt,Tt=Ie;return r(),S(Tt,{modelValue:l.value,"onUpdate:modelValue":v[15]||(v[15]=T=>l.value=T),fullscreen:""},{default:k(()=>[w("div",Lo,[m(z,{class:"absolute top-3 right-3",icon:"i-heroicons-x-mark",variant:"ghost",onClick:v[0]||(v[0]=()=>l.value=!1)}),v[22]||(v[22]=w("h2",{class:"text-xl font-bold"},"Modify flow",-1)),v[23]||(v[23]=w("p",{class:"text-sm text-slate-500 my-2"}," Select LoRAs to modify the flow. New Flow will be created and installed with selected LoRAs. ",-1)),t($)?(r(),j("div",Ao,[w("div",qo,[m(z,{class:"my-1",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",loading:t(d),onClick:v[1]||(v[1]=()=>{f.value={items:[],metadata:{}},Y.value={},O(),ge()})},{default:k(()=>v[17]||(v[17]=[D(" Fetch LoRAs models from CivitAI ")])),_:1},8,["loading"]),w("div",Eo,[m(G,{label:"New flow name",class:"flex justify-center flex-col w-full",error:t(J)},{default:k(()=>[m(V,{modelValue:t(p),"onUpdate:modelValue":v[2]||(v[2]=T=>Q(p)?p.value=T:null),type:"text",placeholder:"unique_flow_name",onInput:v[3]||(v[3]=T=>{T.target.value=T.target.value.toLowerCase(),p.value=T.target.value.toLowerCase()})},null,8,["modelValue"])]),_:1},8,["error"]),m(G,{label:"New display name",class:"flex justify-center flex-col w-full",error:t(B)!==""?"":"Display name is required."},{default:k(()=>[m(V,{modelValue:t(B),"onUpdate:modelValue":v[4]||(v[4]=T=>Q(B)?B.value=T:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),m(G,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:k(()=>[m(V,{modelValue:t(s),"onUpdate:modelValue":v[5]||(v[5]=T=>Q(s)?s.value=T:null),type:"text",placeholder:"Description"},null,8,["modelValue"])]),_:1}),m(G,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:k(()=>[m(V,{modelValue:t(C),"onUpdate:modelValue":v[6]||(v[6]=T=>Q(C)?C.value=T:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),m(G,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:k(()=>[m(V,{modelValue:t(y),"onUpdate:modelValue":v[7]||(v[7]=T=>Q(y)?y.value=T:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),m(G,{label:"Version",class:"flex justify-center flex-col w-full"},{default:k(()=>[m(V,{modelValue:t(g),"onUpdate:modelValue":v[8]||(v[8]=T=>Q(g)?g.value=T:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})])]),m(jt,{class:"w-full",ui:{base:"",ring:"",divide:"divide-y divide-gray-200 dark:divide-gray-700",header:{padding:"px-4 py-5"},body:{padding:"",base:"divide-y divide-gray-200 dark:divide-gray-700"},footer:{padding:"p-4"}}},{footer:k(()=>[w("div",sa,[m(z,{class:"mr-2",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",color:"blue",disabled:t(f).items.length===0||t(f).items.length>0&&!t(f).metadata.nextPage,loading:t(d),onClick:v[14]||(v[14]=()=>{ge(!0)})},{default:k(()=>v[21]||(v[21]=[D(" Load more ")])),_:1},8,["disabled","loading"])])]),default:k(()=>[w("div",Do,[w("div",Wo,[m(V,{modelValue:t(I),"onUpdate:modelValue":v[9]||(v[9]=T=>Q(I)?I.value=T:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:"Filter by name..."},null,8,["modelValue"])]),w("div",Ho,[t(Z)?(r(),S(W,{key:0,modelValue:t(x),"onUpdate:modelValue":v[10]||(v[10]=T=>Q(x)?x.value=T:null),label:"Keep previous LoRAs",class:"mr-2"},null,8,["modelValue"])):P("",!0),t(Z)?(r(),S(z,{key:1,variant:"outline",icon:"i-heroicons-x-circle",color:"orange",class:"mr-2",onClick:v[11]||(v[11]=()=>t(F).splice(0))},{default:k(()=>v[18]||(v[18]=[D(" Clear selection ")])),_:1})):P("",!0),m(K,{text:t(ye)},{default:k(()=>[m(z,{variant:"outline",icon:"i-heroicons-check-16-solid",disabled:!t(ce),loading:t(d),onClick:ee},{default:k(()=>v[19]||(v[19]=[D(" Apply and install ")])),_:1},8,["disabled","loading"])]),_:1},8,["text"])])]),m(Ot,{modelValue:t(F),"onUpdate:modelValue":v[12]||(v[12]=T=>Q(F)?F.value=T:null),expand:t(U),"onUpdate:expand":v[13]||(v[13]=T=>Q(U)?U.value=T:null),columns:_,rows:t(N),loading:t(d),ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10",tr:{base:"dark:hover:bg-slate-800"}}},{caption:k(()=>v[20]||(v[20]=[w("caption",{class:"text-slate-500 text-sm py-1"},"Only supported LORAs for the basic model type are listed",-1)])),"select-header":k(({indeterminate:T,checked:re,change:Te})=>[w("div",Go,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:re,indeterminate:T&&t(Z),onChange:et=>Te(et.target.checked)},null,40,Xo)])]),"select-data":k(({checked:T,change:re,row:Te})=>[Te!=null&&Te.currentFlowLora?P("",!0):(r(),j("div",Jo,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:T,onChange:et=>re(et.target.checked)},null,40,Qo)]))]),"name-data":k(({row:T})=>[w("a",{href:`https://civitai.com/models/${T.id}`,target:"_blank",class:"text-blue-500 underline"},X(T.name),9,Ko)]),"description-data":k(({row:T})=>[m(he,null,{panel:k(()=>[w("div",{class:"model-description p-4 max-h-64 max-w-xl overflow-y-auto",innerHTML:T.description},null,8,Yo)]),default:k(()=>[m(z,{color:"white",label:"Description","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:2},1024)]),"trigger_words-data":k(({row:T})=>[m(he,null,{panel:k(()=>[w("div",Zo,[h(T).length===0?(r(),j("p",ea,"No trigger words available for this model version.")):(r(!0),j(se,{key:1},ve(h(T),re=>(r(),S(Pe,{key:re,class:"flex flex-wrap gap-3 my-1 whitespace-normal",label:re,color:"white",variant:"outline"},null,8,["label"]))),128))])]),default:k(()=>[m(z,{color:"white",label:`Trigger words (${h(T).length})`,"trailing-icon":"i-heroicons-chevron-down-20-solid"},null,8,["label"])]),_:2},1024)]),"nsfw-data":k(({row:T})=>[m(K,{text:`NSFW level: ${T.nsfwLevel}`,class:"pl-4"},{default:k(()=>[m(be,{name:T.nsfw?"i-heroicons-x-circle":"i-heroicons-check-circle",class:le({"text-red-500":T.nsfw,"text-green-500":!T.nsfw})},null,8,["name","class"])]),_:2},1032,["text"])]),"statsThumbsUpCount-data":k(({row:T})=>[w("div",ta,[m(be,{name:"i-heroicons-hand-thumb-up-solid",class:"text-green-500 mr-1"}),w("span",null,X(T.stats.thumbsUpCount),1)])]),"statsDownloadCount-data":k(({row:T})=>[w("div",na,[m(be,{name:"i-heroicons-arrow-down-circle",class:"text-blue-500 mr-1"}),w("span",null,X(T.stats.downloadCount),1)])]),"modelVersion-data":k(({row:T})=>[m(Ue,{modelValue:t(M)[T.id],"onUpdate:modelValue":re=>t(M)[T.id]=re,options:T.modelVersions.map(re=>re.name)},null,8,["modelValue","onUpdate:modelValue","options"])]),"actions-data":k(({row:T})=>[T!=null&&T.currentFlowLora?(r(),S(K,{key:1,text:"Remove previously selected LoRA"},{default:k(()=>[m(z,{icon:"i-heroicons-minus-16-solid",variant:"outline",color:"orange",onClick:re=>te(T)},null,8,["onClick"])]),_:2},1024)):(r(),S(z,{key:0,icon:t(F).includes(T)?"i-heroicons-check-16-solid":"i-heroicons-plus-16-solid",variant:"outline",color:t(F).includes(T)?"green":"white",onClick:()=>{if(t(F).includes(T)){t(F).splice(t(F).indexOf(T),1);return}t(F).push(T)}},null,8,["icon","color","onClick"]))]),expand:k(({row:T})=>[c(T).length>0?(r(),j("div",la,[m(Vt,{class:"my-3",items:c(T).map(re=>({id:re.id,url:re.url,type:(re==null?void 0:re.type)||"image"})),ui:{item:"mx-1"}},{default:k(({item:re})=>[re.type==="image"?(r(),S(ae,{key:0,src:re.url,height:256,width:256,loading:"lazy",draggable:"false"},null,8,["src"])):(r(),j("video",oa,[w("source",{src:re.url},null,8,aa)]))]),_:2},1032,["items"])])):(r(),S(H,{key:1,title:"No images",description:"No images available for this model version.",variant:"soft",color:"amber"}))]),_:1},8,["modelValue","expand","rows","loading"])]),_:1})])):(r(),S(H,{key:0,class:"my-4",title:"CivitAI token missing",description:"Please add a CivitAI token in the settings to use this feature.",variant:"soft",color:"red"},{actions:k(()=>[m(q,{to:"/settings"},{default:k(()=>[m(z,{class:"lg:px-3 py-2",icon:"i-heroicons-arrow-top-right-on-square-16-solid",variant:"link",color:"white"},{default:k(()=>v[16]||(v[16]=[D(" Go to Settings ")])),_:1})]),_:1})]),_:1}))])]),_:1},8,["modelValue"])}}}),ra={class:"flex flex-col lg:flex-row flex-grow items-start w-full"},ua={class:"card-wrapper w-full lg:pr-5"},da={key:0,class:"p-0 text-sm"},ca={class:"flex flex-row items-center text-slate-400 mb-2"},ma={class:"flex flex-row flex-wrap items-center text-md mb-2"},fa=["href"],pa={class:"flex flex-row items-center text-md mb-2"},ga=["href"],va={key:1},ha={class:"flex flex-row items-center text-md mb-2"},wa={key:0},ya={class:"flex flex-row items-center text-md mb-2"},ba={key:0,class:"flex flex-row flex-wrap items-center text-md mb-2"},ka=["href"],xa={key:1},_a={class:"flex flex-row items-center mb-2"},$a={key:1,class:"flex flex-row flex-wrap items-center text-md"},Ca={key:0,class:"flex justify-end"},Sa={class:"flex flex-row items-center justify-center text-sm mr-2"},Ia={key:1},Ra={class:"text-sm flex justify-end"},Ma={class:"flex flex-row items-center justify-center text-sm mr-3"},Fa={key:0,class:"text-right"},Pa={class:"prompt-wrapper w-full"},Ua={class:"flex items-center justify-between"},za={class:"pb-2"},Va={class:"flex justify-end items-center"},Ha=oe({__name:"[name]",setup(e){const n=tn(),l=fe();l.setCurrentFlow(n.params.name);const a=L(()=>l.flowInstallingByName(n.params.name)),i=L(()=>{var x;return a.value&&((x=a.value)==null?void 0:x.progress)<100||!1}),o=R(!1),u=L(()=>{var x;return a.value?"error"in a.value&&((x=a.value)==null?void 0:x.error)!==""?`${a.value.progress.toFixed(0)}% Error setting up`:`${a.value.progress.toFixed(0)}% Setting up`:"Setup flow"}),d=R(!1),f=R(!1),$=R(!1),b=L(()=>{var p,B;const x=[[{label:"Delete flow",icon:"i-heroicons-trash",click:F}]];return((p=l==null?void 0:l.currentFlow)==null?void 0:p.new_version_available)!==""&&x[0].unshift({label:`Update to ${l.currentFlow.new_version_available}`,icon:"i-heroicons-arrow-path",click:()=>{l.updateFlow(l.currentFlow)}}),(B=l==null?void 0:l.currentFlow)!=null&&B.lora_connect_points&&Object.keys(l.currentFlow.lora_connect_points).length>0&&x[0].unshift({label:"Modify flow",icon:"i-heroicons-plus-circle",click:()=>{$.value=!0}}),x});function _(x,p=!1){d.value=!0,l.deleteFlow(x).then(()=>{p&&It().push("/")}).finally(()=>{d.value=!1,f.value=!1})}function F(){var p;const x=((p=l.currentFlow)==null?void 0:p.private)||!1;if(x){f.value=!0;return}_(l.currentFlow,x)}const U=R(!1),I=R(null),O=function(x){var p;(p=I.value)==null||p.copyPromptInputs(x)},N=ut(),M=L(()=>{var x;return(x=l.currentFlow)==null?void 0:x.models.filter(p=>p.installed).reduce((p,B)=>p+(B==null?void 0:B.file_size)||0,0)}),c=L(()=>{var x;return(x=l.currentFlow)==null?void 0:x.models.reduce((p,B)=>p+(B==null?void 0:B.file_size)||0,0)}),h=L(()=>!M.value&&!c.value?"":M.value===c.value?` - ${Ve(c.value)}`:` - ${Ve(M.value)} / ${Ve(c.value)}`);return(x,p)=>{const B=xe,s=De,C=Ee,y=ue,g=Ye,A=Rt,te=yl,ne=Tl,ie=No,pe=Ft,J=Ie,Z=ia,ce=nn;return r(),S(ce,null,{default:k(()=>{var ye;return[!t(l).loading.flows_available&&!t(l).loading.flows_installed&&t(l).currentFlow&&!t(l).$state.loading.tasks_history?(r(),j(se,{key:0},[w("div",ra,[w("div",ua,[m(A,{as:"div",class:"w-full mb-5"},ln({header:k(()=>{var ee,Y;return[w("h2",{class:"text-xl font-bold cursor-pointer select-none flex items-center",onClick:p[0]||(p[0]=()=>{U.value=!t(U)})},[(ee=t(l).currentFlow)!=null&&ee.private?(r(),S(s,{key:0,text:"This flow is local, manually added"},{default:k(()=>{var de;return[m(B,{name:"i-heroicons-lock-closed",class:le(["mr-2",{"text-stone-500":!((de=t(l).currentFlow)!=null&&de.is_supported_by_workers)}])},null,8,["class"])]}),_:1})):P("",!0),m(B,{name:t(U)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),m(s,{text:(Y=t(l).currentFlow)!=null&&Y.is_supported_by_workers?"":"No workers capable of running this flow",popper:{placement:"top"}},{default:k(()=>{var de,ge;return[w("span",{class:le({"text-stone-500":!((de=t(l).currentFlow)!=null&&de.is_supported_by_workers)})},X((ge=t(l).currentFlow)==null?void 0:ge.display_name),3)]}),_:1},8,["text"])])]}),default:k(()=>{var ee,Y,de,ge,E,v,z,q,H,V,G,W,K,he,Pe,be,Ue;return[t(U)?P("",!0):(r(),j("div",da,[w("p",ca,X((ee=t(l).currentFlow)==null?void 0:ee.description),1),w("p",ma,[m(B,{name:"i-heroicons-user-16-solid",class:"mr-1"}),p[9]||(p[9]=w("b",null,"Author:",-1)),p[10]||(p[10]=D("  ")),w("a",{class:"hover:underline text-md",href:(Y=t(l).currentFlow)==null?void 0:Y.homepage,rel:"noopener",target:"_blank"},X((de=t(l).currentFlow)==null?void 0:de.author),9,fa)]),w("p",pa,[m(B,{name:"i-heroicons-document-text",class:"mr-1"}),(ge=t(l).currentFlow)!=null&&ge.documentation?(r(),j("a",{key:0,class:"hover:underline",href:(E=t(l).currentFlow)==null?void 0:E.documentation,rel:"noopener",target:"_blank"}," Documentation ",8,ga)):(r(),j("span",va,"No documentation"))]),w("p",ha,[m(B,{name:"i-heroicons-clock",class:"mr-1"}),p[11]||(p[11]=w("b",null,"Version:",-1)),p[12]||(p[12]=D("  ")),w("span",null,X((v=t(l).currentFlow)==null?void 0:v.version),1),((z=t(l).currentFlow)==null?void 0:z.new_version_available)!==""?(r(),j("span",wa,"  (new version available: "+X((q=t(l).currentFlow)==null?void 0:q.new_version_available)+") ",1)):P("",!0)]),w("p",ya,[m(B,{name:"i-heroicons-tag",class:"mr-1"}),p[13]||(p[13]=w("b",null,"Tags:",-1)),p[14]||(p[14]=D("  ")),((H=t(l).currentFlow)==null?void 0:H.tags.length)>0?(r(!0),j(se,{key:0},ve((V=t(l).currentFlow)==null?void 0:V.tags,ae=>(r(),S(C,{key:ae,label:ae,color:"white",variant:"solid",class:"m-1"},null,8,["label"]))),128)):(r(),S(C,{key:1,label:"No tags",color:"white",variant:"solid",class:"m-1"}))]),((W=(G=t(l).currentFlow)==null?void 0:G.models)==null?void 0:W.length)>0?(r(),j("p",ba,[m(B,{name:"i-heroicons-arrow-down-on-square-stack",class:"mr-1"}),m(s,{text:t(c)-t(M)>0?`${("formatBytes"in x?x.formatBytes:t(Ve))(t(c)-t(M))} to download`:"All models installed",popper:{placement:"top"}},{default:k(()=>{var ae;return[w("b",null,"Models ("+X((ae=t(l).currentFlow)==null?void 0:ae.models.length)+X(t(h))+"):",1),p[15]||(p[15]=D("  "))]}),_:1},8,["text"]),(r(!0),j(se,null,ve((K=t(l).currentFlow)==null?void 0:K.models,ae=>(r(),S(C,{key:ae.name,class:"m-1",color:"white",variant:"solid"},{default:k(()=>[m(s,{text:ae.installed?"Model installed":"Model not installed"},{default:k(()=>[m(B,{name:ae.installed?"i-heroicons-check-circle-20-solid":"i-heroicons-x-mark-20-solid",class:le(ae.installed?"text-green-500":"text-orange-500")},null,8,["name","class"])]),_:2},1032,["text"]),ae.gated?(r(),S(s,{key:0,text:"Gated model, requires auth token for download",popper:{placement:"top"}},{default:k(()=>[m(B,{name:"i-heroicons-key",class:"mr-1"})]),_:1})):P("",!0),w("a",{class:"hover:underline underline-offset-4",href:ae.homepage,rel:"noopener",target:"_blank"},X(ae.name),9,ka),ae.file_size?(r(),j("span",xa," ("+X(("formatBytes"in x?x.formatBytes:t(Ve))(ae.file_size))+") ",1)):P("",!0)]),_:2},1024))),128))])):P("",!0),w("p",_a,[m(B,{name:"i-mdi-help-network-outline",class:"mr-1"}),p[18]||(p[18]=w("b",null,"Platforms:",-1)),p[19]||(p[19]=D("  ")),m(s,{text:"Linux"},{default:k(()=>[m(B,{name:"i-mdi-linux",class:"mr-1"})]),_:1}),m(s,{text:"Microsoft Windows"},{default:k(()=>[m(B,{name:"i-mdi-microsoft-windows",class:"mr-1"})]),_:1}),t(l).currentFlow.is_macos_supported?(r(),S(s,{key:0,text:"macOS"},{default:k(()=>[m(B,{name:"i-mdi-apple",class:"mr-1"})]),_:1})):P("",!0),(he=t(l).currentFlow)!=null&&he.required_memory_gb?(r(),S(s,{key:1,class:"flex flex-row items-center",text:"Required VRAM memory (GB)"},{default:k(()=>{var ae;return[p[16]||(p[16]=D(" (")),m(B,{name:"i-mdi-memory",class:"mr-1"}),w("span",null,X((ae=t(l).currentFlow)==null?void 0:ae.required_memory_gb)+" GB",1),p[17]||(p[17]=D(") "))]}),_:1})):P("",!0)]),((be=(Pe=t(l).currentFlow)==null?void 0:Pe.requires)==null?void 0:be.length)>0?(r(),j("p",$a,[p[20]||(p[20]=w("b",null,"Requires:",-1)),p[21]||(p[21]=D("  ")),(r(!0),j(se,null,ve((Ue=t(l).currentFlow)==null?void 0:Ue.requires,ae=>(r(),S(C,{key:ae,class:"m-1",color:"yellow",variant:"outline"},{default:k(()=>[D(X(ae),1)]),_:2},1024))),128))])):P("",!0)]))]}),_:2},[t(U)?void 0:{name:"footer",fn:k(()=>{var ee,Y;return[t(N).isAdmin?(r(),j("div",Ca,[w("div",Sa,[m(B,{name:t(l).isFlowInstalled(t(n).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:le({"text-green-500":t(l).isFlowInstalled(t(n).params.name),"text-red-500":!t(l).isFlowInstalled(t(n).params.name),"text-stone-500":t(l).isFlowInstalled(t(n).params.name)&&!((ee=t(l).currentFlow)!=null&&ee.is_supported_by_workers)})},X(t(l).isFlowInstalled(t(n).params.name)?(Y=t(l).currentFlow)!=null&&Y.is_supported_by_workers?"Installed":"Installed (no workers)":"Not installed"),3)]),t(l).isFlowInstalled(t(n).params.name)?P("",!0):(r(),S(s,{key:0,text:"Setup flow dependencies and configure it in ComfyUI",popper:{placement:"top"},"open-delay":500},{default:k(()=>[m(y,{icon:"i-heroicons-arrow-down-tray",class:"mx-3",color:"primary",variant:"outline",loading:t(i),onClick:p[1]||(p[1]=()=>t(l).setupFlow(t(l).currentFlow))},{default:k(()=>[D(X(t(u)),1)]),_:1},8,["loading"])]),_:1})),!t(l).isFlowInstalled(t(n).params.name)&&t(i)?(r(),S(s,{key:1,text:"Cancel flow installation",popper:{placement:"top"},"open-delay":500},{default:k(()=>[m(y,{icon:"i-heroicons-stop",variant:"outline",color:"orange",loading:t(o),onClick:p[2]||(p[2]=()=>{o.value=!0,t(l).cancelFlowSetup(t(l).currentFlow).then(()=>{o.value=!1})})},{default:k(()=>p[22]||(p[22]=[D(" Cancel ")])),_:1},8,["loading"])]),_:1})):P("",!0),t(l).isFlowInstalled(t(n).params.name)?(r(),S(g,{key:2,items:t(b),mode:"click",label:"Actions",popper:{placement:"bottom-end"}},{default:k(()=>[m(y,{color:"white",label:"Actions","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:1},8,["items"])):P("",!0)])):(r(),j("div",Ia,[w("div",Ra,[w("div",Ma,[m(B,{name:t(l).isFlowInstalled(t(n).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:le({"text-green-500":t(l).isFlowInstalled(t(n).params.name),"text-red-500":!t(l).isFlowInstalled(t(n).params.name)})},X(t(l).isFlowInstalled(t(n).params.name)?"Installed":"Not installed"),3)]),t(l).isFlowInstalled(t(n).params.name)?P("",!0):(r(),j("div",Fa,p[23]||(p[23]=[w("p",{class:"text-orange-500"},"Only admin can manage workflows.",-1),w("span",{class:"text-slate-500"},"Ask your admin to setup this workflow",-1)])))])]))]}),key:"0"}]),1024)]),w("div",Pa,[!t(d)&&t(l).isFlowInstalled(t(n).params.name)?(r(),S(te,{key:0,ref_key:"workflowPrompt",ref:I},null,512)):P("",!0)])]),!t(d)&&t(l).isFlowInstalled(t(n).params.name)?(r(),S(ne,{key:0})):P("",!0),!t(d)&&t(l).isFlowInstalled(t(n).params.name)||t(l).flowResultsByName(t(n).params.name).length>0?(r(),S(ie,{key:1,onCopyPromptInputs:p[3]||(p[3]=ee=>O(ee))})):P("",!0)],64)):(r(),S(pe,{key:1,class:"mb-3"})),m(J,{modelValue:t(f),"onUpdate:modelValue":p[7]||(p[7]=ee=>Q(f)?f.value=ee:null),"prevent-close":""},{default:k(()=>[m(A,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:k(()=>[w("div",Ua,[p[24]||(p[24]=w("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Confirm workflow deletion ",-1)),m(y,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:p[4]||(p[4]=ee=>f.value=!1)})])]),default:k(()=>{var ee;return[w("p",za,[p[25]||(p[25]=D(" Are you sure you want to delete the ")),p[26]||(p[26]=w("b",null,"private",-1)),p[27]||(p[27]=D(" workflow ")),w("b",null,X((ee=t(l).currentFlow)==null?void 0:ee.display_name),1),p[28]||(p[28]=D("? "))]),w("div",Va,[m(y,{icon:"i-heroicons-x-mark-16-solid",variant:"outline",color:"green",class:"mr-2",onClick:p[5]||(p[5]=Y=>f.value=!1)},{default:k(()=>p[29]||(p[29]=[D(" Cancel ")])),_:1}),m(y,{icon:"i-heroicons-trash",variant:"outline",color:"red",onClick:p[6]||(p[6]=Y=>{var de;return _(t(l).currentFlow,((de=t(l).currentFlow)==null?void 0:de.private)||!1)})},{default:k(()=>p[30]||(p[30]=[D(" Delete ")])),_:1})])]}),_:1})]),_:1},8,["modelValue"]),t(N).isAdmin&&((ye=t(l))!=null&&ye.currentFlow)?(r(),S(Z,{key:2,show:t($),"onUpdate:show":p[8]||(p[8]=ee=>Q($)?$.value=ee:null),flow:t(l).currentFlow},null,8,["show","flow"])):P("",!0)]}),_:1})}}});export{Ha as default};
