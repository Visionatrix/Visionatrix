import{_ as ue}from"./YqCW6HBG.js";import{_ as ce}from"./BQKv2lt2.js";import{_ as me}from"./BjdfZwpI.js";import{B as fe,C as G,_ as pe,f as T,c as h,o as d,a as p,F as D,r as q,n as S,b as f,D as F,k as v,w as i,i as b,h as K,t as _,E as j,G as Q,H as _e,I as H,J as ge,K as ye,L as he,y as W,M as ve,N as k,v as P,d as y,p as e,O as z,m as X,P as O,s as E,Q as be,u as ke,q as Ue,R as Ce,x as R,A as Be,l as Me,j as xe,S as we}from"./CrQEjpV1.js";import{_ as $e}from"./DsisoY3l.js";import{a as Se}from"./OhYbB4L_.js";import{_ as Y}from"./COleAoLe.js";import{_ as Ve,a as Ie}from"./CSeRX3hs.js";import"./Dz77Of_D.js";const ze={wrapper:"relative min-w-0",ol:"flex items-center gap-x-1.5",li:"flex items-center gap-x-1.5 text-gray-500 dark:text-gray-400 text-sm leading-6 min-w-0",base:"flex items-center gap-x-1.5 group font-semibold min-w-0",label:"block truncate",icon:{base:"flex-shrink-0 w-5 h-5",active:"",inactive:""},divider:{base:"flex-shrink-0 w-5 h-5 rtl:rotate-180"},active:"text-primary-500 dark:text-primary-400",inactive:" hover:text-gray-700 dark:hover:text-gray-200",default:{divider:"i-heroicons-chevron-right-20-solid"}},J=fe(G.ui.strategy,G.ui.breadcrumb,ze),Oe=T({components:{UIcon:K,ULink:Q},inheritAttrs:!1,props:{links:{type:Array,default:()=>[]},divider:{type:String,default:()=>J.default.divider},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(s){const{ui:U,attrs:a}=_e("breadcrumb",H(s,"ui"),J,H(s,"class"));return{ui:U,attrs:a,getULinkProps:he,twMerge:ye,twJoin:ge}}}),Le={key:1,role:"presentation"};function Ae(s,U,a,x,B,C){const u=K,m=Q;return d(),h("nav",j({"aria-label":"Breadcrumb",class:s.ui.wrapper},s.attrs),[p("ol",{class:S(s.ui.ol)},[(d(!0),h(D,null,q(s.links,(t,r)=>(d(),h("li",{key:r,class:S(s.ui.li)},[f(m,j({as:"span",class:[s.ui.base,r===s.links.length-1?s.ui.active:t.to?s.ui.inactive:""],"aria-current":r===s.links.length-1?"page":void 0,ref_for:!0},s.getULinkProps(t),{onClick:t.click}),{default:i(()=>[F(s.$slots,"icon",{link:t,index:r,isActive:r===s.links.length-1},()=>[t.icon?(d(),b(u,{key:0,name:t.icon,class:S(s.twMerge(s.twJoin(s.ui.icon.base,r===s.links.length-1?s.ui.icon.active:t.to?s.ui.icon.inactive:""),t.iconClass))},null,8,["name","class"])):v("",!0)]),F(s.$slots,"default",{link:t,index:r,isActive:r===s.links.length-1},()=>[t.label?(d(),h("span",{key:0,class:S(s.twMerge(s.ui.label,t.labelClass))},_(t.label),3)):v("",!0)])]),_:2},1040,["class","aria-current","onClick"]),r<s.links.length-1?F(s.$slots,"divider",{key:0},()=>[s.divider?(d(),h(D,{key:0},[s.divider.startsWith("i-")?(d(),b(u,{key:0,name:s.divider,class:S(s.ui.divider.base),role:"presentation"},null,8,["name","class"])):(d(),h("span",Le,_(s.divider),1))],64)):v("",!0)]):v("",!0)],2))),128))],2)],16)}const Fe=pe(Oe,[["render",Ae]]),Re={class:"orphan-models"},De={class:"text-md font-bold"},Pe={key:0,class:"text-red-500"},Ee={key:0,class:"flex justify-end items-center space-x-2 mt-3"},Te={class:"text-gray-500 text-sm"},Ne=["href"],Ge={key:1},je={class:"p-4 flex flex-col space-y-2 max-h-60 overflow-y-auto"},He={key:2,class:"text-gray-500"},Je=T({__name:"OrphanModels",setup(s){const U=W();ve(()=>{a()});function a(){U.getOrphanModelsList().then(t=>{console.debug("[DEBUG] Orphan models: ",t),C.value=t})}const x=[{key:"full_path",label:"Path",sortable:!0,class:""},{key:"size",label:"Size",sortable:!0,class:""},{key:"creation_time",label:"Created time",sortable:!0,class:""},{key:"res_model",label:"Model",sortable:!0,class:""},{key:"possible_flows",label:"Possible Flows",sortable:!0,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}];function B(){console.debug("[DEBUG] Deleting orphan models: ",u),m.value=!0,Promise.all(u.value.map(t=>U.deleteOrphanModel(t.full_path,t.creation_time))).then(()=>{a(),m.value=!1,u.value=u.value.filter(t=>t.full_path!==t.full_path)}).catch(t=>{console.error("[ERROR] Failed to delete orphan models: ",t),E().add({title:"Failed to delete orphan models",description:t.details}),m.value=!1})}const C=k([]),u=k([]),m=k(!1);return P(()=>U.settingsMap.comfyui_models_folder.value,()=>{a()}),(t,r)=>{const w=X,L=be,A=Y;return d(),h("div",Re,[p("h3",De,[r[2]||(r[2]=y(" Orphan models ")),e(C).length>0?(d(),h("span",Pe,"("+_(e(C).length)+" - "+_(("formatBytes"in t?t.formatBytes:e(z))(e(C).reduce((l,g)=>l+g.size,0)))+")",1)):v("",!0)]),r[5]||(r[5]=p("p",{class:"text-gray-500 text-sm"}," Orphan models are models that are not associated with any model type. They are not used in any installed flow and can be deleted. ",-1)),e(u).length>0?(d(),h("div",Ee,[p("span",Te," Selected: "+_(e(u).length)+" ("+_(("formatBytes"in t?t.formatBytes:e(z))(e(u).reduce((l,g)=>l+g.size,0)))+") ",1),f(w,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:e(m),onClick:r[0]||(r[0]=()=>{B()})},{default:i(()=>r[3]||(r[3]=[y(" Delete selected ")])),_:1},8,["loading"])])):v("",!0),e(C).length>0?(d(),b(A,{key:1,modelValue:e(u),"onUpdate:modelValue":r[1]||(r[1]=l=>O(u)?u.value=l:null),class:"mt-5",ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10"},rows:e(C),columns:x,style:{"max-height":"40vh"}},{"full_path-data":i(({row:l})=>[y(_(l.full_path),1)]),"size-data":i(({row:l})=>[y(_(l.size?("formatBytes"in t?t.formatBytes:e(z))(l.size):"-"),1)]),"creation_time-data":i(({row:l})=>[y(_(l.creation_time?new Date(l.creation_time*1e3).toLocaleString():"-"),1)]),"res_model-data":i(({row:l})=>[l.res_model?(d(),h("a",{key:0,href:l.res_model.homepage,target:"_blank",class:"text-blue-500"},_(l.res_model.name),9,Ne)):(d(),h("span",Ge,"-"))]),"possible_flows-data":i(({row:l})=>[f(L,null,{panel:i(()=>[p("div",je,[(d(!0),h(D,null,q(l.possible_flows,g=>(d(),b(w,{key:g.id,to:`/workflows/${g==null?void 0:g.name}`,variant:"soft",color:"blue",target:"_blank"},{default:i(()=>[y(_(g.name),1)]),_:2},1032,["to"]))),128))])]),default:i(()=>[f(w,{icon:"i-heroicons-chevron-down-16-solid",variant:"outline",color:"blue"},{default:i(()=>[y(_(l.possible_flows.length),1)]),_:2},1024)]),_:2},1024)]),"actions-data":i(({row:l})=>[f(w,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:e(m),disabled:l.readonly===!0,onClick:()=>{console.debug("[DEBUG] Deleting orphan model: ",l),m.value=!0,e(U).deleteOrphanModel(l.full_path,l.creation_time).then(()=>{a()}).catch(g=>{console.error("[ERROR] Failed to delete orphan model: ",g),("useToast"in t?t.useToast:e(E))().add({title:"Failed to delete orphan model",description:g.details})}).finally(()=>{m.value=!1})}},{default:i(()=>r[4]||(r[4]=[y(" Delete ")])),_:2},1032,["loading","disabled","onClick"])]),_:1},8,["modelValue","rows"])):(d(),h("span",He,"No orphan models found."))])}}}),qe={class:"flex flex-col md:flex-row"},Ke={class:"px-5 pb-5 md:w-4/5"},Qe={key:0,class:"admin-settings mb-3"},We={class:"mt-3 mb-5"},Xe={class:"flex items-center mt-3"},Ye={class:"flex items-center mt-3"},Ze={class:"p-4 max-h-screen"},et=["onClick"],tt={class:"flex items-center mt-2"},ct=T({__name:"comfyui",setup(s){ke({title:"ComfyUI settings - Visionatrix",meta:[{name:"description",content:"ComfyUI settings - Visionatrix"}]});const U=Ue(),a=W(),x=E(),B=k(!1),C=k(!1),u=k([]),m=k("../vix_models");P(()=>a.settingsMap.comfyui_models_folder.value,()=>{a.settingsMap.comfyui_models_folder.value!==""&&(m.value=a.settingsMap.comfyui_models_folder.value)}),Ce(()=>{a.settingsMap.comfyui_models_folder.value!==""&&(m.value=a.settingsMap.comfyui_models_folder.value)});const t=k(""),r=R(()=>u.value.length===0?[]:t.value===""?Object.keys(u.value).map(c=>{let o=0;return u.value[c].length>0&&(o=u.value[c].reduce((M,$)=>M+($.total_size??0),0)),{full_path:c,total_size:o,create_time:null}}):u.value[t.value]??[]),w=R(()=>{const c=[{label:"Root",to:""}];if(t.value==="")return c;const o=t.value.split("/");let M="";return o.forEach($=>{M+=$,c.push({label:$,to:M}),M+="/"}),c}),L=R(()=>{const c=[{key:"full_path",label:"Path",sortable:!0,class:""},{key:"total_size",label:"Size",sortable:!0,class:""}];return t.value!==""&&c.push({key:"create_time",label:"Created time",sortable:!0,class:""}),c});function A(c){c.full_path in u.value&&(t.value=c.full_path)}const l=k(!1);function g(c){if(c===""){x.add({title:"ComfyUI models folder is empty",description:"Please provide a valid path to the models folder."});return}else l.value=!0;a.performComfyUiAutoconfig(c).then(o=>{"folders"in o&&(console.debug("[DEBUG] ComfyUI folders: ",o.folders),a.loadAllSettings(),c!==""&&(u.value=o.folders,x.add({title:"ComfyUI models folder modified"})),a.settingsMap.comfyui_models_folder.changed=!0)}).catch(o=>{x.add({title:"Error performing autoconfig",description:o.details})}).finally(()=>{l.value=!1})}const V=k(!0);return P(()=>a.localSettings.showComfyUiNavbarButton,()=>{a.saveLocalSettings()}),(c,o)=>{const M=ue,$=ce,Z=me,I=X,ee=Me,N=$e,te=Se,oe=xe,se=Fe,le=Y,ae=Ve,ne=Ie,ie=Je,re=Be;return d(),b(re,{class:"lg:h-dvh"},{default:i(()=>[p("div",qe,[f(M,{links:e(a).links,class:"md:w-1/5"},null,8,["links"]),p("div",Ke,[e(U).isAdmin?(d(),h("div",Qe,[o[12]||(o[12]=p("h3",{class:"mb-3 text-xl font-bold"},"ComfyUI settings (global)",-1)),p("div",We,[f(N,{size:"md",class:"py-3",label:"ComfyUI models folder",description:"Relative (to ComfyUI folder) or absolute path to the models folders",error:e(m).trim()===""?"Please provide a valid path to the models folder.":""},{default:i(()=>[e(a).settingsMap.comfyui_models_folder.changed?(d(),b($,{key:0,class:"mt-3",color:"orange",variant:"solid",title:"ComfyUI models folder modified",description:"Restart Visionatrix server to apply changes.",icon:"i-heroicons-exclamation-triangle"})):v("",!0),p("div",Xe,[f(Z,{modelValue:e(m),"onUpdate:modelValue":o[0]||(o[0]=n=>O(m)?m.value=n:null),placeholder:"ComfyUI folder path",class:"w-fit mr-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",disabled:e(l),autocomplete:"off"},null,8,["modelValue","disabled"]),e(m)!==e(a).settingsMap.comfyui_models_folder.value?(d(),b(ee,{key:0,text:"Reset to configured value"},{default:i(()=>[f(I,{icon:"i-heroicons-arrow-uturn-left",color:"gray",onClick:o[1]||(o[1]=()=>m.value=e(a).settingsMap.comfyui_models_folder.value)})]),_:1})):v("",!0)]),p("div",Ye,[e(m)!==e(a).settingsMap.comfyui_models_folder.value?(d(),b(I,{key:0,class:"mr-3",icon:"i-heroicons-check-16-solid",color:"primary",loading:e(l),onClick:o[2]||(o[2]=()=>g(e(m)))},{default:i(()=>o[8]||(o[8]=[y(" Apply ")])),_:1},8,["loading"])):v("",!0),e(a).settingsMap.comfyui_models_folder.value!==""?(d(),b(I,{key:1,icon:"i-heroicons-folder-16-solid",color:"cyan",onClick:o[3]||(o[3]=()=>{e(a).getComfyUiFolderListing().then(n=>{console.debug("[DEBUG] ComfyUI folders: ",n),u.value=n.folders}),B.value=!0})},{default:i(()=>o[9]||(o[9]=[y(" Show ComfyUI folders ")])),_:1})):v("",!0)])]),_:1},8,["error"]),e(a).settingsMap.comfyui_models_folder.value!==""?(d(),b(ae,{key:0,modelValue:e(B),"onUpdate:modelValue":o[6]||(o[6]=n=>O(B)?B.value=n:null),class:"z-[90]",fullscreen:""},{default:i(()=>[f(I,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:o[4]||(o[4]=()=>B.value=!1)}),p("div",Ze,[o[10]||(o[10]=p("h3",{class:"text-xl text-center"},"ComfyUI folders",-1)),p("div",null,[f(te,{modelValue:e(V),"onUpdate:modelValue":o[5]||(o[5]=n=>O(V)?V.value=n:null),class:"mt-3",label:"Hide empty folders"},null,8,["modelValue"])]),f(se,{links:e(w),class:"my-2"},{default:i(({link:n,isActive:de})=>[f(oe,{color:de?"primary":"gray",class:"rounded-full truncate cursor-pointer select-none",onClick:()=>{t.value=n.to}},{default:i(()=>[y(_(n.label),1)]),_:2},1032,["color","onClick"])]),_:1},8,["links"]),f(le,{loading:e(C),"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},rows:e(r).filter(n=>e(V)?n.total_size>0:!0),columns:e(L),style:{"max-height":"80vh"}},{"full_path-data":i(({row:n})=>[p("span",{class:S({"text-blue-500":n.full_path in e(u),"cursor-pointer":n.full_path in e(u)}),onClick:()=>A(n)},_(n.full_path),11,et)]),"total_size-data":i(({row:n})=>[y(_(n.total_size?("formatBytes"in c?c.formatBytes:e(z))(n.total_size):"-"),1)]),"create_time-data":i(({row:n})=>[y(_(n.create_time&&new Date(n.create_time).getTime()!==0?new Date(n.create_time).toLocaleString():"-"),1)]),_:1},8,["loading","rows","columns"])])]),_:1},8,["modelValue"])):v("",!0)]),e(a).isNextcloudIntegration?v("",!0):(d(),b(N,{key:0,size:"md",class:"py-3",label:"Show 'Open ComfyUI' navbar button",description:"Toggle Navbar button to open ComfyUI in a new tab (Stored in browser local storage	)"},{default:i(()=>[p("div",tt,[f(ne,{modelValue:e(a).localSettings.showComfyUiNavbarButton,"onUpdate:modelValue":o[7]||(o[7]=n=>e(a).localSettings.showComfyUiNavbarButton=n),class:"mr-3"},null,8,["modelValue"]),f(I,{icon:"i-heroicons-rectangle-group-16-solid",variant:"outline",color:"white",to:("buildBackendUrl"in c?c.buildBackendUrl:e(we))()+"/comfy/",target:"_blank"},{default:i(()=>o[11]||(o[11]=[y(" Open ComfyUI ")])),_:1},8,["to"])])]),_:1})),f(ie,{class:"mt-3"})])):v("",!0)])])]),_:1})}}});export{ct as default};
