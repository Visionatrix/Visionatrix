import{B as at,W as Nt,C as Ce,_ as st,f as oe,c as j,o as u,a as w,D as Ve,E as Me,n as ne,H as it,I as Be,N as C,X as rt,S as Se,v as he,Y as Bt,x as L,K as Qe,J as ze,Z as Lt,$ as At,a0 as pt,a1 as ot,a2 as qt,a3 as Et,a4 as gt,a5 as Le,a6 as yt,a7 as Dt,p as t,a8 as Wt,a9 as ut,aa as Ht,ab as bt,ac as Ae,ad as je,g as pe,M as Ke,T as kt,ae as Ne,i as _,k as I,w as y,b as f,F as ae,r as ge,m as de,d as E,P as K,af as Gt,s as Ie,ag as Xt,t as J,ah as Ye,Q as xt,j as Ee,q as dt,z as Jt,O as Oe,h as xe,y as _t,ai as $t,l as De,aj as ct,ak as Qt,al as Kt,am as Yt,R as lt,an as Ct,ao as St,ap as fe,aq as It,ar as Zt,G as en,as as Rt,at as tn,A as nn,au as on}from"./BKtR1lHj.js";import{b as Ze,a as ln,_ as Mt}from"./D1VUvq4p.js";import{u as Ft,_ as We}from"./C52Cgi5r.js";import{_ as an}from"./BjnDTVQq.js";import{_ as He}from"./CGDxVjno.js";import{_ as Re,a as sn}from"./DP_JPsK8.js";import{_ as et}from"./n0nYTQhC.js";import{a as Ge,_ as Pt}from"./Ctln2K2r.js";import{_ as mt}from"./DZCJikri.js";import{_ as rn}from"./l8gEVTxN.js";import{_ as un}from"./CtT2p3W-.js";const dn={wrapper:"relative",container:"relative w-full flex overflow-x-auto snap-x snap-mandatory scroll-smooth",item:"flex flex-none snap-center",arrows:{wrapper:"flex items-center justify-between"},indicators:{wrapper:"absolute flex items-center justify-center gap-3 bottom-4 inset-x-0",base:"rounded-full h-3 w-3",active:"bg-primary-500 dark:bg-primary-400",inactive:"bg-gray-100 dark:bg-gray-800"},default:{prevButton:{color:"black",class:"rtl:[&_span:first-child]:rotate-180 absolute start-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-left-20-solid"},nextButton:{color:"black",class:"rtl:[&_span:last-child]:rotate-180 absolute end-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-right-20-solid"}}},cn={wrapper:"relative w-full flex items-center",base:"w-full absolute appearance-none cursor-pointer disabled:cursor-not-allowed disabled:bg-opacity-50 focus:outline-none peer group",rounded:"rounded-lg",background:"bg-transparent",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",progress:{base:"absolute pointer-events-none peer-disabled:bg-opacity-50",rounded:"rounded-s-lg",background:"bg-{color}-500 dark:bg-{color}-400",size:{"2xs":"h-px",xs:"h-0.5",sm:"h-1",md:"h-2",lg:"h-3",xl:"h-4","2xl":"h-5"}},thumb:{base:"[&::-webkit-slider-thumb]:relative [&::-moz-range-thumb]:relative [&::-webkit-slider-thumb]:z-[1] [&::-moz-range-thumb]:z-[1] [&::-webkit-slider-thumb]:appearance-none [&::-moz-range-thumb]:appearance-none [&::-webkit-slider-thumb]:rounded-full [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:border-0",color:"text-{color}-500 dark:text-{color}-400",background:"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:dark:bg-gray-900 [&::-moz-range-thumb]:bg-current",ring:"[&::-webkit-slider-thumb]:ring-2 [&::-webkit-slider-thumb]:ring-current",size:{"2xs":"[&::-webkit-slider-thumb]:h-1.5 [&::-moz-range-thumb]:h-1.5 [&::-webkit-slider-thumb]:w-1.5 [&::-moz-range-thumb]:w-1.5 [&::-webkit-slider-thumb]:mt-[-2.5px] [&::-moz-range-thumb]:mt-[-2.5px]",xs:"[&::-webkit-slider-thumb]:h-2 [&::-moz-range-thumb]:h-2 [&::-webkit-slider-thumb]:w-2 [&::-moz-range-thumb]:w-2 [&::-webkit-slider-thumb]:mt-[-3px] [&::-moz-range-thumb]:mt-[-3px]",sm:"[&::-webkit-slider-thumb]:h-3 [&::-moz-range-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-moz-range-thumb]:w-3 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",md:"[&::-webkit-slider-thumb]:h-4 [&::-moz-range-thumb]:h-4 [&::-webkit-slider-thumb]:w-4 [&::-moz-range-thumb]:w-4 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",lg:"[&::-webkit-slider-thumb]:h-5 [&::-moz-range-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 [&::-moz-range-thumb]:w-5 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",xl:"[&::-webkit-slider-thumb]:h-6 [&::-moz-range-thumb]:h-6 [&::-webkit-slider-thumb]:w-6 [&::-moz-range-thumb]:w-6 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1","2xl":"[&::-webkit-slider-thumb]:h-7 [&::-moz-range-thumb]:h-7 [&::-webkit-slider-thumb]:w-7 [&::-moz-range-thumb]:w-7 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1"}},track:{base:"[&::-webkit-slider-runnable-track]:group-disabled:bg-opacity-50 [&::-moz-range-track]:group-disabled:bg-opacity-50",background:"[&::-webkit-slider-runnable-track]:bg-gray-200 [&::-moz-range-track]:bg-gray-200 [&::-webkit-slider-runnable-track]:dark:bg-gray-700 [&::-moz-range-track]:dark:bg-gray-700",rounded:"[&::-webkit-slider-runnable-track]:rounded-lg [&::-moz-range-track]:rounded-lg",size:{"2xs":"[&::-webkit-slider-runnable-track]:h-px [&::-moz-range-track]:h-px",xs:"[&::-webkit-slider-runnable-track]:h-0.5 [&::-moz-range-track]:h-0.5",sm:"[&::-webkit-slider-runnable-track]:h-1 [&::-moz-range-track]:h-1",md:"[&::-webkit-slider-runnable-track]:h-2 [&::-moz-range-track]:h-2",lg:"[&::-webkit-slider-runnable-track]:h-3 [&::-moz-range-track]:h-3",xl:"[&::-webkit-slider-runnable-track]:h-4 [&::-moz-range-track]:h-4","2xl":"[&::-webkit-slider-runnable-track]:h-5 [&::-moz-range-track]:h-5"}},size:{"2xs":"h-1.5",xs:"h-2",sm:"h-3",md:"h-4",lg:"h-5",xl:"h-6","2xl":"h-7"},default:{size:"md",color:"primary"}},$e=at(Ce.ui.strategy,Ce.ui.textarea,Nt),mn=oe({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys($e.size).includes(e)}},color:{type:String,default:()=>$e.default.color,validator(e){return[...Ce.ui.colors,...Object.keys($e.color)].includes(e)}},variant:{type:String,default:()=>$e.default.variant,validator(e){return[...Object.keys($e.variant),...Object.values($e.color).flatMap(n=>Object.keys(n))].includes(e)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:n}){const{ui:o,attrs:i}=it("textarea",Be(e,"ui"),$e,Be(e,"class")),{emitFormBlur:r,emitFormInput:a,inputId:d,color:c,size:p,name:x}=Ft(e,$e),h=C(rt({},e.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),k=C(null),S=()=>{var g;e.autofocus&&((g=k.value)==null||g.focus())},P=()=>{if(e.autoresize){if(!k.value)return;k.value.rows=e.rows;const g=k.value.style.overflow;k.value.style.overflow="hidden";const F=window.getComputedStyle(k.value),V=Number.parseInt(F.paddingTop),b=Number.parseInt(F.paddingBottom),N=V+b,W=Number.parseInt(F.lineHeight),{scrollHeight:l}=k.value,s=(l-N)/W;s>e.rows&&(k.value.rows=e.maxrows?Math.min(s,e.maxrows):s),k.value.style.overflow=g}},$=g=>{h.value.trim&&(g=g.trim()),h.value.number&&(g=Lt(g)),h.value.nullify&&(g||(g=null)),n("update:modelValue",g),a()},z=g=>{P(),h.value.lazy||$(g.target.value)},T=g=>{const F=g.target.value;n("change",F),h.value.lazy&&$(F),h.value.trim&&(g.target.value=F.trim())},R=g=>{n("blur",g),r()};Se(()=>{setTimeout(()=>{S()},e.autofocusDelay)}),he(()=>e.modelValue,()=>{Bt(P)}),Se(()=>{setTimeout(()=>{S(),P()},100)});const m=L(()=>{var F,V;const g=((V=(F=o.value.color)==null?void 0:F[c.value])==null?void 0:V[e.variant])||o.value.variant[e.variant];return Qe(ze(o.value.base,o.value.form,o.value.rounded,o.value.placeholder,o.value.size[p.value],e.padded?o.value.padding[p.value]:"p-0",g==null?void 0:g.replaceAll("{color}",c.value),!e.resize&&"resize-none"),e.textareaClass)});return{ui:o,attrs:i,name:x,inputId:d,textarea:k,textareaClass:m,onInput:z,onChange:T,onBlur:R}}}),fn=["id","value","name","rows","required","disabled","placeholder"];function pn(e,n,o,i,r,a){return u(),j("div",{class:ne(e.ui.wrapper)},[w("textarea",Me({id:e.inputId,ref:"textarea",value:e.modelValue,name:e.name,rows:e.rows,required:e.required,disabled:e.disabled,placeholder:e.placeholder,class:e.textareaClass},e.attrs,{onInput:n[0]||(n[0]=(...d)=>e.onInput&&e.onInput(...d)),onBlur:n[1]||(n[1]=(...d)=>e.onBlur&&e.onBlur(...d)),onChange:n[2]||(n[2]=(...d)=>e.onChange&&e.onChange(...d))}),null,16,fn),Ve(e.$slots,"default")],2)}const gn=st(mn,[["render",pn]]);async function vn(e,n){return await hn(n).catch(i=>(console.error("Failed to get image meta for "+n,i+""),{width:0,height:0,ratio:0}))}async function hn(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((n,o)=>{const i=new Image;i.onload=()=>{const r={width:i.width,height:i.height,ratio:i.width/i.height};n(r)},i.onerror=r=>o(r),i.src=e})}function vt(e){return n=>n?e[n]||n:e.missingValue}function wn({formatter:e,keyMap:n,joinWith:o="/",valueMap:i}={}){e||(e=(a,d)=>`${a}=${d}`),n&&typeof n!="function"&&(n=vt(n));const r=i||{};return Object.keys(r).forEach(a=>{typeof r[a]!="function"&&(r[a]=vt(r[a]))}),(a={})=>Object.entries(a).filter(([c,p])=>typeof p<"u").map(([c,p])=>{const x=r[c];return typeof x=="function"&&(p=x(a[c])),c=typeof n=="function"?n(c):c,e(c,p)}).join(o)}function ke(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return Number.parseInt(e,10)}function yn(e=""){if(e===void 0||!e.length)return[];const n=new Set;for(const o of e.split(" ")){const i=Number.parseInt(o.replace("x",""));i&&n.add(i)}return Array.from(n)}function bn(e){if(e.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function kn(e){const n={};if(typeof e=="string")for(const o of e.split(/[\s,]+/).filter(i=>i)){const i=o.split(":");i.length!==2?n["1px"]=i[0].trim():n[i[0].trim()]=i[1].trim()}else Object.assign(n,e);return n}function xn(e){const n={options:e},o=(r,a={})=>Ut(n,r,a),i=(r,a={},d={})=>o(r,{...d,modifiers:rt(a,d.modifiers||{})}).url;for(const r in e.presets)i[r]=(a,d,c)=>i(a,d,{...e.presets[r],...c});return i.options=e,i.getImage=o,i.getMeta=(r,a)=>_n(n,r,a),i.getSizes=(r,a)=>Sn(n,r,a),n.$img=i,i}async function _n(e,n,o){const i=Ut(e,n,{...o});return typeof i.getMeta=="function"?await i.getMeta():await vn(e,i.url)}function Ut(e,n,o){var x,h;if(n&&typeof n!="string")throw new TypeError(`input must be a string (received ${typeof n}: ${JSON.stringify(n)})`);if(!n||n.startsWith("data:"))return{url:n};const{provider:i,defaults:r}=$n(e,o.provider||e.options.provider),a=Cn(e,o.preset);if(n=pt(n)?n:At(n),!i.supportsAlias){for(const k in e.options.alias)if(n.startsWith(k)){const S=e.options.alias[k];S&&(n=ot(S,n.slice(k.length)))}}if(i.validateDomains&&pt(n)){const k=qt(n).host;if(!e.options.domains.find(S=>S===k))return{url:n}}const d=rt(o,a,r);d.modifiers={...d.modifiers};const c=d.modifiers.format;(x=d.modifiers)!=null&&x.width&&(d.modifiers.width=ke(d.modifiers.width)),(h=d.modifiers)!=null&&h.height&&(d.modifiers.height=ke(d.modifiers.height));const p=i.getImage(n,d,e);return p.format=p.format||c||"",p}function $n(e,n){const o=e.options.providers[n];if(!o)throw new Error("Unknown provider: "+n);return o}function Cn(e,n){if(!n)return{};if(!e.options.presets[n])throw new Error("Unknown preset: "+n);return e.options.presets[n]}function Sn(e,n,o){var $,z,T,R,m;const i=ke(($=o.modifiers)==null?void 0:$.width),r=ke((z=o.modifiers)==null?void 0:z.height),a=kn(o.sizes),d=(T=o.densities)!=null&&T.trim()?yn(o.densities.trim()):e.options.densities;bn(d);const c=i&&r?r/i:0,p=[],x=[];if(Object.keys(a).length>=1){for(const g in a){const F=ht(g,String(a[g]),r,c,e);if(F!==void 0){p.push({size:F.size,screenMaxWidth:F.screenMaxWidth,media:`(max-width: ${F.screenMaxWidth}px)`});for(const V of d)x.push({width:F._cWidth*V,src:wt(e,n,o,F,V)})}}In(p)}else for(const g of d){const F=Object.keys(a)[0];let V=F?ht(F,String(a[F]),r,c,e):void 0;V===void 0&&(V={size:"",screenMaxWidth:0,_cWidth:(R=o.modifiers)==null?void 0:R.width,_cHeight:(m=o.modifiers)==null?void 0:m.height}),x.push({width:g,src:wt(e,n,o,V,g)})}Rn(x);const h=x[x.length-1],k=p.length?p.map(g=>`${g.media?g.media+" ":""}${g.size}`).join(", "):void 0,S=k?"w":"x",P=x.map(g=>`${g.src} ${g.width}${S}`).join(", ");return{sizes:k,srcset:P,src:h==null?void 0:h.src}}function ht(e,n,o,i,r){const a=r.options.screens&&r.options.screens[e]||Number.parseInt(e),d=n.endsWith("vw");if(!d&&/^\d+$/.test(n)&&(n=n+"px"),!d&&!n.endsWith("px"))return;let c=Number.parseInt(n);if(!a||!c)return;d&&(c=Math.round(c/100*a));const p=i?Math.round(c*i):o;return{size:n,screenMaxWidth:a,_cWidth:c,_cHeight:p}}function wt(e,n,o,i,r){return e.$img(n,{...o.modifiers,width:i._cWidth?i._cWidth*r:void 0,height:i._cHeight?i._cHeight*r:void 0},o)}function In(e){var o;e.sort((i,r)=>i.screenMaxWidth-r.screenMaxWidth);let n=null;for(let i=e.length-1;i>=0;i--){const r=e[i];r.media===n&&e.splice(i,1),n=r.media}for(let i=0;i<e.length;i++)e[i].media=((o=e[i+1])==null?void 0:o.media)||""}function Rn(e){e.sort((o,i)=>o.width-i.width);let n=null;for(let o=e.length-1;o>=0;o--){const i=e[o];i.width===n&&e.splice(o,1),n=i.width}}const Mn=wn({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,n)=>gt(e)+"_"+gt(n)}),Fn=(e,{modifiers:n={},baseURL:o}={},i)=>{n.width&&n.height&&(n.resize=`${n.width}x${n.height}`,delete n.width,delete n.height);const r=Mn(n)||"_";return o||(o=ot(i.options.nuxt.baseURL,"/_ipx")),{url:ot(o,r,Et(e))}},Pn=!0,Un=!0,zn=Object.freeze(Object.defineProperty({__proto__:null,getImage:Fn,supportsAlias:Un,validateDomains:Pn},Symbol.toStringTag,{value:"Module"})),zt={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};zt.providers={ipxStatic:{provider:zn,defaults:{}}};const ft=()=>{const e=yt(),n=Le();return n.$img||n._img||(n._img=xn({...zt,nuxt:{baseURL:e.app.baseURL},runtimeConfig:e}))};function On(e){var n;(n=performance==null?void 0:performance.mark)==null||n.call(performance,"mark_feature_usage",{detail:{feature:e}})}const Vn={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},jn=e=>{const n=L(()=>({provider:e.provider,preset:e.preset})),o=L(()=>({width:ke(e.width),height:ke(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding,nonce:e.nonce})),i=ft(),r=L(()=>({...e.modifiers,width:ke(e.width),height:ke(e.height),format:e.format,quality:e.quality||i.options.quality,background:e.background,fit:e.fit}));return{options:n,attrs:o,modifiers:r}},Tn={...Vn,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},Nn=["src"],_e=oe({__name:"NuxtImg",props:Tn,emits:["load","error"],setup(e,{emit:n}){const o=e,i=Dt(),r=n,a=!1,d=ft(),c=jn(o),p=C(!1),x=C(),h=L(()=>d.getSizes(o.src,{...c.options.value,sizes:o.sizes,densities:o.densities,modifiers:{...c.modifiers.value,width:ke(o.width),height:ke(o.height)}})),k=L(()=>{const R={...c.attrs.value,"data-nuxt-img":""};return(!o.placeholder||p.value)&&(R.sizes=h.value.sizes,R.srcset=h.value.srcset),R}),S=L(()=>{let R=o.placeholder;if(R===""&&(R=!0),!R||p.value)return!1;if(typeof R=="string")return R;const m=Array.isArray(R)?R:typeof R=="number"?[R,R]:[10,10];return d(o.src,{...c.modifiers.value,width:m[0],height:m[1],quality:m[2]||50,blur:m[3]||3},c.options.value)}),P=L(()=>o.sizes?h.value.src:d(o.src,c.modifiers.value,c.options.value)),$=L(()=>S.value?S.value:P.value),T=Le().isHydrating;return Se(()=>{if(S.value||o.custom){const R=new Image;P.value&&(R.src=P.value),o.sizes&&(R.sizes=h.value.sizes||"",R.srcset=h.value.srcset),R.onload=m=>{p.value=!0,r("load",m)},R.onerror=m=>{r("error",m)},On("nuxt-image");return}x.value&&(x.value.complete&&T&&(x.value.getAttribute("data-error")?r("error",new Event("error")):r("load",new Event("load"))),x.value.onload=R=>{r("load",R)},x.value.onerror=R=>{r("error",R)})}),(R,m)=>R.custom?Ve(R.$slots,"default",Wt(Me({key:1},{...t(a)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...k.value,...t(i)},isLoaded:p.value,src:$.value}))):(u(),j("img",Me({key:0,ref_key:"imgEl",ref:x,class:o.placeholder&&!p.value?o.placeholderClass:void 0},{...t(a)?{onerror:"this.setAttribute('data-error', 1)"}:{},...k.value,...t(i)},{src:$.value}),null,16,Nn))}}),Je=at(Ce.ui.strategy,Ce.ui.range,cn),Bn=oe({inheritAttrs:!1,props:{modelValue:{type:Number,default:0},id:{type:String,default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},size:{type:String,default:null,validator(e){return Object.keys(Je.size).includes(e)}},color:{type:String,default:()=>Je.default.color,validator(e){return Ce.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:n}){const{ui:o,attrs:i}=it("range",Be(e,"ui"),Je),{emitFormChange:r,inputId:a,color:d,size:c,name:p}=Ft(e,Je),x=L({get(){return e.modelValue},set(R){n("update:modelValue",R)}}),h=R=>{n("change",R.target.value),r()},k=L(()=>Qe(ze(o.value.wrapper,o.value.size[c.value]),e.class)),S=L(()=>Qe(ze(o.value.base,o.value.background,o.value.rounded,d.value&&o.value.ring.replaceAll("{color}",d.value),o.value.size[c.value]),e.inputClass)),P=L(()=>ze(o.value.thumb.base,d.value&&o.value.thumb.color.replaceAll("{color}",d.value),o.value.thumb.ring,o.value.thumb.background,o.value.thumb.size[c.value])),$=L(()=>ze(o.value.track.base,o.value.track.background,o.value.track.rounded,o.value.track.size[c.value])),z=L(()=>ze(o.value.progress.base,o.value.progress.rounded,d.value&&o.value.progress.background.replaceAll("{color}",d.value),o.value.progress.size[c.value])),T=L(()=>{const{modelValue:R,min:m,max:g}=e;return{width:`${(Math.max(m,Math.min(R,g))-m)/(g-m)*100}%`}});return{ui:o,attrs:i,name:p,inputId:a,value:x,wrapperClass:k,inputClass:S,thumbClass:P,trackClass:$,progressClass:z,progressStyle:T,onChange:h}}}),Ln=["id","name","min","max","disabled","step"];function An(e,n,o,i,r,a){return u(),j("div",{class:ne(e.wrapperClass)},[ut(w("input",Me({id:e.inputId,ref:"input","onUpdate:modelValue":n[0]||(n[0]=d=>e.value=d),name:e.name,min:e.min,max:e.max,disabled:e.disabled,step:e.step,type:"range",class:[e.inputClass,e.thumbClass,e.trackClass]},e.attrs,{onChange:n[1]||(n[1]=(...d)=>e.onChange&&e.onChange(...d))}),null,16,Ln),[[Ht,e.value,void 0,{number:!0}]]),w("span",{class:ne(e.progressClass),style:bt(e.progressStyle)},null,6)],2)}const Ot=st(Bn,[["render",An]]),qn={class:"image-mask flex flex-col w-full"},En={class:"canvas flex flex-col items-center justify-center mb-3 w-full"},Dn={class:"preview-over-original relative"},Wn={class:"actions flex items-center justify-center mb-3 mx-auto"},Hn={class:"options w-full max-w-[320px]"},Gn=oe({__name:"ImageInpaint",props:Ae({imageSrc:{type:String,required:!0}},{imageInpaintMask:{default:"",type:String},imageInpaintMaskModifiers:{},imageInpaintMaskData:{default:{},type:Object},imageInpaintMaskDataModifiers:{}}),emits:["update:imageInpaintMask","update:imageInpaintMaskData"],setup(e){const n=e,o=je(e,"imageInpaintMask"),i=je(e,"imageInpaintMaskData"),r=pe(),a=C(null),d=C(null),c=C(null),p=C(null),x=C(30),h=C([]),k=C({width:r.$state.outputMaxSize,height:r.$state.outputMaxSize}),S=C(null),P=C({x:0,y:0}),$=C({x:0,y:0,radius:x.value,fill:"rgba(255, 255, 255, 0.5)",stroke:null,strokeWidth:0,visible:!1}),z=C(5),T=C(!1),R=C([]),m=C([]);function g(){if(!a.value||!c.value){console.error("Could not get stage, image layer, or mask layer");return}const v=a.value.getNode(),M=p.value?p.value.width:v.width(),A=p.value?p.value.height:v.height(),G=document.createElement("canvas");G.width=M,G.height=A;const O=G.getContext("2d");if(!O){console.error("Could not get 2d context for mask canvas");return}O.fillStyle="black",O.fillRect(0,0,M,A);const X=M/v.width(),D=A/v.height();O.fillStyle="white",h.value.forEach(ve=>{O.beginPath(),O.arc(ve.x*X,ve.y*D,ve.radius*Math.max(X,D),0,Math.PI*2,!0),O.closePath(),O.fill()});const Y=G.toDataURL("image/png",1);Y?(s(),o.value=Y,$.value.visible=!1,T.value=!1):console.error("Could not get data URI for masked image")}function F(v){const M=a.value.getNode();if(v.type.startsWith("touch")){const A=v.evt.touches[0]||v.evt.changedTouches[0];return{x:A.clientX-M.getContainer().offsetLeft,y:A.clientY-M.getContainer().offsetTop}}return M.getPointerPosition()}function V(v){v.type==="mousedown"&&v.evt.button!==0||(T.value=!0,P.value=F(v),l(),b(P.value))}function b(v){const M={x:v.x,y:v.y,radius:x.value,fill:"rgba(255, 255, 255, 1)"};h.value=h.value.filter(A=>!(N({x:A.x,y:A.y},v)+A.radius<=M.radius)),h.value.push(M)}function N(v,M){return Math.sqrt(Math.pow(M.x-v.x,2)+Math.pow(M.y-v.y,2))}function W(v){if(v.type.startsWith("touch")&&v.evt.preventDefault(),ye(v),!T.value)return;const M=F(v);N(P.value,F(v))>=z.value&&(b(M),P.value=M)}function l(){R.value.push([...h.value]),m.value=[]}function s(){i.value={circles:[...h.value],brushRadius:x.value,undoStack:R.value,redoStack:m.value}}function U(){i.value!==null&&(h.value=i.value.circles||[],x.value=i.value.brushRadius||30,R.value=i.value.undoStack||[],m.value=i.value.redoStack||[])}function H(){R.value.length!==0&&(m.value.push([...h.value]),h.value=R.value.pop()||[])}function Z(){m.value.length!==0&&(R.value.push([...h.value]),h.value=m.value.pop()||[])}function ee(){T.value=!1}function re(){o.value=""}function ce(){l(),h.value=[],o.value=""}const se=L(()=>R.value.length>0),te=L(()=>m.value.length>0);function ye(v){const M=F(v);$.value.x=M.x,$.value.y=M.y}function we(){$.value.visible=!1,T.value=!1}function Q(){$.value.visible=!0,$.value.radius=x.value}function me(){const v=new Image;v.src=n.imageSrc,v.onload=()=>{p.value=v,ue(),q()}}function ue(){if(!p.value)return;const v=window.innerWidth,M=window.innerHeight,A=p.value.width/p.value.height;let G,O;const X=Math.min(v*.9,1200),D=Math.min(M*.8,r.outputMaxSize);A>X/D?(G=X,O=G/A):(O=D,G=O*A),k.value={width:Math.floor(G),height:Math.floor(O)},q()}function q(){const v=k.value.width,M=k.value.height,A=p.value.width,G=p.value.height,O=v/A,X=M/G,D=Math.min(O,X);S.value={x:0,y:0,width:A*D,height:G*D}}return Ke(()=>{me(),U()}),Se(()=>{if(a.value){const v=a.value.getNode();v.on("touchstart",V),v.on("touchmove",W),v.on("touchend",ee),v.on("touchcancel",we)}}),kt(()=>{if(a.value){const v=a.value.getNode();v.off("touchstart"),v.off("touchmove"),v.off("touchend"),v.off("touchcancel")}s()}),(v,M)=>{const A=_e,G=Ne("v-image"),O=Ne("v-layer"),X=Ne("v-circle"),D=Ne("v-stage"),Y=de,ve=Ot,Pe=He;return u(),j("div",qn,[w("div",En,[M[1]||(M[1]=w("p",{class:"text-sm my-2 text-slate-500"},"Select the target area for image inpaint",-1)),w("div",Dn,[e.imageSrc&&e.imageSrc!==""&&o.value!==""?(u(),_(A,{key:0,src:e.imageSrc,fit:"inside",width:t(k).width,height:t(k).height,draggable:"false",class:ne({absolute:o.value!==""})},null,8,["src","width","height","class"])):I("",!0),o.value?(u(),_(A,{key:1,src:o.value,fit:"inside",width:t(k).width,height:t(k).height,draggable:"false",class:"opacity-50"},null,8,["src","width","height"])):I("",!0)]),o.value===""?(u(),_(D,{key:0,ref_key:"stageRef",ref:a,config:t(k),onMousedown:V,onMousemove:W,onMouseup:ee,onMouseleave:we,onMouseenter:Q},{default:y(()=>[f(O,{ref_key:"imageLayerRef",ref:d},{default:y(()=>[f(G,{image:t(p),config:t(k)},null,8,["image","config"])]),_:1},512),f(O,{ref_key:"maskLayerRef",ref:c},{default:y(()=>[(u(!0),j(ae,null,ge(t(h),(be,Ue)=>(u(),_(X,{key:Ue,config:be},null,8,["config"]))),128)),t($).visible?(u(),_(X,{key:0,config:t($)},null,8,["config"])):I("",!0)]),_:1},512)]),_:1},8,["config"])):I("",!0)]),w("div",Wn,[f(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-clipboard-document-check-16-solid",variant:"soft",disabled:t(h).length===0||o.value!=="",onClick:g},{default:y(()=>M[2]||(M[2]=[E(" Apply ")])),_:1},8,["disabled"]),f(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-left-16-solid",variant:"soft",color:"cyan",disabled:!t(se)||o.value!=="",onClick:H},null,8,["disabled"]),f(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-right-16-solid",variant:"soft",color:"cyan",disabled:!t(te)||o.value!=="",onClick:Z},null,8,["disabled"]),f(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-turn-up-left-20-solid",variant:"soft",disabled:t(h).length===0&&o.value==="",color:"red",onClick:ce},{default:y(()=>M[3]||(M[3]=[E(" Reset ")])),_:1},8,["disabled"]),f(Y,{size:"xs",icon:"i-heroicons-pencil-solid",variant:"soft",disabled:o.value==="",color:"orange",onClick:re},{default:y(()=>M[4]||(M[4]=[E(" Edit ")])),_:1},8,["disabled"])]),w("div",Hn,[f(Pe,{class:"mb-3 text-sm",hint:`value: ${t(x)}`,label:"Brush radius"},{default:y(()=>[f(ve,{modelValue:t(x),"onUpdate:modelValue":M[0]||(M[0]=be=>K(x)?x.value=be:null),min:1,max:100,size:"sm",class:"my-2",disabled:o.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["hint"])])])}}});function qe(e={}){const{copy:n,isSupported:o}=Gt(),i=Ie();function r(a,d={},c={}){o&&n(a).then(()=>{!d.title&&!d.description||i.add({...d,...e})},function(p){i.add({...c,description:c.description||p.message,...e})})}return{copy:r}}const Xn="0.05";function Jn(e,n){const o=parseFloat(e);if(isNaN(o))return e;const i=o+n;return i<0?"0":String(Number(i.toFixed(10)))}function Qn(e,n){let o=n,i=n,r=0,a=0;for(;o>=0&&(o--,!(e[o]==="("&&r===a));)e[o]==="("&&r++,e[o]===")"&&a++;if(o<0)return!1;for(r=0,a=0;i<e.length&&!(e[i]===")"&&r===a);)e[i]==="("&&r++,e[i]===")"&&a++,i++;return i===e.length?!1:{start:o+1,end:i}}function Kn(e){const n=/^\((.*)\)$/,o=e.match(n),i=/:([+-]?(\d*\.)?\d+([eE][+-]?\d+)?)/,r=e.match(i);return o&&!r?`(${o[1]}:1.0)`:e}function Yn(e){const n=e.composedPath()[0],o=parseFloat(Xn);if(n.tagName!=="TEXTAREA"||!(e.key==="ArrowUp"||e.key==="ArrowDown")||!e.ctrlKey&&!e.metaKey)return;e.preventDefault();let i=n.selectionStart,r=n.selectionEnd,a=n.value.substring(i,r);if(!a){const p=Qn(n.value,i);if(p)i=p.start,r=p.end,a=n.value.substring(i,r);else{const x=" .,\\/!?%^*;:{}=-_`~()\r\n	";for(;!x.includes(n.value[i-1])&&i>0;)i--;for(;!x.includes(n.value[r])&&r<n.value.length;)r++;if(a=n.value.substring(i,r),!a)return}}a[a.length-1]===" "&&(a=a.substring(0,a.length-1),r-=1),n.value[i-1]==="("&&n.value[r]===")"&&(i-=1,r+=1,a=n.value.substring(i,r)),(a[0]!=="("||a[a.length-1]!==")")&&(a=`(${a})`),a=Kn(a);const d=e.key==="ArrowUp"?o:-o,c=a.replace(/\((.*):(\d+(?:\.\d+)?)\)/,(p,x,h)=>(h=Jn(h,d),Number(h)==1?x:`(${x}:${h})`));return n.setRangeText(c,i,r,"select"),n.value}const Zn={key:0,class:"text-red-300"},eo={class:"flex items-center"},to={class:"p-2 max-w-48 max-h-48 not-italic"},no={class:"block font-medium text-gray-700 dark:text-gray-200"},oo={key:0,class:"flex items-center"},lo={key:2,class:"flex flex-row flex-grow items-center justify-between"},ao={key:3,class:"flex flex-row flex-grow items-center"},so={class:"sm:inline"},io={class:"preview-over-original relative"},ro={key:1,class:"text-red-300 text-sm"},uo=oe({__name:"InputParam",props:{inputParam:{type:Object,required:!0},index:{type:Number,required:!0},inputParamsMap:{type:Array,required:!0},advanced:{type:Boolean,default:!1}},setup(e){const n=e,o=yt(),i=Xt(),r=L(()=>i.selectedFiles[n.inputParam.name]?i.selectedFiles[n.inputParam.name]:null),a=L(()=>{var s;return r.value?`${window.location.origin}/index.php/core/preview?fileId=${(s=r.value)==null?void 0:s.id}&mimeFallback=true&a=1`:""}),d=L(()=>r.value?r.value.source:"");he(r,l=>{l?(n.inputParamsMap[n.index][n.inputParam.name].value=l,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url=d.value,n.inputParamsMap[n.index][n.inputParam.name].nc_file=!0):(n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url="",n.inputParamsMap[n.index][n.inputParam.name].nc_file=!1)});const c=C(!1),p=C(null),x=C(""),h=C({width:0,height:0}),k=C(""),S=C({}),P=C(null),$=n.inputParamsMap[n.index][n.inputParam.name].source_input_name,z=n.inputParamsMap.findIndex(l=>{if(Object.keys(l)[0]===n.inputParamsMap[n.index][n.inputParam.name].source_input_name)return!0});function T(){try{const l=n.inputParamsMap.find(s=>{const U=Object.keys(s)[0];if(U===$)return s[U]});V(l[$].value)}catch{h.value.width=0,h.value.height=0}}Se(()=>{n.inputParam.type==="range_scale"&&T(),n.inputParam.type==="image-mask"&&he(k,l=>{const s=new File([k.value],`image-mask-${n.inputParam.name}.png`,{type:"image/png"});n.inputParamsMap[n.index][n.inputParam.name].value=s,n.inputParamsMap[n.index][n.inputParam.name].mask_applied=l!==""})}),n.inputParam.type==="range_scale"&&he(n.inputParamsMap,()=>{T()});function R(l){return l?URL.createObjectURL(l):""}function m(){URL.revokeObjectURL(x.value),x.value="",p.value&&(p.value.$refs.input.value=""),n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url=""}function g(){URL.revokeObjectURL(k.value),k.value="",S.value={},n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].mask_applied=!1}const F=L(()=>n.inputParam.type!=="bool"?n.inputParam.display_name:"");function V(l){if(!(l instanceof File)){h.value.width=0,h.value.height=0;return}const s=URL.createObjectURL(l),U=new Image;U.onload=function(){h.value.width=U.naturalWidth,h.value.height=U.naturalHeight,URL.revokeObjectURL(U.src)},U.src=s}const b=L(()=>{if(n.inputParam.type==="range_scale"){const l=n.inputParamsMap[n.index][n.inputParam.name].value;return`value: ${l}x (${h.value.width}x${h.value.height} -> ${(h.value.width*l).toFixed(0)}x${(h.value.height*l).toFixed(0)})`}return["range","range_scale"].includes(n.inputParam.type)?`value: ${n.inputParamsMap[n.index][n.inputParam.name].value}`:""}),N=C(null);function W(l){const s=Yn(l);s&&(n.inputParamsMap[n.index][n.inputParam.name].value=s)}return Se(()=>{n.inputParam.type==="text"&&N.value&&N.value.$refs.textarea.addEventListener("keydown",W),n.inputParam.type==="image-mask"&&(P.value=n.inputParamsMap[z][$],he(n.inputParamsMap[z][$],l=>{k.value="",S.value={},P.value=l}))}),kt(()=>{URL.revokeObjectURL(x.value),URL.revokeObjectURL(k.value),i.removeSelectedFile(n.inputParam.name),n.inputParam.type==="text"&&N.value&&N.value.$refs.textarea.removeEventListener("keydown",W)}),(l,s)=>{var q,v;const U=de,H=Ee,Z=xt,ee=gn,re=We,ce=an,se=_e,te=Gn,ye=Re,we=et,Q=Ge,me=Ot,ue=He;return(((q=e.inputParam)==null?void 0:q.advanced)||!1)===e.advanced?(u(),_(ue,{key:0,class:ne(["mb-3",{italic:(v=e.inputParam)==null?void 0:v.dynamic_lora}]),help:t(b)},{hint:y(()=>[e.inputParam.optional?I("",!0):(u(),j("span",Zn,"required"))]),label:y(()=>{var M;return[w("div",eo,[(M=e.inputParam)!=null&&M.dynamic_lora&&e.inputParam.trigger_words.length>0?(u(),_(Z,{key:0},{panel:y(()=>[w("div",to,[s[20]||(s[20]=w("h4",{class:"mb-2 text-center"},"Trigger words",-1)),(u(!0),j(ae,null,ge(e.inputParam.trigger_words,A=>(u(),_(H,{key:A,color:"violet",class:"mr-1 cursor-pointer",onClick:()=>{("useCopyToClipboard"in l?l.useCopyToClipboard:t(qe))().copy(A),("useToast"in l?l.useToast:t(Ie))().add({title:"Clipboard",description:"Trigger word copied to clipboard",timeout:2e3})}},{default:y(()=>[E(J(A),1)]),_:2},1032,["onClick"]))),128))])]),default:y(()=>[f(U,{icon:"i-heroicons-information-circle",variant:"ghost",size:"xs",color:"gray",class:"mr-2"})]),_:1})):I("",!0),w("label",no,J(t(F)),1)])]}),default:y(()=>{var M,A,G,O,X;return[e.inputParam.type==="text"?(u(),_(ee,{key:0,ref_key:"textareaInput",ref:N,size:"md",placeholder:e.inputParam.display_name,required:!e.inputParam.optional,resize:!0,label:e.inputParam.display_name,value:e.inputParamsMap[e.index][e.inputParam.name].value,autoresize:"",variant:"outline",onInput:s[0]||(s[0]=D=>{const Y=D.target;e.inputParamsMap[e.index][e.inputParam.name].value=Y.value})},null,8,["placeholder","required","label","value"])):I("",!0),e.inputParam.type==="number"?(u(),j(ae,{key:1},[e.inputParam.name==="seed"?(u(),j("div",oo,[e.inputParam.type==="number"?(u(),_(re,{key:0,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[1]||(s[1]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"])):I("",!0),f(U,{icon:"i-heroicons-arrow-path",color:"violet",variant:"outline",size:"xs",class:"ml-2",onClick:s[2]||(s[2]=()=>{e.inputParamsMap[e.index][e.inputParam.name].value=Math.floor(Math.random()*1e7)})})])):(u(),_(re,{key:1,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[3]||(s[3]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"]))],64)):I("",!0),e.inputParam.type==="image"?(u(),j("div",lo,[f(re,{ref_key:"imageInput",ref:p,type:"file",accept:"image/*",class:"w-full",variant:"outline",color:"gray",disabled:t(r)!==null,label:e.inputParam.display_name,onChange:s[4]||(s[4]=D=>{console.debug("files",D);const Y=D==null?void 0:D[0];e.inputParamsMap[e.index][e.inputParam.name].value=Y,x.value=R(Y),e.inputParamsMap[e.index][e.inputParam.name].image_preview_url=t(x),t(r)!==null&&t(i).removeSelectedFile(e.inputParam.name),console.debug("inputParamsMap",e.inputParamsMap)})},null,8,["disabled","label"]),t(o).app.isNextcloudIntegration?(u(),_(ce,{key:0,class:"mx-2",orientation:"vertical",label:"OR"})):I("",!0),t(o).app.isNextcloudIntegration?(u(),_(U,{key:1,icon:"i-heroicons-cloud-arrow-down",variant:"outline",color:"blue",disabled:t(r)!==null||t(x)!=="",title:t(r)!==null?t(r).attributes.filename:"Choose from Nextcloud",onClick:s[5]||(s[5]=()=>{t(i).openNextcloudFilePicker(e.inputParam.name)})},{default:y(()=>s[21]||(s[21]=[E(" Choose from Nextcloud ")])),_:1},8,["disabled","title"])):I("",!0),t(a)!==""?(u(),j(ae,{key:2},[f(se,{src:t(a),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:s[6]||(s[6]=()=>{c.value=!0})},null,8,["src"]),f(U,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:s[7]||(s[7]=()=>{t(i).removeSelectedFile(e.inputParam.name),t(x)!==""&&m()})})],64)):t(x)!==""?(u(),j(ae,{key:3},[f(se,{src:t(k)?t(k):t(x),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:s[8]||(s[8]=()=>{c.value=!0})},null,8,["src"]),f(U,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:m})],64)):I("",!0)])):I("",!0),e.inputParam.type==="image-mask"?(u(),j("div",ao,[t(P)?(u(),_(U,{key:0,icon:"i-heroicons-paint-brush-16-solid",class:"mr-2",color:"violet",variant:"outline",size:"xs",disabled:!((M=t(P))!=null&&M.value),onClick:s[9]||(s[9]=()=>{c.value=!0})},{default:y(()=>[w("span",so,J(t(k)!==""?"Edit mask":"Draw mask"),1)]),_:1},8,["disabled"])):I("",!0),w("div",io,[t(P)&&((A=t(P))!=null&&A.value)?(u(),_(se,{key:0,src:(G=t(P))==null?void 0:G.image_preview_url,class:ne(["h-10 rounded-lg cursor-pointer",{absolute:t(k)!==""}]),onClick:s[10]||(s[10]=()=>{c.value=!0})},null,8,["src","class"])):I("",!0),t(k)?(u(),_(se,{key:1,src:t(k),class:"h-10 rounded-lg cursor-pointer opacity-50",onClick:s[11]||(s[11]=()=>{c.value=!0})},null,8,["src"])):I("",!0)]),!t(P)||t(P)&&!((O=t(P))!=null&&O.value)?(u(),j("span",ro," Select source image ")):I("",!0),t(k)?(u(),_(U,{key:2,icon:"i-heroicons-x-mark",variant:"outline",color:"violet",class:"ml-2",onClick:g})):I("",!0)])):I("",!0),e.inputParam.type==="image"||e.inputParam.type==="image-mask"?(u(),_(ye,{key:4,modelValue:t(c),"onUpdate:modelValue":s[16]||(s[16]=D=>K(c)?c.value=D:null),class:"z-[90] overflow-y-auto",transition:!1,fullscreen:""},{default:y(()=>{var D;return[f(U,{class:"absolute top-4 right-4 z-[100]",icon:"i-heroicons-x-mark",variant:"ghost",onClick:s[12]||(s[12]=()=>c.value=!1)}),e.inputParam.type==="image"?(u(),j("div",{key:0,class:"flex items-center justify-center w-full h-full p-4",onClick:s[13]||(s[13]=Ye(()=>c.value=!1,["left"]))},[t(x)!==""?(u(),_(se,{key:0,class:"lg:h-full",fit:"contain",src:t(x)},null,8,["src"])):I("",!0),t(a)!==""?(u(),_(se,{key:1,class:"lg:h-full",fit:"inside",src:t(d)},null,8,["src"])):I("",!0)])):(u(),_(te,{key:1,ref:"imageInpaint","image-inpaint-mask":t(k),"onUpdate:imageInpaintMask":s[14]||(s[14]=Y=>K(k)?k.value=Y:null),"image-inpaint-mask-data":t(S),"onUpdate:imageInpaintMaskData":s[15]||(s[15]=Y=>K(S)?S.value=Y:null),class:"flex items-center justify-center w-full h-full p-4","image-src":(D=t(P))==null?void 0:D.image_preview_url},null,8,["image-inpaint-mask","image-inpaint-mask-data","image-src"]))]}),_:1},8,["modelValue"])):I("",!0),e.inputParam.type==="list"?(u(),_(we,{key:5,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[17]||(s[17]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),placeholder:e.inputParam.display_name,options:Object.keys(e.inputParam.options)},null,8,["modelValue","placeholder","options"])):I("",!0),e.inputParam.type==="bool"?(u(),_(Q,{key:6,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[18]||(s[18]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),label:(X=e.inputParam)==null?void 0:X.display_name},null,8,["modelValue","label"])):I("",!0),["range","range_scale"].includes(e.inputParam.type)?(u(),_(me,{key:7,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[19]||(s[19]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),label:e.inputParam.display_name,size:"sm",min:e.inputParam.min,max:e.inputParam.max,step:e.inputParam.step},null,8,["modelValue","label","min","max","step"])):I("",!0)]}),_:1},8,["class","help"])):I("",!0)}}}),co={key:0,class:"heading"},mo={key:1},fo={key:0,class:"max-h-96 overflow-y-auto mt-5"},po={class:"heading"},go={key:0,class:"p-4"},vo={key:0,class:"flex items-center w-full max-w-xs"},ho=oe({__name:"InputParams",props:Ae({inputParamsMap:{type:Array,required:!0},additionalInputParamsMap:{type:Array,required:!1,default:[]},advanced:{type:Boolean,default:!1}},{profilingOptions:{default:{},type:Object},profilingOptionsModifiers:{},profilingEnabled:{default:!1,type:Boolean},profilingEnabledModifiers:{}}),emits:["update:profilingOptions","update:profilingEnabled"],setup(e){const n=e,o=pe(),i=dt(),r=Jt(),a=C(!n.advanced),d=je(e,"profilingOptions"),c=je(e,"profilingEnabled"),p=C(!0),x=L(()=>r.workers.map(h=>({value:h.worker_id,label:`${h.worker_id} (type: ${h.device_type}, vram_total: ${Oe(h.vram_total)})`})));return Ke(()=>{var k;if(!i.isAdmin)return;const h=localStorage.getItem(`profilingOptions_${(k=o.currentFlow)==null?void 0:k.name}`);h&&(d.value=JSON.parse(h)),r.fetchWorkersInfo().then(()=>{r.workers.find(P=>{var $;return P.worker_id===(($=d.value["X-WORKER-ID"])==null?void 0:$.value)})||(d.value["X-WORKER-ID"]=null)})}),(h,k)=>{const S=xe,P=uo,$=Ge,z=et,T=de,R=We,m=He;return u(),j(ae,null,[e.advanced?(u(),j("div",co,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:k[0]||(k[0]=()=>{a.value=!t(a)})},[f(S,{name:t(a)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",class:"mr-2"},null,8,["name"]),k[3]||(k[3]=E(" Advanced options "))])])):I("",!0),t(a)?(u(),j("div",mo,[(u(!0),j(ae,null,ge(t(o).currentFlow.input_params,(g,F)=>(u(),_(P,{key:F,"input-params-map":e.inputParamsMap,index:F,"input-param":g,advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),(u(!0),j(ae,null,ge(e.additionalInputParamsMap,(g,F)=>(u(),_(P,{key:Object.keys(g)[0],"input-params-map":e.additionalInputParamsMap,index:F,"input-param":g[Object.keys(g)[0]],advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),t(i).isAdmin&&e.advanced?(u(),j("div",fo,[w("div",po,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:k[1]||(k[1]=()=>{p.value=!t(p)})},[f(S,{name:t(p)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),f(S,{name:"i-mdi-bug-outline",class:"mr-2"}),k[4]||(k[4]=E(" Execution settings "))])]),t(p)?I("",!0):(u(),j("div",go,[f($,{modelValue:c.value,"onUpdate:modelValue":k[2]||(k[2]=g=>c.value=g),label:"Enable Execution settings",class:"mb-3"},null,8,["modelValue"]),(u(!0),j(ae,null,ge(Object.keys(d.value),g=>(u(),_(m,{key:g,label:g},{default:y(()=>[g==="X-WORKER-ID"?(u(),j("div",vo,[f(z,{modelValue:d.value[g],"onUpdate:modelValue":F=>d.value[g]=F,options:t(x),placeholder:"Select worker",class:"w-full my-3"},null,8,["modelValue","onUpdate:modelValue","options"]),f(T,{icon:"i-heroicons-x-mark",variant:"outline",size:"sm",color:"orange",class:"ml-2",onClick:()=>d.value[g]=null},null,8,["onClick"]),f(T,{icon:"i-heroicons-arrow-path-solid",variant:"outline",size:"sm",color:"blue",class:"ml-2",onClick:()=>{t(r).fetchWorkersInfo().then(()=>{d.value[g]=t(x).find(F=>{var V;return F.value===((V=d.value[g])==null?void 0:V.value)})})}},null,8,["onClick"])])):(u(),_(R,{key:1,modelValue:d.value[g],"onUpdate:modelValue":F=>d.value[g]=F,placeholder:"Enter value",class:"my-3"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))]))])):I("",!0)])):I("",!0)],64)}}}),wo={key:0,id:"prompt",class:"w-full my-10 lg:my-0 p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg"},yo={class:"action flex items-center justify-end"},bo=oe({__name:"Prompt",setup(e,{expose:n}){var V,b,N,W;const o=pe(),i=dt();let r=localStorage.getItem(`input_params_map_${(V=o.currentFlow)==null?void 0:V.name}`);if(r){const l=JSON.parse(r);"flow_version"in l&&l.flow_version.split(".")[0]===((b=o.currentFlow)==null?void 0:b.version.split(".")[0])?r=l:(r=null,localStorage.removeItem(`input_params_map_${(N=o.currentFlow)==null?void 0:N.name}`))}const a=C(((W=o.currentFlow)==null?void 0:W.input_params.map(l=>{var s;if(l.type==="text")return{[l.name]:{value:r!==null&&r[l.name]?r[l.name]:l.default||"",type:l.type,optional:l.optional,advanced:l.advanced||!1,default:l.default||"",translatable:l.translatable||!1,dynamic_lora:l.dynamic_lora||!1,trigger_words:l.trigger_words||[]}};if(l.type==="number")return{[l.name]:{value:r!==null&&r[l.name]?r[l.name]:l.default||0,type:l.type,optional:l.optional,advanced:l.advanced||!1,default:l.default||0,dynamic_lora:l.dynamic_lora||!1,trigger_words:l.trigger_words||[]}};if(l.type==="image")return{[l.name]:{value:null,type:l.type,optional:l.optional,advanced:l.advanced||!1,dynamic_lora:l.dynamic_lora||!1,trigger_words:l.trigger_words||[]}};if(l.type==="image-mask")return{[l.name]:{value:null,type:l.type,optional:l.optional,advanced:l.advanced||!1,source_input_name:l.source_input_name||null,dynamic_lora:l.dynamic_lora||!1,trigger_words:l.trigger_words||[]}};if(l.type==="list")return{[l.name]:{value:r!==null&&r[l.name]?r[l.name]:l.default||Object.keys(l.options)[0]||"",type:l.type,optional:l.optional,options:l.options,advanced:l.advanced||!1,default:Object.keys(l.options)[0]||"",dynamic_lora:l.dynamic_lora||!1,trigger_words:l.trigger_words||[]}};if(l.type==="bool")return{[l.name]:{value:r!==null&&r[l.name]?r[l.name]:l.default||!1,type:l.type,optional:l.optional,advanced:l.advanced||!1,default:l.default||!1,dynamic_lora:l.dynamic_lora||!1,trigger_words:l.trigger_words||[]}};if(["range","range_scale"].includes(l.type)){const U={value:r!==null&&r[l.name]?r[l.name]:l.default||0,type:l.type,optional:l.optional,advanced:l.advanced||!1,min:l.min||0,max:l.max||100,step:l.step||1,default:l.default||0,dynamic_lora:l.dynamic_lora||!1,trigger_words:l.trigger_words||[]};if(l.type==="range_scale"&&(U.source_input_name=l.source_input_name||null,U.source_input_name===null||U.source_input_name==="")){const H=(s=o.currentFlow)==null?void 0:s.input_params.find(Z=>Z.type==="image"&&!Z.optional);H&&(U.source_input_name=H.name)}return{[l.name]:U}}}))||[]),d=C([]);o.currentFlow.is_seed_supported&&d.value.push({seed:{name:"seed",display_name:"Random seed",value:Math.floor(Math.random()*1e7),type:"number",optional:!0,advanced:!0,min:0,max:1e7}});const c=_t(),p=C(o.currentFlow.is_translations_supported&&c.settingsMap.translations_provider.value.trim()!==""),x=C(o.currentFlow.is_surprise_me_supported&&c.settingsMap.llm_provider.value.trim()!==""),h=C(p.value);Ke(()=>{const l=localStorage.getItem("translatePrompt");l&&(h.value=JSON.parse(l))}),he(h,l=>{localStorage.setItem("translatePrompt",JSON.stringify(l))});function k(l){console.debug("Copy prompt inputs",l),Object.keys(l).forEach(U=>{const H=a.value.findIndex(Z=>Object.keys(Z)[0]===U);H!==-1&&(a.value[H][U].value=l[U].value)});const s=document.getElementById("prompt");s&&s.scrollIntoView({behavior:"smooth"})}n({copyPromptInputs:k}),a.value.forEach(l=>{const s=Object.keys(l)[0];["image","image-mask"].includes(l[s].type)||he(()=>l[s].value,()=>{var H,Z;const U={};a.value.forEach(ee=>{const re=Object.keys(ee)[0];U[re]=ee[re].value}),localStorage.setItem(`input_params_map_${(H=o.currentFlow)==null?void 0:H.name}`,JSON.stringify({...U,flow_version:(Z=o.currentFlow)==null?void 0:Z.version}))})});const S=L(()=>a.value.filter(l=>{const s=Object.keys(l)[0];return!["image","image-mask"].includes(l[s].type)}).some(l=>{const s=Object.keys(l)[0];return l[s].value!==l[s].default}));function P(){a.value.forEach(l=>{const s=Object.keys(l)[0];l[s].type==="text"?l[s].value=l[s].default||"":l[s].type==="number"?l[s].value=l[s].default||l[s].min||0:l[s].type==="list"?l[s].value=Object.keys(l[s].options)[0]||"":l[s].type==="bool"?l[s].value=l[s].default||!1:["range","range_scale"].includes(l[s].type)&&(l[s].value=l[s].default||l[s].min||0)})}const $=C(!1),z=C(1),T=C(!1),R=L(()=>a.value.every(l=>{var H,Z,ee,re;const s=Object.keys(l)[0];if(l[s].optional)return!0;const U=l[s].value;if(l[s].type==="text")return U!=="";if(l[s].type==="number")return U>=l[s].min&&U<=l[s].max;if(l[s].type==="list")return U!==""&&Object.keys(l[s].options).includes(U);if(l[s].type==="bool")return!0;if(l[s].type==="range")return U>=l[s].min&&U<=l[s].max;if(l[s].type==="range_scale")return U>=l[s].min&&U<=l[s].max;if(l[s].type==="image")return(H=l[s])!=null&&H.nc_file?!0:U instanceof File&&U.size>0;if(l[s].type==="image-mask")return(Z=l[s])!=null&&Z.nc_file?((ee=l[s])==null?void 0:ee.mask_applied)||!1:U instanceof File&&U.size>0&&(((re=l[s])==null?void 0:re.mask_applied)||!1)})),m=C({"X-WORKER-UNLOAD-MODELS":1,"X-WORKER-EXECUTION-PROFILER":1,"X-WORKER-ID":null}),g=C(!1);he(()=>m.value,()=>{var l;i.isAdmin&&localStorage.setItem(`profilingOptions_${(l=o.currentFlow)==null?void 0:l.name}`,JSON.stringify(m.value))},{deep:!0});function F(l=!1){$.value=!0;let s={};i.isAdmin&&g&&(s=Object.fromEntries(Object.entries(m).filter(([U,H])=>H!==null).map(([U,H])=>U==="X-WORKER-ID"?[U,H==null?void 0:H.value]:[U,H]))),o.runFlow(o.currentFlow,[...a.value,...d.value],z.value,p.value&&h.value,!1,null,l,s).finally(()=>{$.value=!1;const U=d.value.find(H=>Object.keys(H)[0]==="seed");U.seed.value=Number(U.seed.value)+z.value+1})}return(l,s)=>{const U=xe,H=ho,Z=We,ee=He,re=Ge,ce=de,se=De;return t(o).currentFlow?(u(),j("div",wo,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:s[0]||(s[0]=()=>{T.value=!t(T)})},[f(U,{name:t(T)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),s[11]||(s[11]=E(" Prompt "))]),ut(w("div",null,[f(H,{"input-params-map":t(a),"onUpdate:inputParamsMap":s[1]||(s[1]=te=>K(a)?a.value=te:null),"additional-input-params-map":t(d),"onUpdate:additionalInputParamsMap":s[2]||(s[2]=te=>K(d)?d.value=te:null),advanced:!1},null,8,["input-params-map","additional-input-params-map"]),t(d).length>0?(u(),_(H,{key:0,"input-params-map":t(a),"onUpdate:inputParamsMap":s[3]||(s[3]=te=>K(a)?a.value=te:null),"additional-input-params-map":t(d),"onUpdate:additionalInputParamsMap":s[4]||(s[4]=te=>K(d)?d.value=te:null),"profiling-options":t(m),"onUpdate:profilingOptions":s[5]||(s[5]=te=>K(m)?m.value=te:null),"profiling-enabled":t(g),"onUpdate:profilingEnabled":s[6]||(s[6]=te=>K(g)?g.value=te:null),advanced:!0},null,8,["input-params-map","additional-input-params-map","profiling-options","profiling-enabled"])):I("",!0),t(o).currentFlow.is_count_supported?(u(),_(ee,{key:1,label:"Number of results"},{default:y(()=>[f(Z,{modelValue:t(z),"onUpdate:modelValue":s[7]||(s[7]=te=>K(z)?z.value=te:null),type:"number",min:"1",max:"50",label:"Batch size",class:"mb-3 max-w-fit flex justify-end"},null,8,["modelValue"])]),_:1})):I("",!0),t(p)?(u(),_(ee,{key:2,class:"my-3 flex justify-end"},{default:y(()=>[f(re,{modelValue:t(h),"onUpdate:modelValue":s[8]||(s[8]=te=>K(h)?h.value=te:null),label:"Translate prompt"},null,8,["modelValue"])]),_:1})):I("",!0),w("div",{class:ne(["flex flex-col md:flex-row",{"justify-between":t(S),"justify-end":!t(S)}])},[t(S)?(u(),_(se,{key:0,text:"Reset input params values to defaults"},{default:y(()=>[f(ce,{icon:"i-heroicons-arrow-path-rounded-square",variant:"ghost",color:"amber",onClick:P},{default:y(()=>s[12]||(s[12]=[E(" Reset params ")])),_:1})]),_:1})):I("",!0),w("div",yo,[t(x)?(u(),_(se,{key:0,text:"Randomize prompt based on your input"},{default:y(()=>[f(ce,{class:"mr-2",icon:"i-heroicons-gift",variant:"soft",color:"blue",loading:t($),onClick:s[9]||(s[9]=()=>F(!0))},{default:y(()=>s[13]||(s[13]=[E(" Surprise me ")])),_:1},8,["loading"])]),_:1})):I("",!0),f(ce,{icon:"i-heroicons-sparkles-16-solid",variant:"outline",loading:t($),disabled:!t(R),onClick:s[10]||(s[10]=()=>F(!1))},{default:y(()=>s[14]||(s[14]=[E(" Run prompt ")])),_:1},8,["loading","disabled"])])],2)],512),[[$t,!t(T)]])])):I("",!0)}}}),ko=e=>{const n=C(0);function o(a){e.value.style.scrollSnapType="none",e.value.style.scrollBehavior="auto",n.value=a.pageX,window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)}function i(){e.value.style.removeProperty("scroll-behavior"),e.value.style.removeProperty("scroll-snap-type"),e.value.style.removeProperty("pointer-events"),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)}function r(a){a.preventDefault(),e.value.style.pointerEvents="none";const d=a.pageX-n.value;n.value=a.pageX,e.value.scrollBy(-d,0)}Se(()=>{e.value&&e.value.addEventListener("mousedown",o)}),ct(()=>{e.value&&e.value.removeEventListener("mousedown",o)})},nt=at(Ce.ui.strategy,Ce.ui.carousel,dn),xo=oe({components:{UButton:de},inheritAttrs:!1,props:{items:{type:Array,default:()=>[]},arrows:{type:Boolean,default:!1},indicators:{type:Boolean,default:!1},dir:{type:String,default:"ltr"},prevButton:{type:Object,default:()=>nt.default.prevButton},nextButton:{type:Object,default:()=>nt.default.nextButton},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:void 0}},setup(e,{expose:n}){const{ui:o,attrs:i}=it("carousel",Be(e,"ui"),nt,Be(e,"class")),r=C(),a=C(0),{x:d}=Qt(r,{behavior:"smooth"}),{width:c}=Kt(r);ko(r),Yt(r,T=>{var m,g;const[R]=T;a.value=((g=(m=R==null?void 0:R.target)==null?void 0:m.firstElementChild)==null?void 0:g.clientWidth)||0});const p=L(()=>e.dir==="rtl"),x=L(()=>a.value?p.value?Math.round(-d.value/a.value)+1:Math.round(d.value/a.value)+1:0),h=L(()=>{if(!a.value)return 0;const T=Math.round(c.value/a.value);return e.items.length<=T?0:e.items.length-T+1}),k=L(()=>x.value<=1),S=L(()=>x.value===h.value);function P(){d.value+=p.value?-a.value:a.value}function $(){d.value-=p.value?-a.value:a.value}function z(T){d.value=(T-1)*a.value*(p.value?-1:1)}return n({pages:h,page:x,prev:$,next:P,select:z}),{ui:o,attrs:i,isFirst:k,isLast:S,carouselRef:r,pages:h,currentPage:x,onClickNext:P,onClickPrev:$,onClick:z,twMerge:Qe}}}),_o=["dir"],$o=["role"],Co=["aria-selected","aria-label","onClick"];function So(e,n,o,i,r,a){const d=de;return u(),j("div",Me({class:e.ui.wrapper},e.attrs,{dir:e.dir}),[w("div",{ref:"carouselRef",class:ne([e.ui.container,"no-scrollbar"])},[(u(!0),j(ae,null,ge(e.items,(c,p)=>(u(),j("div",{key:p,class:ne(e.ui.item),role:e.indicators?"tabpanel":null},[Ve(e.$slots,"default",{item:c,index:p},void 0,!0)],10,$o))),128))],2),e.arrows?(u(),j("div",{key:0,class:ne(e.ui.arrows.wrapper)},[Ve(e.$slots,"prev",{onClick:e.onClickPrev,disabled:e.isFirst},()=>{var c;return[e.prevButton?(u(),_(d,Me({key:0,disabled:e.isFirst},{...e.ui.default.prevButton,...e.prevButton},{class:e.twMerge(e.ui.default.prevButton.class,(c=e.prevButton)==null?void 0:c.class),"aria-label":"Prev",onClick:e.onClickPrev}),null,16,["disabled","class","onClick"])):I("",!0)]},!0),Ve(e.$slots,"next",{onClick:e.onClickNext,disabled:e.isLast},()=>{var c;return[e.nextButton?(u(),_(d,Me({key:0,disabled:e.isLast},{...e.ui.default.nextButton,...e.nextButton},{class:e.twMerge(e.ui.default.nextButton.class,(c=e.nextButton)==null?void 0:c.class),"aria-label":"Next",onClick:e.onClickNext}),null,16,["disabled","class","onClick"])):I("",!0)]},!0)],2)):I("",!0),e.indicators?(u(),j("div",{key:1,role:"tablist",class:ne(e.ui.indicators.wrapper)},[(u(!0),j(ae,null,ge(e.pages,c=>Ve(e.$slots,"indicator",{key:c,onClick:e.onClick,active:c===e.currentPage,page:c},()=>[w("button",{type:"button",role:"tab","aria-selected":c===e.currentPage,class:ne([e.ui.indicators.base,c===e.currentPage?e.ui.indicators.active:e.ui.indicators.inactive]),"aria-label":`set slide ${c}`,onClick:p=>e.onClick(c)},null,10,Co)],!0)),128))],2)):I("",!0)],16,_o)}const Fe=st(xo,[["render",So],["__scopeId","data-v-a3da86ff"]]),Io={class:"flex flex-col basis-full"},Ro=oe({__name:"InputFiles",props:{running:{type:Object,required:!0}},setup(e){const n=ft(),o=function(c,p){return`${Ct()}/tasks/inputs?task_id=${c}&input_index=${p}`},i=C(!1),r=C(""),a=C(0),d=C(!0);return(c,p)=>{var $,z,T,R,m;const x=xe,h=_e,k=Fe,S=de,P=Re;return e.running&&e.running.input_files&&(($=Object.keys(e.running.input_files))==null?void 0:$.length)>0?(u(),j("div",{key:0,class:ne(["ml-2 mt-2 mb-5",{"mb-10":((z=Object.keys(e.running.input_files))==null?void 0:z.length)>1&&!t(d)}])},[w("h4",{class:"mb-3 font-bold cursor-pointer select-none flex items-center text-sm",onClick:p[0]||(p[0]=()=>d.value=!t(d))},[f(x,{name:t(d)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Input files ("+J((T=Object.keys(e.running.input_files))==null?void 0:T.length)+") ",1)]),t(d)?I("",!0):(u(),j(ae,{key:0},[((R=Object.keys(e.running.input_files))==null?void 0:R.length)===1?(u(),_(h,{key:0,class:"mb-5 rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(n)(`${("buildBackendUrl"in c?c.buildBackendUrl:t(lt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:o(e.running.task_id,0),onClick:p[1]||(p[1]=()=>{r.value=o(e.running.task_id,0),a.value=0,i.value=!0})},null,8,["placeholder","src"])):I("",!0),((m=Object.keys(e.running.input_files))==null?void 0:m.length)>1?(u(),_(k,{key:1,items:Object.keys(e.running.input_files).map(g=>({task_id:e.running.task_id,index:g})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:""},{default:y(({item:g})=>[w("div",Io,[f(h,{class:"rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(n)(`${("buildBackendUrl"in c?c.buildBackendUrl:t(lt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:o(g.task_id,g.index),onClick:()=>{r.value=o(e.running.task_id,g.index),a.value=g.index,i.value=!0}},null,8,["placeholder","src","onClick"])])]),_:1},8,["items"])):I("",!0),f(P,{modelValue:t(i),"onUpdate:modelValue":p[4]||(p[4]=g=>K(i)?i.value=g:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[f(S,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:p[2]||(p[2]=()=>i.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:p[3]||(p[3]=Ye(()=>i.value=!1,["left"]))},[t(r)?(u(),_(h,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(r)},null,8,["src"])):I("",!0)])]),_:1},8,["modelValue"])],64))],2)):I("",!0)}}}),Mo=oe({__name:"ErrorAlert",props:{running:{type:Object,required:!0}},setup(e){const n=pe(),o=C(!1);return(i,r)=>{const a=mt;return u(),_(a,{class:"mb-5",icon:"i-heroicons-exclamation-circle-16-solid",color:"red",variant:"soft",title:"Task failed",description:e.running.error,actions:[{variant:"outline",color:"yellow",label:"Restart",loading:t(o),icon:"i-heroicons-arrow-path",click:()=>{o.value=!0,t(n).restartFlow(e.running).finally(()=>{o.value=!1})}}]},null,8,["description","actions"])}}}),Fo={class:"mb-5"},Po={class:"text-sm mb-5 text-slate-500"},Uo={class:"flex justify-between"},zo=oe({__name:"Item",props:{running:{type:Object,required:!0}},setup(e){const n=pe(),o=C(!1),i=C(!1);function r(a){return[[{label:"Comfy flow",labelClass:"text-blue-500",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500",click:()=>{var d;return n.downloadFlowComfy((d=n.currentFlow)==null?void 0:d.name,a.task_id)}}],[{label:`Raise priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-up",iconClass:"bg-gray-500",disabled:a.priority===15||a.progress>0,click:()=>{i.value=!0,n.raiseQueuePriority(a).finally(()=>{i.value=!1})}},{label:`Lower priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-down",iconClass:"bg-gray-500",disabled:a.priority===0||a.progress>0,click:()=>{i.value=!0,n.lowerQueuePriority(a).finally(()=>{i.value=!1})}},{label:`Reset priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-path-rounded-square-solid",iconClass:"bg-gray-500",disabled:a.priority===0||a.progress>0,click:()=>{i.value=!0,n.resetQueuePriority(a).finally(()=>{i.value=!1})}}]]}return(a,d)=>{var S,P;const c=Pt,p=Ro,x=Mo,h=de,k=Ze;return u(),j("div",Fo,[f(c,{class:"mb-3",value:(S=e.running)==null?void 0:S.progress,indicator:"",color:e.running.error?"red":"green"},null,8,["value","color"]),w("p",Po,J([`${(P=e.running)!=null&&P.priority&&e.running.priority>0?"["+e.running.priority+"] ":""}#${e.running.task_id}`,...Object.keys(e.running.input_params_mapped).filter($=>e.running.input_params_mapped[$].value&&e.running.input_params_mapped[$].value!=="").map($=>`${e.running.input_params_mapped[$].display_name}: ${e.running.input_params_mapped[$].value}`)].join(" | ")+`${e.running.execution_time?" | execution_time: "+e.running.execution_time.toFixed(2)+"s":""}`),1),f(p,{running:e.running},null,8,["running"]),e.running.error?(u(),_(x,{key:0,running:e.running},null,8,["running"])):I("",!0),w("div",Uo,[f(h,{icon:e.running.progress>=0&&e.running.progress<100?"i-heroicons-stop":"i-heroicons-minus-circle",color:e.running.error?"red":"orange",variant:"outline",loading:t(o),onClick:d[0]||(d[0]=()=>{o.value=!0,t(n).cancelRunningFlow(e.running).finally(()=>{o.value=!1})})},{default:y(()=>[E(J(e.running.progress>=0&&e.running.progress<100?"Cancel":"Remove"),1)]),_:1},8,["icon","color","loading"]),f(k,{items:r(e.running),mode:"click",popper:{placement:"bottom-end"}},{default:y(()=>[f(h,{color:"blue",variant:"outline",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])])])}}}),Oo={class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md mt-5 mb-10"},Vo={class:"flex items-center justify-between mb-2"},jo={key:0},To={key:1,class:"text-red-400"},No=oe({__name:"Queue",setup(e){const n=pe(),o=C(!0),i=C(!1);return(r,a)=>{var x,h,k,S,P,$,z,T,R;const d=xe,c=de,p=zo;return u(),j("div",Oo,[w("div",Vo,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center",onClick:a[0]||(a[0]=()=>{o.value=!t(o)})},[f(d,{name:t(o)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Queue ("+J(t(n).flowsRunningByName((x=t(n).currentFlow)==null?void 0:x.name).length)+") ",1),t(n).flowsRunningByName((h=t(n).currentFlow)==null?void 0:h.name).length>0?(u(),j("span",jo," - "+J(`${((S=t(n).flowsRunningByName((k=t(n).currentFlow)==null?void 0:k.name).filter(m=>m.progress>0)[0])==null?void 0:S.progress.toFixed(0))??0}%`),1)):I("",!0),t(n).flowsRunningByNameWithErrors((P=t(n))==null?void 0:P.currentFlow.name).length>0?(u(),j("span",To," ("+J(t(n).flowsRunningByNameWithErrors(($=t(n).currentFlow)==null?void 0:$.name).length)+") ",1)):I("",!0)]),(z=t(n).currentFlow)!=null&&z.name&&t(n).flowsRunningByName((T=t(n).currentFlow)==null?void 0:T.name).length>0?(u(),_(c,{key:0,icon:"i-heroicons-stop",color:"orange",variant:"outline",loading:t(i),onClick:a[1]||(a[1]=()=>{var m;i.value=!0,t(n).cancelRunningFlows((m=t(n).currentFlow)==null?void 0:m.name).finally(()=>{i.value=!1})})},{default:y(()=>a[2]||(a[2]=[E(" Cancel all ")])),_:1},8,["loading"])):I("",!0)]),t(o)?I("",!0):(u(!0),j(ae,{key:0},ge(t(n).flowsRunningByName((R=t(n).currentFlow)==null?void 0:R.name),m=>(u(),_(p,{key:m.task_id,running:m},null,8,["running"]))),128))])}}}),Bo=oe({__name:"ScrollToTop",props:{show:{type:Boolean,required:!0},target:{type:String,required:!0}},setup(e){const n=e;function o(){const i=document.getElementById(n.target);i&&i.scrollIntoView({behavior:"smooth"})}return(i,r)=>{const a=de;return e.show?(u(),_(a,{key:0,icon:"i-heroicons-arrow-small-up",color:"black",variant:"outline",onClick:o})):I("",!0)}}}),Lo={class:"flex flex-col items-center mb-2 max-w-fit mx-auto z-0"},Ao={class:"text-slate-500 text-center text-sm w-full mx-auto flex flex-wrap items-center justify-center md:justify-between"},qo={class:"toggles py-2"},Eo={class:"mr-2 inline-flex items-center text-sm"},Do=["for"],Wo={class:"mr-2 inline-flex items-center text-sm"},Ho=["for"],Go={key:0,class:"flex items-center"},Xo=["title"],Jo=oe({__name:"Child",props:{flowResult:{type:Object,required:!0},outputsIndex:{type:Number,required:!1,default:()=>0},openImageModal:{type:Function,required:!0}},setup(e){const n=e,o=pe(),i=(m,g=null,F=!1)=>{if(m.child_tasks.length===0)return m;const V=m.child_tasks.findIndex(b=>b.parent_task_node_id===g);return V!==-1?(F||(a.value=m),i(m.child_tasks[V],m.child_tasks[V].outputs[0].comfy_node_id,F)):m};function r(m,g,F=null){if(F!==null&&m.parent_task_node_id===F||Number(m.task_id)===g)return m;for(let V=0;V<m.child_tasks.length;V++)for(let b=0;b<m.child_tasks[V].outputs.length;b++){const N=r(m.child_tasks[V],g,m.child_tasks[V].outputs[b].comfy_node_id);if(N!==null)return N}return null}const a=C(n.flowResult),d=C(i(n.flowResult,n.flowResult.outputs[n.outputsIndex].comfy_node_id,!1));function c(m){var g;return[[{label:`${(g=o.flowByName((m==null?void 0:m.flow_name)??(m==null?void 0:m.name)))==null?void 0:g.display_name}#${m.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",click:()=>{n.openImageModal(fe({task_id:m.task_id,node_id:m.outputs.length>1?m.outputs[n.outputsIndex].comfy_node_id:m.outputs[0].comfy_node_id}))}}]]}function p(m){var F;const g=[[{label:`${(F=o.flowByName((m==null?void 0:m.flow_name)??(m==null?void 0:m.name)))==null?void 0:F.display_name}#${m.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",disabled:m.progress<100||m.error!=="",click:()=>{n.openImageModal(fe({task_id:m.task_id,node_id:m.outputs.length>1?m.outputs[n.outputsIndex].comfy_node_id:m.outputs[0].comfy_node_id}))}},{label:m.progress<100?"Cancel":"Delete",labelClass:m.progress<100?"text-orange-500":"text-red-500",icon:m.progress<100?"i-heroicons-stop":"i-heroicons-trash",iconClass:m.progress<100?"bg-orange-500":"bg-red-500",click:()=>{o.deleteFlowHistory(m.task_id).then(()=>{const V=r(n.flowResult,m.parent_task_id,m.parent_task_node_id);V&&(V.child_tasks=V.child_tasks.filter(b=>Number(b.task_id)!==Number(m.task_id))),$(!1,n.flowResult)})}}]];return m.progress<100&&(g[0][1]={label:`Progress: ${Math.ceil(m.progress)}% (${m.execution_time.toFixed(2)}s)`,labelClass:"text-blue-500",disabled:!0}),m.error!==""&&g[0].push({label:`Error: ${m.error}`,labelClass:"text-red-500",slot:"error",click:()=>{qe().copy(m.error),Ie().add({title:"Clipboard",description:`Task #${m.task_id} error copied to clipboard`,timeout:2e3})}}),g}function x(){const m=a.value.parent_task_id;if(!m)return;const g=r(n.flowResult,m,a.value.parent_task_node_id);g&&(a.value=g)}function h(){if(a.value.child_tasks.length===0)return;const m=a.value.outputs.length>1?a.value.outputs[n.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id,g=a.value.child_tasks.find(F=>F.parent_task_node_id===m);g&&(a.value=g)}const k=L(()=>{if(a.value.child_tasks.length===0)return;const m=a.value.outputs.length>1?a.value.outputs[n.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id;return a.value.child_tasks.find(F=>F.parent_task_node_id===m).task_id!==d.value.task_id});function S(){const m=d.value.parent_task_id;if(!m)return;const g=r(n.flowResult,m,d.value.parent_task_node_id);g&&(d.value=g)}function P(){if(d.value.child_tasks.length===0)return;const m=Number(d.value.outputs[0].comfy_node_id),g=d.value.child_tasks.find(F=>Number(F.parent_task_node_id)===m);g&&(d.value=g)}function $(m=!1,g=null){m||(a.value=g),d.value=i(g,g==null?void 0:g.outputs[n.outputsIndex].comfy_node_id,m),z.value=!1}he(n.flowResult,m=>{$(!0,m)});const z=C(!1),T=C(!0),R=C(null);return he(z,m=>{m?(R.value=a.value,a.value=n.flowResult):R.value&&(a.value=R.value,d.value=St(R.value,n.outputsIndex,a.value.outputs.length>1?a.value.outputs[n.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id))}),(m,g)=>{const F=_e,V=Ne("ImgComparisonSlider"),b=sn,N=de,W=Ze,l=xe,s=De;return u(),j("div",Lo,[ut(f(F,{class:"mb-2 rounded-lg cursor-pointer",height:t(o).outputMaxSize,width:t(o).outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(d).progress===100?t(d).task_id:e.flowResult.task_id,node_id:t(d).progress===100?t(d).outputs[0].comfy_node_id:e.flowResult.outputs[e.outputsIndex].comfy_node_id}),onClick:g[0]||(g[0]=U=>e.openImageModal(("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(d).task_id??e.flowResult.task_id,node_id:t(d).outputs[0].comfy_node_id??e.flowResult.outputs[e.outputsIndex].comfy_node_id})))},null,8,["height","width","src"]),[[$t,!t(T)]]),t(T)?(u(),_(V,{key:0,class:"mb-2 mx-auto outline-none w-fit rounded-lg"},{default:y(()=>{var U,H,Z;return[f(F,{slot:"first",height:t(o).outputMaxSize,width:t(o).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(z)?e.flowResult.task_id:t(a).task_id,node_id:t(z)?e.flowResult.outputs[e.outputsIndex].comfy_node_id:t(a).parent_task_node_id!==null?(U=t(a))==null?void 0:U.outputs[0].comfy_node_id:((H=t(a))==null?void 0:H.outputs[e.outputsIndex].comfy_node_id)??((Z=t(a))==null?void 0:Z.outputs[0].comfy_node_id)})},null,8,["height","width","src"]),t(d)&&t(d).progress===100?(u(),_(F,{key:0,slot:"second",height:t(o).outputMaxSize,width:t(o).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(d).task_id,node_id:t(d).outputs[0].comfy_node_id})},null,8,["height","width","src"])):(u(),_(F,{key:1,slot:"second",height:t(o).outputMaxSize,width:t(o).outputMaxSize,fit:"cover",draggable:"false",src:`${("buildBackendUrl"in m?m.buildBackendUrl:t(lt))()}/vix_logo.png`},null,8,["height","width","src"]))]}),_:1})):I("",!0),w("div",Ao,[w("div",qo,[w("div",Eo,[f(b,{id:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(T),"onUpdate:modelValue":g[1]||(g[1]=U=>K(T)?T.value=U:null),size:"xs",class:"mr-2"},null,8,["id","modelValue"]),w("label",{class:"cursor-pointer select-none",for:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`}," Comparison ",8,Do)]),w("div",Wo,[f(b,{id:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(z),"onUpdate:modelValue":g[2]||(g[2]=U=>K(z)?z.value=U:null),disabled:!t(T),size:"xs",class:"mr-2"},null,8,["id","modelValue","disabled"]),w("label",{class:"cursor-pointer select-none",for:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`}," Original ",8,Ho)])]),t(T)?(u(),j("div",Go,[f(N,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(z)||t(a).parent_task_id===null,onClick:x},null,8,["disabled"]),f(W,{items:c(t(a)),mode:"click",popper:{placement:"top"}},{default:y(()=>[f(N,{variant:"link",color:"white",size:"xs"},{default:y(()=>[E(" #"+J(t(z)?e.flowResult.task_id:t(a).task_id),1)]),_:1})]),_:1},8,["items"]),f(N,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(z)||!t(k),onClick:h},null,8,["disabled"]),f(l,{class:"mx-3",name:"i-heroicons-arrows-right-left-16-solid"}),f(N,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:!r(n.flowResult,t(d).parent_task_id,t(d).parent_task_node_id)||t(d).parent_task_id===Number(t(a).task_id)||t(d).parent_task_id===null,onClick:S},null,8,["disabled"]),f(W,{items:p(t(d)),mode:"click",popper:{placement:"top"}},{error:y(({item:U})=>[w("div",{class:"text-red-500 truncate",title:U.label},J(U.label),9,Xo)]),default:y(()=>[f(N,{class:ne({"text-blue-500":t(d).progress!==100&&t(d).error==="","text-red-500":t(d).error!==""}),variant:"link",color:"white",size:"xs"},{default:y(()=>[E(J(t(d).progress===100?"#"+t(d).task_id:Math.ceil(t(d).progress)+"%"),1)]),_:1},8,["class"])]),_:1},8,["items"]),f(N,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(d).child_tasks.length===0,onClick:P},null,8,["disabled"]),f(s,{class:"ml-3",text:"Reset comparison",popper:{placement:"top"}},{default:y(()=>[f(N,{icon:"i-heroicons-arrow-path-rounded-square-solid",size:"2xs",variant:"outline",color:"white",onClick:g[3]||(g[3]=()=>$(!1,e.flowResult))})]),_:1})])):I("",!0)])])}}}),Qo={class:"image-output"},Ko={class:"flex flex-col basis-full justify-between mx-2"},Yo=oe({__name:"Image",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const n=pe();return(o,i)=>{var p,x;const r=Jo,a=_e,d=de,c=Fe;return u(),j("div",Qo,[e.flowResult.outputs.length===1?(u(),j(ae,{key:0},[(p=e.flowResult)!=null&&p.child_tasks&&((x=e.flowResult)==null?void 0:x.child_tasks.length)>0?(u(),_(r,{key:0,"flow-result":e.flowResult,"open-image-modal":e.openImageModal},null,8,["flow-result","open-image-modal"])):e.flowResult.outputs.length===1?(u(),_(a,{key:1,class:"mb-2 mx-auto rounded-lg cursor-pointer",height:t(n).$state.outputMaxSize,width:t(n).$state.outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in o?o.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id}),onClick:i[0]||(i[0]=h=>e.openImageModal(("outputResultSrc"in o?o.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})))},null,8,["height","width","src"])):I("",!0)],64)):e.flowResult.outputs.length>1?(u(),_(c,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((h,k)=>({task_id:e.flowResult.task_id,node_id:h.comfy_node_id,index:k})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(({item:h})=>{var k;return[w("div",Ko,[(k=e.flowResult)!=null&&k.child_tasks&&("hasChildTaskByParentTaskNodeId"in o?o.hasChildTaskByParentTaskNodeId:t(It))(e.flowResult,h.index,h.node_id)?(u(),_(r,{key:0,"flow-result":e.flowResult,"outputs-index":h.index,"open-image-modal":e.openImageModal},null,8,["flow-result","outputs-index","open-image-modal"])):(u(),_(a,{key:1,class:ne(`mb-2 h-100 max-h-[${t(n).$state.outputMaxSize}px] mx-auto rounded-lg cursor-pointer`),draggable:"false",height:t(n).$state.outputMaxSize,width:t(n).$state.outputMaxSize,fit:"cover",loading:"lazy",src:("outputResultSrc"in o?o.outputResultSrc:t(fe))(h),onClick:S=>e.openImageModal(("outputResultSrc"in o?o.outputResultSrc:t(fe))(h))},null,8,["class","height","width","src","onClick"])),f(d,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,h.index)}},{default:y(()=>i[1]||(i[1]=[E(" Send to flow ")])),_:2},1032,["onClick"])])]}),_:1},8,["items"])):I("",!0)])}}}),Zo={class:"video-output"},el=["width","height"],tl=["src"],nl={class:"flex flex-col basis-full justify-between mx-2"},ol=["width","height"],ll=["src"],al=oe({__name:"Video",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const n=pe();return(o,i)=>{const r=de,a=Fe;return u(),j("div",Zo,[e.flowResult.outputs.length===1?(u(),j("video",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",style:{"max-height":"80vh"},width:t(n).$state.outputMaxSize,height:t(n).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in o?o.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,tl)],8,el)):e.flowResult.outputs.length>1?(u(),_(a,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((d,c)=>({task_id:e.flowResult.task_id,node_id:d.comfy_node_id,index:c})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(({item:d})=>[w("div",nl,[w("video",{controls:"",class:"mb-2 mx-auto rounded-lg",width:t(n).$state.outputMaxSize,height:t(n).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in o?o.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,ll)],8,ol),f(r,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,d.index)}},{default:y(()=>i[0]||(i[0]=[E(" Send to flow ")])),_:2},1032,["onClick"])])]),_:1},8,["items"])):I("",!0)])}}}),sl={class:"audio-output"},il=["src"],rl={class:"flex flex-col basis-full justify-between mx-2"},ul=["src"],dl=oe({__name:"Audio",props:{flowResult:{type:Object,required:!0}},setup(e){return(n,o)=>{const i=Fe;return u(),j("div",sl,[e.flowResult.outputs.length===1?(u(),j("audio",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,il)):e.flowResult.outputs.length>1?(u(),_(i,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((r,a)=>({task_id:e.flowResult.task_id,node_id:r.comfy_node_id,index:a})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(()=>[w("div",rl,[w("audio",{controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,ul)])]),_:1},8,["items"])):I("",!0)])}}}),cl={class:"text-output"},ml={key:0,class:"mb-2 mx-auto rounded-lg text-md p-4 pr-8 border border-slate-500 relative"},fl=oe({__name:"Text",props:{flowResult:{type:Object,required:!0}},setup(e){const n=e,o=pe(),i=Ie(),r=C(!1),a=C({});function d(c,p){const{$apiFetch:x}=Le(),h=fe({task_id:c.task_id,node_id:p.comfy_node_id});return x(h).then(k=>{a.value[p.comfy_node_id]=k}).catch(k=>{console.error(k)}).finally(()=>{r.value=!1})}return Se(()=>{Promise.all(n.flowResult.outputs.filter(c=>c.type==="text").map(c=>d(n.flowResult,c)))}),(c,p)=>{const x=de,h=Fe;return u(),j("div",cl,[e.flowResult.outputs.length===1?(u(),j("div",ml,[t(r)?I("",!0):(u(),_(x,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:p[0]||(p[0]=()=>{("useCopyToClipboard"in c?c.useCopyToClipboard:t(qe))().copy(t(a)[e.flowResult.outputs[0].comfy_node_id]),t(i).add({title:"Clipboard",description:"Text copied to clipboard"})})})),w("p",null,J(t(r)?"Loading...":t(a)[e.flowResult.outputs[0].comfy_node_id]),1)])):e.flowResult.outputs.length>1?(u(),_(h,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((k,S)=>({task_id:e.flowResult.task_id,node_id:k.comfy_node_id,index:S})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:"",arrows:""},{default:y(({item:k})=>[w("div",{class:"mb-2 mx-2 rounded-lg text-md p-4 border border-slate-500 shadow-sm overflow-y-auto relative",style:bt({"max-height":Math.ceil(t(o).$state.outputMaxSize/2)+"px"})},[t(r)?I("",!0):(u(),_(x,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:()=>{("useCopyToClipboard"in c?c.useCopyToClipboard:t(qe))().copy(t(a)[k.node_id]),t(i).add({title:"Clipboard",description:"Text copied to clipboard"})}},null,8,["onClick"])),w("p",null,J(t(r)?"Loading...":t(a)[k.node_id]),1)],4)]),_:1},8,["items"])):I("",!0)])}}}),pl={class:"w-full h-full p-4"},gl={class:"mt-4 max-h-96 overflow-y-auto text-sm whitespace-pre-wrap"},vl=oe({__name:"Params",props:{flowResult:{type:Object,required:!0}},setup(e){const n=e,o=C(!1),i=L(()=>["#"+n.flowResult.task_id,...Object.keys(n.flowResult.input_params_mapped).filter(c=>n.flowResult.input_params_mapped[c].value&&n.flowResult.input_params_mapped[c].value!=="").map(c=>o.value&&n.flowResult.translated_input_params_mapped&&n.flowResult.translated_input_params_mapped[c]?`${n.flowResult.input_params_mapped[c].display_name}: ${n.flowResult.translated_input_params_mapped[c].value}`:`${n.flowResult.input_params_mapped[c].display_name}: ${n.flowResult.input_params_mapped[c].value}`)].join(" | ")+`${n.flowResult.execution_time?" | execution_time: "+n.flowResult.execution_time.toFixed(2)+"s":""}`);ct(()=>{n.flowResult.showInputFiles=!1,n.flowResult.showExecutionDetailsModal=!1});const r=L(()=>n.flowResult.execution_details&&n.flowResult.extra_flags!==null),a=L(()=>{const c={unload_models:n.flowResult.extra_flags.unload_models,max_memory_usage:n.flowResult.execution_details.max_memory_usage,disable_smart_memory:n.flowResult.execution_details.disable_smart_memory,vram_state:n.flowResult.execution_details.vram_state};return JSON.stringify(c,null,"	")});function d(){const c={extra_flags:n.flowResult.extra_flags,execution_details:n.flowResult.execution_details},p=new Blob([JSON.stringify(c,null,"	")],{type:"application/json"}),x=URL.createObjectURL(p),h=document.createElement("a");h.href=x,h.download=`${n.flowResult.task_id}_execution_details.json`,h.click(),window.URL.revokeObjectURL(x)}return(c,p)=>{const x=de,h=Re,k=De,S=Ee,P=xe;return u(),j(ae,null,[t(r)?(u(),_(h,{key:0,modelValue:e.flowResult.showExecutionDetailsModal,"onUpdate:modelValue":p[2]||(p[2]=$=>e.flowResult.showExecutionDetailsModal=$)},{default:y(()=>[f(x,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:p[0]||(p[0]=()=>e.flowResult.showExecutionDetailsModal=!1)}),w("div",pl,[p[6]||(p[6]=w("h3",{class:"text-center font-bold"}," Execution details ",-1)),w("div",gl,J(t(a)),1),f(x,{class:"mt-3",icon:"i-heroicons-arrow-down-tray-20-solid",variant:"outline",size:"xs",color:"gray",onClick:p[1]||(p[1]=()=>d())},{default:y(()=>p[5]||(p[5]=[E(" Download raw details ")])),_:1})])]),_:1},8,["modelValue"])):I("",!0),e.flowResult.translated_input_params_mapped&&Object.keys(e.flowResult.translated_input_params_mapped).length>0?(u(),_(k,{key:1,text:t(o)?"Hide translated input params":"Show translated input params",popper:{placement:"top"}},{default:y(()=>[f(x,{class:"mb-2 mr-2",color:"white",size:"xs",variant:"outline",icon:"i-heroicons-language-solid",onClick:p[3]||(p[3]=()=>{o.value=!t(o)})})]),_:1},8,["text"])):I("",!0),(u(!0),j(ae,null,ge(t(i).split("|"),$=>(u(),_(S,{key:$,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer",variant:"soft",color:"gray",onClick:()=>{const z=("useCopyToClipboard"in c?c.useCopyToClipboard:t(qe))(),T=$.indexOf(":"),R=$.substring(T+1).trim();z.copy(R),("useToast"in c?c.useToast:t(Ie))().add({title:"Clipboard",description:`${$.split(":")[0].trim()} copied to clipboard`,timeout:2e3})}},{default:y(()=>[E(J($),1)]),_:2},1032,["onClick"]))),128)),e.flowResult.input_files.length>0?(u(),_(S,{key:2,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer select-none",variant:"subtle",color:"sky",onClick:p[4]||(p[4]=()=>{e.flowResult.showInputFiles=!e.flowResult.showInputFiles})},{default:y(()=>[f(P,{name:e.flowResult.showInputFiles?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-1"},null,8,["name"]),f(P,{name:"i-heroicons-document-solid",class:"mr-1"}),E(" "+J(`input_files: ${e.flowResult.input_files.length}`),1)]),_:1})):I("",!0)],64)}}}),hl={key:0,class:ne("w-full p-1")},wl={class:"flex flex-col basis-full justify-between mx-2"},yl=oe({__name:"InputFiles",props:{flowResult:{type:Object,required:!0}},setup(e){const n=pe(),o=(d,c)=>`${Ct()}/tasks/inputs?task_id=${d}&input_index=${c}`,i=C(!1),r=C(""),a=C(0);return(d,c)=>{var S,P;const p=_e,x=Fe,h=de,k=Re;return e.flowResult.showInputFiles?(u(),j("div",hl,[((S=Object.keys(e.flowResult.input_files))==null?void 0:S.length)===1?(u(),_(p,{key:0,class:ne(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(n).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",src:o(e.flowResult.task_id,0),onClick:c[0]||(c[0]=()=>{r.value=o(e.flowResult.task_id,0),a.value=0,i.value=!0})},null,8,["class","src"])):I("",!0),((P=Object.keys(e.flowResult.input_files))==null?void 0:P.length)>1?(u(),_(x,{key:1,items:Object.keys(e.flowResult.input_files).map($=>({task_id:e.flowResult.task_id,index:$})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 my-2"}},page:1,indicators:""},{default:y(({item:$})=>[w("div",wl,[f(p,{class:ne(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(n).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",draggable:"false",src:o($.task_id,$.index),onClick:()=>{r.value=o(e.flowResult.task_id,$.index),a.value=$.index,i.value=!0}},null,8,["class","src","onClick"])])]),_:1},8,["items"])):I("",!0),f(k,{modelValue:t(i),"onUpdate:modelValue":c[3]||(c[3]=$=>K(i)?i.value=$:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[f(h,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:c[1]||(c[1]=()=>i.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:c[2]||(c[2]=Ye(()=>i.value=!1,["left"]))},[t(r)?(u(),_(p,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(r)},null,8,["src"])):I("",!0)])]),_:1},8,["modelValue"])])):I("",!0)}}}),bl={class:"p-4"},kl={class:"flex justify-center mb-4"},xl={key:0,class:"text-sm text-slate-500 text-center mb-4"},_l={class:"text-md text-center text-red-500 mb-4"},$l={key:1},Cl={class:"flex items-center justify-between"},Sl=oe({__name:"SendToFlowModal",props:Ae({flowResult:{type:Object,required:!1,default:()=>null},outputImgSrc:{type:String,required:!0},outputParamIndex:{type:Number,required:!0},inputParamsMapped:{type:Object,required:!0},isChildTask:{type:Boolean,required:!1,default:!1},translatePrompt:{type:Boolean,required:!1,default:!1}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:Ae(["update:show"],["update:show"]),setup(e,{emit:n}){const o=e,i=je(e,"show"),r=pe(),a=L(()=>r.sub_flows.map(S=>({value:S.name,label:`${S.display_name} - ${S.description}`}))),d=C(a.value[0]||""),c=C(!1),p=n;function x(){console.debug("[Send to flow]: ",d.value);const S=r.sub_flows.find($=>$.name===d.value.value&&$.display_name===d.value.label.split(" - ")[0]);if(console.debug("[Send to flow]: targetFlow",S),!S){Ie().add({title:`Target sub-flow "${d.value.value}" not found`,description:"Please, verify the target sub-flow is installed and available and try again",timeout:5e3});return}const P=S.input_params.reduce(($,z)=>{const T={};return z.type==="text"?T[z.name]={value:z.default||"",type:z.type}:z.type==="number"?T[z.name]={value:z.default||0,type:z.type}:z.type==="image"?T[z.name]={value:JSON.stringify({task_id:o.flowResult.task_id,node_id:o.flowResult.outputs.length>1?o.flowResult.outputs[o.outputParamIndex].comfy_node_id:o.flowResult.outputs[0].comfy_node_id})||"",type:z.type}:z.type==="list"?T[z.name]={value:z.default||Object.keys(z.options)[0]||"",type:z.type,options:z.options}:z.type==="bool"?T[z.name]={value:z.default||!1,type:z.type}:["range","range_scale"].includes(z.type)&&(T[z.name]={value:z.default||0,type:z.type}),$.push(T),$},[]);console.debug("[Send to flow]: input_params_map",P),c.value=!0,r.runFlow(S,P,1,o.translatePrompt,h.value,h.value?Number(o.flowResult.task_id):null).finally(()=>{c.value=!1,p("update:show",!1)})}const h=C(!1),k=L(()=>{var S;return o.flowResult.progress===100&&((S=o.flowResult)==null?void 0:S.error)===""});return Ke(()=>{var P,$;const S=o.flowResult?(($=(P=o==null?void 0:o.flowResult)==null?void 0:P.outputs[o.outputParamIndex])==null?void 0:$.type)??"image":"image";r.fetchSubFlows(S).then(()=>{d.value=a.value[0]||""}),h.value=!1}),(S,P)=>{const $=_e,z=mt,T=et,R=Ge,m=de,g=Re;return u(),_(g,{modelValue:i.value,"onUpdate:modelValue":P[2]||(P[2]=F=>i.value=F),class:"z-[90]",transition:!1},{default:y(()=>[w("div",bl,[P[4]||(P[4]=w("h2",{class:"text-lg text-center mb-4"},"Send to flow",-1)),w("div",kl,[t(k)?(u(),_($,{key:0,src:e.outputImgSrc,class:"w-1/2 rounded-lg",draggable:!1},null,8,["src"])):(u(),_(z,{key:1,color:"orange",icon:"i-heroicons-exclamation-circle-solid",title:`Task is still running (${Math.ceil(e.flowResult.progress)}%, ${e.flowResult.execution_time.toFixed(2)}s)`,description:e.flowResult.error!==""?e.flowResult.error:""},null,8,["title","description"]))]),e.inputParamsMapped?(u(),j("p",xl,J(["#"+e.flowResult.task_id,...Object.keys(e.inputParamsMapped).filter(F=>e.inputParamsMapped[F].value!=="").map(F=>`${e.inputParamsMapped[F].display_name}: ${e.inputParamsMapped[F].value}`)].join(" | ")),1)):I("",!0),w("p",_l,[t(a).length>0?(u(),_(T,{key:0,modelValue:t(d),"onUpdate:modelValue":P[0]||(P[0]=F=>K(d)?d.value=F:null),class:"w-full",size:"lg",options:t(a)},null,8,["modelValue","options"])):(u(),j("span",$l,"No sub-flows available"))]),e.isChildTask?(u(),_(z,{key:1,class:"mb-4",icon:"i-heroicons-exclamation-circle-solid",title:"Child task",description:"The latest child task is always used as input for sub-flow"})):I("",!0),w("div",Cl,[f(R,{modelValue:t(h),"onUpdate:modelValue":P[1]||(P[1]=F=>K(h)?h.value=F:null),label:"Bind as child task"},null,8,["modelValue"]),f(m,{icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",variant:"outline",loading:t(c),disabled:t(a).length===0||e.isChildTask&&!t(k),onClick:x},{default:y(()=>P[3]||(P[3]=[E(" Send ")])),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])}}}),Il={class:"flex flex-col md:flex-row items-center justify-center mb-5 sticky top-1 z-[10]"},Rl={class:"flex items-center justify-center"},Ml={class:"p-4"},Fl={class:"text-md text-center text-red-500 mb-4"},Pl={class:"flex justify-center"},Ul={key:0,class:"results overflow-auto"},zl=["id"],Ol={class:"text-sm text-slate-500 text-center mb-1"},Vl={class:"w-5/6 mx-auto flex flex-wrap items-center justify-center"},jl={class:"w-full flex justify-center items-center"},Tl={key:1,class:"text-center text-slate-500"},Nl=oe({__name:"Output",emits:["copy-prompt-inputs"],setup(e,{emit:n}){const o=pe(),i=L(()=>{var l;return o.flowResultsByName((l=o.currentFlow)==null?void 0:l.name).length>0||!1}),r=L(()=>{var l;return o.flowResultsByName((l=o.currentFlow)==null?void 0:l.name)||[]}),a=L(()=>o.$state.resultsPageSize);he(r,()=>{r.value.length<=o.$state.resultsPageSize?o.$state.resultsPage=1:o.$state.resultsPage>Math.ceil(r.value.length/o.$state.resultsPageSize)&&(o.$state.resultsPage=Math.ceil(r.value.length/o.$state.resultsPageSize))}),he(a,()=>{r.value.length<=o.$state.resultsPageSize?o.$state.resultsPage=1:o.$state.resultsPage>Math.ceil(r.value.length/o.$state.resultsPageSize)&&(o.$state.resultsPage=Math.ceil(r.value.length/o.$state.resultsPageSize)),o.saveUserOptions()}),ct(()=>{o.$state.flow_results_filter="",o.$state.resultsPage=1});const d=n;function c(l){d("copy-prompt-inputs",l.input_params_mapped)}function p(l){$.value=l,P.value=!0}const x=C(null),h=C(!1);window.addEventListener("scroll",()=>{var l;h.value=window.scrollY>(((l=x.value)==null?void 0:l.offsetTop)+window.screen.height||0)});const k=L(()=>o.$state.resultsPage);he(k,()=>{const l=document.getElementById("output-container");l&&l.scrollIntoView({behavior:"smooth"})});const S=C(!1),P=C(!1),$=C(""),z=C(!1),T=C(!1),R=C(!1),m=C(""),g=C(null),F=C({}),V=C(0),b=C(!1);function N(l,s=0){if(l.child_tasks.length===0||!It(l,s,l.outputs[s].comfy_node_id))g.value=l,m.value=fe({task_id:l.task_id,node_id:l.outputs[s].comfy_node_id}),F.value=l.input_params_mapped,b.value=!1;else{const U=St(l,s,l.outputs[s].comfy_node_id);g.value=U,F.value=l.input_params_mapped,m.value=fe({task_id:U.task_id,node_id:U.outputs[0].comfy_node_id}),b.value=!0}V.value=s,R.value=!0}function W(l){var Z;const s=l.extra_flags!==null&&((Z=l==null?void 0:l.extra_flags)==null?void 0:Z.profiler_execution),U=[{label:"Comfy flow",labelClass:"text-blue-500 text-sm",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500 h-4 w-4",click:()=>{var ee;return o.downloadFlowComfy((ee=o.currentFlow)==null?void 0:ee.name,l.task_id)}}];s&&U.push({label:"Execution details",labelClass:"text-orange-500 text-sm",icon:"i-mdi-bug",iconClass:"bg-orange-500 h-4 w-4",click:()=>{l.execution_details?l.showExecutionDetailsModal=!0:o.fetchTaskHistoryItem(l.task_id).then(ee=>{l.execution_details=ee.execution_details,l.showExecutionDetailsModal=!0})}});const H=[[{label:"Use params",labelClass:"text-cyan-500 text-sm",icon:"i-heroicons-document-duplicate-16-solid",iconClass:"bg-cyan-500 h-4 w-4",click:()=>c(l)}],U];return l.outputs.length===1&&l.outputs.every(ee=>ee.type==="image")&&H.splice(1,0,[{label:"Send to flow",labelClass:"text-violet-500 text-sm",icon:"i-heroicons-arrow-uturn-up-solid",iconClass:"bg-violet-500 h-4 w-4",click:()=>{N(l)}}]),H}return(l,s)=>{var G;const U=Bo,H=xe,Z=We,ee=ln,re=rn,ce=de,se=Ze,te=Ee,ye=Re,we=Yo,Q=al,me=dl,ue=fl,q=vl,v=yl,M=Sl,A=_e;return u(),j("div",{id:"output-container",ref_key:"outputContainer",ref:x,class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md my-10"},[f(U,{show:t(h),class:"fixed bottom-5 right-5",target:"output-container"},null,8,["show"]),w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:s[0]||(s[0]=()=>{S.value=!t(S)})},[f(H,{name:t(S)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),E(" Output ("+J(t(r).filter(O=>O.parent_task_id===null).length)+") ",1)]),t(S)?I("",!0):(u(),j(ae,{key:0},[w("div",Il,[f(Z,{modelValue:t(o).$state.flow_results_filter,"onUpdate:modelValue":s[1]||(s[1]=O=>t(o).$state.flow_results_filter=O),icon:"i-heroicons-magnifying-glass-20-solid",color:"white",class:"md:mr-3",label:"Filter by prompt",trailing:!0,placeholder:"Filter results by prompt"},null,8,["modelValue"]),t(r).filter(O=>O.parent_task_id===null).length>t(o).$state.resultsPageSize?(u(),_(ee,{key:0,modelValue:t(o).$state.resultsPage,"onUpdate:modelValue":s[2]||(s[2]=O=>t(o).$state.resultsPage=O),class:"my-1 md:my-0","page-count":t(o).$state.resultsPageSize,total:t(r).filter(O=>O.parent_task_id===null).length,"show-first":"","show-last":""},null,8,["modelValue","page-count","total"])):I("",!0),w("div",Rl,[f(re,{modelValue:t(o).resultsPageSize,"onUpdate:modelValue":s[3]||(s[3]=O=>t(o).resultsPageSize=O),class:"md:mx-3 w-fit mr-3",options:[5,10,20,50,100],label:"Results per page"},null,8,["modelValue"]),f(se,{items:[[{label:"Delete all results",labelClass:"text-red-500",icon:"i-heroicons-trash",iconClass:"dark:text-red-500 text-red-500",click:()=>z.value=!0}]],mode:"click",label:"Options",popper:{placement:"bottom-end"}},{default:y(()=>[f(ce,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])]),f(ye,{modelValue:t(z),"onUpdate:modelValue":s[6]||(s[6]=O=>K(z)?z.value=O:null),class:"z-[90]",transition:!1},{default:y(()=>[w("div",Ml,[s[15]||(s[15]=w("p",{class:"text-lg text-center mb-4"},"Are you sure you want to delete all results?",-1)),w("p",Fl,[s[11]||(s[11]=E(" All history and images of ")),f(te,{class:"mx-1",color:"orange",variant:"outline"},{default:y(()=>[E(J(t(o).currentFlow.display_name),1)]),_:1}),s[12]||(s[12]=E(" will be deleted. "))]),w("div",Pl,[f(ce,{class:"mr-2",color:"red",variant:"outline",loading:t(T),onClick:s[4]||(s[4]=()=>{var O;T.value=!0,t(o).deleteFlowResults((O=t(o).currentFlow)==null?void 0:O.name).then(()=>{T.value=!1,z.value=!1})})},{default:y(()=>s[13]||(s[13]=[E(" Yes ")])),_:1},8,["loading"]),f(ce,{variant:"outline",onClick:s[5]||(s[5]=()=>z.value=!1)},{default:y(()=>s[14]||(s[14]=[E("No")])),_:1})])])]),_:1},8,["modelValue"])]),t(i)?(u(),j("div",Ul,[(u(!0),j(ae,null,ge(t(o).flowResultsByNamePaginated((G=t(o).currentFlow)==null?void 0:G.name),O=>(u(),j("div",{id:"task_id_"+O.task_id,key:O.task_id,class:"flex flex-col justify-center mx-auto mb-5"},[O.outputs.some(X=>["image","image-animated"].includes(X.type))?(u(),_(we,{key:0,"flow-result":O,"handle-send-to-flow":N,"open-image-modal":p},null,8,["flow-result"])):O.outputs.some(X=>X.type==="video")?(u(),_(Q,{key:1,"flow-result":O,"handle-send-to-flow":N,"open-image-modal":p},null,8,["flow-result"])):O.outputs.some(X=>X.type==="audio")?(u(),_(me,{key:2,"flow-result":O},null,8,["flow-result"])):O.outputs.some(X=>X.type==="text")?(u(),_(ue,{key:3,"flow-result":O},null,8,["flow-result"])):I("",!0),w("div",Ol,[w("div",Vl,[f(q,{"flow-result":O},null,8,["flow-result"])])]),f(v,{"flow-result":O},null,8,["flow-result"]),w("div",jl,[f(ce,{class:"mr-3",color:"red",icon:"i-heroicons-trash",variant:"outline",size:"xs",onClick:()=>t(o).deleteFlowHistory(O.task_id)},{default:y(()=>s[16]||(s[16]=[E(" Delete ")])),_:2},1032,["onClick"]),f(se,{items:W(O),mode:"click",popper:{placement:"bottom-start"}},{default:y(()=>[f(ce,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid",size:"xs"})]),_:2},1032,["items"])])],8,zl))),128)),f(M,{show:t(R),"onUpdate:show":s[7]||(s[7]=O=>K(R)?R.value=O:null),"flow-result":t(g),"output-img-src":t(m),"output-param-index":t(V),"input-params-mapped":t(F),"is-child-task":t(b)},null,8,["show","flow-result","output-img-src","output-param-index","input-params-mapped","is-child-task"])])):(u(),j("p",Tl," No output results available "))],64)),f(ye,{modelValue:t(P),"onUpdate:modelValue":s[10]||(s[10]=O=>K(P)?P.value=O:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[f(ce,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:s[8]||(s[8]=()=>P.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:s[9]||(s[9]=Ye(()=>P.value=!1,["left"]))},[t($)?(u(),_(A,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",src:t($)},null,8,["src"])):I("",!0)])]),_:1},8,["modelValue"])],512)}}}),Bl=Zt("civitAiStore",{actions:{fetchFlowLoras(e,n,o=50,i=null){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:r}=Le();let d=`https://civitai.com/api/v1/models?baseModels=${e.lora_connect_points[Object.keys(e.lora_connect_points)[0]].base_model_type}&types=LORA&limit=${o}`;i&&(i.includes(window.location.hostname)&&(i=i.replace(window.location.hostname,"civitai.com")),d=i);const c=`/other/proxy?target=${encodeURIComponent(d)}`;return r(c,{method:"GET",headers:{Authentication:"Bearer "+n,Accept:"application/json"}})},fetchFlowLorasByHash(e,n,o){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:i}=Le(),r=`https://civitai.com/api/v1/model-versions/by-hash/${o}`,a=`/other/proxy?target=${encodeURIComponent(r)}`;return i(a,{method:"GET",headers:{Authentication:"Bearer "+n,Accept:"application/json"}})}}}),Ll={class:"p-4 overflow-y-auto relative"},Al={key:1},ql={class:"flex flex-col justify-between w-full md:flex-row md:gap-4 md:items-center lg:items-start"},El={class:"flex flex-col gap-2 lg:flex-row md:justify-end items-start w-full"},Dl={class:"flex flex-col md:flex-row flex-wrap gap-2 justify-between items-center w-full px-4 py-3"},Wl={class:"flex items-center gap-1.5"},Hl={class:"flex gap-1.5 items-center"},Gl={class:"flex items-center h-5"},Xl=["checked","indeterminate","onChange"],Jl={key:0,class:"flex items-center h-5"},Ql=["checked","onChange"],Kl=["href"],Yl=["innerHTML"],Zl={class:"p-4 max-h-64 max-w-xl overflow-y-auto"},ea={key:0},ta={class:"flex items-center"},na={class:"flex items-center"},oa={key:0,class:"flex justify-center space-x-2 w-full"},la={key:1,controls:"",width:256,height:256},aa=["src"],sa={class:"flex justify-end"},ia=oe({__name:"LoraSelectorModal",props:Ae({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const n=e,o=je(e,"show"),i=Ie(),r=pe(),a=_t(),d=Bl(),c=C(!1),p=C({items:[],metadata:{}}),x=L(()=>a.settingsMap.civitai_auth_token.value!==""),h=L(()=>a.settingsMap.civitai_auth_token.value||""),k=[{key:"name",label:"Name",sortable:!0,class:""},{key:"description",label:"Description",sortable:!1,class:""},{key:"trigger_words",label:"Trigger words",sortable:!1,class:""},{key:"nsfw",label:"NSFW",sortable:!1,class:""},{key:"statsDownloadCount",label:"Download count",sortable:!1,class:""},{key:"statsThumbsUpCount",label:"Thumbs up",sortable:!1,class:""},{key:"modelVersion",label:"Model version",sortable:!1,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}],S=C([]),P=C({openedRows:[],row:{}}),$=C(""),z=()=>{$.value=""},T=L(()=>{var v;let q=((v=p.value)==null?void 0:v.items)||[];return $.value&&(q=q.filter(M=>M.name.toLowerCase().includes($.value.toLowerCase()))),q.forEach(M=>{!R.value[M.id]&&(M==null?void 0:M.modelVersions.length)>0&&(R.value[M.id]=M==null?void 0:M.modelVersions[0].name);const A=Object.keys(Q.value);M.modelVersions.forEach(G=>{A.includes(G.files[0].hashes.SHA256.toLowerCase())&&Q.value[G.files[0].hashes.SHA256.toLowerCase()]!==null&&(R.value[M.id]=G.name,M.currentFlowLora=!0,S.value.includes(M)||S.value.push(M))})}),q}),R=C({});function m(q){var v;return((v=q.modelVersions.find(M=>M.name===R.value[q.id]))==null?void 0:v.images)||q.modelVersions[0].images||[]}function g(q){var v;return((v=q.modelVersions.find(M=>M.name===R.value[q.id]))==null?void 0:v.trainedWords)||q.modelVersions[0].trainedWords||[]}const F=C(!0),V=C(""),b=C(n.flow.display_name),N=C(n.flow.description),W=C(n.flow.license),l=C(n.flow.required_memory_gb||0),s=C(n.flow.version);function U(){const q=Object.keys(n.flow.lora_connect_points)[0],M=n.flow.lora_connect_points[q].connected_loras.filter(O=>Q.value[O.hash]!==null).map(O=>({display_name:O.display_name,model_url:O.url,strength_model:O.strength_model})),A={[q]:[]};F.value&&A[q].push(...M);const G=S.value.reduce((O,X)=>{const D=X.modelVersions.find(ve=>ve.name===R.value[X.id]);if(!D||Q.value[D.files[0].hashes.SHA256.toLowerCase()])return O;const Y={strength_model:1,model_url:D.downloadUrl,display_name:X.name};return O.push(Y),O},[]);return A[q].push(...G),console.debug("[DEBUG] newFlowConnectionPoints: ",A),A}function H(q){const v=q.modelVersions.find(G=>G.name===R.value[q.id]);if(!v)return;const M=v.files[0].hashes.SHA256.toLowerCase();Q.value[M]&&(Q.value[M]=null);const A=S.value.indexOf(q);A!==-1&&S.value.splice(A,1),q.currentFlowLora=!1}const Z=L(()=>r.flows.find(q=>q.name===V.value)),ee=L(()=>/^[a-z0-9_-]+$/i.test(V.value)),re=L(()=>V.value!==""&&ee&&!Z.value),ce=L(()=>V.value===""?"Flow name is required.":ee.value?Z.value?"Flow name already exists.":"":"Flow name can only contain letters, numbers, dashes and underscores."),se=L(()=>S.value.filter(q=>!Q.value[q.modelVersions[0].files[0].hashes.SHA256.toLowerCase()]).length!==0),te=L(()=>se.value&&re.value&&b.value!==""&&N.value!==""),ye=L(()=>se.value?re.value?b.value===""?"Please provide a display name.":N.value===""?"Please provide a description.":"":"Please provide a valid flow name.":"No LoRAs selected");function we(){if(S.value.length===0){i.add({title:"No LoRAs selected",description:"Please select at least one LoRA to apply and install."});return}const q={new_name:V.value,new_display_name:b.value,new_description:N.value,new_license:W.value,new_required_memory_gb:l.value,new_version:s.value,new_lora_connection_points:U()};console.debug("[DEBUG] Clone flow params: ",q),c.value=!0,r.cloneFlow(n.flow,q).then(()=>{r.fetchFlows();const v=Rt();i.add({title:"Flow clone applied",actions:[{label:"View flow",click:()=>{v.push("/workflows/"+V.value)}}]})}).catch(v=>{console.error("Error applying and installing flow: ",v.message||"Unknown error"),i.add({title:"Error applying and installing flow",description:"An error occurred while applying and installing the flow. See the console for more details."})}).finally(()=>{c.value=!1})}const Q=C({});function me(){const q=n.flow.lora_connect_points[Object.keys(n.flow.lora_connect_points)[0]].connected_loras;console.debug("Flow LORAs: ",q),Promise.all(q.map(v=>{var M;return(M=d.fetchFlowLorasByHash(n.flow,h.value,v.hash))==null?void 0:M.then(A=>(v.hash in Q.value||(Q.value[v.hash]=A),A))})).then(()=>{console.debug("Fetched flow LORAs info: ",Q.value)}).catch(v=>{console.error("Error fetching flow LORAs info: ",v),i.add({title:"Error fetching flow LORAs info",description:"An error occurred while fetching LoRAs info for the flow. See the console for more details."})})}function ue(q=!1){var M;if(!n.flow||!h.value)return;c.value=!0,q||me();let v=null;return q&&((M=p.value.metadata)!=null&&M.nextPage)&&(v=p.value.metadata.nextPage),d.fetchFlowLoras(n.flow,h.value,50,v).then(A=>{console.debug('Fetched flow "'+n.flow.name+'" loras: ',A);const G=n.flow.lora_connect_points[Object.keys(n.flow.lora_connect_points)[0]].base_model_type,O=A.items.reduce((X,D)=>(D.modelVersions=D.modelVersions.filter(Y=>Y.baseModel===G),D.modelVersions.length>0&&(p.value.items.find(Y=>Y.id===D.id)||X.push(D)),X),[]);return O.length===0&&i.add({title:"No more supported LoRAs",description:"No supported LoRAs available for the flow."}),p.value.items.push(...O),p.value.metadata=A.metadata,A}).catch(A=>{console.error('Error fetching flow "'+n.flow.name+'" loras: ',A),i.add({title:'Error fetching flow "'+n.flow.name+'" loras',description:"An error occurred while fetching LoRAs for the flow. See the console for more details."})}).finally(()=>{c.value=!1})}return(q,v)=>{const M=de,A=en,G=mt,O=We,X=He,D=Ge,Y=De,ve=xt,Pe=Ee,be=xe,Ue=et,Xe=_e,le=Fe,Vt=un,jt=Mt,Tt=Re;return u(),_(Tt,{modelValue:o.value,"onUpdate:modelValue":v[15]||(v[15]=B=>o.value=B),fullscreen:""},{default:y(()=>[w("div",Ll,[f(M,{class:"absolute top-3 right-3",icon:"i-heroicons-x-mark",variant:"ghost",onClick:v[0]||(v[0]=()=>o.value=!1)}),v[22]||(v[22]=w("h2",{class:"text-xl font-bold"},"Modify flow",-1)),v[23]||(v[23]=w("p",{class:"text-sm text-slate-500 my-2"}," Select LoRAs to modify the flow. New Flow will be created and installed with selected LoRAs. ",-1)),t(x)?(u(),j("div",Al,[w("div",ql,[f(M,{class:"my-1",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",loading:t(c),onClick:v[1]||(v[1]=()=>{p.value={items:[],metadata:{}},Q.value={},z(),ue()})},{default:y(()=>v[17]||(v[17]=[E(" Fetch LoRAs models from CivitAI ")])),_:1},8,["loading"]),w("div",El,[f(X,{label:"New flow name",class:"flex justify-center flex-col w-full",error:t(ce)},{default:y(()=>[f(O,{modelValue:t(V),"onUpdate:modelValue":v[2]||(v[2]=B=>K(V)?V.value=B:null),type:"text",placeholder:"unique_flow_name",onInput:v[3]||(v[3]=B=>{B.target.value=B.target.value.toLowerCase(),V.value=B.target.value.toLowerCase()})},null,8,["modelValue"])]),_:1},8,["error"]),f(X,{label:"New display name",class:"flex justify-center flex-col w-full",error:t(b)!==""?"":"Display name is required."},{default:y(()=>[f(O,{modelValue:t(b),"onUpdate:modelValue":v[4]||(v[4]=B=>K(b)?b.value=B:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),f(X,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:y(()=>[f(O,{modelValue:t(N),"onUpdate:modelValue":v[5]||(v[5]=B=>K(N)?N.value=B:null),type:"text",placeholder:"Description"},null,8,["modelValue"])]),_:1}),f(X,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:y(()=>[f(O,{modelValue:t(W),"onUpdate:modelValue":v[6]||(v[6]=B=>K(W)?W.value=B:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),f(X,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:y(()=>[f(O,{modelValue:t(l),"onUpdate:modelValue":v[7]||(v[7]=B=>K(l)?l.value=B:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),f(X,{label:"Version",class:"flex justify-center flex-col w-full"},{default:y(()=>[f(O,{modelValue:t(s),"onUpdate:modelValue":v[8]||(v[8]=B=>K(s)?s.value=B:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})])]),f(jt,{class:"w-full",ui:{base:"",ring:"",divide:"divide-y divide-gray-200 dark:divide-gray-700",header:{padding:"px-4 py-5"},body:{padding:"",base:"divide-y divide-gray-200 dark:divide-gray-700"},footer:{padding:"p-4"}}},{footer:y(()=>[w("div",sa,[f(M,{class:"mr-2",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",color:"blue",disabled:t(p).items.length===0||t(p).items.length>0&&!t(p).metadata.nextPage,loading:t(c),onClick:v[14]||(v[14]=()=>{ue(!0)})},{default:y(()=>v[21]||(v[21]=[E(" Load more ")])),_:1},8,["disabled","loading"])])]),default:y(()=>[w("div",Dl,[w("div",Wl,[f(O,{modelValue:t($),"onUpdate:modelValue":v[9]||(v[9]=B=>K($)?$.value=B:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:"Filter by name..."},null,8,["modelValue"])]),w("div",Hl,[t(se)?(u(),_(D,{key:0,modelValue:t(F),"onUpdate:modelValue":v[10]||(v[10]=B=>K(F)?F.value=B:null),label:"Keep previous LoRAs",class:"mr-2"},null,8,["modelValue"])):I("",!0),t(se)?(u(),_(M,{key:1,variant:"outline",icon:"i-heroicons-x-circle",color:"orange",class:"mr-2",onClick:v[11]||(v[11]=()=>t(S).splice(0))},{default:y(()=>v[18]||(v[18]=[E(" Clear selection ")])),_:1})):I("",!0),f(Y,{text:t(ye)},{default:y(()=>[f(M,{variant:"outline",icon:"i-heroicons-check-16-solid",disabled:!t(te),loading:t(c),onClick:we},{default:y(()=>v[19]||(v[19]=[E(" Apply and install ")])),_:1},8,["disabled","loading"])]),_:1},8,["text"])])]),f(Vt,{modelValue:t(S),"onUpdate:modelValue":v[12]||(v[12]=B=>K(S)?S.value=B:null),expand:t(P),"onUpdate:expand":v[13]||(v[13]=B=>K(P)?P.value=B:null),columns:k,rows:t(T),loading:t(c),ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10",tr:{base:"dark:hover:bg-slate-800"}}},{caption:y(()=>v[20]||(v[20]=[w("caption",{class:"text-slate-500 text-sm py-1"},"Only supported LORAs for the basic model type are listed",-1)])),"select-header":y(({indeterminate:B,checked:ie,change:Te})=>[w("div",Gl,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:ie,indeterminate:B&&t(se),onChange:tt=>Te(tt.target.checked)},null,40,Xl)])]),"select-data":y(({checked:B,change:ie,row:Te})=>[Te!=null&&Te.currentFlowLora?I("",!0):(u(),j("div",Jl,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:B,onChange:tt=>ie(tt.target.checked)},null,40,Ql)]))]),"name-data":y(({row:B})=>[w("a",{href:`https://civitai.com/models/${B.id}`,target:"_blank",class:"text-blue-500 underline"},J(B.name),9,Kl)]),"description-data":y(({row:B})=>[f(ve,null,{panel:y(()=>[w("div",{class:"model-description p-4 max-h-64 max-w-xl overflow-y-auto",innerHTML:B.description},null,8,Yl)]),default:y(()=>[f(M,{color:"white",label:"Description","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:2},1024)]),"trigger_words-data":y(({row:B})=>[f(ve,null,{panel:y(()=>[w("div",Zl,[g(B).length===0?(u(),j("p",ea,"No trigger words available for this model version.")):(u(!0),j(ae,{key:1},ge(g(B),ie=>(u(),_(Pe,{key:ie,class:"flex flex-wrap gap-3 my-1 whitespace-normal",label:ie,color:"white",variant:"outline"},null,8,["label"]))),128))])]),default:y(()=>[f(M,{color:"white",label:`Trigger words (${g(B).length})`,"trailing-icon":"i-heroicons-chevron-down-20-solid"},null,8,["label"])]),_:2},1024)]),"nsfw-data":y(({row:B})=>[f(Y,{text:`NSFW level: ${B.nsfwLevel}`,class:"pl-4"},{default:y(()=>[f(be,{name:B.nsfw?"i-heroicons-x-circle":"i-heroicons-check-circle",class:ne({"text-red-500":B.nsfw,"text-green-500":!B.nsfw})},null,8,["name","class"])]),_:2},1032,["text"])]),"statsThumbsUpCount-data":y(({row:B})=>[w("div",ta,[f(be,{name:"i-heroicons-hand-thumb-up-solid",class:"text-green-500 mr-1"}),w("span",null,J(B.stats.thumbsUpCount),1)])]),"statsDownloadCount-data":y(({row:B})=>[w("div",na,[f(be,{name:"i-heroicons-arrow-down-circle",class:"text-blue-500 mr-1"}),w("span",null,J(B.stats.downloadCount),1)])]),"modelVersion-data":y(({row:B})=>[f(Ue,{modelValue:t(R)[B.id],"onUpdate:modelValue":ie=>t(R)[B.id]=ie,options:B.modelVersions.map(ie=>ie.name)},null,8,["modelValue","onUpdate:modelValue","options"])]),"actions-data":y(({row:B})=>[B!=null&&B.currentFlowLora?(u(),_(Y,{key:1,text:"Remove previously selected LoRA"},{default:y(()=>[f(M,{icon:"i-heroicons-minus-16-solid",variant:"outline",color:"orange",onClick:ie=>H(B)},null,8,["onClick"])]),_:2},1024)):(u(),_(M,{key:0,icon:t(S).includes(B)?"i-heroicons-check-16-solid":"i-heroicons-plus-16-solid",variant:"outline",color:t(S).includes(B)?"green":"white",onClick:()=>{if(t(S).includes(B)){t(S).splice(t(S).indexOf(B),1);return}t(S).push(B)}},null,8,["icon","color","onClick"]))]),expand:y(({row:B})=>[m(B).length>0?(u(),j("div",oa,[f(le,{class:"my-3",items:m(B).map(ie=>({id:ie.id,url:ie.url,type:(ie==null?void 0:ie.type)||"image"})),ui:{item:"mx-1"}},{default:y(({item:ie})=>[ie.type==="image"?(u(),_(Xe,{key:0,src:ie.url,height:256,width:256,loading:"lazy",draggable:"false"},null,8,["src"])):(u(),j("video",la,[w("source",{src:ie.url},null,8,aa)]))]),_:2},1032,["items"])])):(u(),_(G,{key:1,title:"No images",description:"No images available for this model version.",variant:"soft",color:"amber"}))]),_:1},8,["modelValue","expand","rows","loading"])]),_:1})])):(u(),_(G,{key:0,class:"my-4",title:"CivitAI token missing",description:"Please add a CivitAI token in the settings to use this feature.",variant:"soft",color:"red"},{actions:y(()=>[f(A,{to:"/settings"},{default:y(()=>[f(M,{class:"lg:px-3 py-2",icon:"i-heroicons-arrow-top-right-on-square-16-solid",variant:"link",color:"white"},{default:y(()=>v[16]||(v[16]=[E(" Go to Settings ")])),_:1})]),_:1})]),_:1}))])]),_:1},8,["modelValue"])}}}),ra={class:"flex flex-col lg:flex-row flex-grow items-start w-full"},ua={class:"card-wrapper w-full lg:pr-5"},da={key:0,class:"p-0 text-sm"},ca={class:"flex flex-row items-center text-slate-400 mb-2"},ma={class:"flex flex-row flex-wrap items-center text-md mb-2"},fa=["href"],pa={class:"flex flex-row items-center text-md mb-2"},ga=["href"],va={key:1},ha={class:"flex flex-row items-center text-md mb-2"},wa={key:0},ya={class:"flex flex-row items-center text-md mb-2"},ba={key:0,class:"flex flex-row flex-wrap items-center text-md mb-2"},ka=["href"],xa={key:1},_a={class:"flex flex-row items-center mb-2"},$a={key:1,class:"flex flex-row flex-wrap items-center text-md"},Ca={key:0,class:"flex justify-end"},Sa={class:"flex flex-row items-center justify-center text-sm mr-2"},Ia={key:1},Ra={class:"text-sm flex justify-end"},Ma={class:"flex flex-row items-center justify-center text-sm mr-3"},Fa={key:0,class:"text-right"},Pa={class:"prompt-wrapper w-full"},Ua={class:"flex items-center justify-between"},za={class:"pb-2"},Oa={class:"flex justify-end items-center"},Ha=oe({__name:"[name]",setup(e){const n=tn(),o=pe(),i=Ie();o.setCurrentFlow(n.params.name);const r=L(()=>o.flowInstallingByName(n.params.name)),a=L(()=>{var V;return r.value&&((V=r.value)==null?void 0:V.progress)<100||!1}),d=C(!1),c=L(()=>{var V;return r.value?"error"in r.value&&((V=r.value)==null?void 0:V.error)!==""?`${r.value.progress.toFixed(0)}% Error setting up`:`${r.value.progress.toFixed(0)}% Setting up`:"Setup flow"}),p=C(!1),x=C(!1),h=C(!1),k=L(()=>{var b,N;const V=[[{label:"Export flow",icon:"i-heroicons-arrow-down-on-square-stack",click:()=>{o.fetchFlowDetails(o.currentFlow).then(W=>{console.debug("[DEBUG] Flow details for export: ",W);const l=new Blob([JSON.stringify(W==null?void 0:W.flow_comfy)],{type:"application/json"}),s=window.URL.createObjectURL(l),U=document.createElement("a");U.href=s,U.download=`${o.currentFlow.name}.json`,U.click(),window.URL.revokeObjectURL(s)}).catch(W=>{console.debug("Failed to fetch flow details for export: ",W),i.add({title:"Failed to export flow",description:(W==null?void 0:W.details)||"Failed to fetch flow details for export"})})}}],[{label:"Delete flow",icon:"i-heroicons-trash",click:P}]];return((b=o==null?void 0:o.currentFlow)==null?void 0:b.new_version_available)!==""&&V[0].unshift({label:`Update to ${o.currentFlow.new_version_available}`,icon:"i-heroicons-arrow-path",click:()=>{o.updateFlow(o.currentFlow)}}),(N=o==null?void 0:o.currentFlow)!=null&&N.lora_connect_points&&Object.keys(o.currentFlow.lora_connect_points).length>0&&V[0].unshift({label:"Modify flow",icon:"i-heroicons-plus-circle",click:()=>{h.value=!0}}),V});function S(V,b=!1){p.value=!0,o.deleteFlow(V).then(()=>{b&&Rt().push("/")}).finally(()=>{p.value=!1,x.value=!1})}function P(){var b;const V=((b=o.currentFlow)==null?void 0:b.private)||!1;if(V){x.value=!0;return}S(o.currentFlow,V)}const $=C(!1),z=C(null),T=function(V){var b;(b=z.value)==null||b.copyPromptInputs(V)},R=dt(),m=L(()=>{var V;return(V=o.currentFlow)==null?void 0:V.models.filter(b=>b.installed).reduce((b,N)=>b+(N==null?void 0:N.file_size)||0,0)}),g=L(()=>{var V;return(V=o.currentFlow)==null?void 0:V.models.reduce((b,N)=>b+(N==null?void 0:N.file_size)||0,0)}),F=L(()=>!m.value&&!g.value?"":m.value===g.value?` - ${Oe(g.value)}`:` - ${Oe(m.value)} / ${Oe(g.value)}`);return(V,b)=>{const N=xe,W=De,l=Ee,s=de,U=Ze,H=Mt,Z=bo,ee=No,re=Nl,ce=Pt,se=Re,te=ia,ye=nn;return u(),_(ye,null,{default:y(()=>{var we;return[!t(o).loading.flows_available&&!t(o).loading.flows_installed&&t(o).currentFlow&&!t(o).$state.loading.tasks_history?(u(),j(ae,{key:0},[w("div",ra,[w("div",ua,[f(H,{as:"div",class:"w-full mb-5"},on({header:y(()=>{var Q,me;return[w("h2",{class:"text-xl font-bold cursor-pointer select-none flex items-center",onClick:b[0]||(b[0]=()=>{$.value=!t($)})},[(Q=t(o).currentFlow)!=null&&Q.private?(u(),_(W,{key:0,text:"This flow is local, manually added"},{default:y(()=>{var ue;return[f(N,{name:"i-heroicons-lock-closed",class:ne(["mr-2",{"text-stone-500":!((ue=t(o).currentFlow)!=null&&ue.is_supported_by_workers)}])},null,8,["class"])]}),_:1})):I("",!0),f(N,{name:t($)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),f(W,{text:(me=t(o).currentFlow)!=null&&me.is_supported_by_workers?"":"No workers capable of running this flow",popper:{placement:"top"}},{default:y(()=>{var ue,q;return[w("span",{class:ne({"text-stone-500":!((ue=t(o).currentFlow)!=null&&ue.is_supported_by_workers)})},J((q=t(o).currentFlow)==null?void 0:q.display_name),3)]}),_:1},8,["text"])])]}),default:y(()=>{var Q,me,ue,q,v,M,A,G,O,X,D,Y,ve,Pe,be,Ue,Xe;return[t($)?I("",!0):(u(),j("div",da,[w("p",ca,J((Q=t(o).currentFlow)==null?void 0:Q.description),1),w("p",ma,[f(N,{name:"i-heroicons-user-16-solid",class:"mr-1"}),b[9]||(b[9]=w("b",null,"Author:",-1)),b[10]||(b[10]=E(" ")),w("a",{class:"hover:underline text-md",href:(me=t(o).currentFlow)==null?void 0:me.homepage,rel:"noopener",target:"_blank"},J((ue=t(o).currentFlow)==null?void 0:ue.author),9,fa)]),w("p",pa,[f(N,{name:"i-heroicons-document-text",class:"mr-1"}),(q=t(o).currentFlow)!=null&&q.documentation?(u(),j("a",{key:0,class:"hover:underline",href:(v=t(o).currentFlow)==null?void 0:v.documentation,rel:"noopener",target:"_blank"}," Documentation ",8,ga)):(u(),j("span",va,"No documentation"))]),w("p",ha,[f(N,{name:"i-heroicons-clock",class:"mr-1"}),b[11]||(b[11]=w("b",null,"Version:",-1)),b[12]||(b[12]=E(" ")),w("span",null,J((M=t(o).currentFlow)==null?void 0:M.version),1),((A=t(o).currentFlow)==null?void 0:A.new_version_available)!==""?(u(),j("span",wa," (new version available: "+J((G=t(o).currentFlow)==null?void 0:G.new_version_available)+") ",1)):I("",!0)]),w("p",ya,[f(N,{name:"i-heroicons-tag",class:"mr-1"}),b[13]||(b[13]=w("b",null,"Tags:",-1)),b[14]||(b[14]=E(" ")),((O=t(o).currentFlow)==null?void 0:O.tags.length)>0?(u(!0),j(ae,{key:0},ge((X=t(o).currentFlow)==null?void 0:X.tags,le=>(u(),_(l,{key:le,label:le,color:"white",variant:"solid",class:"m-1"},null,8,["label"]))),128)):(u(),_(l,{key:1,label:"No tags",color:"white",variant:"solid",class:"m-1"}))]),((Y=(D=t(o).currentFlow)==null?void 0:D.models)==null?void 0:Y.length)>0?(u(),j("p",ba,[f(N,{name:"i-heroicons-arrow-down-on-square-stack",class:"mr-1"}),f(W,{text:t(g)-t(m)>0?`${("formatBytes"in V?V.formatBytes:t(Oe))(t(g)-t(m))} to download`:"All models installed",popper:{placement:"top"}},{default:y(()=>{var le;return[w("b",null,"Models ("+J((le=t(o).currentFlow)==null?void 0:le.models.length)+J(t(F))+"):",1),b[15]||(b[15]=E(" "))]}),_:1},8,["text"]),(u(!0),j(ae,null,ge((ve=t(o).currentFlow)==null?void 0:ve.models,le=>(u(),_(l,{key:le.name,class:"m-1",color:"white",variant:"solid"},{default:y(()=>[f(W,{text:le.installed?"Model installed":"Model not installed"},{default:y(()=>[f(N,{name:le.installed?"i-heroicons-check-circle-20-solid":"i-heroicons-x-mark-20-solid",class:ne(le.installed?"text-green-500":"text-orange-500")},null,8,["name","class"])]),_:2},1032,["text"]),le.gated?(u(),_(W,{key:0,text:"Gated model, requires auth token for download",popper:{placement:"top"}},{default:y(()=>[f(N,{name:"i-heroicons-key",class:"mr-1"})]),_:1})):I("",!0),w("a",{class:"hover:underline underline-offset-4",href:le.homepage,rel:"noopener",target:"_blank"},J(le.name),9,ka),le.file_size?(u(),j("span",xa," ("+J(("formatBytes"in V?V.formatBytes:t(Oe))(le.file_size))+") ",1)):I("",!0)]),_:2},1024))),128))])):I("",!0),w("p",_a,[f(N,{name:"i-mdi-help-network-outline",class:"mr-1"}),b[18]||(b[18]=w("b",null,"Platforms:",-1)),b[19]||(b[19]=E(" ")),f(W,{text:"Linux"},{default:y(()=>[f(N,{name:"i-mdi-linux",class:"mr-1"})]),_:1}),f(W,{text:"Microsoft Windows"},{default:y(()=>[f(N,{name:"i-mdi-microsoft-windows",class:"mr-1"})]),_:1}),t(o).currentFlow.is_macos_supported?(u(),_(W,{key:0,text:"macOS"},{default:y(()=>[f(N,{name:"i-mdi-apple",class:"mr-1"})]),_:1})):I("",!0),(Pe=t(o).currentFlow)!=null&&Pe.required_memory_gb?(u(),_(W,{key:1,class:"flex flex-row items-center",text:"Required VRAM memory (GB)"},{default:y(()=>{var le;return[b[16]||(b[16]=E(" (")),f(N,{name:"i-mdi-memory",class:"mr-1"}),w("span",null,J((le=t(o).currentFlow)==null?void 0:le.required_memory_gb)+" GB",1),b[17]||(b[17]=E(") "))]}),_:1})):I("",!0)]),((Ue=(be=t(o).currentFlow)==null?void 0:be.requires)==null?void 0:Ue.length)>0?(u(),j("p",$a,[b[20]||(b[20]=w("b",null,"Requires:",-1)),b[21]||(b[21]=E(" ")),(u(!0),j(ae,null,ge((Xe=t(o).currentFlow)==null?void 0:Xe.requires,le=>(u(),_(l,{key:le,class:"m-1",color:"yellow",variant:"outline"},{default:y(()=>[E(J(le),1)]),_:2},1024))),128))])):I("",!0)]))]}),_:2},[t($)?void 0:{name:"footer",fn:y(()=>{var Q,me;return[t(R).isAdmin?(u(),j("div",Ca,[w("div",Sa,[f(N,{name:t(o).isFlowInstalled(t(n).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:ne({"text-green-500":t(o).isFlowInstalled(t(n).params.name),"text-red-500":!t(o).isFlowInstalled(t(n).params.name),"text-stone-500":t(o).isFlowInstalled(t(n).params.name)&&!((Q=t(o).currentFlow)!=null&&Q.is_supported_by_workers)})},J(t(o).isFlowInstalled(t(n).params.name)?(me=t(o).currentFlow)!=null&&me.is_supported_by_workers?"Installed":"Installed (no workers)":"Not installed"),3)]),t(o).isFlowInstalled(t(n).params.name)?I("",!0):(u(),_(W,{key:0,text:"Setup flow dependencies and configure it in ComfyUI",popper:{placement:"top"},"open-delay":500},{default:y(()=>[f(s,{icon:"i-heroicons-arrow-down-tray",class:"mx-3",color:"primary",variant:"outline",loading:t(a),onClick:b[1]||(b[1]=()=>t(o).setupFlow(t(o).currentFlow))},{default:y(()=>[E(J(t(c)),1)]),_:1},8,["loading"])]),_:1})),!t(o).isFlowInstalled(t(n).params.name)&&t(a)?(u(),_(W,{key:1,text:"Cancel flow installation",popper:{placement:"top"},"open-delay":500},{default:y(()=>[f(s,{icon:"i-heroicons-stop",variant:"outline",color:"orange",loading:t(d),onClick:b[2]||(b[2]=()=>{d.value=!0,t(o).cancelFlowSetup(t(o).currentFlow).then(()=>{d.value=!1})})},{default:y(()=>b[22]||(b[22]=[E(" Cancel ")])),_:1},8,["loading"])]),_:1})):I("",!0),t(o).isFlowInstalled(t(n).params.name)?(u(),_(U,{key:2,items:t(k),mode:"click",label:"Actions",popper:{placement:"bottom-end"}},{default:y(()=>[f(s,{color:"white",label:"Actions","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:1},8,["items"])):I("",!0)])):(u(),j("div",Ia,[w("div",Ra,[w("div",Ma,[f(N,{name:t(o).isFlowInstalled(t(n).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:ne({"text-green-500":t(o).isFlowInstalled(t(n).params.name),"text-red-500":!t(o).isFlowInstalled(t(n).params.name)})},J(t(o).isFlowInstalled(t(n).params.name)?"Installed":"Not installed"),3)]),t(o).isFlowInstalled(t(n).params.name)?I("",!0):(u(),j("div",Fa,b[23]||(b[23]=[w("p",{class:"text-orange-500"},"Only admin can manage workflows.",-1),w("span",{class:"text-slate-500"},"Ask your admin to setup this workflow",-1)])))])]))]}),key:"0"}]),1024)]),w("div",Pa,[!t(p)&&t(o).isFlowInstalled(t(n).params.name)?(u(),_(Z,{key:0,ref_key:"workflowPrompt",ref:z},null,512)):I("",!0)])]),!t(p)&&t(o).isFlowInstalled(t(n).params.name)?(u(),_(ee,{key:0})):I("",!0),!t(p)&&t(o).isFlowInstalled(t(n).params.name)||t(o).flowResultsByName(t(n).params.name).length>0?(u(),_(re,{key:1,onCopyPromptInputs:b[3]||(b[3]=Q=>T(Q))})):I("",!0)],64)):(u(),_(ce,{key:1,class:"mb-3"})),f(se,{modelValue:t(x),"onUpdate:modelValue":b[7]||(b[7]=Q=>K(x)?x.value=Q:null),"prevent-close":""},{default:y(()=>[f(H,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:y(()=>[w("div",Ua,[b[24]||(b[24]=w("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Confirm workflow deletion ",-1)),f(s,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:b[4]||(b[4]=Q=>x.value=!1)})])]),default:y(()=>{var Q;return[w("p",za,[b[25]||(b[25]=E(" Are you sure you want to delete the ")),b[26]||(b[26]=w("b",null,"private",-1)),b[27]||(b[27]=E(" workflow ")),w("b",null,J((Q=t(o).currentFlow)==null?void 0:Q.display_name),1),b[28]||(b[28]=E("? "))]),w("div",Oa,[f(s,{icon:"i-heroicons-x-mark-16-solid",variant:"outline",color:"green",class:"mr-2",onClick:b[5]||(b[5]=me=>x.value=!1)},{default:y(()=>b[29]||(b[29]=[E(" Cancel ")])),_:1}),f(s,{icon:"i-heroicons-trash",variant:"outline",color:"red",onClick:b[6]||(b[6]=me=>{var ue;return S(t(o).currentFlow,((ue=t(o).currentFlow)==null?void 0:ue.private)||!1)})},{default:y(()=>b[30]||(b[30]=[E(" Delete ")])),_:1})])]}),_:1})]),_:1},8,["modelValue"]),t(R).isAdmin&&((we=t(o))!=null&&we.currentFlow)?(u(),_(te,{key:2,show:t(h),"onUpdate:show":b[8]||(b[8]=Q=>K(h)?h.value=Q:null),flow:t(o).currentFlow},null,8,["show","flow"])):I("",!0)]}),_:1})}}});export{Ha as default};
