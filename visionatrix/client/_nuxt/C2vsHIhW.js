import{B as ot,W as Nt,C as Ce,_ as at,f as oe,c as O,o as u,a as w,D as Oe,E as Re,n as le,H as st,I as Be,N as C,X as it,S as Se,v as we,Y as Bt,x as B,K as Je,J as ze,Z as Lt,$ as At,a0 as ft,a1 as nt,a2 as qt,a3 as Et,a4 as pt,a5 as Le,a6 as wt,a7 as Dt,p as t,a8 as Wt,a9 as rt,aa as Ht,ab as yt,ac as Ae,ad as je,g as pe,M as Qe,T as bt,ae as Ne,i as _,k as R,w as b,b as f,F as se,r as ve,m as de,d as A,P as J,af as Gt,s as Me,ag as Xt,t as X,ah as Ke,Q as kt,j as Ee,q as ut,z as Jt,O as Ve,h as xe,y as xt,ai as _t,l as De,aj as dt,ak as Qt,al as Kt,am as Yt,R as lt,an as $t,ao as Ct,ap as fe,aq as St,ar as Zt,G as en,as as It,at as tn,A as nn,au as ln}from"./Rsvhu1j3.js";import{b as Ye,a as on,_ as Rt}from"./Z7VSA_rw.js";import{u as Mt,_ as We}from"./BcsIGg2v.js";import{_ as an}from"./D9uBdSpS.js";import{_ as He}from"./Cut4ek6p.js";import{_ as Ie,a as sn}from"./BvFXtqyB.js";import{_ as Ze}from"./WF-SCiZx.js";import{a as Ge,_ as Ft}from"./2WSBSAP_.js";import{_ as ct}from"./C8Ddke5T.js";import{_ as rn}from"./Dd7WUycc.js";import{_ as un}from"./FnphtGz4.js";const dn={wrapper:"relative",container:"relative w-full flex overflow-x-auto snap-x snap-mandatory scroll-smooth",item:"flex flex-none snap-center",arrows:{wrapper:"flex items-center justify-between"},indicators:{wrapper:"absolute flex items-center justify-center gap-3 bottom-4 inset-x-0",base:"rounded-full h-3 w-3",active:"bg-primary-500 dark:bg-primary-400",inactive:"bg-gray-100 dark:bg-gray-800"},default:{prevButton:{color:"black",class:"rtl:[&_span:first-child]:rotate-180 absolute start-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-left-20-solid"},nextButton:{color:"black",class:"rtl:[&_span:last-child]:rotate-180 absolute end-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-right-20-solid"}}},cn={wrapper:"relative w-full flex items-center",base:"w-full absolute appearance-none cursor-pointer disabled:cursor-not-allowed disabled:bg-opacity-50 focus:outline-none peer group",rounded:"rounded-lg",background:"bg-transparent",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",progress:{base:"absolute pointer-events-none peer-disabled:bg-opacity-50",rounded:"rounded-s-lg",background:"bg-{color}-500 dark:bg-{color}-400",size:{"2xs":"h-px",xs:"h-0.5",sm:"h-1",md:"h-2",lg:"h-3",xl:"h-4","2xl":"h-5"}},thumb:{base:"[&::-webkit-slider-thumb]:relative [&::-moz-range-thumb]:relative [&::-webkit-slider-thumb]:z-[1] [&::-moz-range-thumb]:z-[1] [&::-webkit-slider-thumb]:appearance-none [&::-moz-range-thumb]:appearance-none [&::-webkit-slider-thumb]:rounded-full [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:border-0",color:"text-{color}-500 dark:text-{color}-400",background:"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:dark:bg-gray-900 [&::-moz-range-thumb]:bg-current",ring:"[&::-webkit-slider-thumb]:ring-2 [&::-webkit-slider-thumb]:ring-current",size:{"2xs":"[&::-webkit-slider-thumb]:h-1.5 [&::-moz-range-thumb]:h-1.5 [&::-webkit-slider-thumb]:w-1.5 [&::-moz-range-thumb]:w-1.5 [&::-webkit-slider-thumb]:mt-[-2.5px] [&::-moz-range-thumb]:mt-[-2.5px]",xs:"[&::-webkit-slider-thumb]:h-2 [&::-moz-range-thumb]:h-2 [&::-webkit-slider-thumb]:w-2 [&::-moz-range-thumb]:w-2 [&::-webkit-slider-thumb]:mt-[-3px] [&::-moz-range-thumb]:mt-[-3px]",sm:"[&::-webkit-slider-thumb]:h-3 [&::-moz-range-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-moz-range-thumb]:w-3 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",md:"[&::-webkit-slider-thumb]:h-4 [&::-moz-range-thumb]:h-4 [&::-webkit-slider-thumb]:w-4 [&::-moz-range-thumb]:w-4 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",lg:"[&::-webkit-slider-thumb]:h-5 [&::-moz-range-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 [&::-moz-range-thumb]:w-5 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",xl:"[&::-webkit-slider-thumb]:h-6 [&::-moz-range-thumb]:h-6 [&::-webkit-slider-thumb]:w-6 [&::-moz-range-thumb]:w-6 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1","2xl":"[&::-webkit-slider-thumb]:h-7 [&::-moz-range-thumb]:h-7 [&::-webkit-slider-thumb]:w-7 [&::-moz-range-thumb]:w-7 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1"}},track:{base:"[&::-webkit-slider-runnable-track]:group-disabled:bg-opacity-50 [&::-moz-range-track]:group-disabled:bg-opacity-50",background:"[&::-webkit-slider-runnable-track]:bg-gray-200 [&::-moz-range-track]:bg-gray-200 [&::-webkit-slider-runnable-track]:dark:bg-gray-700 [&::-moz-range-track]:dark:bg-gray-700",rounded:"[&::-webkit-slider-runnable-track]:rounded-lg [&::-moz-range-track]:rounded-lg",size:{"2xs":"[&::-webkit-slider-runnable-track]:h-px [&::-moz-range-track]:h-px",xs:"[&::-webkit-slider-runnable-track]:h-0.5 [&::-moz-range-track]:h-0.5",sm:"[&::-webkit-slider-runnable-track]:h-1 [&::-moz-range-track]:h-1",md:"[&::-webkit-slider-runnable-track]:h-2 [&::-moz-range-track]:h-2",lg:"[&::-webkit-slider-runnable-track]:h-3 [&::-moz-range-track]:h-3",xl:"[&::-webkit-slider-runnable-track]:h-4 [&::-moz-range-track]:h-4","2xl":"[&::-webkit-slider-runnable-track]:h-5 [&::-moz-range-track]:h-5"}},size:{"2xs":"h-1.5",xs:"h-2",sm:"h-3",md:"h-4",lg:"h-5",xl:"h-6","2xl":"h-7"},default:{size:"md",color:"primary"}},$e=ot(Ce.ui.strategy,Ce.ui.textarea,Nt),mn=oe({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys($e.size).includes(e)}},color:{type:String,default:()=>$e.default.color,validator(e){return[...Ce.ui.colors,...Object.keys($e.color)].includes(e)}},variant:{type:String,default:()=>$e.default.variant,validator(e){return[...Object.keys($e.variant),...Object.values($e.color).flatMap(n=>Object.keys(n))].includes(e)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:n}){const{ui:l,attrs:s}=st("textarea",Be(e,"ui"),$e,Be(e,"class")),{emitFormBlur:r,emitFormInput:a,inputId:d,color:c,size:p,name:$}=Mt(e,$e),y=C(it({},e.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),x=C(null),I=()=>{var v;e.autofocus&&((v=x.value)==null||v.focus())},F=()=>{if(e.autoresize){if(!x.value)return;x.value.rows=e.rows;const v=x.value.style.overflow;x.value.style.overflow="hidden";const k=window.getComputedStyle(x.value),g=Number.parseInt(k.paddingTop),N=Number.parseInt(k.paddingBottom),E=g+N,te=Number.parseInt(k.lineHeight),{scrollHeight:o}=x.value,i=(o-E)/te;i>e.rows&&(x.value.rows=e.maxrows?Math.min(i,e.maxrows):i),x.value.style.overflow=v}},S=v=>{y.value.trim&&(v=v.trim()),y.value.number&&(v=Lt(v)),y.value.nullify&&(v||(v=null)),n("update:modelValue",v),a()},z=v=>{F(),y.value.lazy||S(v.target.value)},j=v=>{const k=v.target.value;n("change",k),y.value.lazy&&S(k),y.value.trim&&(v.target.value=k.trim())},M=v=>{n("blur",v),r()};Se(()=>{setTimeout(()=>{I()},e.autofocusDelay)}),we(()=>e.modelValue,()=>{Bt(F)}),Se(()=>{setTimeout(()=>{I(),F()},100)});const m=B(()=>{var k,g;const v=((g=(k=l.value.color)==null?void 0:k[c.value])==null?void 0:g[e.variant])||l.value.variant[e.variant];return Je(ze(l.value.base,l.value.form,l.value.rounded,l.value.placeholder,l.value.size[p.value],e.padded?l.value.padding[p.value]:"p-0",v==null?void 0:v.replaceAll("{color}",c.value),!e.resize&&"resize-none"),e.textareaClass)});return{ui:l,attrs:s,name:$,inputId:d,textarea:x,textareaClass:m,onInput:z,onChange:j,onBlur:M}}}),fn=["id","value","name","rows","required","disabled","placeholder"];function pn(e,n,l,s,r,a){return u(),O("div",{class:le(e.ui.wrapper)},[w("textarea",Re({id:e.inputId,ref:"textarea",value:e.modelValue,name:e.name,rows:e.rows,required:e.required,disabled:e.disabled,placeholder:e.placeholder,class:e.textareaClass},e.attrs,{onInput:n[0]||(n[0]=(...d)=>e.onInput&&e.onInput(...d)),onBlur:n[1]||(n[1]=(...d)=>e.onBlur&&e.onBlur(...d)),onChange:n[2]||(n[2]=(...d)=>e.onChange&&e.onChange(...d))}),null,16,fn),Oe(e.$slots,"default")],2)}const gn=at(mn,[["render",pn]]);async function vn(e,n){return await hn(n).catch(s=>(console.error("Failed to get image meta for "+n,s+""),{width:0,height:0,ratio:0}))}async function hn(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((n,l)=>{const s=new Image;s.onload=()=>{const r={width:s.width,height:s.height,ratio:s.width/s.height};n(r)},s.onerror=r=>l(r),s.src=e})}function gt(e){return n=>n?e[n]||n:e.missingValue}function wn({formatter:e,keyMap:n,joinWith:l="/",valueMap:s}={}){e||(e=(a,d)=>`${a}=${d}`),n&&typeof n!="function"&&(n=gt(n));const r=s||{};return Object.keys(r).forEach(a=>{typeof r[a]!="function"&&(r[a]=gt(r[a]))}),(a={})=>Object.entries(a).filter(([c,p])=>typeof p<"u").map(([c,p])=>{const $=r[c];return typeof $=="function"&&(p=$(a[c])),c=typeof n=="function"?n(c):c,e(c,p)}).join(l)}function ke(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return Number.parseInt(e,10)}function yn(e=""){if(e===void 0||!e.length)return[];const n=new Set;for(const l of e.split(" ")){const s=Number.parseInt(l.replace("x",""));s&&n.add(s)}return Array.from(n)}function bn(e){if(e.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function kn(e){const n={};if(typeof e=="string")for(const l of e.split(/[\s,]+/).filter(s=>s)){const s=l.split(":");s.length!==2?n["1px"]=s[0].trim():n[s[0].trim()]=s[1].trim()}else Object.assign(n,e);return n}function xn(e){const n={options:e},l=(r,a={})=>Pt(n,r,a),s=(r,a={},d={})=>l(r,{...d,modifiers:it(a,d.modifiers||{})}).url;for(const r in e.presets)s[r]=(a,d,c)=>s(a,d,{...e.presets[r],...c});return s.options=e,s.getImage=l,s.getMeta=(r,a)=>_n(n,r,a),s.getSizes=(r,a)=>Sn(n,r,a),n.$img=s,s}async function _n(e,n,l){const s=Pt(e,n,{...l});return typeof s.getMeta=="function"?await s.getMeta():await vn(e,s.url)}function Pt(e,n,l){var $,y;if(n&&typeof n!="string")throw new TypeError(`input must be a string (received ${typeof n}: ${JSON.stringify(n)})`);if(!n||n.startsWith("data:"))return{url:n};const{provider:s,defaults:r}=$n(e,l.provider||e.options.provider),a=Cn(e,l.preset);if(n=ft(n)?n:At(n),!s.supportsAlias){for(const x in e.options.alias)if(n.startsWith(x)){const I=e.options.alias[x];I&&(n=nt(I,n.slice(x.length)))}}if(s.validateDomains&&ft(n)){const x=qt(n).host;if(!e.options.domains.find(I=>I===x))return{url:n}}const d=it(l,a,r);d.modifiers={...d.modifiers};const c=d.modifiers.format;($=d.modifiers)!=null&&$.width&&(d.modifiers.width=ke(d.modifiers.width)),(y=d.modifiers)!=null&&y.height&&(d.modifiers.height=ke(d.modifiers.height));const p=s.getImage(n,d,e);return p.format=p.format||c||"",p}function $n(e,n){const l=e.options.providers[n];if(!l)throw new Error("Unknown provider: "+n);return l}function Cn(e,n){if(!n)return{};if(!e.options.presets[n])throw new Error("Unknown preset: "+n);return e.options.presets[n]}function Sn(e,n,l){var S,z,j,M,m;const s=ke((S=l.modifiers)==null?void 0:S.width),r=ke((z=l.modifiers)==null?void 0:z.height),a=kn(l.sizes),d=(j=l.densities)!=null&&j.trim()?yn(l.densities.trim()):e.options.densities;bn(d);const c=s&&r?r/s:0,p=[],$=[];if(Object.keys(a).length>=1){for(const v in a){const k=vt(v,String(a[v]),r,c,e);if(k!==void 0){p.push({size:k.size,screenMaxWidth:k.screenMaxWidth,media:`(max-width: ${k.screenMaxWidth}px)`});for(const g of d)$.push({width:k._cWidth*g,src:ht(e,n,l,k,g)})}}In(p)}else for(const v of d){const k=Object.keys(a)[0];let g=k?vt(k,String(a[k]),r,c,e):void 0;g===void 0&&(g={size:"",screenMaxWidth:0,_cWidth:(M=l.modifiers)==null?void 0:M.width,_cHeight:(m=l.modifiers)==null?void 0:m.height}),$.push({width:v,src:ht(e,n,l,g,v)})}Rn($);const y=$[$.length-1],x=p.length?p.map(v=>`${v.media?v.media+" ":""}${v.size}`).join(", "):void 0,I=x?"w":"x",F=$.map(v=>`${v.src} ${v.width}${I}`).join(", ");return{sizes:x,srcset:F,src:y==null?void 0:y.src}}function vt(e,n,l,s,r){const a=r.options.screens&&r.options.screens[e]||Number.parseInt(e),d=n.endsWith("vw");if(!d&&/^\d+$/.test(n)&&(n=n+"px"),!d&&!n.endsWith("px"))return;let c=Number.parseInt(n);if(!a||!c)return;d&&(c=Math.round(c/100*a));const p=s?Math.round(c*s):l;return{size:n,screenMaxWidth:a,_cWidth:c,_cHeight:p}}function ht(e,n,l,s,r){return e.$img(n,{...l.modifiers,width:s._cWidth?s._cWidth*r:void 0,height:s._cHeight?s._cHeight*r:void 0},l)}function In(e){var l;e.sort((s,r)=>s.screenMaxWidth-r.screenMaxWidth);let n=null;for(let s=e.length-1;s>=0;s--){const r=e[s];r.media===n&&e.splice(s,1),n=r.media}for(let s=0;s<e.length;s++)e[s].media=((l=e[s+1])==null?void 0:l.media)||""}function Rn(e){e.sort((l,s)=>l.width-s.width);let n=null;for(let l=e.length-1;l>=0;l--){const s=e[l];s.width===n&&e.splice(l,1),n=s.width}}const Mn=wn({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,n)=>pt(e)+"_"+pt(n)}),Fn=(e,{modifiers:n={},baseURL:l}={},s)=>{n.width&&n.height&&(n.resize=`${n.width}x${n.height}`,delete n.width,delete n.height);const r=Mn(n)||"_";return l||(l=nt(s.options.nuxt.baseURL,"/_ipx")),{url:nt(l,r,Et(e))}},Pn=!0,Un=!0,zn=Object.freeze(Object.defineProperty({__proto__:null,getImage:Fn,supportsAlias:Un,validateDomains:Pn},Symbol.toStringTag,{value:"Module"})),Ut={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};Ut.providers={ipxStatic:{provider:zn,defaults:{}}};const mt=()=>{const e=wt(),n=Le();return n.$img||n._img||(n._img=xn({...Ut,nuxt:{baseURL:e.app.baseURL},runtimeConfig:e}))};function Vn(e){var n;(n=performance==null?void 0:performance.mark)==null||n.call(performance,"mark_feature_usage",{detail:{feature:e}})}const On={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},jn=e=>{const n=B(()=>({provider:e.provider,preset:e.preset})),l=B(()=>({width:ke(e.width),height:ke(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding,nonce:e.nonce})),s=mt(),r=B(()=>({...e.modifiers,width:ke(e.width),height:ke(e.height),format:e.format,quality:e.quality||s.options.quality,background:e.background,fit:e.fit}));return{options:n,attrs:l,modifiers:r}},Tn={...On,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},Nn=["src"],_e=oe({__name:"NuxtImg",props:Tn,emits:["load","error"],setup(e,{emit:n}){const l=e,s=Dt(),r=n,a=!1,d=mt(),c=jn(l),p=C(!1),$=C(),y=B(()=>d.getSizes(l.src,{...c.options.value,sizes:l.sizes,densities:l.densities,modifiers:{...c.modifiers.value,width:ke(l.width),height:ke(l.height)}})),x=B(()=>{const M={...c.attrs.value,"data-nuxt-img":""};return(!l.placeholder||p.value)&&(M.sizes=y.value.sizes,M.srcset=y.value.srcset),M}),I=B(()=>{let M=l.placeholder;if(M===""&&(M=!0),!M||p.value)return!1;if(typeof M=="string")return M;const m=Array.isArray(M)?M:typeof M=="number"?[M,M]:[10,10];return d(l.src,{...c.modifiers.value,width:m[0],height:m[1],quality:m[2]||50,blur:m[3]||3},c.options.value)}),F=B(()=>l.sizes?y.value.src:d(l.src,c.modifiers.value,c.options.value)),S=B(()=>I.value?I.value:F.value),j=Le().isHydrating;return Se(()=>{if(I.value||l.custom){const M=new Image;F.value&&(M.src=F.value),l.sizes&&(M.sizes=y.value.sizes||"",M.srcset=y.value.srcset),M.onload=m=>{p.value=!0,r("load",m)},M.onerror=m=>{r("error",m)},Vn("nuxt-image");return}$.value&&($.value.complete&&j&&($.value.getAttribute("data-error")?r("error",new Event("error")):r("load",new Event("load"))),$.value.onload=M=>{r("load",M)},$.value.onerror=M=>{r("error",M)})}),(M,m)=>M.custom?Oe(M.$slots,"default",Wt(Re({key:1},{...t(a)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...x.value,...t(s)},isLoaded:p.value,src:S.value}))):(u(),O("img",Re({key:0,ref_key:"imgEl",ref:$,class:l.placeholder&&!p.value?l.placeholderClass:void 0},{...t(a)?{onerror:"this.setAttribute('data-error', 1)"}:{},...x.value,...t(s)},{src:S.value}),null,16,Nn))}}),Xe=ot(Ce.ui.strategy,Ce.ui.range,cn),Bn=oe({inheritAttrs:!1,props:{modelValue:{type:Number,default:0},id:{type:String,default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},size:{type:String,default:null,validator(e){return Object.keys(Xe.size).includes(e)}},color:{type:String,default:()=>Xe.default.color,validator(e){return Ce.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:n}){const{ui:l,attrs:s}=st("range",Be(e,"ui"),Xe),{emitFormChange:r,inputId:a,color:d,size:c,name:p}=Mt(e,Xe),$=B({get(){return e.modelValue},set(M){n("update:modelValue",M)}}),y=M=>{n("change",M.target.value),r()},x=B(()=>Je(ze(l.value.wrapper,l.value.size[c.value]),e.class)),I=B(()=>Je(ze(l.value.base,l.value.background,l.value.rounded,d.value&&l.value.ring.replaceAll("{color}",d.value),l.value.size[c.value]),e.inputClass)),F=B(()=>ze(l.value.thumb.base,d.value&&l.value.thumb.color.replaceAll("{color}",d.value),l.value.thumb.ring,l.value.thumb.background,l.value.thumb.size[c.value])),S=B(()=>ze(l.value.track.base,l.value.track.background,l.value.track.rounded,l.value.track.size[c.value])),z=B(()=>ze(l.value.progress.base,l.value.progress.rounded,d.value&&l.value.progress.background.replaceAll("{color}",d.value),l.value.progress.size[c.value])),j=B(()=>{const{modelValue:M,min:m,max:v}=e;return{width:`${(Math.max(m,Math.min(M,v))-m)/(v-m)*100}%`}});return{ui:l,attrs:s,name:p,inputId:a,value:$,wrapperClass:x,inputClass:I,thumbClass:F,trackClass:S,progressClass:z,progressStyle:j,onChange:y}}}),Ln=["id","name","min","max","disabled","step"];function An(e,n,l,s,r,a){return u(),O("div",{class:le(e.wrapperClass)},[rt(w("input",Re({id:e.inputId,ref:"input","onUpdate:modelValue":n[0]||(n[0]=d=>e.value=d),name:e.name,min:e.min,max:e.max,disabled:e.disabled,step:e.step,type:"range",class:[e.inputClass,e.thumbClass,e.trackClass]},e.attrs,{onChange:n[1]||(n[1]=(...d)=>e.onChange&&e.onChange(...d))}),null,16,Ln),[[Ht,e.value,void 0,{number:!0}]]),w("span",{class:le(e.progressClass),style:yt(e.progressStyle)},null,6)],2)}const zt=at(Bn,[["render",An]]),qn={class:"image-mask flex flex-col w-full"},En={class:"canvas flex flex-col items-center justify-center mb-3 w-full"},Dn={class:"preview-over-original relative"},Wn={class:"actions flex items-center justify-center mb-3 mx-auto"},Hn={class:"options w-full max-w-[320px]"},Gn=oe({__name:"ImageInpaint",props:Ae({imageSrc:{type:String,required:!0}},{imageInpaintMask:{default:"",type:String},imageInpaintMaskModifiers:{},imageInpaintMaskData:{default:{},type:Object},imageInpaintMaskDataModifiers:{}}),emits:["update:imageInpaintMask","update:imageInpaintMaskData"],setup(e){const n=e,l=je(e,"imageInpaintMask"),s=je(e,"imageInpaintMaskData"),r=pe(),a=C(null),d=C(null),c=C(null),p=C(null),$=C(30),y=C([]),x=C({width:r.$state.outputMaxSize,height:r.$state.outputMaxSize}),I=C(null),F=C({x:0,y:0}),S=C({x:0,y:0,radius:$.value,fill:"rgba(255, 255, 255, 0.5)",stroke:null,strokeWidth:0,visible:!1}),z=C(5),j=C(!1),M=C([]),m=C([]);function v(){if(!a.value||!c.value){console.error("Could not get stage, image layer, or mask layer");return}const h=a.value.getNode(),P=p.value?p.value.width:h.width(),L=p.value?p.value.height:h.height(),H=document.createElement("canvas");H.width=P,H.height=L;const U=H.getContext("2d");if(!U){console.error("Could not get 2d context for mask canvas");return}U.fillStyle="black",U.fillRect(0,0,P,L);const G=P/h.width(),D=L/h.height();U.fillStyle="white",y.value.forEach(he=>{U.beginPath(),U.arc(he.x*G,he.y*D,he.radius*Math.max(G,D),0,Math.PI*2,!0),U.closePath(),U.fill()});const Q=H.toDataURL("image/png",1);Q?(i(),l.value=Q,S.value.visible=!1,j.value=!1):console.error("Could not get data URI for masked image")}function k(h){const P=a.value.getNode();if(h.type.startsWith("touch")){const L=h.evt.touches[0]||h.evt.changedTouches[0];return{x:L.clientX-P.getContainer().offsetLeft,y:L.clientY-P.getContainer().offsetTop}}return P.getPointerPosition()}function g(h){h.type==="mousedown"&&h.evt.button!==0||(j.value=!0,F.value=k(h),o(),N(F.value))}function N(h){const P={x:h.x,y:h.y,radius:$.value,fill:"rgba(255, 255, 255, 1)"};y.value=y.value.filter(L=>!(E({x:L.x,y:L.y},h)+L.radius<=P.radius)),y.value.push(P)}function E(h,P){return Math.sqrt(Math.pow(P.x-h.x,2)+Math.pow(P.y-h.y,2))}function te(h){if(h.type.startsWith("touch")&&h.evt.preventDefault(),ye(h),!j.value)return;const P=k(h);E(F.value,k(h))>=z.value&&(N(P),F.value=P)}function o(){M.value.push([...y.value]),m.value=[]}function i(){s.value={circles:[...y.value],brushRadius:$.value,undoStack:M.value,redoStack:m.value}}function V(){s.value!==null&&(y.value=s.value.circles||[],$.value=s.value.brushRadius||30,M.value=s.value.undoStack||[],m.value=s.value.redoStack||[])}function W(){M.value.length!==0&&(m.value.push([...y.value]),y.value=M.value.pop()||[])}function K(){m.value.length!==0&&(M.value.push([...y.value]),y.value=m.value.pop()||[])}function Z(){j.value=!1}function ue(){l.value=""}function me(){o(),y.value=[],l.value=""}const ie=B(()=>M.value.length>0),ne=B(()=>m.value.length>0);function ye(h){const P=k(h);S.value.x=P.x,S.value.y=P.y}function ee(){S.value.visible=!1,j.value=!1}function Y(){S.value.visible=!0,S.value.radius=$.value}function ce(){const h=new Image;h.src=n.imageSrc,h.onload=()=>{p.value=h,ge(),q()}}function ge(){if(!p.value)return;const h=window.innerWidth,P=window.innerHeight,L=p.value.width/p.value.height;let H,U;const G=Math.min(h*.9,1200),D=Math.min(P*.8,r.outputMaxSize);L>G/D?(H=G,U=H/L):(U=D,H=U*L),x.value={width:Math.floor(H),height:Math.floor(U)},q()}function q(){const h=x.value.width,P=x.value.height,L=p.value.width,H=p.value.height,U=h/L,G=P/H,D=Math.min(U,G);I.value={x:0,y:0,width:L*D,height:H*D}}return Qe(()=>{ce(),V()}),Se(()=>{if(a.value){const h=a.value.getNode();h.on("touchstart",g),h.on("touchmove",te),h.on("touchend",Z),h.on("touchcancel",ee)}}),bt(()=>{if(a.value){const h=a.value.getNode();h.off("touchstart"),h.off("touchmove"),h.off("touchend"),h.off("touchcancel")}i()}),(h,P)=>{const L=_e,H=Ne("v-image"),U=Ne("v-layer"),G=Ne("v-circle"),D=Ne("v-stage"),Q=de,he=zt,Pe=He;return u(),O("div",qn,[w("div",En,[P[1]||(P[1]=w("p",{class:"text-sm my-2 text-slate-500"},"Select the target area for image inpaint",-1)),w("div",Dn,[e.imageSrc&&e.imageSrc!==""&&l.value!==""?(u(),_(L,{key:0,src:e.imageSrc,fit:"inside",width:t(x).width,height:t(x).height,draggable:"false",class:le({absolute:l.value!==""})},null,8,["src","width","height","class"])):R("",!0),l.value?(u(),_(L,{key:1,src:l.value,fit:"inside",width:t(x).width,height:t(x).height,draggable:"false",class:"opacity-50"},null,8,["src","width","height"])):R("",!0)]),l.value===""?(u(),_(D,{key:0,ref_key:"stageRef",ref:a,config:t(x),onMousedown:g,onMousemove:te,onMouseup:Z,onMouseleave:ee,onMouseenter:Y},{default:b(()=>[f(U,{ref_key:"imageLayerRef",ref:d},{default:b(()=>[f(H,{image:t(p),config:t(x)},null,8,["image","config"])]),_:1},512),f(U,{ref_key:"maskLayerRef",ref:c},{default:b(()=>[(u(!0),O(se,null,ve(t(y),(be,Ue)=>(u(),_(G,{key:Ue,config:be},null,8,["config"]))),128)),t(S).visible?(u(),_(G,{key:0,config:t(S)},null,8,["config"])):R("",!0)]),_:1},512)]),_:1},8,["config"])):R("",!0)]),w("div",Wn,[f(Q,{class:"mr-2",size:"xs",icon:"i-heroicons-clipboard-document-check-16-solid",variant:"soft",disabled:t(y).length===0||l.value!=="",onClick:v},{default:b(()=>P[2]||(P[2]=[A(" Apply ")])),_:1},8,["disabled"]),f(Q,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-left-16-solid",variant:"soft",color:"cyan",disabled:!t(ie)||l.value!=="",onClick:W},null,8,["disabled"]),f(Q,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-right-16-solid",variant:"soft",color:"cyan",disabled:!t(ne)||l.value!=="",onClick:K},null,8,["disabled"]),f(Q,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-turn-up-left-20-solid",variant:"soft",disabled:t(y).length===0&&l.value==="",color:"red",onClick:me},{default:b(()=>P[3]||(P[3]=[A(" Reset ")])),_:1},8,["disabled"]),f(Q,{size:"xs",icon:"i-heroicons-pencil-solid",variant:"soft",disabled:l.value==="",color:"orange",onClick:ue},{default:b(()=>P[4]||(P[4]=[A(" Edit ")])),_:1},8,["disabled"])]),w("div",Hn,[f(Pe,{class:"mb-3 text-sm",hint:`value: ${t($)}`,label:"Brush radius"},{default:b(()=>[f(he,{modelValue:t($),"onUpdate:modelValue":P[0]||(P[0]=be=>J($)?$.value=be:null),min:1,max:100,size:"sm",class:"my-2",disabled:l.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["hint"])])])}}});function qe(e={}){const{copy:n,isSupported:l}=Gt(),s=Me();function r(a,d={},c={}){l&&n(a).then(()=>{!d.title&&!d.description||s.add({...d,...e})},function(p){s.add({...c,description:c.description||p.message,...e})})}return{copy:r}}const Xn="0.05";function Jn(e,n){const l=parseFloat(e);if(isNaN(l))return e;const s=l+n;return s<0?"0":String(Number(s.toFixed(10)))}function Qn(e,n){let l=n,s=n,r=0,a=0;for(;l>=0&&(l--,!(e[l]==="("&&r===a));)e[l]==="("&&r++,e[l]===")"&&a++;if(l<0)return!1;for(r=0,a=0;s<e.length&&!(e[s]===")"&&r===a);)e[s]==="("&&r++,e[s]===")"&&a++,s++;return s===e.length?!1:{start:l+1,end:s}}function Kn(e){const n=/^\((.*)\)$/,l=e.match(n),s=/:([+-]?(\d*\.)?\d+([eE][+-]?\d+)?)/,r=e.match(s);return l&&!r?`(${l[1]}:1.0)`:e}function Yn(e){const n=e.composedPath()[0],l=parseFloat(Xn);if(n.tagName!=="TEXTAREA"||!(e.key==="ArrowUp"||e.key==="ArrowDown")||!e.ctrlKey&&!e.metaKey)return;e.preventDefault();let s=n.selectionStart,r=n.selectionEnd,a=n.value.substring(s,r);if(!a){const p=Qn(n.value,s);if(p)s=p.start,r=p.end,a=n.value.substring(s,r);else{const $=" .,\\/!?%^*;:{}=-_`~()\r\n	";for(;!$.includes(n.value[s-1])&&s>0;)s--;for(;!$.includes(n.value[r])&&r<n.value.length;)r++;if(a=n.value.substring(s,r),!a)return}}a[a.length-1]===" "&&(a=a.substring(0,a.length-1),r-=1),n.value[s-1]==="("&&n.value[r]===")"&&(s-=1,r+=1,a=n.value.substring(s,r)),(a[0]!=="("||a[a.length-1]!==")")&&(a=`(${a})`),a=Kn(a);const d=e.key==="ArrowUp"?l:-l,c=a.replace(/\((.*):(\d+(?:\.\d+)?)\)/,(p,$,y)=>(y=Jn(y,d),Number(y)==1?$:`(${$}:${y})`));return n.setRangeText(c,s,r,"select"),n.value}const Zn={key:0,class:"text-red-300"},el={class:"flex items-center"},tl={class:"p-2 max-w-48 max-h-48 not-italic"},nl={class:"block font-medium text-gray-700 dark:text-gray-200"},ll={key:0,class:"flex items-center"},ol={key:2,class:"flex flex-row flex-grow items-center justify-between"},al={key:3,class:"flex flex-row flex-grow items-center"},sl={class:"sm:inline"},il={class:"preview-over-original relative"},rl={key:1,class:"text-red-300 text-sm"},ul=oe({__name:"InputParam",props:{inputParam:{type:Object,required:!0},index:{type:Number,required:!0},inputParamsMap:{type:Array,required:!0},advanced:{type:Boolean,default:!1}},setup(e){const n=e,l=wt(),s=Xt(),r=B(()=>s.selectedFiles[n.inputParam.name]?s.selectedFiles[n.inputParam.name]:null),a=B(()=>{var i;return r.value?`${window.location.origin}/index.php/core/preview?fileId=${(i=r.value)==null?void 0:i.id}&mimeFallback=true&a=1`:""}),d=B(()=>r.value?r.value.source:"");we(r,o=>{o?(n.inputParamsMap[n.index][n.inputParam.name].value=o,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url=d.value,n.inputParamsMap[n.index][n.inputParam.name].nc_file=!0):(n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url="",n.inputParamsMap[n.index][n.inputParam.name].nc_file=!1)});const c=C(!1),p=C(null),$=C(""),y=C({width:0,height:0}),x=C(""),I=C({}),F=C(null),S=n.inputParamsMap[n.index][n.inputParam.name].source_input_name,z=n.inputParamsMap.findIndex(o=>{if(Object.keys(o)[0]===n.inputParamsMap[n.index][n.inputParam.name].source_input_name)return!0});function j(){try{const o=n.inputParamsMap.find(i=>{const V=Object.keys(i)[0];if(V===S)return i[V]});g(o[S].value)}catch{y.value.width=0,y.value.height=0}}Se(()=>{n.inputParam.type==="range_scale"&&j(),n.inputParam.type==="image-mask"&&we(x,o=>{const i=new File([x.value],`image-mask-${n.inputParam.name}.png`,{type:"image/png"});n.inputParamsMap[n.index][n.inputParam.name].value=i,n.inputParamsMap[n.index][n.inputParam.name].mask_applied=o!==""})}),n.inputParam.type==="range_scale"&&we(n.inputParamsMap,()=>{j()});function M(o){return o?URL.createObjectURL(o):""}function m(){URL.revokeObjectURL($.value),$.value="",p.value&&(p.value.$refs.input.value=""),n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].image_preview_url=""}function v(){URL.revokeObjectURL(x.value),x.value="",I.value={},n.inputParamsMap[n.index][n.inputParam.name].value=null,n.inputParamsMap[n.index][n.inputParam.name].mask_applied=!1}const k=B(()=>n.inputParam.type!=="bool"?n.inputParam.display_name:"");function g(o){if(!(o instanceof File)){y.value.width=0,y.value.height=0;return}const i=URL.createObjectURL(o),V=new Image;V.onload=function(){y.value.width=V.naturalWidth,y.value.height=V.naturalHeight,URL.revokeObjectURL(V.src)},V.src=i}const N=B(()=>{if(n.inputParam.type==="range_scale"){const o=n.inputParamsMap[n.index][n.inputParam.name].value;return`value: ${o}x (${y.value.width}x${y.value.height} -> ${(y.value.width*o).toFixed(0)}x${(y.value.height*o).toFixed(0)})`}return["range","range_scale"].includes(n.inputParam.type)?`value: ${n.inputParamsMap[n.index][n.inputParam.name].value}`:""}),E=C(null);function te(o){const i=Yn(o);i&&(n.inputParamsMap[n.index][n.inputParam.name].value=i)}return Se(()=>{n.inputParam.type==="text"&&E.value&&E.value.$refs.textarea.addEventListener("keydown",te),n.inputParam.type==="image-mask"&&(F.value=n.inputParamsMap[z][S],we(n.inputParamsMap[z][S],o=>{x.value="",I.value={},F.value=o}))}),bt(()=>{URL.revokeObjectURL($.value),URL.revokeObjectURL(x.value),s.removeSelectedFile(n.inputParam.name),n.inputParam.type==="text"&&E.value&&E.value.$refs.textarea.removeEventListener("keydown",te)}),(o,i)=>{var q,h;const V=de,W=Ee,K=kt,Z=gn,ue=We,me=an,ie=_e,ne=Gn,ye=Ie,ee=Ze,Y=Ge,ce=zt,ge=He;return(((q=e.inputParam)==null?void 0:q.advanced)||!1)===e.advanced?(u(),_(ge,{key:0,class:le(["mb-3",{italic:(h=e.inputParam)==null?void 0:h.dynamic_lora}]),help:t(N)},{hint:b(()=>[e.inputParam.optional?R("",!0):(u(),O("span",Zn,"required"))]),label:b(()=>{var P;return[w("div",el,[(P=e.inputParam)!=null&&P.dynamic_lora&&e.inputParam.trigger_words.length>0?(u(),_(K,{key:0},{panel:b(()=>[w("div",tl,[i[20]||(i[20]=w("h4",{class:"mb-2 text-center"},"Trigger words",-1)),(u(!0),O(se,null,ve(e.inputParam.trigger_words,L=>(u(),_(W,{key:L,color:"violet",class:"mr-1 cursor-pointer",onClick:()=>{("useCopyToClipboard"in o?o.useCopyToClipboard:t(qe))().copy(L),("useToast"in o?o.useToast:t(Me))().add({title:"Clipboard",description:"Trigger word copied to clipboard",timeout:2e3})}},{default:b(()=>[A(X(L),1)]),_:2},1032,["onClick"]))),128))])]),default:b(()=>[f(V,{icon:"i-heroicons-information-circle",variant:"ghost",size:"xs",color:"gray",class:"mr-2"})]),_:1})):R("",!0),w("label",nl,X(t(k)),1)])]}),default:b(()=>{var P,L,H,U,G;return[e.inputParam.type==="text"?(u(),_(Z,{key:0,ref_key:"textareaInput",ref:E,size:"md",placeholder:e.inputParam.display_name,required:!e.inputParam.optional,resize:!0,label:e.inputParam.display_name,value:e.inputParamsMap[e.index][e.inputParam.name].value,autoresize:"",variant:"outline",onInput:i[0]||(i[0]=D=>{const Q=D.target;e.inputParamsMap[e.index][e.inputParam.name].value=Q.value})},null,8,["placeholder","required","label","value"])):R("",!0),e.inputParam.type==="number"?(u(),O(se,{key:1},[e.inputParam.name==="seed"?(u(),O("div",ll,[e.inputParam.type==="number"?(u(),_(ue,{key:0,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":i[1]||(i[1]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"])):R("",!0),f(V,{icon:"i-heroicons-arrow-path",color:"violet",variant:"outline",size:"xs",class:"ml-2",onClick:i[2]||(i[2]=()=>{e.inputParamsMap[e.index][e.inputParam.name].value=Math.floor(Math.random()*1e7)})})])):(u(),_(ue,{key:1,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":i[3]||(i[3]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"]))],64)):R("",!0),e.inputParam.type==="image"?(u(),O("div",ol,[f(ue,{ref_key:"imageInput",ref:p,type:"file",accept:"image/*",class:"w-full",variant:"outline",color:"gray",disabled:t(r)!==null,label:e.inputParam.display_name,onChange:i[4]||(i[4]=D=>{console.debug("files",D);const Q=D==null?void 0:D[0];e.inputParamsMap[e.index][e.inputParam.name].value=Q,$.value=M(Q),e.inputParamsMap[e.index][e.inputParam.name].image_preview_url=t($),t(r)!==null&&t(s).removeSelectedFile(e.inputParam.name),console.debug("inputParamsMap",e.inputParamsMap)})},null,8,["disabled","label"]),t(l).app.isNextcloudIntegration?(u(),_(me,{key:0,class:"mx-2",orientation:"vertical",label:"OR"})):R("",!0),t(l).app.isNextcloudIntegration?(u(),_(V,{key:1,icon:"i-heroicons-cloud-arrow-down",variant:"outline",color:"blue",disabled:t(r)!==null||t($)!=="",title:t(r)!==null?t(r).attributes.filename:"Choose from Nextcloud",onClick:i[5]||(i[5]=()=>{t(s).openNextcloudFilePicker(e.inputParam.name)})},{default:b(()=>i[21]||(i[21]=[A(" Choose from Nextcloud ")])),_:1},8,["disabled","title"])):R("",!0),t(a)!==""?(u(),O(se,{key:2},[f(ie,{src:t(a),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:i[6]||(i[6]=()=>{c.value=!0})},null,8,["src"]),f(V,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:i[7]||(i[7]=()=>{t(s).removeSelectedFile(e.inputParam.name),t($)!==""&&m()})})],64)):t($)!==""?(u(),O(se,{key:3},[f(ie,{src:t(x)?t(x):t($),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:i[8]||(i[8]=()=>{c.value=!0})},null,8,["src"]),f(V,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:m})],64)):R("",!0)])):R("",!0),e.inputParam.type==="image-mask"?(u(),O("div",al,[t(F)?(u(),_(V,{key:0,icon:"i-heroicons-paint-brush-16-solid",class:"mr-2",color:"violet",variant:"outline",size:"xs",disabled:!((P=t(F))!=null&&P.value),onClick:i[9]||(i[9]=()=>{c.value=!0})},{default:b(()=>[w("span",sl,X(t(x)!==""?"Edit mask":"Draw mask"),1)]),_:1},8,["disabled"])):R("",!0),w("div",il,[t(F)&&((L=t(F))!=null&&L.value)?(u(),_(ie,{key:0,src:(H=t(F))==null?void 0:H.image_preview_url,class:le(["h-10 rounded-lg cursor-pointer",{absolute:t(x)!==""}]),onClick:i[10]||(i[10]=()=>{c.value=!0})},null,8,["src","class"])):R("",!0),t(x)?(u(),_(ie,{key:1,src:t(x),class:"h-10 rounded-lg cursor-pointer opacity-50",onClick:i[11]||(i[11]=()=>{c.value=!0})},null,8,["src"])):R("",!0)]),!t(F)||t(F)&&!((U=t(F))!=null&&U.value)?(u(),O("span",rl," Select source image ")):R("",!0),t(x)?(u(),_(V,{key:2,icon:"i-heroicons-x-mark",variant:"outline",color:"violet",class:"ml-2",onClick:v})):R("",!0)])):R("",!0),e.inputParam.type==="image"||e.inputParam.type==="image-mask"?(u(),_(ye,{key:4,modelValue:t(c),"onUpdate:modelValue":i[16]||(i[16]=D=>J(c)?c.value=D:null),class:"z-[90] overflow-y-auto",transition:!1,fullscreen:""},{default:b(()=>{var D;return[f(V,{class:"absolute top-4 right-4 z-[100]",icon:"i-heroicons-x-mark",variant:"ghost",onClick:i[12]||(i[12]=()=>c.value=!1)}),e.inputParam.type==="image"?(u(),O("div",{key:0,class:"flex items-center justify-center w-full h-full p-4",onClick:i[13]||(i[13]=Ke(()=>c.value=!1,["left"]))},[t($)!==""?(u(),_(ie,{key:0,class:"lg:h-full",fit:"contain",src:t($)},null,8,["src"])):R("",!0),t(a)!==""?(u(),_(ie,{key:1,class:"lg:h-full",fit:"inside",src:t(d)},null,8,["src"])):R("",!0)])):(u(),_(ne,{key:1,ref:"imageInpaint","image-inpaint-mask":t(x),"onUpdate:imageInpaintMask":i[14]||(i[14]=Q=>J(x)?x.value=Q:null),"image-inpaint-mask-data":t(I),"onUpdate:imageInpaintMaskData":i[15]||(i[15]=Q=>J(I)?I.value=Q:null),class:"flex items-center justify-center w-full h-full p-4","image-src":(D=t(F))==null?void 0:D.image_preview_url},null,8,["image-inpaint-mask","image-inpaint-mask-data","image-src"]))]}),_:1},8,["modelValue"])):R("",!0),e.inputParam.type==="list"?(u(),_(ee,{key:5,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":i[17]||(i[17]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),placeholder:e.inputParam.display_name,options:Object.keys(e.inputParam.options)},null,8,["modelValue","placeholder","options"])):R("",!0),e.inputParam.type==="bool"?(u(),_(Y,{key:6,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":i[18]||(i[18]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),label:(G=e.inputParam)==null?void 0:G.display_name},null,8,["modelValue","label"])):R("",!0),["range","range_scale"].includes(e.inputParam.type)?(u(),_(ce,{key:7,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":i[19]||(i[19]=D=>e.inputParamsMap[e.index][e.inputParam.name].value=D),label:e.inputParam.display_name,size:"sm",min:e.inputParam.min,max:e.inputParam.max,step:e.inputParam.step},null,8,["modelValue","label","min","max","step"])):R("",!0)]}),_:1},8,["class","help"])):R("",!0)}}}),dl={key:0,class:"heading"},cl={key:1},ml={key:0,class:"max-h-96 overflow-y-auto mt-5"},fl={class:"heading"},pl={key:0,class:"p-4"},gl={key:0,class:"flex items-center w-full max-w-xs"},vl=oe({__name:"InputParams",props:Ae({inputParamsMap:{type:Array,required:!0},additionalInputParamsMap:{type:Array,required:!1,default:[]},advanced:{type:Boolean,default:!1}},{profilingOptions:{default:{},type:Object},profilingOptionsModifiers:{},profilingEnabled:{default:!1,type:Boolean},profilingEnabledModifiers:{}}),emits:["update:profilingOptions","update:profilingEnabled"],setup(e){const n=e,l=pe(),s=ut(),r=Jt(),a=C(!n.advanced),d=je(e,"profilingOptions"),c=je(e,"profilingEnabled"),p=C(!0),$=B(()=>r.workers.map(y=>({value:y.worker_id,label:`${y.worker_id} (type: ${y.device_type}, vram_total: ${Ve(y.vram_total)})`})));return Qe(()=>{var x;if(!s.isAdmin)return;const y=localStorage.getItem(`profilingOptions_${(x=l.currentFlow)==null?void 0:x.name}`);y&&(d.value=JSON.parse(y)),r.fetchWorkersInfo().then(()=>{r.workers.find(F=>{var S;return F.worker_id===((S=d.value["X-WORKER-ID"])==null?void 0:S.value)})||(d.value["X-WORKER-ID"]=null)})}),(y,x)=>{const I=xe,F=ul,S=Ge,z=Ze,j=de,M=We,m=He;return u(),O(se,null,[e.advanced?(u(),O("div",dl,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:x[0]||(x[0]=()=>{a.value=!t(a)})},[f(I,{name:t(a)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",class:"mr-2"},null,8,["name"]),x[3]||(x[3]=A(" Advanced options "))])])):R("",!0),t(a)?(u(),O("div",cl,[(u(!0),O(se,null,ve(t(l).currentFlow.input_params,(v,k)=>(u(),_(F,{key:k,"input-params-map":e.inputParamsMap,index:k,"input-param":v,advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),(u(!0),O(se,null,ve(e.additionalInputParamsMap,(v,k)=>(u(),_(F,{key:Object.keys(v)[0],"input-params-map":e.additionalInputParamsMap,index:k,"input-param":v[Object.keys(v)[0]],advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),t(s).isAdmin&&e.advanced?(u(),O("div",ml,[w("div",fl,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:x[1]||(x[1]=()=>{p.value=!t(p)})},[f(I,{name:t(p)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),f(I,{name:"i-mdi-bug-outline",class:"mr-2"}),x[4]||(x[4]=A(" Execution settings "))])]),t(p)?R("",!0):(u(),O("div",pl,[f(S,{modelValue:c.value,"onUpdate:modelValue":x[2]||(x[2]=v=>c.value=v),label:"Enable Execution settings",class:"mb-3"},null,8,["modelValue"]),(u(!0),O(se,null,ve(Object.keys(d.value),v=>(u(),_(m,{key:v,label:v},{default:b(()=>[v==="X-WORKER-ID"?(u(),O("div",gl,[f(z,{modelValue:d.value[v],"onUpdate:modelValue":k=>d.value[v]=k,options:t($),placeholder:"Select worker",class:"w-full my-3"},null,8,["modelValue","onUpdate:modelValue","options"]),f(j,{icon:"i-heroicons-x-mark",variant:"outline",size:"sm",color:"orange",class:"ml-2",onClick:()=>d.value[v]=null},null,8,["onClick"]),f(j,{icon:"i-heroicons-arrow-path-solid",variant:"outline",size:"sm",color:"blue",class:"ml-2",onClick:()=>{t(r).fetchWorkersInfo().then(()=>{d.value[v]=t($).find(k=>{var g;return k.value===((g=d.value[v])==null?void 0:g.value)})})}},null,8,["onClick"])])):(u(),_(M,{key:1,modelValue:d.value[v],"onUpdate:modelValue":k=>d.value[v]=k,placeholder:"Enter value",class:"my-3"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))]))])):R("",!0)])):R("",!0)],64)}}}),hl={key:0,id:"prompt",class:"w-full my-10 lg:my-0 p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg"},wl={class:"action flex items-center justify-end"},yl=oe({__name:"Prompt",setup(e,{expose:n}){var g,N,E,te;const l=pe(),s=ut();let r=localStorage.getItem(`input_params_map_${(g=l.currentFlow)==null?void 0:g.name}`);if(r){const o=JSON.parse(r);"flow_version"in o&&o.flow_version.split(".")[0]===((N=l.currentFlow)==null?void 0:N.version.split(".")[0])?r=o:(r=null,localStorage.removeItem(`input_params_map_${(E=l.currentFlow)==null?void 0:E.name}`))}const a=C(((te=l.currentFlow)==null?void 0:te.input_params.map(o=>{var i;if(o.type==="text")return{[o.name]:{value:r!==null&&r[o.name]?r[o.name]:o.default||"",type:o.type,optional:o.optional,advanced:o.advanced||!1,default:o.default||"",translatable:o.translatable||!1,dynamic_lora:o.dynamic_lora||!1,trigger_words:o.trigger_words||[]}};if(o.type==="number")return{[o.name]:{value:r!==null&&r[o.name]?r[o.name]:o.default||0,type:o.type,optional:o.optional,advanced:o.advanced||!1,default:o.default||0,dynamic_lora:o.dynamic_lora||!1,trigger_words:o.trigger_words||[]}};if(o.type==="image")return{[o.name]:{value:null,type:o.type,optional:o.optional,advanced:o.advanced||!1,dynamic_lora:o.dynamic_lora||!1,trigger_words:o.trigger_words||[]}};if(o.type==="image-mask")return{[o.name]:{value:null,type:o.type,optional:o.optional,advanced:o.advanced||!1,source_input_name:o.source_input_name||null,dynamic_lora:o.dynamic_lora||!1,trigger_words:o.trigger_words||[]}};if(o.type==="list")return{[o.name]:{value:r!==null&&r[o.name]?r[o.name]:o.default||Object.keys(o.options)[0]||"",type:o.type,optional:o.optional,options:o.options,advanced:o.advanced||!1,default:Object.keys(o.options)[0]||"",dynamic_lora:o.dynamic_lora||!1,trigger_words:o.trigger_words||[]}};if(o.type==="bool")return{[o.name]:{value:r!==null&&r[o.name]?r[o.name]:o.default||!1,type:o.type,optional:o.optional,advanced:o.advanced||!1,default:o.default||!1,dynamic_lora:o.dynamic_lora||!1,trigger_words:o.trigger_words||[]}};if(["range","range_scale"].includes(o.type)){const V={value:r!==null&&r[o.name]?r[o.name]:o.default||0,type:o.type,optional:o.optional,advanced:o.advanced||!1,min:o.min||0,max:o.max||100,step:o.step||1,default:o.default||0,dynamic_lora:o.dynamic_lora||!1,trigger_words:o.trigger_words||[]};if(o.type==="range_scale"&&(V.source_input_name=o.source_input_name||null,V.source_input_name===null||V.source_input_name==="")){const W=(i=l.currentFlow)==null?void 0:i.input_params.find(K=>K.type==="image"&&!K.optional);W&&(V.source_input_name=W.name)}return{[o.name]:V}}}))||[]),d=C([]);l.currentFlow.is_seed_supported&&d.value.push({seed:{name:"seed",display_name:"Random seed",value:Math.floor(Math.random()*1e7),type:"number",optional:!0,advanced:!0,min:0,max:1e7}});const c=xt(),p=C(l.currentFlow.is_translations_supported&&c.settingsMap.translations_provider.value.trim()!==""),$=C(l.currentFlow.is_surprise_me_supported&&c.settingsMap.llm_provider.value.trim()!==""),y=C(p.value);Qe(()=>{const o=localStorage.getItem("translatePrompt");o&&(y.value=JSON.parse(o))}),we(y,o=>{localStorage.setItem("translatePrompt",JSON.stringify(o))});function x(o){console.debug("Copy prompt inputs",o),Object.keys(o).forEach(V=>{const W=a.value.findIndex(K=>Object.keys(K)[0]===V);W!==-1&&(a.value[W][V].value=o[V].value)});const i=document.getElementById("prompt");i&&i.scrollIntoView({behavior:"smooth"})}n({copyPromptInputs:x}),a.value.forEach(o=>{const i=Object.keys(o)[0];["image","image-mask"].includes(o[i].type)||we(()=>o[i].value,()=>{var W,K;const V={};a.value.forEach(Z=>{const ue=Object.keys(Z)[0];V[ue]=Z[ue].value}),localStorage.setItem(`input_params_map_${(W=l.currentFlow)==null?void 0:W.name}`,JSON.stringify({...V,flow_version:(K=l.currentFlow)==null?void 0:K.version}))})});const I=B(()=>a.value.filter(o=>{const i=Object.keys(o)[0];return!["image","image-mask"].includes(o[i].type)}).some(o=>{const i=Object.keys(o)[0];return o[i].value!==o[i].default}));function F(){a.value.forEach(o=>{const i=Object.keys(o)[0];o[i].type==="text"?o[i].value=o[i].default||"":o[i].type==="number"?o[i].value=o[i].default||o[i].min||0:o[i].type==="list"?o[i].value=Object.keys(o[i].options)[0]||"":o[i].type==="bool"?o[i].value=o[i].default||!1:["range","range_scale"].includes(o[i].type)&&(o[i].value=o[i].default||o[i].min||0)})}const S=C(!1),z=C(1),j=C(!1),M=B(()=>a.value.every(o=>{var W,K,Z,ue;const i=Object.keys(o)[0];if(o[i].optional)return!0;const V=o[i].value;if(o[i].type==="text")return V!=="";if(o[i].type==="number")return V>=o[i].min&&V<=o[i].max;if(o[i].type==="list")return V!==""&&Object.keys(o[i].options).includes(V);if(o[i].type==="bool")return!0;if(o[i].type==="range")return V>=o[i].min&&V<=o[i].max;if(o[i].type==="range_scale")return V>=o[i].min&&V<=o[i].max;if(o[i].type==="image")return(W=o[i])!=null&&W.nc_file?!0:V instanceof File&&V.size>0;if(o[i].type==="image-mask")return(K=o[i])!=null&&K.nc_file?((Z=o[i])==null?void 0:Z.mask_applied)||!1:V instanceof File&&V.size>0&&(((ue=o[i])==null?void 0:ue.mask_applied)||!1)})),m=C({"X-WORKER-UNLOAD-MODELS":1,"X-WORKER-EXECUTION-PROFILER":1,"X-WORKER-ID":null}),v=C(!1);we(()=>m.value,()=>{var o;s.isAdmin&&localStorage.setItem(`profilingOptions_${(o=l.currentFlow)==null?void 0:o.name}`,JSON.stringify(m.value))},{deep:!0});function k(o=!1){S.value=!0;let i={};s.isAdmin&&v&&(i=Object.fromEntries(Object.entries(m).filter(([V,W])=>W!==null).map(([V,W])=>V==="X-WORKER-ID"?[V,W==null?void 0:W.value]:[V,W]))),l.runFlow(l.currentFlow,[...a.value,...d.value],z.value,p.value&&y.value,!1,null,o,i).finally(()=>{S.value=!1;const V=d.value.find(W=>Object.keys(W)[0]==="seed");V.seed.value=Number(V.seed.value)+z.value+1})}return(o,i)=>{const V=xe,W=vl,K=We,Z=He,ue=Ge,me=de,ie=De;return t(l).currentFlow?(u(),O("div",hl,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:i[0]||(i[0]=()=>{j.value=!t(j)})},[f(V,{name:t(j)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),i[11]||(i[11]=A(" Prompt "))]),rt(w("div",null,[f(W,{"input-params-map":t(a),"onUpdate:inputParamsMap":i[1]||(i[1]=ne=>J(a)?a.value=ne:null),"additional-input-params-map":t(d),"onUpdate:additionalInputParamsMap":i[2]||(i[2]=ne=>J(d)?d.value=ne:null),advanced:!1},null,8,["input-params-map","additional-input-params-map"]),t(d).length>0?(u(),_(W,{key:0,"input-params-map":t(a),"onUpdate:inputParamsMap":i[3]||(i[3]=ne=>J(a)?a.value=ne:null),"additional-input-params-map":t(d),"onUpdate:additionalInputParamsMap":i[4]||(i[4]=ne=>J(d)?d.value=ne:null),"profiling-options":t(m),"onUpdate:profilingOptions":i[5]||(i[5]=ne=>J(m)?m.value=ne:null),"profiling-enabled":t(v),"onUpdate:profilingEnabled":i[6]||(i[6]=ne=>J(v)?v.value=ne:null),advanced:!0},null,8,["input-params-map","additional-input-params-map","profiling-options","profiling-enabled"])):R("",!0),t(l).currentFlow.is_count_supported?(u(),_(Z,{key:1,label:"Number of results"},{default:b(()=>[f(K,{modelValue:t(z),"onUpdate:modelValue":i[7]||(i[7]=ne=>J(z)?z.value=ne:null),type:"number",min:"1",max:"50",label:"Batch size",class:"mb-3 max-w-fit flex justify-end"},null,8,["modelValue"])]),_:1})):R("",!0),t(p)?(u(),_(Z,{key:2,class:"my-3 flex justify-end"},{default:b(()=>[f(ue,{modelValue:t(y),"onUpdate:modelValue":i[8]||(i[8]=ne=>J(y)?y.value=ne:null),label:"Translate prompt"},null,8,["modelValue"])]),_:1})):R("",!0),w("div",{class:le(["flex flex-col md:flex-row",{"justify-between":t(I),"justify-end":!t(I)}])},[t(I)?(u(),_(ie,{key:0,text:"Reset input params values to defaults"},{default:b(()=>[f(me,{icon:"i-heroicons-arrow-path-rounded-square",variant:"ghost",color:"amber",onClick:F},{default:b(()=>i[12]||(i[12]=[A(" Reset params ")])),_:1})]),_:1})):R("",!0),w("div",wl,[t($)?(u(),_(ie,{key:0,text:"Randomize prompt based on your input"},{default:b(()=>[f(me,{class:"mr-2",icon:"i-heroicons-gift",variant:"soft",color:"blue",loading:t(S),onClick:i[9]||(i[9]=()=>k(!0))},{default:b(()=>i[13]||(i[13]=[A(" Surprise me ")])),_:1},8,["loading"])]),_:1})):R("",!0),f(me,{icon:"i-heroicons-sparkles-16-solid",variant:"outline",loading:t(S),disabled:!t(M),onClick:i[10]||(i[10]=()=>k(!1))},{default:b(()=>i[14]||(i[14]=[A(" Run prompt ")])),_:1},8,["loading","disabled"])])],2)],512),[[_t,!t(j)]])])):R("",!0)}}}),bl=e=>{const n=C(0);function l(a){e.value.style.scrollSnapType="none",e.value.style.scrollBehavior="auto",n.value=a.pageX,window.addEventListener("mousemove",r),window.addEventListener("mouseup",s)}function s(){e.value.style.removeProperty("scroll-behavior"),e.value.style.removeProperty("scroll-snap-type"),e.value.style.removeProperty("pointer-events"),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s)}function r(a){a.preventDefault(),e.value.style.pointerEvents="none";const d=a.pageX-n.value;n.value=a.pageX,e.value.scrollBy(-d,0)}Se(()=>{e.value&&e.value.addEventListener("mousedown",l)}),dt(()=>{e.value&&e.value.removeEventListener("mousedown",l)})},tt=ot(Ce.ui.strategy,Ce.ui.carousel,dn),kl=oe({components:{UButton:de},inheritAttrs:!1,props:{items:{type:Array,default:()=>[]},arrows:{type:Boolean,default:!1},indicators:{type:Boolean,default:!1},dir:{type:String,default:"ltr"},prevButton:{type:Object,default:()=>tt.default.prevButton},nextButton:{type:Object,default:()=>tt.default.nextButton},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:void 0}},setup(e,{expose:n}){const{ui:l,attrs:s}=st("carousel",Be(e,"ui"),tt,Be(e,"class")),r=C(),a=C(0),{x:d}=Qt(r,{behavior:"smooth"}),{width:c}=Kt(r);bl(r),Yt(r,j=>{var m,v;const[M]=j;a.value=((v=(m=M==null?void 0:M.target)==null?void 0:m.firstElementChild)==null?void 0:v.clientWidth)||0});const p=B(()=>e.dir==="rtl"),$=B(()=>a.value?p.value?Math.round(-d.value/a.value)+1:Math.round(d.value/a.value)+1:0),y=B(()=>{if(!a.value)return 0;const j=Math.round(c.value/a.value);return e.items.length<=j?0:e.items.length-j+1}),x=B(()=>$.value<=1),I=B(()=>$.value===y.value);function F(){d.value+=p.value?-a.value:a.value}function S(){d.value-=p.value?-a.value:a.value}function z(j){d.value=(j-1)*a.value*(p.value?-1:1)}return n({pages:y,page:$,prev:S,next:F,select:z}),{ui:l,attrs:s,isFirst:x,isLast:I,carouselRef:r,pages:y,currentPage:$,onClickNext:F,onClickPrev:S,onClick:z,twMerge:Je}}}),xl=["dir"],_l=["role"],$l=["aria-selected","aria-label","onClick"];function Cl(e,n,l,s,r,a){const d=de;return u(),O("div",Re({class:e.ui.wrapper},e.attrs,{dir:e.dir}),[w("div",{ref:"carouselRef",class:le([e.ui.container,"no-scrollbar"])},[(u(!0),O(se,null,ve(e.items,(c,p)=>(u(),O("div",{key:p,class:le(e.ui.item),role:e.indicators?"tabpanel":null},[Oe(e.$slots,"default",{item:c,index:p},void 0,!0)],10,_l))),128))],2),e.arrows?(u(),O("div",{key:0,class:le(e.ui.arrows.wrapper)},[Oe(e.$slots,"prev",{onClick:e.onClickPrev,disabled:e.isFirst},()=>{var c;return[e.prevButton?(u(),_(d,Re({key:0,disabled:e.isFirst},{...e.ui.default.prevButton,...e.prevButton},{class:e.twMerge(e.ui.default.prevButton.class,(c=e.prevButton)==null?void 0:c.class),"aria-label":"Prev",onClick:e.onClickPrev}),null,16,["disabled","class","onClick"])):R("",!0)]},!0),Oe(e.$slots,"next",{onClick:e.onClickNext,disabled:e.isLast},()=>{var c;return[e.nextButton?(u(),_(d,Re({key:0,disabled:e.isLast},{...e.ui.default.nextButton,...e.nextButton},{class:e.twMerge(e.ui.default.nextButton.class,(c=e.nextButton)==null?void 0:c.class),"aria-label":"Next",onClick:e.onClickNext}),null,16,["disabled","class","onClick"])):R("",!0)]},!0)],2)):R("",!0),e.indicators?(u(),O("div",{key:1,role:"tablist",class:le(e.ui.indicators.wrapper)},[(u(!0),O(se,null,ve(e.pages,c=>Oe(e.$slots,"indicator",{key:c,onClick:e.onClick,active:c===e.currentPage,page:c},()=>[w("button",{type:"button",role:"tab","aria-selected":c===e.currentPage,class:le([e.ui.indicators.base,c===e.currentPage?e.ui.indicators.active:e.ui.indicators.inactive]),"aria-label":`set slide ${c}`,onClick:p=>e.onClick(c)},null,10,$l)],!0)),128))],2)):R("",!0)],16,xl)}const Fe=at(kl,[["render",Cl],["__scopeId","data-v-a3da86ff"]]),Sl={class:"flex flex-col basis-full"},Il=oe({__name:"InputFiles",props:{running:{type:Object,required:!0}},setup(e){const n=mt(),l=function(c,p){return`${$t()}/tasks/inputs?task_id=${c}&input_index=${p}`},s=C(!1),r=C(""),a=C(0),d=C(!0);return(c,p)=>{var S,z,j,M,m;const $=xe,y=_e,x=Fe,I=de,F=Ie;return e.running&&e.running.input_files&&((S=Object.keys(e.running.input_files))==null?void 0:S.length)>0?(u(),O("div",{key:0,class:le(["ml-2 mt-2 mb-5",{"mb-10":((z=Object.keys(e.running.input_files))==null?void 0:z.length)>1&&!t(d)}])},[w("h4",{class:"mb-3 font-bold cursor-pointer select-none flex items-center text-sm",onClick:p[0]||(p[0]=()=>d.value=!t(d))},[f($,{name:t(d)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Input files ("+X((j=Object.keys(e.running.input_files))==null?void 0:j.length)+") ",1)]),t(d)?R("",!0):(u(),O(se,{key:0},[((M=Object.keys(e.running.input_files))==null?void 0:M.length)===1?(u(),_(y,{key:0,class:"mb-5 rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(n)(`${("buildBackendUrl"in c?c.buildBackendUrl:t(lt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:l(e.running.task_id,0),onClick:p[1]||(p[1]=()=>{r.value=l(e.running.task_id,0),a.value=0,s.value=!0})},null,8,["placeholder","src"])):R("",!0),((m=Object.keys(e.running.input_files))==null?void 0:m.length)>1?(u(),_(x,{key:1,items:Object.keys(e.running.input_files).map(v=>({task_id:e.running.task_id,index:v})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:""},{default:b(({item:v})=>[w("div",Sl,[f(y,{class:"rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(n)(`${("buildBackendUrl"in c?c.buildBackendUrl:t(lt))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:l(v.task_id,v.index),onClick:()=>{r.value=l(e.running.task_id,v.index),a.value=v.index,s.value=!0}},null,8,["placeholder","src","onClick"])])]),_:1},8,["items"])):R("",!0),f(F,{modelValue:t(s),"onUpdate:modelValue":p[4]||(p[4]=v=>J(s)?s.value=v:null),class:"z-[90]",transition:!1,fullscreen:""},{default:b(()=>[f(I,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:p[2]||(p[2]=()=>s.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:p[3]||(p[3]=Ke(()=>s.value=!1,["left"]))},[t(r)?(u(),_(y,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(r)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])],64))],2)):R("",!0)}}}),Rl=oe({__name:"ErrorAlert",props:{running:{type:Object,required:!0}},setup(e){const n=pe(),l=C(!1);return(s,r)=>{const a=ct;return u(),_(a,{class:"mb-5",icon:"i-heroicons-exclamation-circle-16-solid",color:"red",variant:"soft",title:"Task failed",description:e.running.error,actions:[{variant:"outline",color:"yellow",label:"Restart",loading:t(l),icon:"i-heroicons-arrow-path",click:()=>{l.value=!0,t(n).restartFlow(e.running).finally(()=>{l.value=!1})}}]},null,8,["description","actions"])}}}),Ml={class:"mb-5"},Fl={class:"text-sm mb-5 text-slate-500"},Pl={class:"flex justify-between"},Ul=oe({__name:"Item",props:{running:{type:Object,required:!0}},setup(e){const n=pe(),l=C(!1),s=C(!1);function r(a){return[[{label:"Comfy flow",labelClass:"text-blue-500",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500",click:()=>{var d;return n.downloadFlowComfy((d=n.currentFlow)==null?void 0:d.name,a.task_id)}}],[{label:`Raise priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-up",iconClass:"bg-gray-500",disabled:a.priority===15||a.progress>0,click:()=>{s.value=!0,n.raiseQueuePriority(a).finally(()=>{s.value=!1})}},{label:`Lower priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-down",iconClass:"bg-gray-500",disabled:a.priority===0||a.progress>0,click:()=>{s.value=!0,n.lowerQueuePriority(a).finally(()=>{s.value=!1})}},{label:`Reset priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-path-rounded-square-solid",iconClass:"bg-gray-500",disabled:a.priority===0||a.progress>0,click:()=>{s.value=!0,n.resetQueuePriority(a).finally(()=>{s.value=!1})}}]]}return(a,d)=>{var I,F;const c=Ft,p=Il,$=Rl,y=de,x=Ye;return u(),O("div",Ml,[f(c,{class:"mb-3",value:(I=e.running)==null?void 0:I.progress,indicator:"",color:e.running.error?"red":"green"},null,8,["value","color"]),w("p",Fl,X([`${(F=e.running)!=null&&F.priority&&e.running.priority>0?"["+e.running.priority+"] ":""}#${e.running.task_id}`,...Object.keys(e.running.input_params_mapped).filter(S=>e.running.input_params_mapped[S].value&&e.running.input_params_mapped[S].value!=="").map(S=>`${e.running.input_params_mapped[S].display_name}: ${e.running.input_params_mapped[S].value}`)].join(" | ")+`${e.running.execution_time?" | execution_time: "+e.running.execution_time.toFixed(2)+"s":""}`),1),f(p,{running:e.running},null,8,["running"]),e.running.error?(u(),_($,{key:0,running:e.running},null,8,["running"])):R("",!0),w("div",Pl,[f(y,{icon:e.running.progress>=0&&e.running.progress<100?"i-heroicons-stop":"i-heroicons-minus-circle",color:e.running.error?"red":"orange",variant:"outline",loading:t(l),onClick:d[0]||(d[0]=()=>{l.value=!0,t(n).cancelRunningFlow(e.running).finally(()=>{l.value=!1})})},{default:b(()=>[A(X(e.running.progress>=0&&e.running.progress<100?"Cancel":"Remove"),1)]),_:1},8,["icon","color","loading"]),f(x,{items:r(e.running),mode:"click",popper:{placement:"bottom-end"}},{default:b(()=>[f(y,{color:"blue",variant:"outline",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])])])}}}),zl={class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md mt-5 mb-10"},Vl={class:"flex items-center justify-between mb-2"},Ol={key:0},jl={key:1,class:"text-red-400"},Tl=oe({__name:"Queue",setup(e){const n=pe(),l=C(!0),s=C(!1);return(r,a)=>{var $,y,x,I,F,S,z,j,M;const d=xe,c=de,p=Ul;return u(),O("div",zl,[w("div",Vl,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center",onClick:a[0]||(a[0]=()=>{l.value=!t(l)})},[f(d,{name:t(l)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Queue ("+X(t(n).flowsRunningByName(($=t(n).currentFlow)==null?void 0:$.name).length)+") ",1),t(n).flowsRunningByName((y=t(n).currentFlow)==null?void 0:y.name).length>0?(u(),O("span",Ol,"  - "+X(`${((I=t(n).flowsRunningByName((x=t(n).currentFlow)==null?void 0:x.name).filter(m=>m.progress>0)[0])==null?void 0:I.progress.toFixed(0))??0}%`),1)):R("",!0),t(n).flowsRunningByNameWithErrors((F=t(n))==null?void 0:F.currentFlow.name).length>0?(u(),O("span",jl,"  ("+X(t(n).flowsRunningByNameWithErrors((S=t(n).currentFlow)==null?void 0:S.name).length)+") ",1)):R("",!0)]),(z=t(n).currentFlow)!=null&&z.name&&t(n).flowsRunningByName((j=t(n).currentFlow)==null?void 0:j.name).length>0?(u(),_(c,{key:0,icon:"i-heroicons-stop",color:"orange",variant:"outline",loading:t(s),onClick:a[1]||(a[1]=()=>{var m;s.value=!0,t(n).cancelRunningFlows((m=t(n).currentFlow)==null?void 0:m.name).finally(()=>{s.value=!1})})},{default:b(()=>a[2]||(a[2]=[A(" Cancel all ")])),_:1},8,["loading"])):R("",!0)]),t(l)?R("",!0):(u(!0),O(se,{key:0},ve(t(n).flowsRunningByName((M=t(n).currentFlow)==null?void 0:M.name),m=>(u(),_(p,{key:m.task_id,running:m},null,8,["running"]))),128))])}}}),Nl=oe({__name:"ScrollToTop",props:{show:{type:Boolean,required:!0},target:{type:String,required:!0}},setup(e){const n=e;function l(){const s=document.getElementById(n.target);s&&s.scrollIntoView({behavior:"smooth"})}return(s,r)=>{const a=de;return e.show?(u(),_(a,{key:0,icon:"i-heroicons-arrow-small-up",color:"black",variant:"outline",onClick:l})):R("",!0)}}}),Bl={class:"flex flex-col items-center mb-2 max-w-fit mx-auto z-0"},Ll={class:"text-slate-500 text-center text-sm w-full mx-auto flex flex-wrap items-center justify-center md:justify-between"},Al={class:"toggles py-2"},ql={class:"mr-2 inline-flex items-center text-sm"},El=["for"],Dl={class:"mr-2 inline-flex items-center text-sm"},Wl=["for"],Hl={key:0,class:"flex items-center"},Gl=["title"],Xl=oe({__name:"Child",props:{flowResult:{type:Object,required:!0},outputsIndex:{type:Number,required:!1,default:()=>0},openImageModal:{type:Function,required:!0}},setup(e){const n=e,l=pe(),s=(m,v=null,k=!1)=>{if(m.child_tasks.length===0)return m;const g=m.child_tasks.findIndex(N=>N.parent_task_node_id===v);return g!==-1?(k||(a.value=m),s(m.child_tasks[g],m.child_tasks[g].outputs[0].comfy_node_id,k)):m};function r(m,v,k=null){if(k!==null&&m.parent_task_node_id===k||Number(m.task_id)===v)return m;for(let g=0;g<m.child_tasks.length;g++)for(let N=0;N<m.child_tasks[g].outputs.length;N++){const E=r(m.child_tasks[g],v,m.child_tasks[g].outputs[N].comfy_node_id);if(E!==null)return E}return null}const a=C(n.flowResult),d=C(s(n.flowResult,n.flowResult.outputs[n.outputsIndex].comfy_node_id,!1));function c(m){var v;return[[{label:`${(v=l.flowByName((m==null?void 0:m.flow_name)??(m==null?void 0:m.name)))==null?void 0:v.display_name}#${m.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",click:()=>{n.openImageModal(fe({task_id:m.task_id,node_id:m.outputs.length>1?m.outputs[n.outputsIndex].comfy_node_id:m.outputs[0].comfy_node_id}))}}]]}function p(m){var k;const v=[[{label:`${(k=l.flowByName((m==null?void 0:m.flow_name)??(m==null?void 0:m.name)))==null?void 0:k.display_name}#${m.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",disabled:m.progress<100||m.error!=="",click:()=>{n.openImageModal(fe({task_id:m.task_id,node_id:m.outputs.length>1?m.outputs[n.outputsIndex].comfy_node_id:m.outputs[0].comfy_node_id}))}},{label:m.progress<100?"Cancel":"Delete",labelClass:m.progress<100?"text-orange-500":"text-red-500",icon:m.progress<100?"i-heroicons-stop":"i-heroicons-trash",iconClass:m.progress<100?"bg-orange-500":"bg-red-500",click:()=>{l.deleteFlowHistory(m.task_id).then(()=>{const g=r(n.flowResult,m.parent_task_id,m.parent_task_node_id);g&&(g.child_tasks=g.child_tasks.filter(N=>Number(N.task_id)!==Number(m.task_id))),S(!1,n.flowResult)})}}]];return m.progress<100&&(v[0][1]={label:`Progress: ${Math.ceil(m.progress)}% (${m.execution_time.toFixed(2)}s)`,labelClass:"text-blue-500",disabled:!0}),m.error!==""&&v[0].push({label:`Error: ${m.error}`,labelClass:"text-red-500",slot:"error",click:()=>{qe().copy(m.error),Me().add({title:"Clipboard",description:`Task #${m.task_id} error copied to clipboard`,timeout:2e3})}}),v}function $(){const m=a.value.parent_task_id;if(!m)return;const v=r(n.flowResult,m,a.value.parent_task_node_id);v&&(a.value=v)}function y(){if(a.value.child_tasks.length===0)return;const m=a.value.outputs.length>1?a.value.outputs[n.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id,v=a.value.child_tasks.find(k=>k.parent_task_node_id===m);v&&(a.value=v)}const x=B(()=>{if(a.value.child_tasks.length===0)return;const m=a.value.outputs.length>1?a.value.outputs[n.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id;return a.value.child_tasks.find(k=>k.parent_task_node_id===m).task_id!==d.value.task_id});function I(){const m=d.value.parent_task_id;if(!m)return;const v=r(n.flowResult,m,d.value.parent_task_node_id);v&&(d.value=v)}function F(){if(d.value.child_tasks.length===0)return;const m=Number(d.value.outputs[0].comfy_node_id),v=d.value.child_tasks.find(k=>Number(k.parent_task_node_id)===m);v&&(d.value=v)}function S(m=!1,v=null){m||(a.value=v),d.value=s(v,v==null?void 0:v.outputs[n.outputsIndex].comfy_node_id,m),z.value=!1}we(n.flowResult,m=>{S(!0,m)});const z=C(!1),j=C(!0),M=C(null);return we(z,m=>{m?(M.value=a.value,a.value=n.flowResult):M.value&&(a.value=M.value,d.value=Ct(M.value,n.outputsIndex,a.value.outputs.length>1?a.value.outputs[n.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id))}),(m,v)=>{const k=_e,g=Ne("ImgComparisonSlider"),N=sn,E=de,te=Ye,o=xe,i=De;return u(),O("div",Bl,[rt(f(k,{class:"mb-2 rounded-lg cursor-pointer",height:t(l).outputMaxSize,width:t(l).outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(d).progress===100?t(d).task_id:e.flowResult.task_id,node_id:t(d).progress===100?t(d).outputs[0].comfy_node_id:e.flowResult.outputs[e.outputsIndex].comfy_node_id}),onClick:v[0]||(v[0]=V=>e.openImageModal(("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(d).task_id??e.flowResult.task_id,node_id:t(d).outputs[0].comfy_node_id??e.flowResult.outputs[e.outputsIndex].comfy_node_id})))},null,8,["height","width","src"]),[[_t,!t(j)]]),t(j)?(u(),_(g,{key:0,class:"mb-2 mx-auto outline-none w-fit rounded-lg"},{default:b(()=>{var V,W,K;return[f(k,{slot:"first",height:t(l).outputMaxSize,width:t(l).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(z)?e.flowResult.task_id:t(a).task_id,node_id:t(z)?e.flowResult.outputs[e.outputsIndex].comfy_node_id:t(a).parent_task_node_id!==null?(V=t(a))==null?void 0:V.outputs[0].comfy_node_id:((W=t(a))==null?void 0:W.outputs[e.outputsIndex].comfy_node_id)??((K=t(a))==null?void 0:K.outputs[0].comfy_node_id)})},null,8,["height","width","src"]),t(d)&&t(d).progress===100?(u(),_(k,{key:0,slot:"second",height:t(l).outputMaxSize,width:t(l).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in m?m.outputResultSrc:t(fe))({task_id:t(d).task_id,node_id:t(d).outputs[0].comfy_node_id})},null,8,["height","width","src"])):(u(),_(k,{key:1,slot:"second",height:t(l).outputMaxSize,width:t(l).outputMaxSize,fit:"cover",draggable:"false",src:`${("buildBackendUrl"in m?m.buildBackendUrl:t(lt))()}/vix_logo.png`},null,8,["height","width","src"]))]}),_:1})):R("",!0),w("div",Ll,[w("div",Al,[w("div",ql,[f(N,{id:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(j),"onUpdate:modelValue":v[1]||(v[1]=V=>J(j)?j.value=V:null),size:"xs",class:"mr-2"},null,8,["id","modelValue"]),w("label",{class:"cursor-pointer select-none",for:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`}," Comparison ",8,El)]),w("div",Dl,[f(N,{id:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(z),"onUpdate:modelValue":v[2]||(v[2]=V=>J(z)?z.value=V:null),disabled:!t(j),size:"xs",class:"mr-2"},null,8,["id","modelValue","disabled"]),w("label",{class:"cursor-pointer select-none",for:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`}," Original ",8,Wl)])]),t(j)?(u(),O("div",Hl,[f(E,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(z)||t(a).parent_task_id===null,onClick:$},null,8,["disabled"]),f(te,{items:c(t(a)),mode:"click",popper:{placement:"top"}},{default:b(()=>[f(E,{variant:"link",color:"white",size:"xs"},{default:b(()=>[A(" #"+X(t(z)?e.flowResult.task_id:t(a).task_id),1)]),_:1})]),_:1},8,["items"]),f(E,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(z)||!t(x),onClick:y},null,8,["disabled"]),f(o,{class:"mx-3",name:"i-heroicons-arrows-right-left-16-solid"}),f(E,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:!r(n.flowResult,t(d).parent_task_id,t(d).parent_task_node_id)||t(d).parent_task_id===Number(t(a).task_id)||t(d).parent_task_id===null,onClick:I},null,8,["disabled"]),f(te,{items:p(t(d)),mode:"click",popper:{placement:"top"}},{error:b(({item:V})=>[w("div",{class:"text-red-500 truncate",title:V.label},X(V.label),9,Gl)]),default:b(()=>[f(E,{class:le({"text-blue-500":t(d).progress!==100&&t(d).error==="","text-red-500":t(d).error!==""}),variant:"link",color:"white",size:"xs"},{default:b(()=>[A(X(t(d).progress===100?"#"+t(d).task_id:Math.ceil(t(d).progress)+"%"),1)]),_:1},8,["class"])]),_:1},8,["items"]),f(E,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(d).child_tasks.length===0,onClick:F},null,8,["disabled"]),f(i,{class:"ml-3",text:"Reset comparison",popper:{placement:"top"}},{default:b(()=>[f(E,{icon:"i-heroicons-arrow-path-rounded-square-solid",size:"2xs",variant:"outline",color:"white",onClick:v[3]||(v[3]=()=>S(!1,e.flowResult))})]),_:1})])):R("",!0)])])}}}),Jl={class:"image-output"},Ql={class:"flex flex-col basis-full justify-between mx-2"},Kl=oe({__name:"Image",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const n=pe();return(l,s)=>{var p,$;const r=Xl,a=_e,d=de,c=Fe;return u(),O("div",Jl,[e.flowResult.outputs.length===1?(u(),O(se,{key:0},[(p=e.flowResult)!=null&&p.child_tasks&&(($=e.flowResult)==null?void 0:$.child_tasks.length)>0?(u(),_(r,{key:0,"flow-result":e.flowResult,"open-image-modal":e.openImageModal},null,8,["flow-result","open-image-modal"])):e.flowResult.outputs.length===1?(u(),_(a,{key:1,class:"mb-2 mx-auto rounded-lg cursor-pointer",height:t(n).$state.outputMaxSize,width:t(n).$state.outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in l?l.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id}),onClick:s[0]||(s[0]=y=>e.openImageModal(("outputResultSrc"in l?l.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})))},null,8,["height","width","src"])):R("",!0)],64)):e.flowResult.outputs.length>1?(u(),_(c,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((y,x)=>({task_id:e.flowResult.task_id,node_id:y.comfy_node_id,index:x})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:b(({item:y})=>{var x;return[w("div",Ql,[(x=e.flowResult)!=null&&x.child_tasks&&("hasChildTaskByParentTaskNodeId"in l?l.hasChildTaskByParentTaskNodeId:t(St))(e.flowResult,y.index,y.node_id)?(u(),_(r,{key:0,"flow-result":e.flowResult,"outputs-index":y.index,"open-image-modal":e.openImageModal},null,8,["flow-result","outputs-index","open-image-modal"])):(u(),_(a,{key:1,class:le(`mb-2 h-100 max-h-[${t(n).$state.outputMaxSize}px] mx-auto rounded-lg cursor-pointer`),draggable:"false",height:t(n).$state.outputMaxSize,width:t(n).$state.outputMaxSize,fit:"cover",loading:"lazy",src:("outputResultSrc"in l?l.outputResultSrc:t(fe))(y),onClick:I=>e.openImageModal(("outputResultSrc"in l?l.outputResultSrc:t(fe))(y))},null,8,["class","height","width","src","onClick"])),f(d,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,y.index)}},{default:b(()=>s[1]||(s[1]=[A(" Send to flow ")])),_:2},1032,["onClick"])])]}),_:1},8,["items"])):R("",!0)])}}}),Yl={class:"video-output"},Zl=["width","height"],eo=["src"],to={class:"flex flex-col basis-full justify-between mx-2"},no=["width","height"],lo=["src"],oo=oe({__name:"Video",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const n=pe();return(l,s)=>{const r=de,a=Fe;return u(),O("div",Yl,[e.flowResult.outputs.length===1?(u(),O("video",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",style:{"max-height":"80vh"},width:t(n).$state.outputMaxSize,height:t(n).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in l?l.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,eo)],8,Zl)):e.flowResult.outputs.length>1?(u(),_(a,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((d,c)=>({task_id:e.flowResult.task_id,node_id:d.comfy_node_id,index:c})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:b(({item:d})=>[w("div",to,[w("video",{controls:"",class:"mb-2 mx-auto rounded-lg",width:t(n).$state.outputMaxSize,height:t(n).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in l?l.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,lo)],8,no),f(r,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,d.index)}},{default:b(()=>s[0]||(s[0]=[A(" Send to flow ")])),_:2},1032,["onClick"])])]),_:1},8,["items"])):R("",!0)])}}}),ao={class:"audio-output"},so=["src"],io={class:"flex flex-col basis-full justify-between mx-2"},ro=["src"],uo=oe({__name:"Audio",props:{flowResult:{type:Object,required:!0}},setup(e){return(n,l)=>{const s=Fe;return u(),O("div",ao,[e.flowResult.outputs.length===1?(u(),O("audio",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,so)):e.flowResult.outputs.length>1?(u(),_(s,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((r,a)=>({task_id:e.flowResult.task_id,node_id:r.comfy_node_id,index:a})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:b(()=>[w("div",io,[w("audio",{controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in n?n.outputResultSrc:t(fe))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,ro)])]),_:1},8,["items"])):R("",!0)])}}}),co={class:"text-output"},mo={key:0,class:"mb-2 mx-auto rounded-lg text-md p-4 pr-8 border border-slate-500 relative"},fo=oe({__name:"Text",props:{flowResult:{type:Object,required:!0}},setup(e){const n=e,l=pe(),s=Me(),r=C(!1),a=C({});function d(c,p){const{$apiFetch:$}=Le(),y=fe({task_id:c.task_id,node_id:p.comfy_node_id});return $(y).then(x=>{a.value[p.comfy_node_id]=x}).catch(x=>{console.error(x)}).finally(()=>{r.value=!1})}return Se(()=>{Promise.all(n.flowResult.outputs.filter(c=>c.type==="text").map(c=>d(n.flowResult,c)))}),(c,p)=>{const $=de,y=Fe;return u(),O("div",co,[e.flowResult.outputs.length===1?(u(),O("div",mo,[t(r)?R("",!0):(u(),_($,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:p[0]||(p[0]=()=>{("useCopyToClipboard"in c?c.useCopyToClipboard:t(qe))().copy(t(a)[e.flowResult.outputs[0].comfy_node_id]),t(s).add({title:"Clipboard",description:"Text copied to clipboard"})})})),w("p",null,X(t(r)?"Loading...":t(a)[e.flowResult.outputs[0].comfy_node_id]),1)])):e.flowResult.outputs.length>1?(u(),_(y,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((x,I)=>({task_id:e.flowResult.task_id,node_id:x.comfy_node_id,index:I})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:"",arrows:""},{default:b(({item:x})=>[w("div",{class:"mb-2 mx-2 rounded-lg text-md p-4 border border-slate-500 shadow-sm overflow-y-auto relative",style:yt({"max-height":Math.ceil(t(l).$state.outputMaxSize/2)+"px"})},[t(r)?R("",!0):(u(),_($,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:()=>{("useCopyToClipboard"in c?c.useCopyToClipboard:t(qe))().copy(t(a)[x.node_id]),t(s).add({title:"Clipboard",description:"Text copied to clipboard"})}},null,8,["onClick"])),w("p",null,X(t(r)?"Loading...":t(a)[x.node_id]),1)],4)]),_:1},8,["items"])):R("",!0)])}}}),po={class:"w-full h-full p-4"},go={class:"mt-4 max-h-96 overflow-y-auto text-sm whitespace-pre-wrap"},vo=oe({__name:"Params",props:{flowResult:{type:Object,required:!0}},setup(e){const n=e,l=C(!1),s=B(()=>["#"+n.flowResult.task_id,...Object.keys(n.flowResult.input_params_mapped).filter(c=>n.flowResult.input_params_mapped[c].value&&n.flowResult.input_params_mapped[c].value!=="").map(c=>l.value&&n.flowResult.translated_input_params_mapped&&n.flowResult.translated_input_params_mapped[c]?`${n.flowResult.input_params_mapped[c].display_name}: ${n.flowResult.translated_input_params_mapped[c].value}`:`${n.flowResult.input_params_mapped[c].display_name}: ${n.flowResult.input_params_mapped[c].value}`)].join(" | ")+`${n.flowResult.execution_time?" | execution_time: "+n.flowResult.execution_time.toFixed(2)+"s":""}`);dt(()=>{n.flowResult.showInputFiles=!1,n.flowResult.showExecutionDetailsModal=!1});const r=B(()=>n.flowResult.execution_details&&n.flowResult.extra_flags!==null),a=B(()=>{const c={unload_models:n.flowResult.extra_flags.unload_models,max_memory_usage:n.flowResult.execution_details.max_memory_usage,disable_smart_memory:n.flowResult.execution_details.disable_smart_memory,vram_state:n.flowResult.execution_details.vram_state};return JSON.stringify(c,null,"	")});function d(){const c={extra_flags:n.flowResult.extra_flags,execution_details:n.flowResult.execution_details},p=new Blob([JSON.stringify(c,null,"	")],{type:"application/json"}),$=URL.createObjectURL(p),y=document.createElement("a");y.href=$,y.download=`${n.flowResult.task_id}_execution_details.json`,y.click(),window.URL.revokeObjectURL($)}return(c,p)=>{const $=de,y=Ie,x=De,I=Ee,F=xe;return u(),O(se,null,[t(r)?(u(),_(y,{key:0,modelValue:e.flowResult.showExecutionDetailsModal,"onUpdate:modelValue":p[2]||(p[2]=S=>e.flowResult.showExecutionDetailsModal=S)},{default:b(()=>[f($,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:p[0]||(p[0]=()=>e.flowResult.showExecutionDetailsModal=!1)}),w("div",po,[p[6]||(p[6]=w("h3",{class:"text-center font-bold"}," Execution details ",-1)),w("div",go,X(t(a)),1),f($,{class:"mt-3",icon:"i-heroicons-arrow-down-tray-20-solid",variant:"outline",size:"xs",color:"gray",onClick:p[1]||(p[1]=()=>d())},{default:b(()=>p[5]||(p[5]=[A(" Download raw details ")])),_:1})])]),_:1},8,["modelValue"])):R("",!0),e.flowResult.translated_input_params_mapped&&Object.keys(e.flowResult.translated_input_params_mapped).length>0?(u(),_(x,{key:1,text:t(l)?"Hide translated input params":"Show translated input params",popper:{placement:"top"}},{default:b(()=>[f($,{class:"mb-2 mr-2",color:"white",size:"xs",variant:"outline",icon:"i-heroicons-language-solid",onClick:p[3]||(p[3]=()=>{l.value=!t(l)})})]),_:1},8,["text"])):R("",!0),(u(!0),O(se,null,ve(t(s).split("|"),S=>(u(),_(I,{key:S,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer",variant:"soft",color:"gray",onClick:()=>{const z=("useCopyToClipboard"in c?c.useCopyToClipboard:t(qe))(),j=S.indexOf(":"),M=S.substring(j+1).trim();z.copy(M),("useToast"in c?c.useToast:t(Me))().add({title:"Clipboard",description:`${S.split(":")[0].trim()} copied to clipboard`,timeout:2e3})}},{default:b(()=>[A(X(S),1)]),_:2},1032,["onClick"]))),128)),e.flowResult.input_files.length>0?(u(),_(I,{key:2,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer select-none",variant:"subtle",color:"sky",onClick:p[4]||(p[4]=()=>{e.flowResult.showInputFiles=!e.flowResult.showInputFiles})},{default:b(()=>[f(F,{name:e.flowResult.showInputFiles?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-1"},null,8,["name"]),f(F,{name:"i-heroicons-document-solid",class:"mr-1"}),A(" "+X(`input_files: ${e.flowResult.input_files.length}`),1)]),_:1})):R("",!0)],64)}}}),ho={key:0,class:le("w-full p-1")},wo={class:"flex flex-col basis-full justify-between mx-2"},yo=oe({__name:"InputFiles",props:{flowResult:{type:Object,required:!0}},setup(e){const n=pe(),l=(d,c)=>`${$t()}/tasks/inputs?task_id=${d}&input_index=${c}`,s=C(!1),r=C(""),a=C(0);return(d,c)=>{var I,F;const p=_e,$=Fe,y=de,x=Ie;return e.flowResult.showInputFiles?(u(),O("div",ho,[((I=Object.keys(e.flowResult.input_files))==null?void 0:I.length)===1?(u(),_(p,{key:0,class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(n).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",src:l(e.flowResult.task_id,0),onClick:c[0]||(c[0]=()=>{r.value=l(e.flowResult.task_id,0),a.value=0,s.value=!0})},null,8,["class","src"])):R("",!0),((F=Object.keys(e.flowResult.input_files))==null?void 0:F.length)>1?(u(),_($,{key:1,items:Object.keys(e.flowResult.input_files).map(S=>({task_id:e.flowResult.task_id,index:S})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 my-2"}},page:1,indicators:""},{default:b(({item:S})=>[w("div",wo,[f(p,{class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(n).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",draggable:"false",src:l(S.task_id,S.index),onClick:()=>{r.value=l(e.flowResult.task_id,S.index),a.value=S.index,s.value=!0}},null,8,["class","src","onClick"])])]),_:1},8,["items"])):R("",!0),f(x,{modelValue:t(s),"onUpdate:modelValue":c[3]||(c[3]=S=>J(s)?s.value=S:null),class:"z-[90]",transition:!1,fullscreen:""},{default:b(()=>[f(y,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:c[1]||(c[1]=()=>s.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:c[2]||(c[2]=Ke(()=>s.value=!1,["left"]))},[t(r)?(u(),_(p,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(r)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])])):R("",!0)}}}),bo={class:"p-4"},ko={class:"flex justify-center mb-4"},xo={key:0,class:"text-sm text-slate-500 text-center mb-4"},_o={class:"text-md text-center text-red-500 mb-4"},$o={key:1},Co={class:"flex items-center justify-between"},So=oe({__name:"SendToFlowModal",props:Ae({flowResult:{type:Object,required:!1,default:()=>null},outputImgSrc:{type:String,required:!0},outputParamIndex:{type:Number,required:!0},inputParamsMapped:{type:Object,required:!0},isChildTask:{type:Boolean,required:!1,default:!1},translatePrompt:{type:Boolean,required:!1,default:!1}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:Ae(["update:show"],["update:show"]),setup(e,{emit:n}){const l=e,s=je(e,"show"),r=pe(),a=B(()=>r.sub_flows.map(I=>({value:I.name,label:`${I.display_name} - ${I.description}`}))),d=C(a.value[0]||""),c=C(!1),p=n;function $(){console.debug("[Send to flow]: ",d.value);const I=r.sub_flows.find(S=>S.name===d.value.value&&S.display_name===d.value.label.split(" - ")[0]);if(console.debug("[Send to flow]: targetFlow",I),!I){Me().add({title:`Target sub-flow "${d.value.value}" not found`,description:"Please, verify the target sub-flow is installed and available and try again",timeout:5e3});return}const F=I.input_params.reduce((S,z)=>{const j={};return z.type==="text"?j[z.name]={value:z.default||"",type:z.type}:z.type==="number"?j[z.name]={value:z.default||0,type:z.type}:z.type==="image"?j[z.name]={value:JSON.stringify({task_id:l.flowResult.task_id,node_id:l.flowResult.outputs.length>1?l.flowResult.outputs[l.outputParamIndex].comfy_node_id:l.flowResult.outputs[0].comfy_node_id})||"",type:z.type}:z.type==="list"?j[z.name]={value:z.default||Object.keys(z.options)[0]||"",type:z.type,options:z.options}:z.type==="bool"?j[z.name]={value:z.default||!1,type:z.type}:["range","range_scale"].includes(z.type)&&(j[z.name]={value:z.default||0,type:z.type}),S.push(j),S},[]);console.debug("[Send to flow]: input_params_map",F),c.value=!0,r.runFlow(I,F,1,l.translatePrompt,y.value,y.value?Number(l.flowResult.task_id):null).finally(()=>{c.value=!1,p("update:show",!1)})}const y=C(!1),x=B(()=>{var I;return l.flowResult.progress===100&&((I=l.flowResult)==null?void 0:I.error)===""});return Qe(()=>{var F,S;const I=l.flowResult?((S=(F=l==null?void 0:l.flowResult)==null?void 0:F.outputs[l.outputParamIndex])==null?void 0:S.type)??"image":"image";r.fetchSubFlows(I).then(()=>{d.value=a.value[0]||""}),y.value=!1}),(I,F)=>{const S=_e,z=ct,j=Ze,M=Ge,m=de,v=Ie;return u(),_(v,{modelValue:s.value,"onUpdate:modelValue":F[2]||(F[2]=k=>s.value=k),class:"z-[90]",transition:!1},{default:b(()=>[w("div",bo,[F[4]||(F[4]=w("h2",{class:"text-lg text-center mb-4"},"Send to flow",-1)),w("div",ko,[t(x)?(u(),_(S,{key:0,src:e.outputImgSrc,class:"w-1/2 rounded-lg",draggable:!1},null,8,["src"])):(u(),_(z,{key:1,color:"orange",icon:"i-heroicons-exclamation-circle-solid",title:`Task is still running (${Math.ceil(e.flowResult.progress)}%, ${e.flowResult.execution_time.toFixed(2)}s)`,description:e.flowResult.error!==""?e.flowResult.error:""},null,8,["title","description"]))]),e.inputParamsMapped?(u(),O("p",xo,X(["#"+e.flowResult.task_id,...Object.keys(e.inputParamsMapped).filter(k=>e.inputParamsMapped[k].value!=="").map(k=>`${e.inputParamsMapped[k].display_name}: ${e.inputParamsMapped[k].value}`)].join(" | ")),1)):R("",!0),w("p",_o,[t(a).length>0?(u(),_(j,{key:0,modelValue:t(d),"onUpdate:modelValue":F[0]||(F[0]=k=>J(d)?d.value=k:null),class:"w-full",size:"lg",options:t(a)},null,8,["modelValue","options"])):(u(),O("span",$o,"No sub-flows available"))]),e.isChildTask?(u(),_(z,{key:1,class:"mb-4",icon:"i-heroicons-exclamation-circle-solid",title:"Child task",description:"The latest child task is always used as input for sub-flow"})):R("",!0),w("div",Co,[f(M,{modelValue:t(y),"onUpdate:modelValue":F[1]||(F[1]=k=>J(y)?y.value=k:null),label:"Bind as child task"},null,8,["modelValue"]),f(m,{icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",variant:"outline",loading:t(c),disabled:t(a).length===0||e.isChildTask&&!t(x),onClick:$},{default:b(()=>F[3]||(F[3]=[A(" Send ")])),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])}}}),Io={class:"flex flex-col md:flex-row items-center justify-center mb-5 sticky top-1 z-[10]"},Ro={class:"flex items-center justify-center"},Mo={class:"p-4"},Fo={class:"text-md text-center text-red-500 mb-4"},Po={class:"flex justify-center"},Uo={key:0,class:"results overflow-auto"},zo=["id"],Vo={class:"text-sm text-slate-500 text-center mb-1"},Oo={class:"w-5/6 mx-auto flex flex-wrap items-center justify-center"},jo={class:"w-full flex justify-center items-center"},To={key:1,class:"text-center text-slate-500"},No=oe({__name:"Output",emits:["copy-prompt-inputs"],setup(e,{emit:n}){const l=pe(),s=B(()=>{var o;return l.flowResultsByName((o=l.currentFlow)==null?void 0:o.name).length>0||!1}),r=B(()=>{var o;return l.flowResultsByName((o=l.currentFlow)==null?void 0:o.name)||[]}),a=B(()=>l.$state.resultsPageSize);we(r,()=>{r.value.length<=l.$state.resultsPageSize?l.$state.resultsPage=1:l.$state.resultsPage>Math.ceil(r.value.length/l.$state.resultsPageSize)&&(l.$state.resultsPage=Math.ceil(r.value.length/l.$state.resultsPageSize))}),we(a,()=>{r.value.length<=l.$state.resultsPageSize?l.$state.resultsPage=1:l.$state.resultsPage>Math.ceil(r.value.length/l.$state.resultsPageSize)&&(l.$state.resultsPage=Math.ceil(r.value.length/l.$state.resultsPageSize)),l.saveUserOptions()}),dt(()=>{l.$state.flow_results_filter="",l.$state.resultsPage=1});const d=n;function c(o){d("copy-prompt-inputs",o.input_params_mapped)}function p(o){S.value=o,F.value=!0}const $=C(null),y=C(!1);window.addEventListener("scroll",()=>{var o;y.value=window.scrollY>(((o=$.value)==null?void 0:o.offsetTop)+window.screen.height||0)});const x=B(()=>l.$state.resultsPage);we(x,()=>{const o=document.getElementById("output-container");o&&o.scrollIntoView({behavior:"smooth"})});const I=C(!1),F=C(!1),S=C(""),z=C(!1),j=C(!1),M=C(!1),m=C(""),v=C(null),k=C({}),g=C(0),N=C(!1);function E(o,i=0){if(o.child_tasks.length===0||!St(o,i,o.outputs[i].comfy_node_id))v.value=o,m.value=fe({task_id:o.task_id,node_id:o.outputs[i].comfy_node_id}),k.value=o.input_params_mapped,N.value=!1;else{const V=Ct(o,i,o.outputs[i].comfy_node_id);v.value=V,k.value=o.input_params_mapped,m.value=fe({task_id:V.task_id,node_id:V.outputs[0].comfy_node_id}),N.value=!0}g.value=i,M.value=!0}function te(o){var K;const i=o.extra_flags!==null&&((K=o==null?void 0:o.extra_flags)==null?void 0:K.profiler_execution),V=[{label:"Comfy flow",labelClass:"text-blue-500 text-sm",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500 h-4 w-4",click:()=>{var Z;return l.downloadFlowComfy((Z=l.currentFlow)==null?void 0:Z.name,o.task_id)}}];i&&V.push({label:"Execution details",labelClass:"text-orange-500 text-sm",icon:"i-mdi-bug",iconClass:"bg-orange-500 h-4 w-4",click:()=>{o.execution_details?o.showExecutionDetailsModal=!0:l.fetchTaskHistoryItem(o.task_id).then(Z=>{o.execution_details=Z.execution_details,o.showExecutionDetailsModal=!0})}});const W=[[{label:"Use params",labelClass:"text-cyan-500 text-sm",icon:"i-heroicons-document-duplicate-16-solid",iconClass:"bg-cyan-500 h-4 w-4",click:()=>c(o)}],V];return o.outputs.length===1&&o.outputs.every(Z=>Z.type==="image")&&W.splice(1,0,[{label:"Send to flow",labelClass:"text-violet-500 text-sm",icon:"i-heroicons-arrow-uturn-up-solid",iconClass:"bg-violet-500 h-4 w-4",click:()=>{E(o)}}]),W}return(o,i)=>{var H;const V=Nl,W=xe,K=We,Z=on,ue=rn,me=de,ie=Ye,ne=Ee,ye=Ie,ee=Kl,Y=oo,ce=uo,ge=fo,q=vo,h=yo,P=So,L=_e;return u(),O("div",{id:"output-container",ref_key:"outputContainer",ref:$,class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md my-10"},[f(V,{show:t(y),class:"fixed bottom-5 right-5",target:"output-container"},null,8,["show"]),w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:i[0]||(i[0]=()=>{I.value=!t(I)})},[f(W,{name:t(I)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),A(" Output ("+X(t(r).filter(U=>U.parent_task_id===null).length)+") ",1)]),t(I)?R("",!0):(u(),O(se,{key:0},[w("div",Io,[f(K,{modelValue:t(l).$state.flow_results_filter,"onUpdate:modelValue":i[1]||(i[1]=U=>t(l).$state.flow_results_filter=U),icon:"i-heroicons-magnifying-glass-20-solid",color:"white",class:"md:mr-3",label:"Filter by prompt",trailing:!0,placeholder:"Filter results by prompt"},null,8,["modelValue"]),t(r).filter(U=>U.parent_task_id===null).length>t(l).$state.resultsPageSize?(u(),_(Z,{key:0,modelValue:t(l).$state.resultsPage,"onUpdate:modelValue":i[2]||(i[2]=U=>t(l).$state.resultsPage=U),class:"my-1 md:my-0","page-count":t(l).$state.resultsPageSize,total:t(r).filter(U=>U.parent_task_id===null).length,"show-first":"","show-last":""},null,8,["modelValue","page-count","total"])):R("",!0),w("div",Ro,[f(ue,{modelValue:t(l).resultsPageSize,"onUpdate:modelValue":i[3]||(i[3]=U=>t(l).resultsPageSize=U),class:"md:mx-3 w-fit mr-3",options:[5,10,20,50,100],label:"Results per page"},null,8,["modelValue"]),f(ie,{items:[[{label:"Delete all results",labelClass:"text-red-500",icon:"i-heroicons-trash",iconClass:"dark:text-red-500 text-red-500",click:()=>z.value=!0}]],mode:"click",label:"Options",popper:{placement:"bottom-end"}},{default:b(()=>[f(me,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])]),f(ye,{modelValue:t(z),"onUpdate:modelValue":i[6]||(i[6]=U=>J(z)?z.value=U:null),class:"z-[90]",transition:!1},{default:b(()=>[w("div",Mo,[i[15]||(i[15]=w("p",{class:"text-lg text-center mb-4"},"Are you sure you want to delete all results?",-1)),w("p",Fo,[i[11]||(i[11]=A(" All history and images of ")),f(ne,{class:"mx-1",color:"orange",variant:"outline"},{default:b(()=>[A(X(t(l).currentFlow.display_name),1)]),_:1}),i[12]||(i[12]=A(" will be deleted. "))]),w("div",Po,[f(me,{class:"mr-2",color:"red",variant:"outline",loading:t(j),onClick:i[4]||(i[4]=()=>{var U;j.value=!0,t(l).deleteFlowResults((U=t(l).currentFlow)==null?void 0:U.name).then(()=>{j.value=!1,z.value=!1})})},{default:b(()=>i[13]||(i[13]=[A(" Yes ")])),_:1},8,["loading"]),f(me,{variant:"outline",onClick:i[5]||(i[5]=()=>z.value=!1)},{default:b(()=>i[14]||(i[14]=[A("No")])),_:1})])])]),_:1},8,["modelValue"])]),t(s)?(u(),O("div",Uo,[(u(!0),O(se,null,ve(t(l).flowResultsByNamePaginated((H=t(l).currentFlow)==null?void 0:H.name),U=>(u(),O("div",{id:"task_id_"+U.task_id,key:U.task_id,class:"flex flex-col justify-center mx-auto mb-5"},[U.outputs.some(G=>["image","image-animated"].includes(G.type))?(u(),_(ee,{key:0,"flow-result":U,"handle-send-to-flow":E,"open-image-modal":p},null,8,["flow-result"])):U.outputs.some(G=>G.type==="video")?(u(),_(Y,{key:1,"flow-result":U,"handle-send-to-flow":E,"open-image-modal":p},null,8,["flow-result"])):U.outputs.some(G=>G.type==="audio")?(u(),_(ce,{key:2,"flow-result":U},null,8,["flow-result"])):U.outputs.some(G=>G.type==="text")?(u(),_(ge,{key:3,"flow-result":U},null,8,["flow-result"])):R("",!0),w("div",Vo,[w("div",Oo,[f(q,{"flow-result":U},null,8,["flow-result"])])]),f(h,{"flow-result":U},null,8,["flow-result"]),w("div",jo,[f(me,{class:"mr-3",color:"red",icon:"i-heroicons-trash",variant:"outline",size:"xs",onClick:()=>t(l).deleteFlowHistory(U.task_id)},{default:b(()=>i[16]||(i[16]=[A(" Delete ")])),_:2},1032,["onClick"]),f(ie,{items:te(U),mode:"click",popper:{placement:"bottom-start"}},{default:b(()=>[f(me,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid",size:"xs"})]),_:2},1032,["items"])])],8,zo))),128)),f(P,{show:t(M),"onUpdate:show":i[7]||(i[7]=U=>J(M)?M.value=U:null),"flow-result":t(v),"output-img-src":t(m),"output-param-index":t(g),"input-params-mapped":t(k),"is-child-task":t(N)},null,8,["show","flow-result","output-img-src","output-param-index","input-params-mapped","is-child-task"])])):(u(),O("p",To," No output results available "))],64)),f(ye,{modelValue:t(F),"onUpdate:modelValue":i[10]||(i[10]=U=>J(F)?F.value=U:null),class:"z-[90]",transition:!1,fullscreen:""},{default:b(()=>[f(me,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:i[8]||(i[8]=()=>F.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:i[9]||(i[9]=Ke(()=>F.value=!1,["left"]))},[t(S)?(u(),_(L,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",src:t(S)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])],512)}}}),Bo=Zt("civitAiStore",{actions:{fetchFlowLoras(e,n,l=50,s=null){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:r}=Le();let d=`https://civitai.com/api/v1/models?baseModels=${e.lora_connect_points[Object.keys(e.lora_connect_points)[0]].base_model_type}&types=LORA&limit=${l}`;s&&(s.includes(window.location.hostname)&&(s=s.replace(window.location.hostname,"civitai.com")),d=s);const c=`/other/proxy?target=${encodeURIComponent(d)}`;return r(c,{method:"GET",headers:{Authentication:"Bearer "+n,Accept:"application/json"}})},fetchFlowLorasByHash(e,n,l){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:s}=Le(),r=`https://civitai.com/api/v1/model-versions/by-hash/${l}`,a=`/other/proxy?target=${encodeURIComponent(r)}`;return s(a,{method:"GET",headers:{Authentication:"Bearer "+n,Accept:"application/json"}})}}}),Lo={class:"p-4 overflow-y-auto relative"},Ao={key:1},qo={class:"flex flex-col justify-between w-full md:flex-row md:gap-4 md:items-center lg:items-start"},Eo={class:"flex flex-col gap-2 lg:flex-row md:justify-end items-start w-full"},Do={class:"flex flex-col md:flex-row flex-wrap gap-2 justify-between items-center w-full px-4 py-3"},Wo={class:"flex items-center gap-1.5"},Ho={class:"flex gap-1.5 items-center"},Go={class:"flex items-center h-5"},Xo=["checked","indeterminate","onChange"],Jo={key:0,class:"flex items-center h-5"},Qo=["checked","onChange"],Ko=["href"],Yo=["innerHTML"],Zo={class:"p-4 max-h-64 max-w-xl overflow-y-auto"},ea={key:0},ta={class:"flex items-center"},na={class:"flex items-center"},la={key:0,class:"flex justify-center space-x-2 w-full"},oa={key:1,controls:"",width:256,height:256},aa=["src"],sa={class:"flex justify-end"},ia=oe({__name:"LoraSelectorModal",props:Ae({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const n=e,l=je(e,"show"),s=Me(),r=pe(),a=xt(),d=Bo(),c=C(!1),p=C({items:[],metadata:{}}),$=B(()=>a.settingsMap.civitai_auth_token.value!==""),y=B(()=>a.settingsMap.civitai_auth_token.value||""),x=[{key:"name",label:"Name",sortable:!0,class:""},{key:"description",label:"Description",sortable:!1,class:""},{key:"trigger_words",label:"Trigger words",sortable:!1,class:""},{key:"nsfw",label:"NSFW",sortable:!1,class:""},{key:"statsDownloadCount",label:"Download count",sortable:!1,class:""},{key:"statsThumbsUpCount",label:"Thumbs up",sortable:!1,class:""},{key:"modelVersion",label:"Model version",sortable:!1,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}],I=C([]),F=C({openedRows:[],row:{}}),S=C(""),z=()=>{S.value=""},j=B(()=>{var h;let q=((h=p.value)==null?void 0:h.items)||[];return S.value&&(q=q.filter(P=>P.name.toLowerCase().includes(S.value.toLowerCase()))),q.forEach(P=>{!M.value[P.id]&&(P==null?void 0:P.modelVersions.length)>0&&(M.value[P.id]=P==null?void 0:P.modelVersions[0].name);const L=Object.keys(Y.value);P.modelVersions.forEach(H=>{L.includes(H.files[0].hashes.SHA256.toLowerCase())&&Y.value[H.files[0].hashes.SHA256.toLowerCase()]!==null&&(M.value[P.id]=H.name,P.currentFlowLora=!0,I.value.includes(P)||I.value.push(P))})}),q}),M=C({});function m(q){var h;return((h=q.modelVersions.find(P=>P.name===M.value[q.id]))==null?void 0:h.images)||q.modelVersions[0].images||[]}function v(q){var h;return((h=q.modelVersions.find(P=>P.name===M.value[q.id]))==null?void 0:h.trainedWords)||q.modelVersions[0].trainedWords||[]}const k=C(!0),g=C(""),N=C(n.flow.display_name),E=C(n.flow.description),te=C(n.flow.license),o=C(n.flow.required_memory_gb||0),i=C(n.flow.version);function V(){const q=Object.keys(n.flow.lora_connect_points)[0],P=n.flow.lora_connect_points[q].connected_loras.filter(U=>Y.value[U.hash]!==null).map(U=>({display_name:U.display_name,model_url:U.url,strength_model:U.strength_model})),L={[q]:[]};k.value&&L[q].push(...P);const H=I.value.reduce((U,G)=>{const D=G.modelVersions.find(he=>he.name===M.value[G.id]);if(!D||Y.value[D.files[0].hashes.SHA256.toLowerCase()])return U;const Q={strength_model:1,model_url:D.downloadUrl,display_name:G.name};return U.push(Q),U},[]);return L[q].push(...H),console.debug("[DEBUG] newFlowConnectionPoints: ",L),L}function W(q){const h=q.modelVersions.find(H=>H.name===M.value[q.id]);if(!h)return;const P=h.files[0].hashes.SHA256.toLowerCase();Y.value[P]&&(Y.value[P]=null);const L=I.value.indexOf(q);L!==-1&&I.value.splice(L,1),q.currentFlowLora=!1}const K=B(()=>r.flows.find(q=>q.name===g.value)),Z=B(()=>/^[a-z0-9_-]+$/i.test(g.value)),ue=B(()=>g.value!==""&&Z&&!K.value),me=B(()=>g.value===""?"Flow name is required.":Z.value?K.value?"Flow name already exists.":"":"Flow name can only contain letters, numbers, dashes and underscores."),ie=B(()=>I.value.filter(q=>!Y.value[q.modelVersions[0].files[0].hashes.SHA256.toLowerCase()]).length!==0),ne=B(()=>ie.value&&ue.value&&N.value!==""&&E.value!==""),ye=B(()=>ie.value?ue.value?N.value===""?"Please provide a display name.":E.value===""?"Please provide a description.":"":"Please provide a valid flow name.":"No LoRAs selected");function ee(){if(I.value.length===0){s.add({title:"No LoRAs selected",description:"Please select at least one LoRA to apply and install."});return}const q={new_name:g.value,new_display_name:N.value,new_description:E.value,new_license:te.value,new_required_memory_gb:o.value,new_version:i.value,new_lora_connection_points:V()};console.debug("[DEBUG] Clone flow params: ",q),c.value=!0,r.cloneFlow(n.flow,q).then(()=>{r.fetchFlows();const h=It();s.add({title:"Flow clone applied",actions:[{label:"View flow",click:()=>{h.push("/workflows/"+g.value)}}]})}).catch(h=>{console.error("Error applying and installing flow: ",h.message||"Unknown error"),s.add({title:"Error applying and installing flow",description:"An error occurred while applying and installing the flow. See the console for more details."})}).finally(()=>{c.value=!1})}const Y=C({});function ce(){const q=n.flow.lora_connect_points[Object.keys(n.flow.lora_connect_points)[0]].connected_loras;console.debug("Flow LORAs: ",q),Promise.all(q.map(h=>{var P;return(P=d.fetchFlowLorasByHash(n.flow,y.value,h.hash))==null?void 0:P.then(L=>(h.hash in Y.value||(Y.value[h.hash]=L),L))})).then(()=>{console.debug("Fetched flow LORAs info: ",Y.value)}).catch(h=>{console.error("Error fetching flow LORAs info: ",h),s.add({title:"Error fetching flow LORAs info",description:"An error occurred while fetching LoRAs info for the flow. See the console for more details."})})}function ge(q=!1){var P;if(!n.flow||!y.value)return;c.value=!0,q||ce();let h=null;return q&&((P=p.value.metadata)!=null&&P.nextPage)&&(h=p.value.metadata.nextPage),d.fetchFlowLoras(n.flow,y.value,50,h).then(L=>{console.debug('Fetched flow "'+n.flow.name+'" loras: ',L);const H=n.flow.lora_connect_points[Object.keys(n.flow.lora_connect_points)[0]].base_model_type,U=L.items.reduce((G,D)=>(D.modelVersions=D.modelVersions.filter(Q=>Q.baseModel===H),D.modelVersions.length>0&&(p.value.items.find(Q=>Q.id===D.id)||G.push(D)),G),[]);return U.length===0&&s.add({title:"No more supported LoRAs",description:"No supported LoRAs available for the flow."}),p.value.items.push(...U),p.value.metadata=L.metadata,L}).catch(L=>{console.error('Error fetching flow "'+n.flow.name+'" loras: ',L),s.add({title:'Error fetching flow "'+n.flow.name+'" loras',description:"An error occurred while fetching LoRAs for the flow. See the console for more details."})}).finally(()=>{c.value=!1})}return(q,h)=>{const P=de,L=en,H=ct,U=We,G=He,D=Ge,Q=De,he=kt,Pe=Ee,be=xe,Ue=Ze,ae=_e,Vt=Fe,Ot=un,jt=Rt,Tt=Ie;return u(),_(Tt,{modelValue:l.value,"onUpdate:modelValue":h[15]||(h[15]=T=>l.value=T),fullscreen:""},{default:b(()=>[w("div",Lo,[f(P,{class:"absolute top-3 right-3",icon:"i-heroicons-x-mark",variant:"ghost",onClick:h[0]||(h[0]=()=>l.value=!1)}),h[22]||(h[22]=w("h2",{class:"text-xl font-bold"},"Modify flow",-1)),h[23]||(h[23]=w("p",{class:"text-sm text-slate-500 my-2"}," Select LoRAs to modify the flow. New Flow will be created and installed with selected LoRAs. ",-1)),t($)?(u(),O("div",Ao,[w("div",qo,[f(P,{class:"my-1",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",loading:t(c),onClick:h[1]||(h[1]=()=>{p.value={items:[],metadata:{}},Y.value={},z(),ge()})},{default:b(()=>h[17]||(h[17]=[A(" Fetch LoRAs models from CivitAI ")])),_:1},8,["loading"]),w("div",Eo,[f(G,{label:"New flow name",class:"flex justify-center flex-col w-full",error:t(me)},{default:b(()=>[f(U,{modelValue:t(g),"onUpdate:modelValue":h[2]||(h[2]=T=>J(g)?g.value=T:null),type:"text",placeholder:"unique_flow_name",onInput:h[3]||(h[3]=T=>{T.target.value=T.target.value.toLowerCase(),g.value=T.target.value.toLowerCase()})},null,8,["modelValue"])]),_:1},8,["error"]),f(G,{label:"New display name",class:"flex justify-center flex-col w-full",error:t(N)!==""?"":"Display name is required."},{default:b(()=>[f(U,{modelValue:t(N),"onUpdate:modelValue":h[4]||(h[4]=T=>J(N)?N.value=T:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),f(G,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:b(()=>[f(U,{modelValue:t(E),"onUpdate:modelValue":h[5]||(h[5]=T=>J(E)?E.value=T:null),type:"text",placeholder:"Description"},null,8,["modelValue"])]),_:1}),f(G,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:b(()=>[f(U,{modelValue:t(te),"onUpdate:modelValue":h[6]||(h[6]=T=>J(te)?te.value=T:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),f(G,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:b(()=>[f(U,{modelValue:t(o),"onUpdate:modelValue":h[7]||(h[7]=T=>J(o)?o.value=T:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),f(G,{label:"Version",class:"flex justify-center flex-col w-full"},{default:b(()=>[f(U,{modelValue:t(i),"onUpdate:modelValue":h[8]||(h[8]=T=>J(i)?i.value=T:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})])]),f(jt,{class:"w-full",ui:{base:"",ring:"",divide:"divide-y divide-gray-200 dark:divide-gray-700",header:{padding:"px-4 py-5"},body:{padding:"",base:"divide-y divide-gray-200 dark:divide-gray-700"},footer:{padding:"p-4"}}},{footer:b(()=>[w("div",sa,[f(P,{class:"mr-2",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",color:"blue",disabled:t(p).items.length===0||t(p).items.length>0&&!t(p).metadata.nextPage,loading:t(c),onClick:h[14]||(h[14]=()=>{ge(!0)})},{default:b(()=>h[21]||(h[21]=[A(" Load more ")])),_:1},8,["disabled","loading"])])]),default:b(()=>[w("div",Do,[w("div",Wo,[f(U,{modelValue:t(S),"onUpdate:modelValue":h[9]||(h[9]=T=>J(S)?S.value=T:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:"Filter by name..."},null,8,["modelValue"])]),w("div",Ho,[t(ie)?(u(),_(D,{key:0,modelValue:t(k),"onUpdate:modelValue":h[10]||(h[10]=T=>J(k)?k.value=T:null),label:"Keep previous LoRAs",class:"mr-2"},null,8,["modelValue"])):R("",!0),t(ie)?(u(),_(P,{key:1,variant:"outline",icon:"i-heroicons-x-circle",color:"orange",class:"mr-2",onClick:h[11]||(h[11]=()=>t(I).splice(0))},{default:b(()=>h[18]||(h[18]=[A(" Clear selection ")])),_:1})):R("",!0),f(Q,{text:t(ye)},{default:b(()=>[f(P,{variant:"outline",icon:"i-heroicons-check-16-solid",disabled:!t(ne),loading:t(c),onClick:ee},{default:b(()=>h[19]||(h[19]=[A(" Apply and install ")])),_:1},8,["disabled","loading"])]),_:1},8,["text"])])]),f(Ot,{modelValue:t(I),"onUpdate:modelValue":h[12]||(h[12]=T=>J(I)?I.value=T:null),expand:t(F),"onUpdate:expand":h[13]||(h[13]=T=>J(F)?F.value=T:null),columns:x,rows:t(j),loading:t(c),ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10",tr:{base:"dark:hover:bg-slate-800"}}},{caption:b(()=>h[20]||(h[20]=[w("caption",{class:"text-slate-500 text-sm py-1"},"Only supported LORAs for the basic model type are listed",-1)])),"select-header":b(({indeterminate:T,checked:re,change:Te})=>[w("div",Go,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:re,indeterminate:T&&t(ie),onChange:et=>Te(et.target.checked)},null,40,Xo)])]),"select-data":b(({checked:T,change:re,row:Te})=>[Te!=null&&Te.currentFlowLora?R("",!0):(u(),O("div",Jo,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:T,onChange:et=>re(et.target.checked)},null,40,Qo)]))]),"name-data":b(({row:T})=>[w("a",{href:`https://civitai.com/models/${T.id}`,target:"_blank",class:"text-blue-500 underline"},X(T.name),9,Ko)]),"description-data":b(({row:T})=>[f(he,null,{panel:b(()=>[w("div",{class:"model-description p-4 max-h-64 max-w-xl overflow-y-auto",innerHTML:T.description},null,8,Yo)]),default:b(()=>[f(P,{color:"white",label:"Description","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:2},1024)]),"trigger_words-data":b(({row:T})=>[f(he,null,{panel:b(()=>[w("div",Zo,[v(T).length===0?(u(),O("p",ea,"No trigger words available for this model version.")):(u(!0),O(se,{key:1},ve(v(T),re=>(u(),_(Pe,{key:re,class:"flex flex-wrap gap-3 my-1 whitespace-normal",label:re,color:"white",variant:"outline"},null,8,["label"]))),128))])]),default:b(()=>[f(P,{color:"white",label:`Trigger words (${v(T).length})`,"trailing-icon":"i-heroicons-chevron-down-20-solid"},null,8,["label"])]),_:2},1024)]),"nsfw-data":b(({row:T})=>[f(Q,{text:`NSFW level: ${T.nsfwLevel}`,class:"pl-4"},{default:b(()=>[f(be,{name:T.nsfw?"i-heroicons-x-circle":"i-heroicons-check-circle",class:le({"text-red-500":T.nsfw,"text-green-500":!T.nsfw})},null,8,["name","class"])]),_:2},1032,["text"])]),"statsThumbsUpCount-data":b(({row:T})=>[w("div",ta,[f(be,{name:"i-heroicons-hand-thumb-up-solid",class:"text-green-500 mr-1"}),w("span",null,X(T.stats.thumbsUpCount),1)])]),"statsDownloadCount-data":b(({row:T})=>[w("div",na,[f(be,{name:"i-heroicons-arrow-down-circle",class:"text-blue-500 mr-1"}),w("span",null,X(T.stats.downloadCount),1)])]),"modelVersion-data":b(({row:T})=>[f(Ue,{modelValue:t(M)[T.id],"onUpdate:modelValue":re=>t(M)[T.id]=re,options:T.modelVersions.map(re=>re.name)},null,8,["modelValue","onUpdate:modelValue","options"])]),"actions-data":b(({row:T})=>[T!=null&&T.currentFlowLora?(u(),_(Q,{key:1,text:"Remove previously selected LoRA"},{default:b(()=>[f(P,{icon:"i-heroicons-minus-16-solid",variant:"outline",color:"orange",onClick:re=>W(T)},null,8,["onClick"])]),_:2},1024)):(u(),_(P,{key:0,icon:t(I).includes(T)?"i-heroicons-check-16-solid":"i-heroicons-plus-16-solid",variant:"outline",color:t(I).includes(T)?"green":"white",onClick:()=>{if(t(I).includes(T)){t(I).splice(t(I).indexOf(T),1);return}t(I).push(T)}},null,8,["icon","color","onClick"]))]),expand:b(({row:T})=>[m(T).length>0?(u(),O("div",la,[f(Vt,{class:"my-3",items:m(T).map(re=>({id:re.id,url:re.url,type:(re==null?void 0:re.type)||"image"})),ui:{item:"mx-1"}},{default:b(({item:re})=>[re.type==="image"?(u(),_(ae,{key:0,src:re.url,height:256,width:256,loading:"lazy",draggable:"false"},null,8,["src"])):(u(),O("video",oa,[w("source",{src:re.url},null,8,aa)]))]),_:2},1032,["items"])])):(u(),_(H,{key:1,title:"No images",description:"No images available for this model version.",variant:"soft",color:"amber"}))]),_:1},8,["modelValue","expand","rows","loading"])]),_:1})])):(u(),_(H,{key:0,class:"my-4",title:"CivitAI token missing",description:"Please add a CivitAI token in the settings to use this feature.",variant:"soft",color:"red"},{actions:b(()=>[f(L,{to:"/settings"},{default:b(()=>[f(P,{class:"lg:px-3 py-2",icon:"i-heroicons-arrow-top-right-on-square-16-solid",variant:"link",color:"white"},{default:b(()=>h[16]||(h[16]=[A(" Go to Settings ")])),_:1})]),_:1})]),_:1}))])]),_:1},8,["modelValue"])}}}),ra={class:"flex flex-col lg:flex-row flex-grow items-start w-full"},ua={class:"card-wrapper w-full lg:pr-5"},da={key:0,class:"p-0 text-sm"},ca={class:"flex flex-row items-center text-slate-400 mb-2"},ma={class:"flex flex-row flex-wrap items-center text-md mb-2"},fa=["href"],pa={class:"flex flex-row items-center text-md mb-2"},ga=["href"],va={key:1},ha={class:"flex flex-row items-center text-md mb-2"},wa={key:0},ya={class:"flex flex-row items-center text-md mb-2"},ba={key:0,class:"flex flex-row flex-wrap items-center text-md mb-2"},ka=["href"],xa={key:1},_a={class:"flex flex-row items-center mb-2"},$a={key:1,class:"flex flex-row flex-wrap items-center text-md"},Ca={key:0,class:"flex justify-end"},Sa={class:"flex flex-row items-center justify-center text-sm mr-2"},Ia={key:1},Ra={class:"text-sm flex justify-end"},Ma={class:"flex flex-row items-center justify-center text-sm mr-3"},Fa={key:0,class:"text-right"},Pa={class:"prompt-wrapper w-full"},Ua={class:"flex items-center justify-between"},za={class:"pb-2"},Va={class:"flex justify-end items-center"},Ha=oe({__name:"[name]",setup(e){const n=tn(),l=pe();l.setCurrentFlow(n.params.name);const s=B(()=>l.flowInstallingByName(n.params.name)),r=B(()=>{var k;return s.value&&((k=s.value)==null?void 0:k.progress)<100||!1}),a=C(!1),d=B(()=>{var k;return s.value?"error"in s.value&&((k=s.value)==null?void 0:k.error)!==""?`${s.value.progress.toFixed(0)}% Error setting up`:`${s.value.progress.toFixed(0)}% Setting up`:"Setup flow"}),c=C(!1),p=C(!1),$=C(!1),y=B(()=>{var g,N;const k=[[{label:"Delete flow",icon:"i-heroicons-trash",click:I}]];return((g=l==null?void 0:l.currentFlow)==null?void 0:g.new_version_available)!==""&&k[0].unshift({label:`Update to ${l.currentFlow.new_version_available}`,icon:"i-heroicons-arrow-path",click:()=>{l.updateFlow(l.currentFlow)}}),(N=l==null?void 0:l.currentFlow)!=null&&N.lora_connect_points&&Object.keys(l.currentFlow.lora_connect_points).length>0&&k[0].unshift({label:"Modify flow",icon:"i-heroicons-plus-circle",click:()=>{$.value=!0}}),k});function x(k,g=!1){c.value=!0,l.deleteFlow(k).then(()=>{g&&It().push("/")}).finally(()=>{c.value=!1,p.value=!1})}function I(){var g;const k=((g=l.currentFlow)==null?void 0:g.private)||!1;if(k){p.value=!0;return}x(l.currentFlow,k)}const F=C(!1),S=C(null),z=function(k){var g;(g=S.value)==null||g.copyPromptInputs(k)},j=ut(),M=B(()=>{var k;return(k=l.currentFlow)==null?void 0:k.models.filter(g=>g.installed).reduce((g,N)=>g+(N==null?void 0:N.file_size)||0,0)}),m=B(()=>{var k;return(k=l.currentFlow)==null?void 0:k.models.reduce((g,N)=>g+(N==null?void 0:N.file_size)||0,0)}),v=B(()=>!M.value&&!m.value?"":M.value===m.value?` - ${Ve(m.value)}`:` - ${Ve(M.value)} / ${Ve(m.value)}`);return(k,g)=>{const N=xe,E=De,te=Ee,o=de,i=Ye,V=Rt,W=yl,K=Tl,Z=No,ue=Ft,me=Ie,ie=ia,ne=nn;return u(),_(ne,null,{default:b(()=>{var ye;return[!t(l).loading.flows_available&&!t(l).loading.flows_installed&&t(l).currentFlow&&!t(l).$state.loading.tasks_history?(u(),O(se,{key:0},[w("div",ra,[w("div",ua,[f(V,{as:"div",class:"w-full mb-5"},ln({header:b(()=>{var ee,Y;return[w("h2",{class:"text-xl font-bold cursor-pointer select-none flex items-center",onClick:g[0]||(g[0]=()=>{F.value=!t(F)})},[(ee=t(l).currentFlow)!=null&&ee.private?(u(),_(E,{key:0,text:"This flow is local, manually added"},{default:b(()=>{var ce;return[f(N,{name:"i-heroicons-lock-closed",class:le(["mr-2",{"text-stone-500":!((ce=t(l).currentFlow)!=null&&ce.is_supported_by_workers)}])},null,8,["class"])]}),_:1})):R("",!0),f(N,{name:t(F)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),f(E,{text:(Y=t(l).currentFlow)!=null&&Y.is_supported_by_workers?"":"No workers capable of running this flow",popper:{placement:"top"}},{default:b(()=>{var ce,ge;return[w("span",{class:le({"text-stone-500":!((ce=t(l).currentFlow)!=null&&ce.is_supported_by_workers)})},X((ge=t(l).currentFlow)==null?void 0:ge.display_name),3)]}),_:1},8,["text"])])]}),default:b(()=>{var ee,Y,ce,ge,q,h,P,L,H,U,G,D,Q,he,Pe,be,Ue;return[t(F)?R("",!0):(u(),O("div",da,[w("p",ca,X((ee=t(l).currentFlow)==null?void 0:ee.description),1),w("p",ma,[f(N,{name:"i-heroicons-user-16-solid",class:"mr-1"}),g[9]||(g[9]=w("b",null,"Author:",-1)),g[10]||(g[10]=A("  ")),w("a",{class:"hover:underline text-md",href:(Y=t(l).currentFlow)==null?void 0:Y.homepage,rel:"noopener",target:"_blank"},X((ce=t(l).currentFlow)==null?void 0:ce.author),9,fa)]),w("p",pa,[f(N,{name:"i-heroicons-document-text",class:"mr-1"}),(ge=t(l).currentFlow)!=null&&ge.documentation?(u(),O("a",{key:0,class:"hover:underline",href:(q=t(l).currentFlow)==null?void 0:q.documentation,rel:"noopener",target:"_blank"}," Documentation ",8,ga)):(u(),O("span",va,"No documentation"))]),w("p",ha,[f(N,{name:"i-heroicons-clock",class:"mr-1"}),g[11]||(g[11]=w("b",null,"Version:",-1)),g[12]||(g[12]=A("  ")),w("span",null,X((h=t(l).currentFlow)==null?void 0:h.version),1),((P=t(l).currentFlow)==null?void 0:P.new_version_available)!==""?(u(),O("span",wa,"  (new version available: "+X((L=t(l).currentFlow)==null?void 0:L.new_version_available)+") ",1)):R("",!0)]),w("p",ya,[f(N,{name:"i-heroicons-tag",class:"mr-1"}),g[13]||(g[13]=w("b",null,"Tags:",-1)),g[14]||(g[14]=A("  ")),((H=t(l).currentFlow)==null?void 0:H.tags.length)>0?(u(!0),O(se,{key:0},ve((U=t(l).currentFlow)==null?void 0:U.tags,ae=>(u(),_(te,{key:ae,label:ae,color:"white",variant:"solid",class:"m-1"},null,8,["label"]))),128)):(u(),_(te,{key:1,label:"No tags",color:"white",variant:"solid",class:"m-1"}))]),((D=(G=t(l).currentFlow)==null?void 0:G.models)==null?void 0:D.length)>0?(u(),O("p",ba,[f(N,{name:"i-heroicons-arrow-down-on-square-stack",class:"mr-1"}),f(E,{text:t(m)-t(M)>0?`${("formatBytes"in k?k.formatBytes:t(Ve))(t(m)-t(M))} to download`:"All models installed",popper:{placement:"top"}},{default:b(()=>{var ae;return[w("b",null,"Models ("+X((ae=t(l).currentFlow)==null?void 0:ae.models.length)+X(t(v))+"):",1),g[15]||(g[15]=A("  "))]}),_:1},8,["text"]),(u(!0),O(se,null,ve((Q=t(l).currentFlow)==null?void 0:Q.models,ae=>(u(),_(te,{key:ae.name,class:"m-1",color:"white",variant:"solid"},{default:b(()=>[f(E,{text:ae.installed?"Model installed":"Model not installed"},{default:b(()=>[f(N,{name:ae.installed?"i-heroicons-check-circle-20-solid":"i-heroicons-x-mark-20-solid",class:le(ae.installed?"text-green-500":"text-orange-500")},null,8,["name","class"])]),_:2},1032,["text"]),ae.gated?(u(),_(E,{key:0,text:"Gated model, requires auth token for download",popper:{placement:"top"}},{default:b(()=>[f(N,{name:"i-heroicons-key",class:"mr-1"})]),_:1})):R("",!0),w("a",{class:"hover:underline underline-offset-4",href:ae.homepage,rel:"noopener",target:"_blank"},X(ae.name),9,ka),ae.file_size?(u(),O("span",xa," ("+X(("formatBytes"in k?k.formatBytes:t(Ve))(ae.file_size))+") ",1)):R("",!0)]),_:2},1024))),128))])):R("",!0),w("p",_a,[f(N,{name:"i-mdi-help-network-outline",class:"mr-1"}),g[18]||(g[18]=w("b",null,"Platforms:",-1)),g[19]||(g[19]=A("  ")),f(E,{text:"Linux"},{default:b(()=>[f(N,{name:"i-mdi-linux",class:"mr-1"})]),_:1}),f(E,{text:"Microsoft Windows"},{default:b(()=>[f(N,{name:"i-mdi-microsoft-windows",class:"mr-1"})]),_:1}),t(l).currentFlow.is_macos_supported?(u(),_(E,{key:0,text:"macOS"},{default:b(()=>[f(N,{name:"i-mdi-apple",class:"mr-1"})]),_:1})):R("",!0),(he=t(l).currentFlow)!=null&&he.required_memory_gb?(u(),_(E,{key:1,class:"flex flex-row items-center",text:"Required VRAM memory (GB)"},{default:b(()=>{var ae;return[g[16]||(g[16]=A(" (")),f(N,{name:"i-mdi-memory",class:"mr-1"}),w("span",null,X((ae=t(l).currentFlow)==null?void 0:ae.required_memory_gb)+" GB",1),g[17]||(g[17]=A(") "))]}),_:1})):R("",!0)]),((be=(Pe=t(l).currentFlow)==null?void 0:Pe.requires)==null?void 0:be.length)>0?(u(),O("p",$a,[g[20]||(g[20]=w("b",null,"Requires:",-1)),g[21]||(g[21]=A("  ")),(u(!0),O(se,null,ve((Ue=t(l).currentFlow)==null?void 0:Ue.requires,ae=>(u(),_(te,{key:ae,class:"m-1",color:"yellow",variant:"outline"},{default:b(()=>[A(X(ae),1)]),_:2},1024))),128))])):R("",!0)]))]}),_:2},[t(F)?void 0:{name:"footer",fn:b(()=>{var ee,Y;return[t(j).isAdmin?(u(),O("div",Ca,[w("div",Sa,[f(N,{name:t(l).isFlowInstalled(t(n).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:le({"text-green-500":t(l).isFlowInstalled(t(n).params.name),"text-red-500":!t(l).isFlowInstalled(t(n).params.name),"text-stone-500":t(l).isFlowInstalled(t(n).params.name)&&!((ee=t(l).currentFlow)!=null&&ee.is_supported_by_workers)})},X(t(l).isFlowInstalled(t(n).params.name)?(Y=t(l).currentFlow)!=null&&Y.is_supported_by_workers?"Installed":"Installed (no workers)":"Not installed"),3)]),t(l).isFlowInstalled(t(n).params.name)?R("",!0):(u(),_(E,{key:0,text:"Setup flow dependencies and configure it in ComfyUI",popper:{placement:"top"},"open-delay":500},{default:b(()=>[f(o,{icon:"i-heroicons-arrow-down-tray",class:"mx-3",color:"primary",variant:"outline",loading:t(r),onClick:g[1]||(g[1]=()=>t(l).setupFlow(t(l).currentFlow))},{default:b(()=>[A(X(t(d)),1)]),_:1},8,["loading"])]),_:1})),!t(l).isFlowInstalled(t(n).params.name)&&t(r)?(u(),_(E,{key:1,text:"Cancel flow installation",popper:{placement:"top"},"open-delay":500},{default:b(()=>[f(o,{icon:"i-heroicons-stop",variant:"outline",color:"orange",loading:t(a),onClick:g[2]||(g[2]=()=>{a.value=!0,t(l).cancelFlowSetup(t(l).currentFlow).then(()=>{a.value=!1})})},{default:b(()=>g[22]||(g[22]=[A(" Cancel ")])),_:1},8,["loading"])]),_:1})):R("",!0),t(l).isFlowInstalled(t(n).params.name)?(u(),_(i,{key:2,items:t(y),mode:"click",label:"Actions",popper:{placement:"bottom-end"}},{default:b(()=>[f(o,{color:"white",label:"Actions","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:1},8,["items"])):R("",!0)])):(u(),O("div",Ia,[w("div",Ra,[w("div",Ma,[f(N,{name:t(l).isFlowInstalled(t(n).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:le({"text-green-500":t(l).isFlowInstalled(t(n).params.name),"text-red-500":!t(l).isFlowInstalled(t(n).params.name)})},X(t(l).isFlowInstalled(t(n).params.name)?"Installed":"Not installed"),3)]),t(l).isFlowInstalled(t(n).params.name)?R("",!0):(u(),O("div",Fa,g[23]||(g[23]=[w("p",{class:"text-orange-500"},"Only admin can manage workflows.",-1),w("span",{class:"text-slate-500"},"Ask your admin to setup this workflow",-1)])))])]))]}),key:"0"}]),1024)]),w("div",Pa,[!t(c)&&t(l).isFlowInstalled(t(n).params.name)?(u(),_(W,{key:0,ref_key:"workflowPrompt",ref:S},null,512)):R("",!0)])]),!t(c)&&t(l).isFlowInstalled(t(n).params.name)?(u(),_(K,{key:0})):R("",!0),!t(c)&&t(l).isFlowInstalled(t(n).params.name)||t(l).flowResultsByName(t(n).params.name).length>0?(u(),_(Z,{key:1,onCopyPromptInputs:g[3]||(g[3]=ee=>z(ee))})):R("",!0)],64)):(u(),_(ue,{key:1,class:"mb-3"})),f(me,{modelValue:t(p),"onUpdate:modelValue":g[7]||(g[7]=ee=>J(p)?p.value=ee:null),"prevent-close":""},{default:b(()=>[f(V,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:b(()=>[w("div",Ua,[g[24]||(g[24]=w("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Confirm workflow deletion ",-1)),f(o,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:g[4]||(g[4]=ee=>p.value=!1)})])]),default:b(()=>{var ee;return[w("p",za,[g[25]||(g[25]=A(" Are you sure you want to delete the ")),g[26]||(g[26]=w("b",null,"private",-1)),g[27]||(g[27]=A(" workflow ")),w("b",null,X((ee=t(l).currentFlow)==null?void 0:ee.display_name),1),g[28]||(g[28]=A("? "))]),w("div",Va,[f(o,{icon:"i-heroicons-x-mark-16-solid",variant:"outline",color:"green",class:"mr-2",onClick:g[5]||(g[5]=Y=>p.value=!1)},{default:b(()=>g[29]||(g[29]=[A(" Cancel ")])),_:1}),f(o,{icon:"i-heroicons-trash",variant:"outline",color:"red",onClick:g[6]||(g[6]=Y=>{var ce;return x(t(l).currentFlow,((ce=t(l).currentFlow)==null?void 0:ce.private)||!1)})},{default:b(()=>g[30]||(g[30]=[A(" Delete ")])),_:1})])]}),_:1})]),_:1},8,["modelValue"]),t(j).isAdmin&&((ye=t(l))!=null&&ye.currentFlow)?(u(),_(ie,{key:2,show:t($),"onUpdate:show":g[8]||(g[8]=ee=>J($)?$.value=ee:null),flow:t(l).currentFlow},null,8,["show","flow"])):R("",!0)]}),_:1})}}});export{Ha as default};
