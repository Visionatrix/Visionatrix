import{_ as ne}from"./Ce0q1BcF.js";import{_ as ie}from"./ioqlICsP.js";import{_ as re,o as d,c as g,a as m,F as R,r as de,q as x,b as i,w as r,s as P,i as F,h as K,l as p,t as z,v as j,x as q,f as W,y as ue,z as H,A as fe,B as J,C as me,D as ce,E as pe,u as ye,G as ge,H as ve,I as _e,J as u,K as G,m as o,L as V,k as be,d as y,j as ke,M as Ce,p as Ue}from"./CvkeOVX7.js";import{_ as he}from"./BQLqXII3.js";import{_ as we}from"./D77PCaF2.js";import{_ as Ie}from"./CEcwuY70.js";import{_ as Ve}from"./CWMaZyeB.js";import"./D3_NRHbQ.js";const xe={wrapper:"relative min-w-0",ol:"flex items-center gap-x-1.5",li:"flex items-center gap-x-1.5 text-gray-500 dark:text-gray-400 text-sm leading-6 min-w-0",base:"flex items-center gap-x-1.5 group font-semibold min-w-0",label:"block truncate",icon:{base:"flex-shrink-0 w-5 h-5",active:"",inactive:""},divider:{base:"flex-shrink-0 w-5 h-5 rtl:rotate-180"},active:"text-primary-500 dark:text-primary-400",inactive:" hover:text-gray-700 dark:hover:text-gray-200",default:{divider:"i-heroicons-chevron-right-20-solid"}},O=fe(J.ui.strategy,J.ui.breadcrumb,xe),Fe=W({components:{UIcon:K,ULink:q},inheritAttrs:!1,props:{links:{type:Array,default:()=>[]},divider:{type:String,default:()=>O.default.divider},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(t){const{ui:$,attrs:f}=ue("breadcrumb",H(t,"ui"),O,H(t,"class"));return{ui:$,attrs:f,getULinkProps:pe,twMerge:ce,twJoin:me}}}),ze={key:1,role:"presentation"};function Ae(t,$,f,C,U,N){const n=K,h=q;return d(),g("nav",j({"aria-label":"Breadcrumb",class:t.ui.wrapper},t.attrs),[m("ol",{class:x(t.ui.ol)},[(d(!0),g(R,null,de(t.links,(a,c)=>(d(),g("li",{key:c,class:x(t.ui.li)},[i(h,j({as:"span",class:[t.ui.base,c===t.links.length-1?t.ui.active:a.to?t.ui.inactive:""],"aria-current":c===t.links.length-1?"page":void 0,ref_for:!0},t.getULinkProps(a),{onClick:a.click}),{default:r(()=>[P(t.$slots,"icon",{link:a,index:c,isActive:c===t.links.length-1},()=>[a.icon?(d(),F(n,{key:0,name:a.icon,class:x(t.twMerge(t.twJoin(t.ui.icon.base,c===t.links.length-1?t.ui.icon.active:a.to?t.ui.icon.inactive:""),a.iconClass))},null,8,["name","class"])):p("",!0)]),P(t.$slots,"default",{link:a,index:c,isActive:c===t.links.length-1},()=>[a.label?(d(),g("span",{key:0,class:x(t.twMerge(t.ui.label,a.labelClass))},z(a.label),3)):p("",!0)])]),_:2},1040,["class","aria-current","onClick"]),c<t.links.length-1?P(t.$slots,"divider",{key:0},()=>[t.divider?(d(),g(R,{key:0},[t.divider.startsWith("i-")?(d(),F(n,{key:0,name:t.divider,class:x(t.ui.divider.base),role:"presentation"},null,8,["name","class"])):(d(),g("span",ze,z(t.divider),1))],64)):p("",!0)]):p("",!0)],2))),128))],2)],16)}const Be=re(Fe,[["render",Ae]]),$e={class:"flex flex-col md:flex-row"},Le={class:"px-5 pb-5 md:w-4/5"},Se={key:0,class:"admin-settings mb-3"},Ee={class:"mt-3 mb-5"},De={key:0},Me={key:1},Pe={class:"flex flex-row w-full md:flex-col"},Ge={class:"flex mt-3"},Ne={class:"p-4 max-h-screen"},Te=["onClick"],Qe=W({__name:"comfyui",setup(t){ye({title:"ComfyUI settings - Visionatrix",meta:[{name:"description",content:"ComfyUI settings - Visionatrix"}]});const $=ge(),f=ve(),C=_e(),U=u(!1),N=u(!1),n=u([]),h=u("../vix_models"),a=u(""),c=G(()=>n.value.length===0?[]:a.value===""?Object.keys(n.value).map(s=>{let e=0;return n.value[s].length>0&&(e=n.value[s].reduce((_,v)=>_+(v.total_size??0),0)),{full_path:s,total_size:e,create_time:null,is_default:null,readonly:null}}):n.value[a.value]??[]),Q=G(()=>{const s=[{label:"Root",to:""}];if(a.value==="")return s;const e=a.value.split("/");let _="";return e.forEach(v=>{_+=v,s.push({label:v,to:_}),_+="/"}),s}),X=G(()=>{const s=[{key:"full_path",label:"Path",sortable:!0,class:""},{key:"total_size",label:"Size",sortable:!0,class:""}];return a.value!==""&&(s.push({key:"create_time",label:"Created time",sortable:!0,class:""}),s.push({key:"actions",label:"Actions",sortable:!1,class:""})),s});function Y(s){s.full_path in n.value&&(a.value=s.full_path)}const L=u(!1);function Z(){L.value=!0,f.performComfyUiAutoconfig(h.value).then(s=>{"folders"in s&&(console.debug("[DEBUG] ComfyUI folders: ",s.folders),n.value=s.folders,f.loadAllSettings(),C.add({title:"Autoconfig performed",description:"Autoconfig performed successfully"}))}).catch(s=>{C.add({title:"Error performing autoconfig",description:s.details})}).finally(()=>{L.value=!1})}const E=u(null),D=u(!1),A=u(""),w=u(!1),I=u(""),B=u(!1),M=u(!1),S=u(!0);return(s,e)=>{const _=ne,v=ie,b=be,T=he,ee=we,oe=ke,le=Be,te=Ie,se=Ve,ae=Ue;return d(),F(ae,{class:"lg:h-dvh"},{default:r(()=>[m("div",$e,[i(_,{links:o(f).links,class:"md:w-1/5"},null,8,["links"]),m("div",Le,[o($).isAdmin?(d(),g("div",Se,[e[19]||(e[19]=m("h3",{class:"mb-3 text-xl font-bold"},"ComfyUI settings (global)",-1)),m("div",Ee,[i(ee,{size:"md",class:"py-3",label:"ComfyUI models folder",description:"Relative or absolute path to the models folders"},{default:r(()=>[o(f).settingsMap.comfyui_folders.value===""?(d(),g("div",De,[e[12]||(e[12]=m("p",{class:"text-gray-500"},"No ComfyUI folders initialized.",-1)),i(v,{modelValue:o(h),"onUpdate:modelValue":e[0]||(e[0]=l=>V(h)?h.value=l:null),placeholder:"ComfyUI folder path",class:"w-fit mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",disabled:o(L),autocomplete:"off"},null,8,["modelValue","disabled"]),i(b,{class:"mt-3",icon:"i-heroicons-cog-6-tooth-20-solid",color:"orange",loading:o(L),onClick:Z},{default:r(()=>e[11]||(e[11]=[y(" Perform autoconfig ")])),_:1},8,["loading"])])):p("",!0),o(D)?(d(),g("div",Me,[m("div",Pe,[i(v,{ref_key:"newComfyUiFolderInput",ref:E,modelValue:o(I),"onUpdate:modelValue":e[1]||(e[1]=l=>V(I)?I.value=l:null),placeholder:"External folder to use for model types",class:"w-full mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",autocomplete:"off",disable:o(w)},null,8,["modelValue","disable"]),i(v,{modelValue:o(A),"onUpdate:modelValue":e[2]||(e[2]=l=>V(A)?A.value=l:null),placeholder:"Folder Name (model type, e.g. checkpoints, loras, vae)",class:"w-full mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",autocomplete:"off",disable:o(w)},null,8,["modelValue","disable"]),i(T,{modelValue:o(B),"onUpdate:modelValue":e[3]||(e[3]=l=>V(B)?B.value=l:null),class:"mt-3",label:"Is default"},null,8,["modelValue"])]),m("div",Ge,[i(b,{class:"mr-2",color:"white",icon:"i-heroicons-x-mark",variant:"outline",disabled:o(w),onClick:e[4]||(e[4]=()=>{D.value=!1,I.value="",A.value="",B.value=!1})},{default:r(()=>e[13]||(e[13]=[y(" Cancel ")])),_:1},8,["disabled"]),i(b,{icon:"i-heroicons-check-16-solid",loading:o(w),onClick:e[5]||(e[5]=()=>{o(I)!==""&&(w.value=!0,o(f).addComfyUiFolder(o(A),o(I),o(B)).then(l=>{"folders"in l&&(console.debug("[DEBUG] ComfyUI folders: ",l.folders),n.value=l.folders,o(C).add({title:"ComfyUI folder added",description:"ComfyUI folder added successfully"}))}).finally(()=>{w.value=!1}))})},{default:r(()=>e[14]||(e[14]=[y(" Add ")])),_:1},8,["loading"])])])):p("",!0),o(f).settingsMap.comfyui_folders.value!==""?(d(),F(b,{key:2,class:"mt-3",icon:"i-heroicons-folder-16-solid",color:"cyan",onClick:e[6]||(e[6]=()=>{o(f).getComfyUiFolderListing().then(l=>{console.debug("[DEBUG] ComfyUI folders: ",l),n.value=l.folders}),U.value=!0})},{default:r(()=>e[15]||(e[15]=[y(" Show ComfyUI folders ")])),_:1})):p("",!0),o(f).settingsMap.comfyui_folders.value!==""?(d(),F(b,{key:3,class:"mt-3 ml-2",color:"white",variant:"outline",icon:"i-heroicons-folder-plus-16-solid",onClick:e[7]||(e[7]=()=>{D.value=!0,s.$nextTick(()=>{o(E)&&o(E).$refs.input.focus()})})},{default:r(()=>e[16]||(e[16]=[y(" Add ComfyUI folder ")])),_:1})):p("",!0)]),_:1}),o(f).settingsMap.comfyui_folders.value!==""?(d(),F(se,{key:0,modelValue:o(U),"onUpdate:modelValue":e[10]||(e[10]=l=>V(U)?U.value=l:null),class:"z-[90]",fullscreen:""},{default:r(()=>[i(b,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:e[8]||(e[8]=()=>U.value=!1)}),m("div",Ne,[e[18]||(e[18]=m("h3",{class:"text-xl text-center"},"ComfyUI folders",-1)),m("div",null,[i(T,{modelValue:o(S),"onUpdate:modelValue":e[9]||(e[9]=l=>V(S)?S.value=l:null),class:"mt-3",label:"Hide empty folders"},null,8,["modelValue"])]),i(le,{links:o(Q),class:"my-2"},{default:r(({link:l,isActive:k})=>[i(oe,{color:k?"primary":"gray",class:"rounded-full truncate cursor-pointer select-none",onClick:()=>{a.value=l.to}},{default:r(()=>[y(z(l.label),1)]),_:2},1032,["color","onClick"])]),_:1},8,["links"]),i(te,{loading:o(N),"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},rows:o(c).filter(l=>o(S)?l.total_size>0:!0),columns:o(X),style:{"max-height":"80vh"}},{"full_path-data":r(({row:l})=>[m("span",{class:x({"text-blue-500":l.full_path in o(n),"cursor-pointer":l.full_path in o(n)}),onClick:()=>Y(l)},z(l.full_path),11,Te)]),"total_size-data":r(({row:l})=>[y(z(l.total_size?("formatBytes"in s?s.formatBytes:o(Ce))(l.total_size):"-"),1)]),"create_time-data":r(({row:l})=>[y(z(l.create_time&&new Date(l.create_time).getTime()!==0?new Date(l.create_time).toLocaleString():"-"),1)]),"actions-data":r(({row:l})=>[i(b,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:o(M),disabled:l.readonly===!0,onClick:()=>{M.value=!0,o(f).deleteComfyUiFolder(o(a),l.full_path).then(k=>{"folders"in k&&(console.debug("[DEBUG] ComfyUI folders: ",k.folders),n.value=k.folders,o(C).add({title:"ComfyUI folder removed",description:"ComfyUI folder removed successfully"}),o(n)[o(a)]||(a.value=""))}).catch(k=>{o(C).add({title:"Error removing ComfyUI folder",description:k.details})}).finally(()=>{M.value=!1})}},{default:r(()=>e[17]||(e[17]=[y(" Remove ")])),_:2},1032,["loading","disabled","onClick"])]),_:1},8,["loading","rows","columns"])])]),_:1},8,["modelValue"])):p("",!0)])])):p("",!0)])])]),_:1})}}});export{Qe as default};
