import{_ as de}from"./C2A9DUAO.js";import{_ as ue}from"./BEYaVWBZ.js";import{_ as ce}from"./NcrYBkH7.js";import{B as me,C as N,_ as fe,f as P,c as h,o as u,a as g,F as R,r as K,n as B,b as r,D as A,k as v,w as i,i as V,h as q,t as p,E as G,G as Q,H as pe,I as j,J as _e,K as ge,L as ye,y as W,M as he,N as U,v as X,d as y,p as e,O as D,m as Y,P as E,s as H,Q as be,u as ve,q as ke,x as F,A as Ue,j as Ce,R as Ve}from"./B3Is_2-G.js";import{_ as we}from"./CT-hPMd9.js";import{a as Me}from"./1f-QZCnX.js";import{_ as Z}from"./Cp0od7H4.js";import{_ as Ie,a as Se}from"./CKD1JcWl.js";import"./C88sN9Oy.js";const xe={wrapper:"relative min-w-0",ol:"flex items-center gap-x-1.5",li:"flex items-center gap-x-1.5 text-gray-500 dark:text-gray-400 text-sm leading-6 min-w-0",base:"flex items-center gap-x-1.5 group font-semibold min-w-0",label:"block truncate",icon:{base:"flex-shrink-0 w-5 h-5",active:"",inactive:""},divider:{base:"flex-shrink-0 w-5 h-5 rtl:rotate-180"},active:"text-primary-500 dark:text-primary-400",inactive:" hover:text-gray-700 dark:hover:text-gray-200",default:{divider:"i-heroicons-chevron-right-20-solid"}},J=me(N.ui.strategy,N.ui.breadcrumb,xe),Be=P({components:{UIcon:q,ULink:Q},inheritAttrs:!1,props:{links:{type:Array,default:()=>[]},divider:{type:String,default:()=>J.default.divider},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(t){const{ui:k,attrs:a}=pe("breadcrumb",j(t,"ui"),J,j(t,"class"));return{ui:k,attrs:a,getULinkProps:ye,twMerge:ge,twJoin:_e}}}),ze={key:1,role:"presentation"};function $e(t,k,a,C,$,f){const c=q,b=Q;return u(),h("nav",G({"aria-label":"Breadcrumb",class:t.ui.wrapper},t.attrs),[g("ol",{class:B(t.ui.ol)},[(u(!0),h(R,null,K(t.links,(o,d)=>(u(),h("li",{key:d,class:B(t.ui.li)},[r(b,G({as:"span",class:[t.ui.base,d===t.links.length-1?t.ui.active:o.to?t.ui.inactive:""],"aria-current":d===t.links.length-1?"page":void 0,ref_for:!0},t.getULinkProps(o),{onClick:o.click}),{default:i(()=>[A(t.$slots,"icon",{link:o,index:d,isActive:d===t.links.length-1},()=>[o.icon?(u(),V(c,{key:0,name:o.icon,class:B(t.twMerge(t.twJoin(t.ui.icon.base,d===t.links.length-1?t.ui.icon.active:o.to?t.ui.icon.inactive:""),o.iconClass))},null,8,["name","class"])):v("",!0)]),A(t.$slots,"default",{link:o,index:d,isActive:d===t.links.length-1},()=>[o.label?(u(),h("span",{key:0,class:B(t.twMerge(t.ui.label,o.labelClass))},p(o.label),3)):v("",!0)])]),_:2},1040,["class","aria-current","onClick"]),d<t.links.length-1?A(t.$slots,"divider",{key:0},()=>[t.divider?(u(),h(R,{key:0},[t.divider.startsWith("i-")?(u(),V(c,{key:0,name:t.divider,class:B(t.ui.divider.base),role:"presentation"},null,8,["name","class"])):(u(),h("span",ze,p(t.divider),1))],64)):v("",!0)]):v("",!0)],2))),128))],2)],16)}const Oe=fe(Be,[["render",$e]]),Le={class:"orphan-models"},Fe={class:"text-md font-bold"},De={key:0,class:"text-red-500"},Ae={key:0,class:"flex justify-end items-center space-x-2 mt-3"},Re={class:"text-gray-500 text-sm"},Ee=["href"],Pe={key:1},Te={class:"p-4 flex flex-col space-y-2 max-h-60 overflow-y-auto"},Ne={key:2,class:"text-gray-500"},Ge=P({__name:"OrphanModels",setup(t){const k=W();he(()=>{a()});function a(){k.getOrphanModelsList().then(o=>{console.debug("[DEBUG] Orphan models: ",o),f.value=o})}const C=[{key:"full_path",label:"Path",sortable:!0,class:""},{key:"size",label:"Size",sortable:!0,class:""},{key:"creation_time",label:"Created time",sortable:!0,class:""},{key:"res_model",label:"Model",sortable:!0,class:""},{key:"possible_flows",label:"Possible Flows",sortable:!0,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}];function $(){console.debug("[DEBUG] Deleting orphan models: ",c),b.value=!0,Promise.all(c.value.map(o=>k.deleteOrphanModel(o.full_path,o.creation_time))).then(()=>{a(),b.value=!1,c.value=c.value.filter(o=>o.full_path!==o.full_path)}).catch(o=>{console.error("[ERROR] Failed to delete orphan models: ",o),H().add({title:"Failed to delete orphan models",description:o.details}),b.value=!1})}const f=U([]),c=U([]),b=U(!1);return X(()=>k.settingsMap.comfyui_models_folder.value,()=>{a()}),(o,d)=>{const M=Y,I=be,O=Z;return u(),h("div",Le,[g("h3",Fe,[d[2]||(d[2]=y(" Orphan models ")),e(f).length>0?(u(),h("span",De,"("+p(e(f).length)+" - "+p(("formatBytes"in o?o.formatBytes:e(D))(e(f).reduce((n,_)=>n+_.size,0)))+")",1)):v("",!0)]),d[5]||(d[5]=g("p",{class:"text-gray-500 text-sm"}," Orphan models are models that are not associated with any model type. They are not used in any installed flow and can be deleted. ",-1)),e(c).length>0?(u(),h("div",Ae,[g("span",Re," Selected: "+p(e(c).length)+" ("+p(("formatBytes"in o?o.formatBytes:e(D))(e(c).reduce((n,_)=>n+_.size,0)))+") ",1),r(M,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:e(b),onClick:d[0]||(d[0]=()=>{$()})},{default:i(()=>d[3]||(d[3]=[y(" Delete selected ")])),_:1},8,["loading"])])):v("",!0),e(f).length>0?(u(),V(O,{key:1,modelValue:e(c),"onUpdate:modelValue":d[1]||(d[1]=n=>E(c)?c.value=n:null),class:"mt-5",ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10"},rows:e(f),columns:C,style:{"max-height":"40vh"}},{"full_path-data":i(({row:n})=>[y(p(n.full_path),1)]),"size-data":i(({row:n})=>[y(p(n.size?("formatBytes"in o?o.formatBytes:e(D))(n.size):"-"),1)]),"creation_time-data":i(({row:n})=>[y(p(n.creation_time?new Date(n.creation_time*1e3).toLocaleString():"-"),1)]),"res_model-data":i(({row:n})=>[n.res_model?(u(),h("a",{key:0,href:n.res_model.homepage,target:"_blank",class:"text-blue-500"},p(n.res_model.name),9,Ee)):(u(),h("span",Pe,"-"))]),"possible_flows-data":i(({row:n})=>[r(I,null,{panel:i(()=>[g("div",Te,[(u(!0),h(R,null,K(n.possible_flows,_=>(u(),V(M,{key:_.id,to:`/workflows/${_==null?void 0:_.name}`,variant:"soft",color:"blue",target:"_blank"},{default:i(()=>[y(p(_.name),1)]),_:2},1032,["to"]))),128))])]),default:i(()=>[r(M,{icon:"i-heroicons-chevron-down-16-solid",variant:"outline",color:"blue"},{default:i(()=>[y(p(n.possible_flows.length),1)]),_:2},1024)]),_:2},1024)]),"actions-data":i(({row:n})=>[r(M,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:e(b),disabled:n.readonly===!0,onClick:()=>{console.debug("[DEBUG] Deleting orphan model: ",n),b.value=!0,e(k).deleteOrphanModel(n.full_path,n.creation_time).then(()=>{a()}).catch(_=>{console.error("[ERROR] Failed to delete orphan model: ",_),("useToast"in o?o.useToast:e(H))().add({title:"Failed to delete orphan model",description:_.details})}).finally(()=>{b.value=!1})}},{default:i(()=>d[4]||(d[4]=[y(" Delete ")])),_:2},1032,["loading","disabled","onClick"])]),_:1},8,["modelValue","rows"])):(u(),h("span",Ne,"No orphan models found."))])}}}),je={class:"flex flex-col md:flex-row"},He={class:"px-5 pb-5 md:w-4/5"},Je={key:0,class:"admin-settings mb-3"},Ke={class:"mt-3 mb-5"},qe={class:"p-4 max-h-screen"},Qe=["onClick"],We={class:"flex items-center mt-2"},nt=P({__name:"comfyui",setup(t){ve({title:"ComfyUI settings - Visionatrix",meta:[{name:"description",content:"ComfyUI settings - Visionatrix"}]});const k=ke(),a=W(),C=U(!1),$=U(!1),f=U([]),c=U(""),b=F(()=>f.value.length===0?[]:c.value===""?Object.keys(f.value).map(m=>{let l=0;return f.value[m].length>0&&(l=f.value[m].reduce((w,S)=>w+(S.total_size??0),0)),{full_path:m,total_size:l,create_time:null}}):f.value[c.value]??[]),o=F(()=>{const m=[{label:"Root",to:""}];if(c.value==="")return m;const l=c.value.split("/");let w="";return l.forEach(S=>{w+=S,m.push({label:S,to:w}),w+="/"}),m}),d=F(()=>{const m=[{key:"full_path",label:"Path",sortable:!0,class:""},{key:"total_size",label:"Size",sortable:!0,class:""}];return c.value!==""&&m.push({key:"create_time",label:"Created time",sortable:!0,class:""}),m});function M(m){m.full_path in f.value&&(c.value=m.full_path)}const I=U(!0);X(()=>a.localSettings.showComfyUiNavbarButton,()=>{a.saveLocalSettings()});const O=["comfyui_models_folder","comfyui_base_data_folder","comfyui_output_folder","comfyui_input_folder","comfyui_user_folder"],n=U(!1);function _(){n.value=!0,a.saveChanges(O).then(()=>{a.getAllSettings().then(()=>{O.forEach(m=>{a.settingsMap[m].changed=!0})})}).finally(()=>{n.value=!1})}const T=F(()=>a.settingsMap.comfyui_models_folder.changed||a.settingsMap.comfyui_base_data_folder.changed||a.settingsMap.comfyui_output_folder.changed||a.settingsMap.comfyui_input_folder.changed||a.settingsMap.comfyui_user_folder.changed);return(m,l)=>{const w=de,S=ue,z=ce,L=Y,x=we,ee=Me,te=Ce,oe=Oe,le=Z,se=Ie,ae=Se,ne=Ge,ie=Ue;return u(),V(ie,{class:"lg:h-dvh"},{default:i(()=>[g("div",je,[r(w,{links:e(a).links,class:"md:w-1/5"},null,8,["links"]),g("div",He,[e(k).isAdmin?(u(),h("div",Je,[l[14]||(l[14]=g("h3",{class:"mb-3 text-xl font-bold"},"ComfyUI settings (global)",-1)),g("div",Ke,[r(x,{size:"md",class:"py-3",label:"ComfyUI models folder",description:"Absolute path to the models folders or relative to current Visionatrix folder. Overrides ComfyUI base data folder."},{default:i(()=>[e(T)?(u(),V(S,{key:0,class:"mt-3",color:"orange",variant:"solid",title:"ComfyUI settings modified",description:"Restart Visionatrix server to apply changes",icon:"i-heroicons-exclamation-triangle"})):v("",!0),r(z,{modelValue:e(a).settingsMap.comfyui_models_folder.value,"onUpdate:modelValue":l[0]||(l[0]=s=>e(a).settingsMap.comfyui_models_folder.value=s),placeholder:"ComfyUI folder path",class:"w-fit mr-3 mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",loading:e(n),autocomplete:"off"},null,8,["modelValue","loading"]),r(L,{icon:"i-heroicons-eye",class:"mt-3",color:"cyan",onClick:l[1]||(l[1]=()=>{e(a).getComfyUiFolderListing().then(s=>{console.debug("[DEBUG] ComfyUI folders: ",s),f.value=s.folders}),C.value=!0})},{default:i(()=>l[10]||(l[10]=[y(" Show ComfyUI folders ")])),_:1})]),_:1}),r(x,{size:"md",class:"py-3",label:"ComfyUI base data folder",description:"Set the ComfyUI base data directory with an absolute path."},{default:i(()=>[r(z,{modelValue:e(a).settingsMap.comfyui_base_data_folder.value,"onUpdate:modelValue":l[2]||(l[2]=s=>e(a).settingsMap.comfyui_base_data_folder.value=s),placeholder:"ComfyUI base data folder path",class:"w-full",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",loading:e(n),autocomplete:"off"},null,8,["modelValue","loading"])]),_:1}),r(x,{size:"md",class:"py-3",label:"ComfyUI output folder",description:"Set the ComfyUI output directory with an absolute path. Overrides ComfyUI base data folder."},{default:i(()=>[r(z,{modelValue:e(a).settingsMap.comfyui_output_folder.value,"onUpdate:modelValue":l[3]||(l[3]=s=>e(a).settingsMap.comfyui_output_folder.value=s),placeholder:"ComfyUI output folder path",class:"w-full",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",loading:e(n),autocomplete:"off"},null,8,["modelValue","loading"])]),_:1}),r(x,{size:"md",class:"py-3",label:"ComfyUI input folder",description:"Set the ComfyUI input directory with an absolute path. Overrides ComfyUI base data folder."},{default:i(()=>[r(z,{modelValue:e(a).settingsMap.comfyui_input_folder.value,"onUpdate:modelValue":l[4]||(l[4]=s=>e(a).settingsMap.comfyui_input_folder.value=s),placeholder:"ComfyUI input folder path",class:"w-full",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",loading:e(n),autocomplete:"off"},null,8,["modelValue","loading"])]),_:1}),r(x,{size:"md",class:"py-3",label:"ComfyUI user folder",description:"Set the ComfyUI user directory with an absolute path. Overrides ComfyUI base data folder."},{default:i(()=>[r(z,{modelValue:e(a).settingsMap.comfyui_user_folder.value,"onUpdate:modelValue":l[5]||(l[5]=s=>e(a).settingsMap.comfyui_user_folder.value=s),placeholder:"ComfyUI user folder path",class:"w-full",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",loading:e(n),autocomplete:"off"},null,8,["modelValue","loading"])]),_:1}),r(L,{class:"mt-3",icon:"i-heroicons-check-16-solid",loading:e(n),onClick:_},{default:i(()=>l[11]||(l[11]=[y(" Save ")])),_:1},8,["loading"]),e(a).settingsMap.comfyui_models_folder.value!==""?(u(),V(se,{key:0,modelValue:e(C),"onUpdate:modelValue":l[8]||(l[8]=s=>E(C)?C.value=s:null),class:"z-[90]",fullscreen:""},{default:i(()=>[r(L,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:l[6]||(l[6]=()=>C.value=!1)}),g("div",qe,[l[12]||(l[12]=g("h3",{class:"text-xl text-center"},"ComfyUI folders",-1)),g("div",null,[r(ee,{modelValue:e(I),"onUpdate:modelValue":l[7]||(l[7]=s=>E(I)?I.value=s:null),class:"mt-3",label:"Hide empty folders"},null,8,["modelValue"])]),r(oe,{links:e(o),class:"my-2"},{default:i(({link:s,isActive:re})=>[r(te,{color:re?"primary":"gray",class:"rounded-full truncate cursor-pointer select-none",onClick:()=>{c.value=s.to}},{default:i(()=>[y(p(s.label),1)]),_:2},1032,["color","onClick"])]),_:1},8,["links"]),r(le,{loading:e($),"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},rows:e(b).filter(s=>e(I)?s.total_size>0:!0),columns:e(d),style:{"max-height":"80vh"}},{"full_path-data":i(({row:s})=>[g("span",{class:B({"text-blue-500":s.full_path in e(f),"cursor-pointer":s.full_path in e(f)}),onClick:()=>M(s)},p(s.full_path),11,Qe)]),"total_size-data":i(({row:s})=>[y(p(s.total_size?("formatBytes"in m?m.formatBytes:e(D))(s.total_size):"-"),1)]),"create_time-data":i(({row:s})=>[y(p(s.create_time&&new Date(s.create_time).getTime()!==0?new Date(s.create_time).toLocaleString():"-"),1)]),_:1},8,["loading","rows","columns"])])]),_:1},8,["modelValue"])):v("",!0)]),e(a).isNextcloudIntegration?v("",!0):(u(),V(x,{key:0,size:"md",class:"py-3",label:"Show 'Open ComfyUI' navbar button",description:"Toggle Navbar button to open ComfyUI in a new tab (Stored in browser local storage	)"},{default:i(()=>[g("div",We,[r(ae,{modelValue:e(a).localSettings.showComfyUiNavbarButton,"onUpdate:modelValue":l[9]||(l[9]=s=>e(a).localSettings.showComfyUiNavbarButton=s),class:"mr-3"},null,8,["modelValue"]),r(L,{icon:"i-heroicons-rectangle-group-16-solid",variant:"outline",color:"white",to:("buildBackendUrl"in m?m.buildBackendUrl:e(Ve))()+"/comfy/",target:"_blank"},{default:i(()=>l[13]||(l[13]=[y(" Open ComfyUI ")])),_:1},8,["to"])])]),_:1})),r(ne,{class:"mt-3"})])):v("",!0)])])]),_:1})}}});export{nt as default};
