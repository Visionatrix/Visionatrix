import{_ as ie}from"./BMdBJNwD.js";import{_ as re}from"./C1X8DzQ6.js";import{_ as de,o as d,c as _,a as h,F as R,r as J,q as w,b as p,w as r,s as D,i as B,h as q,l as b,t as m,v as G,x as K,f as T,y as ue,z as N,A as ce,B as j,C as me,D as fe,E as pe,G as W,H as _e,I as v,n as ge,d as y,m as o,J as I,K as P,k as Q,L as he,M as L,u as ye,N as ve,O as E,j as be,p as ke}from"./fH7QqWsv.js";import{_ as Ue}from"./DxOWttGN.js";import{_ as Ce}from"./CKwhxOjQ.js";import{_ as X}from"./CnytamWG.js";import{_ as Be}from"./DjTYmULL.js";import"./j5lmBwBj.js";const xe={wrapper:"relative min-w-0",ol:"flex items-center gap-x-1.5",li:"flex items-center gap-x-1.5 text-gray-500 dark:text-gray-400 text-sm leading-6 min-w-0",base:"flex items-center gap-x-1.5 group font-semibold min-w-0",label:"block truncate",icon:{base:"flex-shrink-0 w-5 h-5",active:"",inactive:""},divider:{base:"flex-shrink-0 w-5 h-5 rtl:rotate-180"},active:"text-primary-500 dark:text-primary-400",inactive:" hover:text-gray-700 dark:hover:text-gray-200",default:{divider:"i-heroicons-chevron-right-20-solid"}},H=ce(j.ui.strategy,j.ui.breadcrumb,xe),Me=T({components:{UIcon:q,ULink:K},inheritAttrs:!1,props:{links:{type:Array,default:()=>[]},divider:{type:String,default:()=>H.default.divider},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(s){const{ui:k,attrs:c}=ue("breadcrumb",N(s,"ui"),H,N(s,"class"));return{ui:k,attrs:c,getULinkProps:pe,twMerge:fe,twJoin:me}}}),$e={key:1,role:"presentation"};function ze(s,k,c,M,C,U){const a=q,g=K;return d(),_("nav",G({"aria-label":"Breadcrumb",class:s.ui.wrapper},s.attrs),[h("ol",{class:w(s.ui.ol)},[(d(!0),_(R,null,J(s.links,(e,n)=>(d(),_("li",{key:n,class:w(s.ui.li)},[p(g,G({as:"span",class:[s.ui.base,n===s.links.length-1?s.ui.active:e.to?s.ui.inactive:""],"aria-current":n===s.links.length-1?"page":void 0,ref_for:!0},s.getULinkProps(e),{onClick:e.click}),{default:r(()=>[D(s.$slots,"icon",{link:e,index:n,isActive:n===s.links.length-1},()=>[e.icon?(d(),B(a,{key:0,name:e.icon,class:w(s.twMerge(s.twJoin(s.ui.icon.base,n===s.links.length-1?s.ui.icon.active:e.to?s.ui.icon.inactive:""),e.iconClass))},null,8,["name","class"])):b("",!0)]),D(s.$slots,"default",{link:e,index:n,isActive:n===s.links.length-1},()=>[e.label?(d(),_("span",{key:0,class:w(s.twMerge(s.ui.label,e.labelClass))},m(e.label),3)):b("",!0)])]),_:2},1040,["class","aria-current","onClick"]),n<s.links.length-1?D(s.$slots,"divider",{key:0},()=>[s.divider?(d(),_(R,{key:0},[s.divider.startsWith("i-")?(d(),B(a,{key:0,name:s.divider,class:w(s.ui.divider.base),role:"presentation"},null,8,["name","class"])):(d(),_("span",$e,m(s.divider),1))],64)):b("",!0)]):b("",!0)],2))),128))],2)],16)}const we=de(Me,[["render",ze]]),Se={class:"orphan-models"},Ve={class:"text-md font-bold"},Ie={key:0,class:"text-red-500"},Le={key:0,class:"flex justify-end items-center space-x-2 mt-3"},Oe={class:"text-gray-500 text-sm"},Fe=["href"],Ae={key:1},De={class:"p-4 flex flex-col space-y-2 max-h-60 overflow-y-auto"},Ee={key:2,class:"text-gray-500"},Re=T({__name:"OrphanModels",setup(s){const k=W();_e(()=>{c()});function c(){k.getOrphanModelsList().then(e=>{console.debug("[DEBUG] Orphan models: ",e),U.value=e})}const M=[{key:"",label:"",sortable:!1,class:""},{key:"full_path",label:"Path",sortable:!0,class:""},{key:"size",label:"Size",sortable:!0,class:""},{key:"creation_time",label:"Created time",sortable:!0,class:""},{key:"res_model",label:"Model",sortable:!0,class:""},{key:"possible_flows",label:"Possible Flows",sortable:!0,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}];function C(){console.debug("[DEBUG] Deleting orphan models: ",a),g.value=!0,Promise.all(a.value.map(e=>k.deleteOrphanModel(e.full_path,e.creation_time))).then(()=>{c(),g.value=!1,a.value=a.value.filter(e=>e.full_path!==e.full_path)}).catch(e=>{console.error("[ERROR] Failed to delete orphan models: ",e),P().add({title:"Failed to delete orphan models",description:e.details}),g.value=!1})}const U=v([]),a=v([]),g=v(!1);return ge(()=>k.settingsMap.comfyui_models_folder.value,()=>{c()}),(e,n)=>{const $=Q,O=he,F=X;return d(),_("div",Se,[h("h3",Ve,[n[2]||(n[2]=y(" Orphan models ")),o(U).length>0?(d(),_("span",Ie,"("+m(o(U).length)+" - "+m(("formatBytes"in e?e.formatBytes:o(I))(o(U).reduce((l,f)=>l+f.size,0)))+")",1)):b("",!0)]),n[5]||(n[5]=h("p",{class:"text-gray-500 text-sm"}," Orphan models are models that are not associated with any model type. They are not used in any installed flow and can be deleted. ",-1)),o(a).length>0?(d(),_("div",Le,[h("span",Oe," Selected: "+m(o(a).length)+" ("+m(("formatBytes"in e?e.formatBytes:o(I))(o(a).reduce((l,f)=>l+f.size,0)))+") ",1),p($,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:o(g),onClick:n[0]||(n[0]=()=>{C()})},{default:r(()=>n[3]||(n[3]=[y(" Delete selected ")])),_:1},8,["loading"])])):b("",!0),o(U).length>0?(d(),B(F,{key:1,modelValue:o(a),"onUpdate:modelValue":n[1]||(n[1]=l=>L(a)?a.value=l:null),class:"mt-5",ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10"},rows:o(U),columns:M,style:{"max-height":"40vh"}},{"full_path-data":r(({row:l})=>[y(m(l.full_path),1)]),"size-data":r(({row:l})=>[y(m(l.size?("formatBytes"in e?e.formatBytes:o(I))(l.size):"-"),1)]),"creation_time-data":r(({row:l})=>[y(m(l.creation_time?new Date(l.creation_time*1e3).toLocaleString():"-"),1)]),"res_model-data":r(({row:l})=>[l.res_model?(d(),_("a",{key:0,href:l.res_model.homepage,target:"_blank",class:"text-blue-500"},m(l.res_model.name),9,Fe)):(d(),_("span",Ae,"-"))]),"possible_flows-data":r(({row:l})=>[p(O,null,{panel:r(()=>[h("div",De,[(d(!0),_(R,null,J(l.possible_flows,f=>(d(),B($,{key:f.id,to:`/workflows/${f==null?void 0:f.name}`,variant:"soft",color:"blue",target:"_blank"},{default:r(()=>[y(m(f.name),1)]),_:2},1032,["to"]))),128))])]),default:r(()=>[p($,{icon:"i-heroicons-chevron-down-16-solid",variant:"outline",color:"blue"},{default:r(()=>[y(m(l.possible_flows.length),1)]),_:2},1024)]),_:2},1024)]),"actions-data":r(({row:l})=>[p($,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:o(g),disabled:l.readonly===!0,onClick:()=>{console.debug("[DEBUG] Deleting orphan model: ",l),g.value=!0,o(k).deleteOrphanModel(l.full_path,l.creation_time).then(()=>{c()}).catch(f=>{console.error("[ERROR] Failed to delete orphan model: ",f),("useToast"in e?e.useToast:o(P))().add({title:"Failed to delete orphan model",description:f.details})}).finally(()=>{g.value=!1})}},{default:r(()=>n[4]||(n[4]=[y(" Delete ")])),_:2},1032,["loading","disabled","onClick"])]),_:1},8,["modelValue","rows"])):(d(),_("span",Ee,"No orphan models found."))])}}}),Pe={class:"flex flex-col md:flex-row"},Te={class:"px-5 pb-5 md:w-4/5"},Ge={key:0,class:"admin-settings mb-3"},Ne={class:"mt-3 mb-5"},je={key:0},He={class:"p-4 max-h-screen"},Je=["onClick"],tt=T({__name:"comfyui",setup(s){ye({title:"ComfyUI settings - Visionatrix",meta:[{name:"description",content:"ComfyUI settings - Visionatrix"}]});const k=ve(),c=W(),M=P(),C=v(!1),U=v(!1),a=v([]),g=v("../vix_models"),e=v(""),n=E(()=>a.value.length===0?[]:e.value===""?Object.keys(a.value).map(u=>{let t=0;return a.value[u].length>0&&(t=a.value[u].reduce((x,z)=>x+(z.total_size??0),0)),{full_path:u,total_size:t,create_time:null}}):a.value[e.value]??[]),$=E(()=>{const u=[{label:"Root",to:""}];if(e.value==="")return u;const t=e.value.split("/");let x="";return t.forEach(z=>{x+=z,u.push({label:z,to:x}),x+="/"}),u}),O=E(()=>{const u=[{key:"full_path",label:"Path",sortable:!0,class:""},{key:"total_size",label:"Size",sortable:!0,class:""}];return e.value!==""&&u.push({key:"create_time",label:"Created time",sortable:!0,class:""}),u});function F(u){u.full_path in a.value&&(e.value=u.full_path)}const l=v(!1);function f(u){u===""?A.value=!0:l.value=!0,c.performComfyUiAutoconfig(u).then(t=>{"folders"in t&&(console.debug("[DEBUG] ComfyUI folders: ",t.folders),c.loadAllSettings(),u!==""?(a.value=t.folders,M.add({title:"Autoconfig performed",description:"Autoconfig performed successfully"})):(a.value=[],c.settingsMap.comfyui_models_folder.value="",M.add({title:"ComfyUI folders reset",description:"ComfyUI folders reset successfully"})))}).catch(t=>{M.add({title:"Error performing autoconfig",description:t.details})}).finally(()=>{l.value=!1,A.value=!1})}const A=v(!1),S=v(!0);return(u,t)=>{const x=ie,z=re,V=Q,Y=Ue,Z=Ce,ee=be,te=we,oe=X,se=Be,le=Re,ae=ke;return d(),B(ae,{class:"lg:h-dvh"},{default:r(()=>[h("div",Pe,[p(x,{links:o(c).links,class:"md:w-1/5"},null,8,["links"]),h("div",Te,[o(k).isAdmin?(d(),_("div",Ge,[t[12]||(t[12]=h("h3",{class:"mb-3 text-xl font-bold"},"ComfyUI settings (global)",-1)),h("div",Ne,[p(Y,{size:"md",class:"py-3",label:"ComfyUI models folder",description:"Relative or absolute path to the models folders"},{default:r(()=>[o(c).settingsMap.comfyui_models_folder.value===""?(d(),_("div",je,[t[8]||(t[8]=h("p",{class:"text-gray-500"},"No ComfyUI folders initialized.",-1)),p(z,{modelValue:o(g),"onUpdate:modelValue":t[0]||(t[0]=i=>L(g)?g.value=i:null),placeholder:"ComfyUI folder path",class:"w-fit mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",disabled:o(l),autocomplete:"off"},null,8,["modelValue","disabled"]),p(V,{class:"mt-3",icon:"i-heroicons-cog-6-tooth-20-solid",color:"orange",loading:o(l),onClick:t[1]||(t[1]=()=>f(o(g)))},{default:r(()=>t[7]||(t[7]=[y(" Perform autoconfig ")])),_:1},8,["loading"])])):b("",!0),o(c).settingsMap.comfyui_models_folder.value!==""?(d(),B(V,{key:1,class:"mt-3",icon:"i-heroicons-folder-16-solid",color:"cyan",onClick:t[2]||(t[2]=()=>{o(c).getComfyUiFolderListing().then(i=>{console.debug("[DEBUG] ComfyUI folders: ",i),a.value=i.folders}),C.value=!0})},{default:r(()=>t[9]||(t[9]=[y(" Show ComfyUI folders ")])),_:1})):b("",!0),o(c).settingsMap.comfyui_models_folder.value!==""?(d(),B(V,{key:2,class:"mt-3 ml-2",color:"red",variant:"outline",icon:"i-heroicons-trash-16-solid",onClick:t[3]||(t[3]=()=>f(""))},{default:r(()=>t[10]||(t[10]=[y(" Reset ComfyUI folders ")])),_:1})):b("",!0)]),_:1}),o(c).settingsMap.comfyui_models_folder.value!==""?(d(),B(se,{key:0,modelValue:o(C),"onUpdate:modelValue":t[6]||(t[6]=i=>L(C)?C.value=i:null),class:"z-[90]",fullscreen:""},{default:r(()=>[p(V,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:t[4]||(t[4]=()=>C.value=!1)}),h("div",He,[t[11]||(t[11]=h("h3",{class:"text-xl text-center"},"ComfyUI folders",-1)),h("div",null,[p(Z,{modelValue:o(S),"onUpdate:modelValue":t[5]||(t[5]=i=>L(S)?S.value=i:null),class:"mt-3",label:"Hide empty folders"},null,8,["modelValue"])]),p(te,{links:o($),class:"my-2"},{default:r(({link:i,isActive:ne})=>[p(ee,{color:ne?"primary":"gray",class:"rounded-full truncate cursor-pointer select-none",onClick:()=>{e.value=i.to}},{default:r(()=>[y(m(i.label),1)]),_:2},1032,["color","onClick"])]),_:1},8,["links"]),p(oe,{loading:o(U),"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},rows:o(n).filter(i=>o(S)?i.total_size>0:!0),columns:o(O),style:{"max-height":"80vh"}},{"full_path-data":r(({row:i})=>[h("span",{class:w({"text-blue-500":i.full_path in o(a),"cursor-pointer":i.full_path in o(a)}),onClick:()=>F(i)},m(i.full_path),11,Je)]),"total_size-data":r(({row:i})=>[y(m(i.total_size?("formatBytes"in u?u.formatBytes:o(I))(i.total_size):"-"),1)]),"create_time-data":r(({row:i})=>[y(m(i.create_time&&new Date(i.create_time).getTime()!==0?new Date(i.create_time).toLocaleString():"-"),1)]),_:1},8,["loading","rows","columns"])])]),_:1},8,["modelValue"])):b("",!0)]),p(le,{class:"mt-3"})])):b("",!0)])])]),_:1})}}});export{tt as default};
