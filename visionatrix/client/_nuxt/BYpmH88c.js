import{_ as me}from"./CcdnznEI.js";import{a as re,b as fe,_ as pe}from"./BCiuChBT.js";import{_ as ge}from"./BNqqxFS9.js";import{y as ye,z as ee,_ as be,g as ie,m as ue,l as Z,A as ve,B as te,C as V,D as ke,E as oe,G as Y,o as n,c as f,a as d,H as m,b as v,I as j,k as D,F as E,r as H,J as G,j as R,t as y,K as he,d as _,L as ae,u as _e,M as Se,N as we,O as F,P as se,h as Ve,Q as Be,w as i,q as Ce,i as u,R as z,S as O,x as le,n as Ue,T as $e,U as Ae}from"./Ci5lPSp7.js";import{_ as de}from"./lJB27U8S.js";import"./71ttf3Sf.js";const Te={wrapper:"relative overflow-x-auto",base:"min-w-full table-fixed",divide:"divide-y divide-gray-300 dark:divide-gray-700",thead:"relative",tbody:"divide-y divide-gray-200 dark:divide-gray-800",tr:{base:"",selected:"bg-gray-50 dark:bg-gray-800/50",active:"hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer"},th:{base:"text-left rtl:text-right",padding:"px-4 py-3.5",color:"text-gray-900 dark:text-white",font:"font-semibold",size:"text-sm"},td:{base:"whitespace-nowrap",padding:"px-4 py-4",color:"text-gray-500 dark:text-gray-400",font:"",size:"text-sm"},checkbox:{padding:"ps-4"},loadingState:{wrapper:"flex flex-col items-center justify-center flex-1 px-6 py-14 sm:px-14",label:"text-sm text-center text-gray-900 dark:text-white",icon:"w-6 h-6 mx-auto text-gray-400 dark:text-gray-500 mb-4 animate-spin"},emptyState:{wrapper:"flex flex-col items-center justify-center flex-1 px-6 py-14 sm:px-14",label:"text-sm text-center text-gray-900 dark:text-white",icon:"w-6 h-6 mx-auto text-gray-400 dark:text-gray-500 mb-4"},progress:{wrapper:"absolute inset-x-0 -bottom-[0.5px] p-0"},default:{sortAscIcon:"i-heroicons-bars-arrow-up-20-solid",sortDescIcon:"i-heroicons-bars-arrow-down-20-solid",sortButton:{icon:"i-heroicons-arrows-up-down-20-solid",trailing:!0,square:!0,color:"gray",variant:"ghost",class:"-m-1.5"},checkbox:{color:"primary"},progress:{color:"primary",animation:"carousel"},loadingState:{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},emptyState:{icon:"i-heroicons-circle-stack-20-solid",label:"No items."}}};function Ie(e){return e?e[0].toUpperCase()+e.slice(1):""}const A=ye(ee.ui.strategy,ee.ui.table,Te);function Oe(e,r){return e===r}function ne(e,r,C){return e===r?0:C==="asc"?e<r?-1:1:e>r?-1:1}const De=ie({components:{UIcon:ue,UButton:Z,UProgress:re,UCheckbox:de},inheritAttrs:!1,props:{modelValue:{type:Array,default:null},by:{type:[String,Function],default:()=>Oe},rows:{type:Array,default:()=>[]},columns:{type:Array,default:null},columnAttribute:{type:String,default:"label"},sort:{type:Object,default:()=>({})},sortMode:{type:String,default:"auto"},sortButton:{type:Object,default:()=>A.default.sortButton},sortAscIcon:{type:String,default:()=>A.default.sortAscIcon},sortDescIcon:{type:String,default:()=>A.default.sortDescIcon},loading:{type:Boolean,default:!1},loadingState:{type:Object,default:()=>A.default.loadingState},emptyState:{type:Object,default:()=>A.default.emptyState},progress:{type:Object,default:()=>A.default.progress},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","update:sort"],setup(e,{emit:r,attrs:C}){const{ui:B,attrs:U}=ve("table",te(e,"ui"),A,te(e,"class")),T=V(()=>e.columns??Object.keys(e.rows[0]??{}).map(t=>({key:t,label:Ie(t),sortable:!1,class:void 0,sort:ne}))),c=ke(e,"sort",r,{passive:!0,defaultValue:oe({},e.sort,{column:null,direction:"asc"})}),w={column:c.value.column,direction:null},I=V(()=>{var S;if(!((S=c.value)!=null&&S.column)||e.sortMode==="manual")return e.rows;const{column:t,direction:l}=c.value;return e.rows.slice().sort((q,L)=>{var P;const K=Y(q,t),N=Y(L,t);return(((P=T.value.find(Q=>Q.key===t))==null?void 0:P.sort)??ne)(K,N,l)})}),p=V({get(){return e.modelValue},set(t){r("update:modelValue",t)}}),s=V(()=>p.value&&p.value.length>0&&p.value.length<e.rows.length),b=V(()=>e.emptyState===null?null:{...B.value.default.emptyState,...e.emptyState}),g=V(()=>e.loadingState===null?null:{...B.value.default.loadingState,...e.loadingState});function M(t,l){if(typeof e.by=="string"){const S=e.by;return(t==null?void 0:t[S])===(l==null?void 0:l[S])}return e.by(t,l)}function k(t){return e.modelValue?p.value.some(l=>M(ae(l),ae(t))):!1}function $(t){if(c.value.column===t.key){const l=!t.direction||t.direction==="asc"?"desc":"asc";c.value.direction===l?c.value=oe({},w,{column:null,direction:"asc"}):c.value={column:c.value.column,direction:c.value.direction==="asc"?"desc":"asc"}}else c.value={column:t.key,direction:t.direction||"asc"}}function J(t){C.onSelect&&C.onSelect(t)}function W(){e.rows.forEach(t=>{k(t)||p.value.push(t)})}function h(t){t?W():p.value=[]}function o(t,l,S=""){return Y(t,l,S)}return{ui:B,attrs:U,sort:c,columns:T,rows:I,selected:p,indeterminate:s,emptyState:b,loadingState:g,isSelected:k,onSort:$,onSelect:J,onChange:h,getRowData:o}}}),Re={key:1},Me={key:0},je={key:0},Fe=["colspan"],We={key:1},Le=["colspan"],Ne=["onClick"];function Pe(e,r,C,B,U,T){const c=de,w=Z,I=re,p=ue;return n(),f("div",j({class:e.ui.wrapper},e.attrs),[d("table",{class:m([e.ui.base,e.ui.divide])},[d("thead",{class:m(e.ui.thead)},[d("tr",{class:m(e.ui.tr.base)},[e.modelValue?(n(),f("th",{key:0,scope:"col",class:m(e.ui.checkbox.padding)},[v(c,j({"model-value":e.indeterminate||e.selected.length===e.rows.length,indeterminate:e.indeterminate},e.ui.default.checkbox,{"aria-label":"Select all",onChange:e.onChange}),null,16,["model-value","indeterminate","onChange"])],2)):D("",!0),(n(!0),f(E,null,H(e.columns,(s,b)=>(n(),f("th",{key:b,scope:"col",class:m([e.ui.th.base,e.ui.th.padding,e.ui.th.color,e.ui.th.font,e.ui.th.size,s.class])},[G(e.$slots,`${s.key}-header`,{column:s,sort:e.sort,onSort:e.onSort},()=>[s.sortable?(n(),R(w,j({key:0,ref_for:!0},{...e.ui.default.sortButton||{},...e.sortButton},{icon:!e.sort.column||e.sort.column!==s.key?e.sortButton.icon||e.ui.default.sortButton.icon:e.sort.direction==="asc"?e.sortAscIcon:e.sortDescIcon,label:s[e.columnAttribute],onClick:g=>e.onSort(s)}),null,16,["icon","label","onClick"])):(n(),f("span",Re,y(s[e.columnAttribute]),1))])],2))),128))],2),e.loading&&e.progress?(n(),f("tr",Me,[d("td",{colspan:0,class:m(e.ui.progress.wrapper)},[v(I,j({...e.ui.default.progress||{},...e.progress},{size:"2xs"}),null,16)],2)])):D("",!0)],2),d("tbody",{class:m(e.ui.tbody)},[e.loadingState&&e.loading&&!e.rows.length?(n(),f("tr",je,[d("td",{colspan:e.columns.length+(e.modelValue?1:0)},[G(e.$slots,"loading-state",{},()=>[d("div",{class:m(e.ui.loadingState.wrapper)},[e.loadingState.icon?(n(),R(p,{key:0,name:e.loadingState.icon,class:m(e.ui.loadingState.icon),"aria-hidden":"true"},null,8,["name","class"])):D("",!0),d("p",{class:m(e.ui.loadingState.label)},y(e.loadingState.label),3)],2)])],8,Fe)])):e.emptyState&&!e.rows.length?(n(),f("tr",We,[d("td",{colspan:e.columns.length+(e.modelValue?1:0)},[G(e.$slots,"empty-state",{},()=>[d("div",{class:m(e.ui.emptyState.wrapper)},[e.emptyState.icon?(n(),R(p,{key:0,name:e.emptyState.icon,class:m(e.ui.emptyState.icon),"aria-hidden":"true"},null,8,["name","class"])):D("",!0),d("p",{class:m(e.ui.emptyState.label)},y(e.emptyState.label),3)],2)])],8,Le)])):(n(!0),f(E,{key:2},H(e.rows,(s,b)=>(n(),f("tr",{key:b,class:m([e.ui.tr.base,e.isSelected(s)&&e.ui.tr.selected,e.$attrs.onSelect&&e.ui.tr.active,s==null?void 0:s.class]),onClick:()=>e.onSelect(s)},[e.modelValue?(n(),f("td",{key:0,class:m(e.ui.checkbox.padding)},[v(c,j({modelValue:e.selected,"onUpdate:modelValue":r[0]||(r[0]=g=>e.selected=g),value:s,ref_for:!0},e.ui.default.checkbox,{"aria-label":"Select row",onClick:r[1]||(r[1]=he(()=>{},["stop"]))}),null,16,["modelValue","value"])],2)):D("",!0),(n(!0),f(E,null,H(e.columns,(g,M)=>{var k;return n(),f("td",{key:M,class:m([e.ui.td.base,e.ui.td.padding,e.ui.td.color,e.ui.td.font,e.ui.td.size,(k=s[g.key])==null?void 0:k.class])},[G(e.$slots,`${g.key}-data`,{column:g,row:s,index:b,getRowData:$=>e.getRowData(s,g.key,$)},()=>[_(y(e.getRowData(s,g.key)),1)])],2)}),128))],10,Ne))),128))],2)],2)],16)}const Ge=be(De,[["render",Pe]]),ze={class:"flex flex-col md:flex-row"},Ee={class:"px-5 md:w-4/5"},He=d("h2",{class:"mb-3 text-xl"},"Workers",-1),Je={class:"flex flex-col lg:flex-row px-3 py-3.5 border-b border-gray-200 dark:border-gray-700"},qe={class:"flex"},Ke={key:0,class:"flex flex-col md:flex-row items-center"},Qe=d("span",null,"Tasks to give",-1),Xe={key:0},Ye={class:"p-4 flex flex-wrap max-w-64"},st=ie({__name:"workers",setup(e){_e({title:"Workers - Visionatrix",meta:[{name:"description",content:"Workers - Visionatrix"}]});const r=Se();we(()=>{r.startPolling()});const C=[{label:"Settings",icon:"i-heroicons-cog-6-tooth-20-solid",to:"/settings"},{label:"Workers information",icon:"i-heroicons-chart-bar-16-solid",to:"/settings/workers"}],B=[{id:"worker_status",label:"Worker status",sortable:!0},{id:"id",label:"ID"},{id:"worker_id",label:"Worker ID"},{id:"worker_version",label:"Worker version",sortable:!0},{id:"last_seen",label:"Last seen",sortable:!0},{id:"tasks_to_give",label:"Tasks to give",sortable:!1},{id:"os",label:"OS",sortable:!0},{id:"version",label:"Python Version",sortable:!0},{id:"device_name",label:"Device name"},{id:"device_type",label:"Device type",sortable:!0},{id:"vram_total",label:"VRAM total",sortable:!0},{id:"vram_free",label:"VRAM free",sortable:!0},{id:"torch_vram_total",label:"Torch VRAM total",sortable:!0},{id:"torch_vram_free",label:"Torch VRAM free",sortable:!0},{id:"ram_total",label:"RAM total",sortable:!0},{id:"ram_free",label:"RAM free",sortable:!0}],U=B.map(o=>({key:o.id,label:o.label,sortable:o.sortable||!1,class:""})),T=localStorage.getItem("selectedColumns");let c=null;if(T!==null){const o=JSON.parse(T);c=U.filter(t=>o.includes(t.key)),c.sort(I)}const w=F(c||[...U]);se(w,o=>{localStorage.setItem("selectedColumns",JSON.stringify(Object.values(U).filter(t=>o.includes(t)).map(t=>t.key))),o.sort(I)});function I(o,t){return B.findIndex(l=>l.id===o.key)-B.findIndex(l=>l.id===t.key)}const p=Ve(),s=V(()=>p.flows.map(o=>({label:o.display_name,value:o.name}))),b=F([]);Be(()=>{if(p.flows.length===0){p.fetchFlows().then(()=>{b.value=[...s.value]});return}b.value=[...s.value]});const g=F(!1);function M(){g.value=!0,Promise.all(h.value.map(o=>r.setTasksToGive(o.worker_id,b.value.map(t=>t.value)))).then(()=>{le().add({title:"Tasks to give updated",description:"Tasks to give updated successfully"}),h.value=[]}).catch(()=>{le().add({title:"Failed to update tasks to give",description:"Try again"})}).finally(()=>{g.value=!1,r.loadWorkers()})}const k=F(""),$=V(()=>r.$state.workers),J=V(()=>$.value.filter(o=>Object.values(o).some(t=>String(t).toLowerCase().includes(k.value.toLowerCase()))));function W(o){return new Date().getTime()-new Date(o.last_seen).getTime()<=12e4?"Online":"Offline"}const h=F([]);return se($,o=>{if(h.value.length>0){const t=h.value.map(l=>l.id);h.value=o.filter(l=>t.includes(l.id))}}),(o,t)=>{const l=me,S=fe,q=ge,L=Z,K=pe,N=Ue,x=Ae,P=$e,Q=Ge,ce=Ce;return n(),R(ce,{class:"lg:h-dvh"},{default:i(()=>[d("div",ze,[v(l,{links:C,class:"md:w-1/5"}),d("div",Ee,[He,d("div",Je,[d("div",qe,[v(S,{modelValue:u(w),"onUpdate:modelValue":t[0]||(t[0]=a=>z(w)?w.value=a:null),class:"mr-3",options:u(U),multiple:""},null,8,["modelValue","options"]),v(q,{modelValue:u(k),"onUpdate:modelValue":t[1]||(t[1]=a=>z(k)?k.value=a:null),placeholder:"Filter workers..."},null,8,["modelValue"])]),u(h).length>=1?(n(),f("div",Ke,[v(S,{modelValue:u(b),"onUpdate:modelValue":t[2]||(t[2]=a=>z(b)?b.value=a:null),class:"mr-3 my-3 lg:mx-3 lg:my-0 w-full max-w-64",options:u(s),multiple:""},{label:i(()=>[Qe]),_:1},8,["modelValue","options"]),v(K,{text:"Flows available for worker to get tasks"},{default:i(()=>[v(L,{icon:"i-heroicons-check-16-solid",variant:"outline",color:"cyan",size:"sm",loading:u(g),onClick:M},{default:i(()=>[_(" Update tasks to give ")]),_:1},8,["loading"])]),_:1})])):D("",!0)]),v(Q,{modelValue:u(h),"onUpdate:modelValue":t[3]||(t[3]=a=>z(h)?h.value=a:null),columns:u(w),rows:u(k)===""?u($):u(J),loading:u(r).$state.loading},{"worker_status-data":i(({row:a})=>[v(N,{variant:"solid",color:W(a)==="Online"?"green":"red"},{default:i(()=>[_(y(W(a)),1)]),_:2},1032,["color"])]),"tasks_to_give-data":i(({row:a})=>[a.tasks_to_give.length===0?(n(),f("span",Xe,"All")):(n(),R(P,{key:1,popper:{placement:"bottom"}},{panel:i(()=>[d("div",Ye,[(n(!0),f(E,null,H(a.tasks_to_give,X=>(n(),R(N,{key:X,class:"mr-2 mb-2",variant:"solid",color:"cyan"},{default:i(()=>[v(x,{class:"hover:underline",to:`/workflows/${X}`},{default:i(()=>[_(y(X),1)]),_:2},1032,["to"])]),_:2},1024))),128))])]),default:i(()=>[v(L,{icon:"i-heroicons-list-bullet-16-solid",variant:"outline",color:"gray",size:"sm"},{default:i(()=>[d("span",null,y(a.tasks_to_give.length)+" selected",1)]),_:2},1024)]),_:2},1024))]),"last_seen-data":i(({row:a})=>[_(y(new Date(a.last_seen).toLocaleString()),1)]),"vram_total-data":i(({row:a})=>[_(y(("formatBytes"in o?o.formatBytes:u(O))(a.vram_total)),1)]),"vram_free-data":i(({row:a})=>[_(y(("formatBytes"in o?o.formatBytes:u(O))(a.vram_free)),1)]),"torch_vram_total-data":i(({row:a})=>[_(y(("formatBytes"in o?o.formatBytes:u(O))(a.torch_vram_total)),1)]),"torch_vram_free-data":i(({row:a})=>[_(y(("formatBytes"in o?o.formatBytes:u(O))(a.torch_vram_free)),1)]),"ram_total-data":i(({row:a})=>[_(y(("formatBytes"in o?o.formatBytes:u(O))(a.ram_total)),1)]),"ram_free-data":i(({row:a})=>[_(y(("formatBytes"in o?o.formatBytes:u(O))(a.ram_free)),1)]),_:1},8,["modelValue","columns","rows","loading"])])])]),_:1})}}});export{st as default};
