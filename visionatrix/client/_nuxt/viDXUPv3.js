import{A as lt,W as Tt,B as Ce,_ as at,f as ee,c as j,o as d,a as w,C as Oe,D as Re,n as Z,G as st,H as Ne,M as $,X as it,S as Se,s as ye,Y as Bt,v as L,J as Je,I as ze,Z as Nt,$ as Lt,a0 as ft,a1 as nt,a2 as At,a3 as qt,a4 as pt,a5 as Le,a6 as Et,a7 as Dt,p as t,a8 as Wt,a9 as rt,aa as Ht,ab as wt,ac as Ae,ad as je,g as pe,L as Qe,T as yt,ae as Be,i as _,k as F,w as y,b as g,F as ue,r as ge,m as de,d as E,O as Q,af as Gt,q as Me,t as W,ag as Ke,P as bt,j as Ee,Q as ut,y as Xt,N as Ve,h as xe,x as kt,ah as xt,l as De,ai as dt,aj as Jt,ak as Qt,al as Kt,R as ot,am as _t,an as $t,ao as me,ap as Ct,aq as Yt,E as Zt,ar as St,as as en,z as tn,at as nn}from"./D6rcjpW4.js";import{b as Ye,a as on,_ as It}from"./yukO1VJJ.js";import{u as Rt,_ as We}from"./CxOE70TE.js";import{_ as He}from"./D9A0ItSc.js";import{_ as Ie,a as ln}from"./BE-RKBlt.js";import{_ as Ze}from"./D5PrDcmw.js";import{a as Ge,_ as Mt}from"./DUBF4uGr.js";import{_ as ct}from"./DlCB8Lx3.js";import{_ as an}from"./BbwTIuda.js";import{_ as sn}from"./HcQkcXfz.js";const rn={wrapper:"relative",container:"relative w-full flex overflow-x-auto snap-x snap-mandatory scroll-smooth",item:"flex flex-none snap-center",arrows:{wrapper:"flex items-center justify-between"},indicators:{wrapper:"absolute flex items-center justify-center gap-3 bottom-4 inset-x-0",base:"rounded-full h-3 w-3",active:"bg-primary-500 dark:bg-primary-400",inactive:"bg-gray-100 dark:bg-gray-800"},default:{prevButton:{color:"black",class:"rtl:[&_span:first-child]:rotate-180 absolute start-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-left-20-solid"},nextButton:{color:"black",class:"rtl:[&_span:last-child]:rotate-180 absolute end-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-right-20-solid"}}},un={wrapper:"relative w-full flex items-center",base:"w-full absolute appearance-none cursor-pointer disabled:cursor-not-allowed disabled:bg-opacity-50 focus:outline-none peer group",rounded:"rounded-lg",background:"bg-transparent",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",progress:{base:"absolute pointer-events-none peer-disabled:bg-opacity-50",rounded:"rounded-s-lg",background:"bg-{color}-500 dark:bg-{color}-400",size:{"2xs":"h-px",xs:"h-0.5",sm:"h-1",md:"h-2",lg:"h-3",xl:"h-4","2xl":"h-5"}},thumb:{base:"[&::-webkit-slider-thumb]:relative [&::-moz-range-thumb]:relative [&::-webkit-slider-thumb]:z-[1] [&::-moz-range-thumb]:z-[1] [&::-webkit-slider-thumb]:appearance-none [&::-moz-range-thumb]:appearance-none [&::-webkit-slider-thumb]:rounded-full [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:border-0",color:"text-{color}-500 dark:text-{color}-400",background:"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:dark:bg-gray-900 [&::-moz-range-thumb]:bg-current",ring:"[&::-webkit-slider-thumb]:ring-2 [&::-webkit-slider-thumb]:ring-current",size:{"2xs":"[&::-webkit-slider-thumb]:h-1.5 [&::-moz-range-thumb]:h-1.5 [&::-webkit-slider-thumb]:w-1.5 [&::-moz-range-thumb]:w-1.5 [&::-webkit-slider-thumb]:mt-[-2.5px] [&::-moz-range-thumb]:mt-[-2.5px]",xs:"[&::-webkit-slider-thumb]:h-2 [&::-moz-range-thumb]:h-2 [&::-webkit-slider-thumb]:w-2 [&::-moz-range-thumb]:w-2 [&::-webkit-slider-thumb]:mt-[-3px] [&::-moz-range-thumb]:mt-[-3px]",sm:"[&::-webkit-slider-thumb]:h-3 [&::-moz-range-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-moz-range-thumb]:w-3 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",md:"[&::-webkit-slider-thumb]:h-4 [&::-moz-range-thumb]:h-4 [&::-webkit-slider-thumb]:w-4 [&::-moz-range-thumb]:w-4 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",lg:"[&::-webkit-slider-thumb]:h-5 [&::-moz-range-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 [&::-moz-range-thumb]:w-5 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",xl:"[&::-webkit-slider-thumb]:h-6 [&::-moz-range-thumb]:h-6 [&::-webkit-slider-thumb]:w-6 [&::-moz-range-thumb]:w-6 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1","2xl":"[&::-webkit-slider-thumb]:h-7 [&::-moz-range-thumb]:h-7 [&::-webkit-slider-thumb]:w-7 [&::-moz-range-thumb]:w-7 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1"}},track:{base:"[&::-webkit-slider-runnable-track]:group-disabled:bg-opacity-50 [&::-moz-range-track]:group-disabled:bg-opacity-50",background:"[&::-webkit-slider-runnable-track]:bg-gray-200 [&::-moz-range-track]:bg-gray-200 [&::-webkit-slider-runnable-track]:dark:bg-gray-700 [&::-moz-range-track]:dark:bg-gray-700",rounded:"[&::-webkit-slider-runnable-track]:rounded-lg [&::-moz-range-track]:rounded-lg",size:{"2xs":"[&::-webkit-slider-runnable-track]:h-px [&::-moz-range-track]:h-px",xs:"[&::-webkit-slider-runnable-track]:h-0.5 [&::-moz-range-track]:h-0.5",sm:"[&::-webkit-slider-runnable-track]:h-1 [&::-moz-range-track]:h-1",md:"[&::-webkit-slider-runnable-track]:h-2 [&::-moz-range-track]:h-2",lg:"[&::-webkit-slider-runnable-track]:h-3 [&::-moz-range-track]:h-3",xl:"[&::-webkit-slider-runnable-track]:h-4 [&::-moz-range-track]:h-4","2xl":"[&::-webkit-slider-runnable-track]:h-5 [&::-moz-range-track]:h-5"}},size:{"2xs":"h-1.5",xs:"h-2",sm:"h-3",md:"h-4",lg:"h-5",xl:"h-6","2xl":"h-7"},default:{size:"md",color:"primary"}},$e=lt(Ce.ui.strategy,Ce.ui.textarea,Tt),dn=ee({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys($e.size).includes(e)}},color:{type:String,default:()=>$e.default.color,validator(e){return[...Ce.ui.colors,...Object.keys($e.color)].includes(e)}},variant:{type:String,default:()=>$e.default.variant,validator(e){return[...Object.keys($e.variant),...Object.values($e.color).flatMap(o=>Object.keys(o))].includes(e)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:o}){const{ui:n,attrs:a}=st("textarea",Ne(e,"ui"),$e,Ne(e,"class")),{emitFormBlur:s,emitFormInput:l,inputId:i,color:m,size:f,name:x}=Rt(e,$e),b=$(it({},e.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),C=$(null),P=()=>{var h;e.autofocus&&((h=C.value)==null||h.focus())},U=()=>{if(e.autoresize){if(!C.value)return;C.value.rows=e.rows;const h=C.value.style.overflow;C.value.style.overflow="hidden";const v=window.getComputedStyle(C.value),u=Number.parseInt(v.paddingTop),T=Number.parseInt(v.paddingBottom),r=u+T,k=Number.parseInt(v.lineHeight),{scrollHeight:R}=C.value,O=(R-r)/k;O>e.rows&&(C.value.rows=e.maxrows?Math.min(O,e.maxrows):O),C.value.style.overflow=h}},I=h=>{b.value.trim&&(h=h.trim()),b.value.number&&(h=Nt(h)),b.value.nullify&&(h||(h=null)),o("update:modelValue",h),l()},z=h=>{U(),b.value.lazy||I(h.target.value)},N=h=>{const v=h.target.value;o("change",v),b.value.lazy&&I(v),b.value.trim&&(h.target.value=v.trim())},S=h=>{o("blur",h),s()};Se(()=>{setTimeout(()=>{P()},e.autofocusDelay)}),ye(()=>e.modelValue,()=>{Bt(U)}),Se(()=>{setTimeout(()=>{P(),U()},100)});const c=L(()=>{var v,u;const h=((u=(v=n.value.color)==null?void 0:v[m.value])==null?void 0:u[e.variant])||n.value.variant[e.variant];return Je(ze(n.value.base,n.value.form,n.value.rounded,n.value.placeholder,n.value.size[f.value],e.padded?n.value.padding[f.value]:"p-0",h==null?void 0:h.replaceAll("{color}",m.value),!e.resize&&"resize-none"),e.textareaClass)});return{ui:n,attrs:a,name:x,inputId:i,textarea:C,textareaClass:c,onInput:z,onChange:N,onBlur:S}}}),cn=["id","value","name","rows","required","disabled","placeholder"];function mn(e,o,n,a,s,l){return d(),j("div",{class:Z(e.ui.wrapper)},[w("textarea",Re({id:e.inputId,ref:"textarea",value:e.modelValue,name:e.name,rows:e.rows,required:e.required,disabled:e.disabled,placeholder:e.placeholder,class:e.textareaClass},e.attrs,{onInput:o[0]||(o[0]=(...i)=>e.onInput&&e.onInput(...i)),onBlur:o[1]||(o[1]=(...i)=>e.onBlur&&e.onBlur(...i)),onChange:o[2]||(o[2]=(...i)=>e.onChange&&e.onChange(...i))}),null,16,cn),Oe(e.$slots,"default")],2)}const fn=at(dn,[["render",mn]]);async function pn(e,o){return await gn(o).catch(a=>(console.error("Failed to get image meta for "+o,a+""),{width:0,height:0,ratio:0}))}async function gn(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((o,n)=>{const a=new Image;a.onload=()=>{const s={width:a.width,height:a.height,ratio:a.width/a.height};o(s)},a.onerror=s=>n(s),a.src=e})}function gt(e){return o=>o?e[o]||o:e.missingValue}function vn({formatter:e,keyMap:o,joinWith:n="/",valueMap:a}={}){e||(e=(l,i)=>`${l}=${i}`),o&&typeof o!="function"&&(o=gt(o));const s=a||{};return Object.keys(s).forEach(l=>{typeof s[l]!="function"&&(s[l]=gt(s[l]))}),(l={})=>Object.entries(l).filter(([m,f])=>typeof f<"u").map(([m,f])=>{const x=s[m];return typeof x=="function"&&(f=x(l[m])),m=typeof o=="function"?o(m):m,e(m,f)}).join(n)}function ke(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return Number.parseInt(e,10)}function hn(e=""){if(e===void 0||!e.length)return[];const o=new Set;for(const n of e.split(" ")){const a=Number.parseInt(n.replace("x",""));a&&o.add(a)}return Array.from(o)}function wn(e){if(e.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function yn(e){const o={};if(typeof e=="string")for(const n of e.split(/[\s,]+/).filter(a=>a)){const a=n.split(":");a.length!==2?o["1px"]=a[0].trim():o[a[0].trim()]=a[1].trim()}else Object.assign(o,e);return o}function bn(e){const o={options:e},n=(s,l={})=>Ft(o,s,l),a=(s,l={},i={})=>n(s,{...i,modifiers:it(l,i.modifiers||{})}).url;for(const s in e.presets)a[s]=(l,i,m)=>a(l,i,{...e.presets[s],...m});return a.options=e,a.getImage=n,a.getMeta=(s,l)=>kn(o,s,l),a.getSizes=(s,l)=>$n(o,s,l),o.$img=a,a}async function kn(e,o,n){const a=Ft(e,o,{...n});return typeof a.getMeta=="function"?await a.getMeta():await pn(e,a.url)}function Ft(e,o,n){var x,b;if(o&&typeof o!="string")throw new TypeError(`input must be a string (received ${typeof o}: ${JSON.stringify(o)})`);if(!o||o.startsWith("data:"))return{url:o};const{provider:a,defaults:s}=xn(e,n.provider||e.options.provider),l=_n(e,n.preset);if(o=ft(o)?o:Lt(o),!a.supportsAlias){for(const C in e.options.alias)if(o.startsWith(C)){const P=e.options.alias[C];P&&(o=nt(P,o.slice(C.length)))}}if(a.validateDomains&&ft(o)){const C=At(o).host;if(!e.options.domains.find(P=>P===C))return{url:o}}const i=it(n,l,s);i.modifiers={...i.modifiers};const m=i.modifiers.format;(x=i.modifiers)!=null&&x.width&&(i.modifiers.width=ke(i.modifiers.width)),(b=i.modifiers)!=null&&b.height&&(i.modifiers.height=ke(i.modifiers.height));const f=a.getImage(o,i,e);return f.format=f.format||m||"",f}function xn(e,o){const n=e.options.providers[o];if(!n)throw new Error("Unknown provider: "+o);return n}function _n(e,o){if(!o)return{};if(!e.options.presets[o])throw new Error("Unknown preset: "+o);return e.options.presets[o]}function $n(e,o,n){var I,z,N,S,c;const a=ke((I=n.modifiers)==null?void 0:I.width),s=ke((z=n.modifiers)==null?void 0:z.height),l=yn(n.sizes),i=(N=n.densities)!=null&&N.trim()?hn(n.densities.trim()):e.options.densities;wn(i);const m=a&&s?s/a:0,f=[],x=[];if(Object.keys(l).length>=1){for(const h in l){const v=vt(h,String(l[h]),s,m,e);if(v!==void 0){f.push({size:v.size,screenMaxWidth:v.screenMaxWidth,media:`(max-width: ${v.screenMaxWidth}px)`});for(const u of i)x.push({width:v._cWidth*u,src:ht(e,o,n,v,u)})}}Cn(f)}else for(const h of i){const v=Object.keys(l)[0];let u=v?vt(v,String(l[v]),s,m,e):void 0;u===void 0&&(u={size:"",screenMaxWidth:0,_cWidth:(S=n.modifiers)==null?void 0:S.width,_cHeight:(c=n.modifiers)==null?void 0:c.height}),x.push({width:h,src:ht(e,o,n,u,h)})}Sn(x);const b=x[x.length-1],C=f.length?f.map(h=>`${h.media?h.media+" ":""}${h.size}`).join(", "):void 0,P=C?"w":"x",U=x.map(h=>`${h.src} ${h.width}${P}`).join(", ");return{sizes:C,srcset:U,src:b==null?void 0:b.src}}function vt(e,o,n,a,s){const l=s.options.screens&&s.options.screens[e]||Number.parseInt(e),i=o.endsWith("vw");if(!i&&/^\d+$/.test(o)&&(o=o+"px"),!i&&!o.endsWith("px"))return;let m=Number.parseInt(o);if(!l||!m)return;i&&(m=Math.round(m/100*l));const f=a?Math.round(m*a):n;return{size:o,screenMaxWidth:l,_cWidth:m,_cHeight:f}}function ht(e,o,n,a,s){return e.$img(o,{...n.modifiers,width:a._cWidth?a._cWidth*s:void 0,height:a._cHeight?a._cHeight*s:void 0},n)}function Cn(e){var n;e.sort((a,s)=>a.screenMaxWidth-s.screenMaxWidth);let o=null;for(let a=e.length-1;a>=0;a--){const s=e[a];s.media===o&&e.splice(a,1),o=s.media}for(let a=0;a<e.length;a++)e[a].media=((n=e[a+1])==null?void 0:n.media)||""}function Sn(e){e.sort((n,a)=>n.width-a.width);let o=null;for(let n=e.length-1;n>=0;n--){const a=e[n];a.width===o&&e.splice(n,1),o=a.width}}const In=vn({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,o)=>pt(e)+"_"+pt(o)}),Rn=(e,{modifiers:o={},baseURL:n}={},a)=>{o.width&&o.height&&(o.resize=`${o.width}x${o.height}`,delete o.width,delete o.height);const s=In(o)||"_";return n||(n=nt(a.options.nuxt.baseURL,"/_ipx")),{url:nt(n,s,qt(e))}},Mn=!0,Fn=!0,Pn=Object.freeze(Object.defineProperty({__proto__:null,getImage:Rn,supportsAlias:Fn,validateDomains:Mn},Symbol.toStringTag,{value:"Module"})),Pt={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};Pt.providers={ipxStatic:{provider:Pn,defaults:{}}};const mt=()=>{const e=Et(),o=Le();return o.$img||o._img||(o._img=bn({...Pt,nuxt:{baseURL:e.app.baseURL},runtimeConfig:e}))};function Un(e){var o;(o=performance==null?void 0:performance.mark)==null||o.call(performance,"mark_feature_usage",{detail:{feature:e}})}const zn={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},Vn=e=>{const o=L(()=>({provider:e.provider,preset:e.preset})),n=L(()=>({width:ke(e.width),height:ke(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding,nonce:e.nonce})),a=mt(),s=L(()=>({...e.modifiers,width:ke(e.width),height:ke(e.height),format:e.format,quality:e.quality||a.options.quality,background:e.background,fit:e.fit}));return{options:o,attrs:n,modifiers:s}},On={...zn,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},jn=["src"],_e=ee({__name:"NuxtImg",props:On,emits:["load","error"],setup(e,{emit:o}){const n=e,a=Dt(),s=o,l=!1,i=mt(),m=Vn(n),f=$(!1),x=$(),b=L(()=>i.getSizes(n.src,{...m.options.value,sizes:n.sizes,densities:n.densities,modifiers:{...m.modifiers.value,width:ke(n.width),height:ke(n.height)}})),C=L(()=>{const S={...m.attrs.value,"data-nuxt-img":""};return(!n.placeholder||f.value)&&(S.sizes=b.value.sizes,S.srcset=b.value.srcset),S}),P=L(()=>{let S=n.placeholder;if(S===""&&(S=!0),!S||f.value)return!1;if(typeof S=="string")return S;const c=Array.isArray(S)?S:typeof S=="number"?[S,S]:[10,10];return i(n.src,{...m.modifiers.value,width:c[0],height:c[1],quality:c[2]||50,blur:c[3]||3},m.options.value)}),U=L(()=>n.sizes?b.value.src:i(n.src,m.modifiers.value,m.options.value)),I=L(()=>P.value?P.value:U.value),N=Le().isHydrating;return Se(()=>{if(P.value||n.custom){const S=new Image;U.value&&(S.src=U.value),n.sizes&&(S.sizes=b.value.sizes||"",S.srcset=b.value.srcset),S.onload=c=>{f.value=!0,s("load",c)},S.onerror=c=>{s("error",c)},Un("nuxt-image");return}x.value&&(x.value.complete&&N&&(x.value.getAttribute("data-error")?s("error",new Event("error")):s("load",new Event("load"))),x.value.onload=S=>{s("load",S)},x.value.onerror=S=>{s("error",S)})}),(S,c)=>S.custom?Oe(S.$slots,"default",Wt(Re({key:1},{...t(l)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...C.value,...t(a)},isLoaded:f.value,src:I.value}))):(d(),j("img",Re({key:0,ref_key:"imgEl",ref:x,class:n.placeholder&&!f.value?n.placeholderClass:void 0},{...t(l)?{onerror:"this.setAttribute('data-error', 1)"}:{},...C.value,...t(a)},{src:I.value}),null,16,jn))}}),Xe=lt(Ce.ui.strategy,Ce.ui.range,un),Tn=ee({inheritAttrs:!1,props:{modelValue:{type:Number,default:0},id:{type:String,default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},size:{type:String,default:null,validator(e){return Object.keys(Xe.size).includes(e)}},color:{type:String,default:()=>Xe.default.color,validator(e){return Ce.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:o}){const{ui:n,attrs:a}=st("range",Ne(e,"ui"),Xe),{emitFormChange:s,inputId:l,color:i,size:m,name:f}=Rt(e,Xe),x=L({get(){return e.modelValue},set(S){o("update:modelValue",S)}}),b=S=>{o("change",S.target.value),s()},C=L(()=>Je(ze(n.value.wrapper,n.value.size[m.value]),e.class)),P=L(()=>Je(ze(n.value.base,n.value.background,n.value.rounded,i.value&&n.value.ring.replaceAll("{color}",i.value),n.value.size[m.value]),e.inputClass)),U=L(()=>ze(n.value.thumb.base,i.value&&n.value.thumb.color.replaceAll("{color}",i.value),n.value.thumb.ring,n.value.thumb.background,n.value.thumb.size[m.value])),I=L(()=>ze(n.value.track.base,n.value.track.background,n.value.track.rounded,n.value.track.size[m.value])),z=L(()=>ze(n.value.progress.base,n.value.progress.rounded,i.value&&n.value.progress.background.replaceAll("{color}",i.value),n.value.progress.size[m.value])),N=L(()=>{const{modelValue:S,min:c,max:h}=e;return{width:`${(Math.max(c,Math.min(S,h))-c)/(h-c)*100}%`}});return{ui:n,attrs:a,name:f,inputId:l,value:x,wrapperClass:C,inputClass:P,thumbClass:U,trackClass:I,progressClass:z,progressStyle:N,onChange:b}}}),Bn=["id","name","min","max","disabled","step"];function Nn(e,o,n,a,s,l){return d(),j("div",{class:Z(e.wrapperClass)},[rt(w("input",Re({id:e.inputId,ref:"input","onUpdate:modelValue":o[0]||(o[0]=i=>e.value=i),name:e.name,min:e.min,max:e.max,disabled:e.disabled,step:e.step,type:"range",class:[e.inputClass,e.thumbClass,e.trackClass]},e.attrs,{onChange:o[1]||(o[1]=(...i)=>e.onChange&&e.onChange(...i))}),null,16,Bn),[[Ht,e.value,void 0,{number:!0}]]),w("span",{class:Z(e.progressClass),style:wt(e.progressStyle)},null,6)],2)}const Ut=at(Tn,[["render",Nn]]),Ln={class:"image-mask flex flex-col w-full"},An={class:"canvas flex flex-col items-center justify-center mb-3 w-full"},qn={class:"preview-over-original relative"},En={class:"actions flex items-center justify-center mb-3 mx-auto"},Dn={class:"options w-full max-w-[320px]"},Wn=ee({__name:"ImageInpaint",props:Ae({imageSrc:{type:String,required:!0}},{imageInpaintMask:{default:"",type:String},imageInpaintMaskModifiers:{},imageInpaintMaskData:{default:{},type:Object},imageInpaintMaskDataModifiers:{}}),emits:["update:imageInpaintMask","update:imageInpaintMaskData"],setup(e){const o=e,n=je(e,"imageInpaintMask"),a=je(e,"imageInpaintMaskData"),s=pe(),l=$(null),i=$(null),m=$(null),f=$(null),x=$(30),b=$([]),C=$({width:s.$state.outputMaxSize,height:s.$state.outputMaxSize}),P=$(null),U=$({x:0,y:0}),I=$({x:0,y:0,radius:x.value,fill:"rgba(255, 255, 255, 0.5)",stroke:null,strokeWidth:0,visible:!1}),z=$(5),N=$(!1),S=$([]),c=$([]);function h(){if(!l.value||!m.value){console.error("Could not get stage, image layer, or mask layer");return}const p=l.value.getNode(),M=f.value?f.value.width:p.width(),q=f.value?f.value.height:p.height(),G=document.createElement("canvas");G.width=M,G.height=q;const V=G.getContext("2d");if(!V){console.error("Could not get 2d context for mask canvas");return}V.fillStyle="black",V.fillRect(0,0,M,q);const H=M/p.width(),Y=q/p.height();V.fillStyle="white",b.value.forEach(ve=>{V.beginPath(),V.arc(ve.x*H,ve.y*Y,ve.radius*Math.max(H,Y),0,Math.PI*2,!0),V.closePath(),V.fill()});const ie=G.toDataURL("image/png",1);ie?(O(),n.value=ie,I.value.visible=!1,N.value=!1):console.error("Could not get data URI for masked image")}function v(p){const M=l.value.getNode();if(p.type.startsWith("touch")){const q=p.evt.touches[0]||p.evt.changedTouches[0];return{x:q.clientX-M.getContainer().offsetLeft,y:q.clientY-M.getContainer().offsetTop}}return M.getPointerPosition()}function u(p){p.type==="mousedown"&&p.evt.button!==0||(N.value=!0,U.value=v(p),R(),T(U.value))}function T(p){const M={x:p.x,y:p.y,radius:x.value,fill:"rgba(255, 255, 255, 1)"};b.value=b.value.filter(q=>!(r({x:q.x,y:q.y},p)+q.radius<=M.radius)),b.value.push(M)}function r(p,M){return Math.sqrt(Math.pow(M.x-p.x,2)+Math.pow(M.y-p.y,2))}function k(p){if(p.type.startsWith("touch")&&p.evt.preventDefault(),we(p),!N.value)return;const M=v(p);r(U.value,v(p))>=z.value&&(T(M),U.value=M)}function R(){S.value.push([...b.value]),c.value=[]}function O(){a.value={circles:[...b.value],brushRadius:x.value,undoStack:S.value,redoStack:c.value}}function D(){a.value!==null&&(b.value=a.value.circles||[],x.value=a.value.brushRadius||30,S.value=a.value.undoStack||[],c.value=a.value.redoStack||[])}function oe(){S.value.length!==0&&(c.value.push([...b.value]),b.value=S.value.pop()||[])}function le(){c.value.length!==0&&(S.value.push([...b.value]),b.value=c.value.pop()||[])}function ae(){N.value=!1}function he(){n.value=""}function X(){R(),b.value=[],n.value=""}const ne=L(()=>S.value.length>0),ce=L(()=>c.value.length>0);function we(p){const M=v(p);I.value.x=M.x,I.value.y=M.y}function K(){I.value.visible=!1,N.value=!1}function J(){I.value.visible=!0,I.value.radius=x.value}function se(){const p=new Image;p.src=o.imageSrc,p.onload=()=>{f.value=p,fe(),A()}}function fe(){if(!f.value)return;const p=window.innerWidth,M=window.innerHeight,q=f.value.width/f.value.height;let G,V;const H=Math.min(p*.9,1200),Y=Math.min(M*.8,s.outputMaxSize);q>H/Y?(G=H,V=G/q):(V=Y,G=V*q),C.value={width:Math.floor(G),height:Math.floor(V)},A()}function A(){const p=C.value.width,M=C.value.height,q=f.value.width,G=f.value.height,V=p/q,H=M/G,Y=Math.min(V,H);P.value={x:0,y:0,width:q*Y,height:G*Y}}return Qe(()=>{se(),D()}),Se(()=>{if(l.value){const p=l.value.getNode();p.on("touchstart",u),p.on("touchmove",k),p.on("touchend",ae),p.on("touchcancel",K)}}),yt(()=>{if(l.value){const p=l.value.getNode();p.off("touchstart"),p.off("touchmove"),p.off("touchend"),p.off("touchcancel")}O()}),(p,M)=>{const q=_e,G=Be("v-image"),V=Be("v-layer"),H=Be("v-circle"),Y=Be("v-stage"),ie=de,ve=Ut,Pe=He;return d(),j("div",Ln,[w("div",An,[M[1]||(M[1]=w("p",{class:"text-sm my-2 text-slate-500"},"Select the target area for image inpaint",-1)),w("div",qn,[e.imageSrc&&e.imageSrc!==""&&n.value!==""?(d(),_(q,{key:0,src:e.imageSrc,fit:"inside",width:t(C).width,height:t(C).height,draggable:"false",class:Z({absolute:n.value!==""})},null,8,["src","width","height","class"])):F("",!0),n.value?(d(),_(q,{key:1,src:n.value,fit:"inside",width:t(C).width,height:t(C).height,draggable:"false",class:"opacity-50"},null,8,["src","width","height"])):F("",!0)]),n.value===""?(d(),_(Y,{key:0,ref_key:"stageRef",ref:l,config:t(C),onMousedown:u,onMousemove:k,onMouseup:ae,onMouseleave:K,onMouseenter:J},{default:y(()=>[g(V,{ref_key:"imageLayerRef",ref:i},{default:y(()=>[g(G,{image:t(f),config:t(C)},null,8,["image","config"])]),_:1},512),g(V,{ref_key:"maskLayerRef",ref:m},{default:y(()=>[(d(!0),j(ue,null,ge(t(b),(be,Ue)=>(d(),_(H,{key:Ue,config:be},null,8,["config"]))),128)),t(I).visible?(d(),_(H,{key:0,config:t(I)},null,8,["config"])):F("",!0)]),_:1},512)]),_:1},8,["config"])):F("",!0)]),w("div",En,[g(ie,{class:"mr-2",size:"xs",icon:"i-heroicons-clipboard-document-check-16-solid",variant:"soft",disabled:t(b).length===0||n.value!=="",onClick:h},{default:y(()=>M[2]||(M[2]=[E(" Apply ")])),_:1},8,["disabled"]),g(ie,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-left-16-solid",variant:"soft",color:"cyan",disabled:!t(ne)||n.value!=="",onClick:oe},null,8,["disabled"]),g(ie,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-right-16-solid",variant:"soft",color:"cyan",disabled:!t(ce)||n.value!=="",onClick:le},null,8,["disabled"]),g(ie,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-turn-up-left-20-solid",variant:"soft",disabled:t(b).length===0&&n.value==="",color:"red",onClick:X},{default:y(()=>M[3]||(M[3]=[E(" Reset ")])),_:1},8,["disabled"]),g(ie,{size:"xs",icon:"i-heroicons-pencil-solid",variant:"soft",disabled:n.value==="",color:"orange",onClick:he},{default:y(()=>M[4]||(M[4]=[E(" Edit ")])),_:1},8,["disabled"])]),w("div",Dn,[g(Pe,{class:"mb-3 text-sm",hint:`value: ${t(x)}`,label:"Brush radius"},{default:y(()=>[g(ve,{modelValue:t(x),"onUpdate:modelValue":M[0]||(M[0]=be=>Q(x)?x.value=be:null),min:1,max:100,size:"sm",class:"my-2",disabled:n.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["hint"])])])}}});function qe(e={}){const{copy:o,isSupported:n}=Gt(),a=Me();function s(l,i={},m={}){n&&o(l).then(()=>{!i.title&&!i.description||a.add({...i,...e})},function(f){a.add({...m,description:m.description||f.message,...e})})}return{copy:s}}const Hn="0.05";function Gn(e,o){const n=parseFloat(e);if(isNaN(n))return e;const a=n+o;return a<0?"0":String(Number(a.toFixed(10)))}function Xn(e,o){let n=o,a=o,s=0,l=0;for(;n>=0&&(n--,!(e[n]==="("&&s===l));)e[n]==="("&&s++,e[n]===")"&&l++;if(n<0)return!1;for(s=0,l=0;a<e.length&&!(e[a]===")"&&s===l);)e[a]==="("&&s++,e[a]===")"&&l++,a++;return a===e.length?!1:{start:n+1,end:a}}function Jn(e){const o=/^\((.*)\)$/,n=e.match(o),a=/:([+-]?(\d*\.)?\d+([eE][+-]?\d+)?)/,s=e.match(a);return n&&!s?`(${n[1]}:1.0)`:e}function Qn(e){const o=e.composedPath()[0],n=parseFloat(Hn);if(o.tagName!=="TEXTAREA"||!(e.key==="ArrowUp"||e.key==="ArrowDown")||!e.ctrlKey&&!e.metaKey)return;e.preventDefault();let a=o.selectionStart,s=o.selectionEnd,l=o.value.substring(a,s);if(!l){const f=Xn(o.value,a);if(f)a=f.start,s=f.end,l=o.value.substring(a,s);else{const x=" .,\\/!?%^*;:{}=-_`~()\r\n	";for(;!x.includes(o.value[a-1])&&a>0;)a--;for(;!x.includes(o.value[s])&&s<o.value.length;)s++;if(l=o.value.substring(a,s),!l)return}}l[l.length-1]===" "&&(l=l.substring(0,l.length-1),s-=1),o.value[a-1]==="("&&o.value[s]===")"&&(a-=1,s+=1,l=o.value.substring(a,s)),(l[0]!=="("||l[l.length-1]!==")")&&(l=`(${l})`),l=Jn(l);const i=e.key==="ArrowUp"?n:-n,m=l.replace(/\((.*):(\d+(?:\.\d+)?)\)/,(f,x,b)=>(b=Gn(b,i),Number(b)==1?x:`(${x}:${b})`));return o.setRangeText(m,a,s,"select"),o.value}const Kn={key:0,class:"text-red-300"},Yn={class:"flex items-center"},Zn={class:"p-2 max-w-48 max-h-48 not-italic"},eo={class:"block font-medium text-gray-700 dark:text-gray-200"},to={key:0,class:"flex items-center"},no={key:2,class:"flex flex-row flex-grow items-center justify-between"},oo={key:3,class:"flex flex-row flex-grow items-center"},lo={class:"sm:inline"},ao={class:"preview-over-original relative"},so={key:1,class:"text-red-300 text-sm"},io=ee({__name:"InputParam",props:{inputParam:{type:Object,required:!0},index:{type:Number,required:!0},inputParamsMap:{type:Array,required:!0},advanced:{type:Boolean,default:!1}},setup(e){const o=e,n=$(!1),a=$(null),s=$(""),l=$({width:0,height:0}),i=$(""),m=$({}),f=$(null),x=o.inputParamsMap[o.index][o.inputParam.name].source_input_name,b=o.inputParamsMap.findIndex(v=>{if(Object.keys(v)[0]===o.inputParamsMap[o.index][o.inputParam.name].source_input_name)return!0});function C(){try{const v=o.inputParamsMap.find(u=>{const T=Object.keys(u)[0];if(T===x)return u[T]});N(v[x].value)}catch{l.value.width=0,l.value.height=0}}Se(()=>{o.inputParam.type==="range_scale"&&C(),o.inputParam.type==="image-mask"&&ye(i,v=>{const u=new File([i.value],`image-mask-${o.inputParam.name}.png`,{type:"image/png"});o.inputParamsMap[o.index][o.inputParam.name].value=u,o.inputParamsMap[o.index][o.inputParam.name].mask_applied=v!==""})}),o.inputParam.type==="range_scale"&&ye(o.inputParamsMap,()=>{C()});function P(v){return v?URL.createObjectURL(v):""}function U(){URL.revokeObjectURL(s.value),s.value="",a.value&&(a.value.$refs.input.value=""),o.inputParamsMap[o.index][o.inputParam.name].value=null,o.inputParamsMap[o.index][o.inputParam.name].image_preview_url=""}function I(){URL.revokeObjectURL(i.value),i.value="",m.value={},o.inputParamsMap[o.index][o.inputParam.name].value=null,o.inputParamsMap[o.index][o.inputParam.name].mask_applied=!1}const z=L(()=>o.inputParam.type!=="bool"?o.inputParam.display_name:"");function N(v){if(!(v instanceof File)){l.value.width=0,l.value.height=0;return}const u=URL.createObjectURL(v),T=new Image;T.onload=function(){l.value.width=T.naturalWidth,l.value.height=T.naturalHeight,URL.revokeObjectURL(T.src)},T.src=u}const S=L(()=>{if(o.inputParam.type==="range_scale"){const v=o.inputParamsMap[o.index][o.inputParam.name].value;return`value: ${v}x (${l.value.width}x${l.value.height} -> ${(l.value.width*v).toFixed(0)}x${(l.value.height*v).toFixed(0)})`}return["range","range_scale"].includes(o.inputParam.type)?`value: ${o.inputParamsMap[o.index][o.inputParam.name].value}`:""}),c=$(null);function h(v){const u=Qn(v);u&&(o.inputParamsMap[o.index][o.inputParam.name].value=u)}return Se(()=>{o.inputParam.type==="text"&&c.value&&c.value.$refs.textarea.addEventListener("keydown",h),o.inputParam.type==="image-mask"&&(f.value=o.inputParamsMap[b][x],ye(o.inputParamsMap[b][x],v=>{i.value="",m.value={},f.value=v}))}),yt(()=>{URL.revokeObjectURL(s.value),URL.revokeObjectURL(i.value),o.inputParam.type==="text"&&c.value&&c.value.$refs.textarea.removeEventListener("keydown",h)}),(v,u)=>{var ce,we;const T=de,r=Ee,k=bt,R=fn,O=We,D=_e,oe=Wn,le=Ie,ae=Ze,he=Ge,X=Ut,ne=He;return(((ce=e.inputParam)==null?void 0:ce.advanced)||!1)===e.advanced?(d(),_(ne,{key:0,class:Z(["mb-3",{italic:(we=e.inputParam)==null?void 0:we.dynamic_lora}]),help:t(S)},{hint:y(()=>[e.inputParam.optional?F("",!0):(d(),j("span",Kn,"required"))]),label:y(()=>{var K;return[w("div",Yn,[(K=e.inputParam)!=null&&K.dynamic_lora&&e.inputParam.trigger_words.length>0?(d(),_(k,{key:0},{panel:y(()=>[w("div",Zn,[u[17]||(u[17]=w("h4",{class:"mb-2 text-center"},"Trigger words",-1)),(d(!0),j(ue,null,ge(e.inputParam.trigger_words,J=>(d(),_(r,{key:J,color:"violet",class:"mr-1 cursor-pointer",onClick:()=>{("useCopyToClipboard"in v?v.useCopyToClipboard:t(qe))().copy(J),("useToast"in v?v.useToast:t(Me))().add({title:"Clipboard",description:"Trigger word copied to clipboard",timeout:2e3})}},{default:y(()=>[E(W(J),1)]),_:2},1032,["onClick"]))),128))])]),default:y(()=>[g(T,{icon:"i-heroicons-information-circle",variant:"ghost",size:"xs",color:"gray",class:"mr-2"})]),_:1})):F("",!0),w("label",eo,W(t(z)),1)])]}),default:y(()=>{var K,J,se,fe,A;return[e.inputParam.type==="text"?(d(),_(R,{key:0,ref_key:"textareaInput",ref:c,size:"md",placeholder:e.inputParam.display_name,required:!e.inputParam.optional,resize:!0,label:e.inputParam.display_name,value:e.inputParamsMap[e.index][e.inputParam.name].value,autoresize:"",variant:"outline",onInput:u[0]||(u[0]=p=>{const M=p.target;e.inputParamsMap[e.index][e.inputParam.name].value=M.value})},null,8,["placeholder","required","label","value"])):F("",!0),e.inputParam.type==="number"?(d(),j(ue,{key:1},[e.inputParam.name==="seed"?(d(),j("div",to,[e.inputParam.type==="number"?(d(),_(O,{key:0,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":u[1]||(u[1]=p=>e.inputParamsMap[e.index][e.inputParam.name].value=p),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"])):F("",!0),g(T,{icon:"i-heroicons-arrow-path",color:"violet",variant:"outline",size:"xs",class:"ml-2",onClick:u[2]||(u[2]=()=>{e.inputParamsMap[e.index][e.inputParam.name].value=Math.floor(Math.random()*1e7)})})])):(d(),_(O,{key:1,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":u[3]||(u[3]=p=>e.inputParamsMap[e.index][e.inputParam.name].value=p),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"]))],64)):F("",!0),e.inputParam.type==="image"?(d(),j("div",no,[g(O,{ref_key:"imageInput",ref:a,type:"file",accept:"image/*",class:"w-full",variant:"outline",color:"gray",label:e.inputParam.display_name,onChange:u[4]||(u[4]=p=>{console.debug("files",p);const M=p==null?void 0:p[0];e.inputParamsMap[e.index][e.inputParam.name].value=M,s.value=P(M),e.inputParamsMap[e.index][e.inputParam.name].image_preview_url=t(s),console.debug("inputParamsMap",e.inputParamsMap)})},null,8,["label"]),t(s)!==""?(d(),_(D,{key:0,src:t(i)?t(i):t(s),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:u[5]||(u[5]=()=>{n.value=!0})},null,8,["src"])):F("",!0),t(s)!==""?(d(),_(T,{key:1,icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:U})):F("",!0)])):F("",!0),e.inputParam.type==="image-mask"?(d(),j("div",oo,[t(f)?(d(),_(T,{key:0,icon:"i-heroicons-paint-brush-16-solid",class:"mr-2",color:"violet",variant:"outline",size:"xs",disabled:!((K=t(f))!=null&&K.value),onClick:u[6]||(u[6]=()=>{n.value=!0})},{default:y(()=>[w("span",lo,W(t(i)!==""?"Edit mask":"Draw mask"),1)]),_:1},8,["disabled"])):F("",!0),w("div",ao,[t(f)&&((J=t(f))!=null&&J.value)?(d(),_(D,{key:0,src:(se=t(f))==null?void 0:se.image_preview_url,class:Z(["h-10 rounded-lg cursor-pointer",{absolute:t(i)!==""}]),onClick:u[7]||(u[7]=()=>{n.value=!0})},null,8,["src","class"])):F("",!0),t(i)?(d(),_(D,{key:1,src:t(i),class:"h-10 rounded-lg cursor-pointer opacity-50",onClick:u[8]||(u[8]=()=>{n.value=!0})},null,8,["src"])):F("",!0)]),!t(f)||t(f)&&!((fe=t(f))!=null&&fe.value)?(d(),j("span",so," Select source image ")):F("",!0),t(i)?(d(),_(T,{key:2,icon:"i-heroicons-x-mark",variant:"outline",color:"violet",class:"ml-2",onClick:I})):F("",!0)])):F("",!0),e.inputParam.type==="image"||e.inputParam.type==="image-mask"?(d(),_(le,{key:4,modelValue:t(n),"onUpdate:modelValue":u[13]||(u[13]=p=>Q(n)?n.value=p:null),class:"z-[90] overflow-y-auto",transition:!1,fullscreen:""},{default:y(()=>{var p;return[g(T,{class:"absolute top-4 right-4 z-[100]",icon:"i-heroicons-x-mark",variant:"ghost",onClick:u[9]||(u[9]=()=>n.value=!1)}),e.inputParam.type==="image"?(d(),j("div",{key:0,class:"flex items-center justify-center w-full h-full p-4",onClick:u[10]||(u[10]=Ke(()=>n.value=!1,["left"]))},[g(D,{class:"lg:h-full",fit:"inside",src:t(s)},null,8,["src"])])):(d(),_(oe,{key:1,ref:"imageInpaint","image-inpaint-mask":t(i),"onUpdate:imageInpaintMask":u[11]||(u[11]=M=>Q(i)?i.value=M:null),"image-inpaint-mask-data":t(m),"onUpdate:imageInpaintMaskData":u[12]||(u[12]=M=>Q(m)?m.value=M:null),class:"flex items-center justify-center w-full h-full p-4","image-src":(p=t(f))==null?void 0:p.image_preview_url},null,8,["image-inpaint-mask","image-inpaint-mask-data","image-src"]))]}),_:1},8,["modelValue"])):F("",!0),e.inputParam.type==="list"?(d(),_(ae,{key:5,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":u[14]||(u[14]=p=>e.inputParamsMap[e.index][e.inputParam.name].value=p),placeholder:e.inputParam.display_name,options:Object.keys(e.inputParam.options)},null,8,["modelValue","placeholder","options"])):F("",!0),e.inputParam.type==="bool"?(d(),_(he,{key:6,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":u[15]||(u[15]=p=>e.inputParamsMap[e.index][e.inputParam.name].value=p),label:(A=e.inputParam)==null?void 0:A.display_name},null,8,["modelValue","label"])):F("",!0),["range","range_scale"].includes(e.inputParam.type)?(d(),_(X,{key:7,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":u[16]||(u[16]=p=>e.inputParamsMap[e.index][e.inputParam.name].value=p),label:e.inputParam.display_name,size:"sm",min:e.inputParam.min,max:e.inputParam.max,step:e.inputParam.step},null,8,["modelValue","label","min","max","step"])):F("",!0)]}),_:1},8,["class","help"])):F("",!0)}}}),ro={key:0,class:"heading"},uo={key:1},co={key:0,class:"max-h-96 overflow-y-auto mt-5"},mo={class:"heading"},fo={key:0,class:"p-4"},po={key:0,class:"flex items-center w-full max-w-xs"},go=ee({__name:"InputParams",props:Ae({inputParamsMap:{type:Array,required:!0},additionalInputParamsMap:{type:Array,required:!1,default:[]},advanced:{type:Boolean,default:!1}},{profilingOptions:{default:{},type:Object},profilingOptionsModifiers:{},profilingEnabled:{default:!1,type:Boolean},profilingEnabledModifiers:{}}),emits:["update:profilingOptions","update:profilingEnabled"],setup(e){const o=e,n=pe(),a=ut(),s=Xt(),l=$(!o.advanced),i=je(e,"profilingOptions"),m=je(e,"profilingEnabled"),f=$(!0),x=L(()=>s.workers.map(b=>({value:b.worker_id,label:`${b.worker_id} (type: ${b.device_type}, vram_total: ${Ve(b.vram_total)})`})));return Qe(()=>{var C;if(!a.isAdmin)return;const b=localStorage.getItem(`profilingOptions_${(C=n.currentFlow)==null?void 0:C.name}`);b&&(i.value=JSON.parse(b)),s.fetchWorkersInfo().then(()=>{s.workers.find(U=>{var I;return U.worker_id===((I=i.value["X-WORKER-ID"])==null?void 0:I.value)})||(i.value["X-WORKER-ID"]=null)})}),(b,C)=>{const P=xe,U=io,I=Ge,z=Ze,N=de,S=We,c=He;return d(),j(ue,null,[e.advanced?(d(),j("div",ro,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:C[0]||(C[0]=()=>{l.value=!t(l)})},[g(P,{name:t(l)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",class:"mr-2"},null,8,["name"]),C[3]||(C[3]=E(" Advanced options "))])])):F("",!0),t(l)?(d(),j("div",uo,[(d(!0),j(ue,null,ge(t(n).currentFlow.input_params,(h,v)=>(d(),_(U,{key:v,"input-params-map":e.inputParamsMap,index:v,"input-param":h,advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),(d(!0),j(ue,null,ge(e.additionalInputParamsMap,(h,v)=>(d(),_(U,{key:Object.keys(h)[0],"input-params-map":e.additionalInputParamsMap,index:v,"input-param":h[Object.keys(h)[0]],advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),t(a).isAdmin&&e.advanced?(d(),j("div",co,[w("div",mo,[w("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:C[1]||(C[1]=()=>{f.value=!t(f)})},[g(P,{name:t(f)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),g(P,{name:"i-mdi-bug-outline",class:"mr-2"}),C[4]||(C[4]=E(" Execution settings "))])]),t(f)?F("",!0):(d(),j("div",fo,[g(I,{modelValue:m.value,"onUpdate:modelValue":C[2]||(C[2]=h=>m.value=h),label:"Enable Execution settings",class:"mb-3"},null,8,["modelValue"]),(d(!0),j(ue,null,ge(Object.keys(i.value),h=>(d(),_(c,{key:h,label:h},{default:y(()=>[h==="X-WORKER-ID"?(d(),j("div",po,[g(z,{modelValue:i.value[h],"onUpdate:modelValue":v=>i.value[h]=v,options:t(x),placeholder:"Select worker",class:"w-full my-3"},null,8,["modelValue","onUpdate:modelValue","options"]),g(N,{icon:"i-heroicons-x-mark",variant:"outline",size:"sm",color:"orange",class:"ml-2",onClick:()=>i.value[h]=null},null,8,["onClick"]),g(N,{icon:"i-heroicons-arrow-path-solid",variant:"outline",size:"sm",color:"blue",class:"ml-2",onClick:()=>{t(s).fetchWorkersInfo().then(()=>{i.value[h]=t(x).find(v=>{var u;return v.value===((u=i.value[h])==null?void 0:u.value)})})}},null,8,["onClick"])])):(d(),_(S,{key:1,modelValue:i.value[h],"onUpdate:modelValue":v=>i.value[h]=v,placeholder:"Enter value",class:"my-3"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))]))])):F("",!0)])):F("",!0)],64)}}}),vo={key:0,id:"prompt",class:"w-full my-10 lg:my-0 p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg"},ho={class:"action flex items-center"},wo=ee({__name:"Prompt",setup(e,{expose:o}){var h,v,u,T;const n=pe(),a=ut();let s=localStorage.getItem(`input_params_map_${(h=n.currentFlow)==null?void 0:h.name}`);if(s){const r=JSON.parse(s);"flow_version"in r&&r.flow_version.split(".")[0]===((v=n.currentFlow)==null?void 0:v.version.split(".")[0])?s=r:(s=null,localStorage.removeItem(`input_params_map_${(u=n.currentFlow)==null?void 0:u.name}`))}const l=$(((T=n.currentFlow)==null?void 0:T.input_params.map(r=>{var k;if(r.type==="text")return{[r.name]:{value:s!==null&&s[r.name]?s[r.name]:r.default||"",type:r.type,optional:r.optional,advanced:r.advanced||!1,default:r.default||"",translatable:r.translatable||!1,dynamic_lora:r.dynamic_lora||!1,trigger_words:r.trigger_words||[]}};if(r.type==="number")return{[r.name]:{value:s!==null&&s[r.name]?s[r.name]:r.default||0,type:r.type,optional:r.optional,advanced:r.advanced||!1,default:r.default||0,dynamic_lora:r.dynamic_lora||!1,trigger_words:r.trigger_words||[]}};if(r.type==="image")return{[r.name]:{value:null,type:r.type,optional:r.optional,advanced:r.advanced||!1,dynamic_lora:r.dynamic_lora||!1,trigger_words:r.trigger_words||[]}};if(r.type==="image-mask")return{[r.name]:{value:null,type:r.type,optional:r.optional,advanced:r.advanced||!1,source_input_name:r.source_input_name||null,dynamic_lora:r.dynamic_lora||!1,trigger_words:r.trigger_words||[]}};if(r.type==="list")return{[r.name]:{value:s!==null&&s[r.name]?s[r.name]:r.default||Object.keys(r.options)[0]||"",type:r.type,optional:r.optional,options:r.options,advanced:r.advanced||!1,default:Object.keys(r.options)[0]||"",dynamic_lora:r.dynamic_lora||!1,trigger_words:r.trigger_words||[]}};if(r.type==="bool")return{[r.name]:{value:s!==null&&s[r.name]?s[r.name]:r.default||!1,type:r.type,optional:r.optional,advanced:r.advanced||!1,default:r.default||!1,dynamic_lora:r.dynamic_lora||!1,trigger_words:r.trigger_words||[]}};if(["range","range_scale"].includes(r.type)){const R={value:s!==null&&s[r.name]?s[r.name]:r.default||0,type:r.type,optional:r.optional,advanced:r.advanced||!1,min:r.min||0,max:r.max||100,step:r.step||1,default:r.default||0,dynamic_lora:r.dynamic_lora||!1,trigger_words:r.trigger_words||[]};if(r.type==="range_scale"&&(R.source_input_name=r.source_input_name||null,R.source_input_name===null||R.source_input_name==="")){const O=(k=n.currentFlow)==null?void 0:k.input_params.find(D=>D.type==="image"&&!D.optional);O&&(R.source_input_name=O.name)}return{[r.name]:R}}}))||[]),i=$([]);n.currentFlow.is_seed_supported&&i.value.push({seed:{name:"seed",display_name:"Random seed",value:Math.floor(Math.random()*1e7),type:"number",optional:!0,advanced:!0,min:0,max:1e7}});const m=kt(),f=$(n.currentFlow.is_translations_supported&&m.settingsMap.translations_provider.value.trim()!==""),x=$(f.value);Qe(()=>{const r=localStorage.getItem("translatePrompt");r&&(x.value=JSON.parse(r))}),ye(x,r=>{localStorage.setItem("translatePrompt",JSON.stringify(r))});function b(r){console.debug("Copy prompt inputs",r),Object.keys(r).forEach(R=>{const O=l.value.findIndex(D=>Object.keys(D)[0]===R);O!==-1&&(l.value[O][R].value=r[R].value)});const k=document.getElementById("prompt");k&&k.scrollIntoView({behavior:"smooth"})}o({copyPromptInputs:b}),l.value.forEach(r=>{const k=Object.keys(r)[0];["image","image-mask"].includes(r[k].type)||ye(()=>r[k].value,()=>{var O,D;const R={};l.value.forEach(oe=>{const le=Object.keys(oe)[0];R[le]=oe[le].value}),localStorage.setItem(`input_params_map_${(O=n.currentFlow)==null?void 0:O.name}`,JSON.stringify({...R,flow_version:(D=n.currentFlow)==null?void 0:D.version}))})});const C=L(()=>l.value.filter(r=>{const k=Object.keys(r)[0];return!["image","image-mask"].includes(r[k].type)}).some(r=>{const k=Object.keys(r)[0];return r[k].value!==r[k].default}));function P(){l.value.forEach(r=>{const k=Object.keys(r)[0];r[k].type==="text"?r[k].value=r[k].default||"":r[k].type==="number"?r[k].value=r[k].default||r[k].min||0:r[k].type==="list"?r[k].value=Object.keys(r[k].options)[0]||"":r[k].type==="bool"?r[k].value=r[k].default||!1:["range","range_scale"].includes(r[k].type)&&(r[k].value=r[k].default||r[k].min||0)})}const U=$(!1),I=$(1),z=$(!1),N=L(()=>l.value.every(r=>{var O;const k=Object.keys(r)[0];if(r[k].optional)return!0;const R=r[k].value;if(r[k].type==="text")return R!=="";if(r[k].type==="number")return R>=r[k].min&&R<=r[k].max;if(r[k].type==="list")return R!==""&&Object.keys(r[k].options).includes(R);if(r[k].type==="bool")return!0;if(r[k].type==="range")return R>=r[k].min&&R<=r[k].max;if(r[k].type==="range_scale")return R>=r[k].min&&R<=r[k].max;if(r[k].type==="image")return R instanceof File&&R.size>0;if(r[k].type==="image-mask")return R instanceof File&&R.size>0&&(((O=r[k])==null?void 0:O.mask_applied)||!1)})),S=$({"X-WORKER-UNLOAD-MODELS":1,"X-WORKER-EXECUTION-PROFILER":1,"X-WORKER-ID":null}),c=$(!1);return ye(()=>S.value,()=>{var r;a.isAdmin&&localStorage.setItem(`profilingOptions_${(r=n.currentFlow)==null?void 0:r.name}`,JSON.stringify(S.value))},{deep:!0}),(r,k)=>{const R=xe,O=go,D=We,oe=He,le=Ge,ae=de,he=De;return t(n).currentFlow?(d(),j("div",vo,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:k[0]||(k[0]=()=>{z.value=!t(z)})},[g(R,{name:t(z)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),k[10]||(k[10]=E(" Prompt "))]),rt(w("div",null,[g(O,{"input-params-map":t(l),"onUpdate:inputParamsMap":k[1]||(k[1]=X=>Q(l)?l.value=X:null),"additional-input-params-map":t(i),"onUpdate:additionalInputParamsMap":k[2]||(k[2]=X=>Q(i)?i.value=X:null),advanced:!1},null,8,["input-params-map","additional-input-params-map"]),t(i).length>0?(d(),_(O,{key:0,"input-params-map":t(l),"onUpdate:inputParamsMap":k[3]||(k[3]=X=>Q(l)?l.value=X:null),"additional-input-params-map":t(i),"onUpdate:additionalInputParamsMap":k[4]||(k[4]=X=>Q(i)?i.value=X:null),"profiling-options":t(S),"onUpdate:profilingOptions":k[5]||(k[5]=X=>Q(S)?S.value=X:null),"profiling-enabled":t(c),"onUpdate:profilingEnabled":k[6]||(k[6]=X=>Q(c)?c.value=X:null),advanced:!0},null,8,["input-params-map","additional-input-params-map","profiling-options","profiling-enabled"])):F("",!0),t(n).currentFlow.is_count_supported?(d(),_(oe,{key:1,label:"Number of results"},{default:y(()=>[g(D,{modelValue:t(I),"onUpdate:modelValue":k[7]||(k[7]=X=>Q(I)?I.value=X:null),type:"number",min:"1",max:"50",label:"Batch size",class:"mb-3 max-w-fit flex justify-end"},null,8,["modelValue"])]),_:1})):F("",!0),t(f)?(d(),_(oe,{key:2,class:"my-3 flex justify-end"},{default:y(()=>[g(le,{modelValue:t(x),"onUpdate:modelValue":k[8]||(k[8]=X=>Q(x)?x.value=X:null),label:"Translate prompt"},null,8,["modelValue"])]),_:1})):F("",!0),w("div",{class:Z(["flex",{"justify-between":t(C),"justify-end":!t(C)}])},[t(C)?(d(),_(he,{key:0,text:"Reset input params values to defaults"},{default:y(()=>[g(ae,{icon:"i-heroicons-arrow-path-rounded-square",variant:"ghost",color:"amber",onClick:P},{default:y(()=>k[11]||(k[11]=[E(" Reset params ")])),_:1})]),_:1})):F("",!0),w("div",ho,[g(ae,{icon:"i-heroicons-sparkles-16-solid",variant:"outline",loading:t(U),disabled:!t(N),onClick:k[9]||(k[9]=()=>{U.value=!0;let X={};t(a).isAdmin&&t(c)&&(X=Object.fromEntries(Object.entries(t(S)).filter(([ne,ce])=>ce!==null).map(([ne,ce])=>ne==="X-WORKER-ID"?[ne,ce==null?void 0:ce.value]:[ne,ce]))),t(n).runFlow(t(n).currentFlow,[...t(l),...t(i)],t(I),t(f)&&t(x),!1,null,X).finally(()=>{U.value=!1;const ne=t(i).find(ce=>Object.keys(ce)[0]==="seed");ne.seed.value=Number(ne.seed.value)+t(I)+1})})},{default:y(()=>k[12]||(k[12]=[E(" Run prompt ")])),_:1},8,["loading","disabled"])])],2)],512),[[xt,!t(z)]])])):F("",!0)}}}),yo=e=>{const o=$(0);function n(l){e.value.style.scrollSnapType="none",e.value.style.scrollBehavior="auto",o.value=l.pageX,window.addEventListener("mousemove",s),window.addEventListener("mouseup",a)}function a(){e.value.style.removeProperty("scroll-behavior"),e.value.style.removeProperty("scroll-snap-type"),e.value.style.removeProperty("pointer-events"),window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",a)}function s(l){l.preventDefault(),e.value.style.pointerEvents="none";const i=l.pageX-o.value;o.value=l.pageX,e.value.scrollBy(-i,0)}Se(()=>{e.value&&e.value.addEventListener("mousedown",n)}),dt(()=>{e.value&&e.value.removeEventListener("mousedown",n)})},tt=lt(Ce.ui.strategy,Ce.ui.carousel,rn),bo=ee({components:{UButton:de},inheritAttrs:!1,props:{items:{type:Array,default:()=>[]},arrows:{type:Boolean,default:!1},indicators:{type:Boolean,default:!1},dir:{type:String,default:"ltr"},prevButton:{type:Object,default:()=>tt.default.prevButton},nextButton:{type:Object,default:()=>tt.default.nextButton},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:void 0}},setup(e,{expose:o}){const{ui:n,attrs:a}=st("carousel",Ne(e,"ui"),tt,Ne(e,"class")),s=$(),l=$(0),{x:i}=Jt(s,{behavior:"smooth"}),{width:m}=Qt(s);yo(s),Kt(s,N=>{var c,h;const[S]=N;l.value=((h=(c=S==null?void 0:S.target)==null?void 0:c.firstElementChild)==null?void 0:h.clientWidth)||0});const f=L(()=>e.dir==="rtl"),x=L(()=>l.value?f.value?Math.round(-i.value/l.value)+1:Math.round(i.value/l.value)+1:0),b=L(()=>{if(!l.value)return 0;const N=Math.round(m.value/l.value);return e.items.length<=N?0:e.items.length-N+1}),C=L(()=>x.value<=1),P=L(()=>x.value===b.value);function U(){i.value+=f.value?-l.value:l.value}function I(){i.value-=f.value?-l.value:l.value}function z(N){i.value=(N-1)*l.value*(f.value?-1:1)}return o({pages:b,page:x,prev:I,next:U,select:z}),{ui:n,attrs:a,isFirst:C,isLast:P,carouselRef:s,pages:b,currentPage:x,onClickNext:U,onClickPrev:I,onClick:z,twMerge:Je}}}),ko=["dir"],xo=["role"],_o=["aria-selected","aria-label","onClick"];function $o(e,o,n,a,s,l){const i=de;return d(),j("div",Re({class:e.ui.wrapper},e.attrs,{dir:e.dir}),[w("div",{ref:"carouselRef",class:Z([e.ui.container,"no-scrollbar"])},[(d(!0),j(ue,null,ge(e.items,(m,f)=>(d(),j("div",{key:f,class:Z(e.ui.item),role:e.indicators?"tabpanel":null},[Oe(e.$slots,"default",{item:m,index:f},void 0,!0)],10,xo))),128))],2),e.arrows?(d(),j("div",{key:0,class:Z(e.ui.arrows.wrapper)},[Oe(e.$slots,"prev",{onClick:e.onClickPrev,disabled:e.isFirst},()=>{var m;return[e.prevButton?(d(),_(i,Re({key:0,disabled:e.isFirst},{...e.ui.default.prevButton,...e.prevButton},{class:e.twMerge(e.ui.default.prevButton.class,(m=e.prevButton)==null?void 0:m.class),"aria-label":"Prev",onClick:e.onClickPrev}),null,16,["disabled","class","onClick"])):F("",!0)]},!0),Oe(e.$slots,"next",{onClick:e.onClickNext,disabled:e.isLast},()=>{var m;return[e.nextButton?(d(),_(i,Re({key:0,disabled:e.isLast},{...e.ui.default.nextButton,...e.nextButton},{class:e.twMerge(e.ui.default.nextButton.class,(m=e.nextButton)==null?void 0:m.class),"aria-label":"Next",onClick:e.onClickNext}),null,16,["disabled","class","onClick"])):F("",!0)]},!0)],2)):F("",!0),e.indicators?(d(),j("div",{key:1,role:"tablist",class:Z(e.ui.indicators.wrapper)},[(d(!0),j(ue,null,ge(e.pages,m=>Oe(e.$slots,"indicator",{key:m,onClick:e.onClick,active:m===e.currentPage,page:m},()=>[w("button",{type:"button",role:"tab","aria-selected":m===e.currentPage,class:Z([e.ui.indicators.base,m===e.currentPage?e.ui.indicators.active:e.ui.indicators.inactive]),"aria-label":`set slide ${m}`,onClick:f=>e.onClick(m)},null,10,_o)],!0)),128))],2)):F("",!0)],16,ko)}const Fe=at(bo,[["render",$o],["__scopeId","data-v-a3da86ff"]]),Co={class:"flex flex-col basis-full"},So=ee({__name:"InputFiles",props:{running:{type:Object,required:!0}},setup(e){const o=mt(),n=function(m,f){return`${_t()}/tasks/inputs?task_id=${m}&input_index=${f}`},a=$(!1),s=$(""),l=$(0),i=$(!0);return(m,f)=>{var I,z,N,S,c;const x=xe,b=_e,C=Fe,P=de,U=Ie;return e.running&&e.running.input_files&&((I=Object.keys(e.running.input_files))==null?void 0:I.length)>0?(d(),j("div",{key:0,class:Z(["ml-2 mt-2 mb-5",{"mb-10":((z=Object.keys(e.running.input_files))==null?void 0:z.length)>1&&!t(i)}])},[w("h4",{class:"mb-3 font-bold cursor-pointer select-none flex items-center text-sm",onClick:f[0]||(f[0]=()=>i.value=!t(i))},[g(x,{name:t(i)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Input files ("+W((N=Object.keys(e.running.input_files))==null?void 0:N.length)+") ",1)]),t(i)?F("",!0):(d(),j(ue,{key:0},[((S=Object.keys(e.running.input_files))==null?void 0:S.length)===1?(d(),_(b,{key:0,class:"mb-5 rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(o)(`${("buildBackendUrl"in m?m.buildBackendUrl:t(ot))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:n(e.running.task_id,0),onClick:f[1]||(f[1]=()=>{s.value=n(e.running.task_id,0),l.value=0,a.value=!0})},null,8,["placeholder","src"])):F("",!0),((c=Object.keys(e.running.input_files))==null?void 0:c.length)>1?(d(),_(C,{key:1,items:Object.keys(e.running.input_files).map(h=>({task_id:e.running.task_id,index:h})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:""},{default:y(({item:h})=>[w("div",Co,[g(b,{class:"rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(o)(`${("buildBackendUrl"in m?m.buildBackendUrl:t(ot))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:n(h.task_id,h.index),onClick:()=>{s.value=n(e.running.task_id,h.index),l.value=h.index,a.value=!0}},null,8,["placeholder","src","onClick"])])]),_:1},8,["items"])):F("",!0),g(U,{modelValue:t(a),"onUpdate:modelValue":f[4]||(f[4]=h=>Q(a)?a.value=h:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[g(P,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:f[2]||(f[2]=()=>a.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:f[3]||(f[3]=Ke(()=>a.value=!1,["left"]))},[t(s)?(d(),_(b,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(s)},null,8,["src"])):F("",!0)])]),_:1},8,["modelValue"])],64))],2)):F("",!0)}}}),Io=ee({__name:"ErrorAlert",props:{running:{type:Object,required:!0}},setup(e){const o=pe(),n=$(!1);return(a,s)=>{const l=ct;return d(),_(l,{class:"mb-5",icon:"i-heroicons-exclamation-circle-16-solid",color:"red",variant:"soft",title:"Task failed",description:e.running.error,actions:[{variant:"outline",color:"yellow",label:"Restart",loading:t(n),icon:"i-heroicons-arrow-path",click:()=>{n.value=!0,t(o).restartFlow(e.running).finally(()=>{n.value=!1})}}]},null,8,["description","actions"])}}}),Ro={class:"mb-5"},Mo={class:"text-sm mb-5 text-slate-500"},Fo={class:"flex justify-between"},Po=ee({__name:"Item",props:{running:{type:Object,required:!0}},setup(e){const o=pe(),n=$(!1),a=$(!1);function s(l){return[[{label:"Comfy flow",labelClass:"text-blue-500",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500",click:()=>{var i;return o.downloadFlowComfy((i=o.currentFlow)==null?void 0:i.name,l.task_id)}}],[{label:`Raise priority ${l.priority>0?`(${l.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-up",iconClass:"bg-gray-500",disabled:l.priority===15||l.progress>0,click:()=>{a.value=!0,o.raiseQueuePriority(l).finally(()=>{a.value=!1})}},{label:`Lower priority ${l.priority>0?`(${l.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-down",iconClass:"bg-gray-500",disabled:l.priority===0||l.progress>0,click:()=>{a.value=!0,o.lowerQueuePriority(l).finally(()=>{a.value=!1})}},{label:`Reset priority ${l.priority>0?`(${l.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-path-rounded-square-solid",iconClass:"bg-gray-500",disabled:l.priority===0||l.progress>0,click:()=>{a.value=!0,o.resetQueuePriority(l).finally(()=>{a.value=!1})}}]]}return(l,i)=>{var P,U;const m=Mt,f=So,x=Io,b=de,C=Ye;return d(),j("div",Ro,[g(m,{class:"mb-3",value:(P=e.running)==null?void 0:P.progress,indicator:"",color:e.running.error?"red":"green"},null,8,["value","color"]),w("p",Mo,W([`${(U=e.running)!=null&&U.priority&&e.running.priority>0?"["+e.running.priority+"] ":""}#${e.running.task_id}`,...Object.keys(e.running.input_params_mapped).filter(I=>e.running.input_params_mapped[I].value&&e.running.input_params_mapped[I].value!=="").map(I=>`${e.running.input_params_mapped[I].display_name}: ${e.running.input_params_mapped[I].value}`)].join(" | ")+`${e.running.execution_time?" | execution_time: "+e.running.execution_time.toFixed(2)+"s":""}`),1),g(f,{running:e.running},null,8,["running"]),e.running.error?(d(),_(x,{key:0,running:e.running},null,8,["running"])):F("",!0),w("div",Fo,[g(b,{icon:e.running.progress>=0&&e.running.progress<100?"i-heroicons-stop":"i-heroicons-minus-circle",color:e.running.error?"red":"orange",variant:"outline",loading:t(n),onClick:i[0]||(i[0]=()=>{n.value=!0,t(o).cancelRunningFlow(e.running).finally(()=>{n.value=!1})})},{default:y(()=>[E(W(e.running.progress>=0&&e.running.progress<100?"Cancel":"Remove"),1)]),_:1},8,["icon","color","loading"]),g(C,{items:s(e.running),mode:"click",popper:{placement:"bottom-end"}},{default:y(()=>[g(b,{color:"blue",variant:"outline",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])])])}}}),Uo={class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md mt-5 mb-10"},zo={class:"flex items-center justify-between mb-2"},Vo={key:0},Oo={key:1,class:"text-red-400"},jo=ee({__name:"Queue",setup(e){const o=pe(),n=$(!0),a=$(!1);return(s,l)=>{var x,b,C,P,U,I,z,N,S;const i=xe,m=de,f=Po;return d(),j("div",Uo,[w("div",zo,[w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center",onClick:l[0]||(l[0]=()=>{n.value=!t(n)})},[g(i,{name:t(n)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),w("span",null," Queue ("+W(t(o).flowsRunningByName((x=t(o).currentFlow)==null?void 0:x.name).length)+") ",1),t(o).flowsRunningByName((b=t(o).currentFlow)==null?void 0:b.name).length>0?(d(),j("span",Vo," - "+W(`${((P=t(o).flowsRunningByName((C=t(o).currentFlow)==null?void 0:C.name).filter(c=>c.progress>0)[0])==null?void 0:P.progress.toFixed(0))??0}%`),1)):F("",!0),t(o).flowsRunningByNameWithErrors((U=t(o))==null?void 0:U.currentFlow.name).length>0?(d(),j("span",Oo," ("+W(t(o).flowsRunningByNameWithErrors((I=t(o).currentFlow)==null?void 0:I.name).length)+") ",1)):F("",!0)]),(z=t(o).currentFlow)!=null&&z.name&&t(o).flowsRunningByName((N=t(o).currentFlow)==null?void 0:N.name).length>0?(d(),_(m,{key:0,icon:"i-heroicons-stop",color:"orange",variant:"outline",loading:t(a),onClick:l[1]||(l[1]=()=>{var c;a.value=!0,t(o).cancelRunningFlows((c=t(o).currentFlow)==null?void 0:c.name).finally(()=>{a.value=!1})})},{default:y(()=>l[2]||(l[2]=[E(" Cancel all ")])),_:1},8,["loading"])):F("",!0)]),t(n)?F("",!0):(d(!0),j(ue,{key:0},ge(t(o).flowsRunningByName((S=t(o).currentFlow)==null?void 0:S.name),c=>(d(),_(f,{key:c.task_id,running:c},null,8,["running"]))),128))])}}}),To=ee({__name:"ScrollToTop",props:{show:{type:Boolean,required:!0},target:{type:String,required:!0}},setup(e){const o=e;function n(){const a=document.getElementById(o.target);a&&a.scrollIntoView({behavior:"smooth"})}return(a,s)=>{const l=de;return e.show?(d(),_(l,{key:0,icon:"i-heroicons-arrow-small-up",color:"black",variant:"outline",onClick:n})):F("",!0)}}}),Bo={class:"flex flex-col items-center mb-2 max-w-fit mx-auto z-0"},No={class:"text-slate-500 text-center text-sm w-full mx-auto flex flex-wrap items-center justify-center md:justify-between"},Lo={class:"toggles py-2"},Ao={class:"mr-2 inline-flex items-center text-sm"},qo=["for"],Eo={class:"mr-2 inline-flex items-center text-sm"},Do=["for"],Wo={key:0,class:"flex items-center"},Ho=["title"],Go=ee({__name:"Child",props:{flowResult:{type:Object,required:!0},outputsIndex:{type:Number,required:!1,default:()=>0},openImageModal:{type:Function,required:!0}},setup(e){const o=e,n=pe(),a=(c,h=null,v=!1)=>{if(c.child_tasks.length===0)return c;const u=c.child_tasks.findIndex(T=>T.parent_task_node_id===h);return u!==-1?(v||(l.value=c),a(c.child_tasks[u],c.child_tasks[u].outputs[0].comfy_node_id,v)):c};function s(c,h,v=null){if(v!==null&&c.parent_task_node_id===v||Number(c.task_id)===h)return c;for(let u=0;u<c.child_tasks.length;u++)for(let T=0;T<c.child_tasks[u].outputs.length;T++){const r=s(c.child_tasks[u],h,c.child_tasks[u].outputs[T].comfy_node_id);if(r!==null)return r}return null}const l=$(o.flowResult),i=$(a(o.flowResult,o.flowResult.outputs[o.outputsIndex].comfy_node_id,!1));function m(c){var h;return[[{label:`${(h=n.flowByName((c==null?void 0:c.flow_name)??(c==null?void 0:c.name)))==null?void 0:h.display_name}#${c.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",click:()=>{o.openImageModal(me({task_id:c.task_id,node_id:c.outputs.length>1?c.outputs[o.outputsIndex].comfy_node_id:c.outputs[0].comfy_node_id}))}}]]}function f(c){var v;const h=[[{label:`${(v=n.flowByName((c==null?void 0:c.flow_name)??(c==null?void 0:c.name)))==null?void 0:v.display_name}#${c.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",disabled:c.progress<100||c.error!=="",click:()=>{o.openImageModal(me({task_id:c.task_id,node_id:c.outputs.length>1?c.outputs[o.outputsIndex].comfy_node_id:c.outputs[0].comfy_node_id}))}},{label:c.progress<100?"Cancel":"Delete",labelClass:c.progress<100?"text-orange-500":"text-red-500",icon:c.progress<100?"i-heroicons-stop":"i-heroicons-trash",iconClass:c.progress<100?"bg-orange-500":"bg-red-500",click:()=>{n.deleteFlowHistory(c.task_id).then(()=>{const u=s(o.flowResult,c.parent_task_id,c.parent_task_node_id);u&&(u.child_tasks=u.child_tasks.filter(T=>Number(T.task_id)!==Number(c.task_id))),I(!1,o.flowResult)})}}]];return c.progress<100&&(h[0][1]={label:`Progress: ${Math.ceil(c.progress)}% (${c.execution_time.toFixed(2)}s)`,labelClass:"text-blue-500",disabled:!0}),c.error!==""&&h[0].push({label:`Error: ${c.error}`,labelClass:"text-red-500",slot:"error",click:()=>{qe().copy(c.error),Me().add({title:"Clipboard",description:`Task #${c.task_id} error copied to clipboard`,timeout:2e3})}}),h}function x(){const c=l.value.parent_task_id;if(!c)return;const h=s(o.flowResult,c,l.value.parent_task_node_id);h&&(l.value=h)}function b(){if(l.value.child_tasks.length===0)return;const c=l.value.outputs.length>1?l.value.outputs[o.outputsIndex].comfy_node_id:l.value.outputs[0].comfy_node_id,h=l.value.child_tasks.find(v=>v.parent_task_node_id===c);h&&(l.value=h)}const C=L(()=>{if(l.value.child_tasks.length===0)return;const c=l.value.outputs.length>1?l.value.outputs[o.outputsIndex].comfy_node_id:l.value.outputs[0].comfy_node_id;return l.value.child_tasks.find(v=>v.parent_task_node_id===c).task_id!==i.value.task_id});function P(){const c=i.value.parent_task_id;if(!c)return;const h=s(o.flowResult,c,i.value.parent_task_node_id);h&&(i.value=h)}function U(){if(i.value.child_tasks.length===0)return;const c=Number(i.value.outputs[0].comfy_node_id),h=i.value.child_tasks.find(v=>Number(v.parent_task_node_id)===c);h&&(i.value=h)}function I(c=!1,h=null){c||(l.value=h),i.value=a(h,h==null?void 0:h.outputs[o.outputsIndex].comfy_node_id,c),z.value=!1}ye(o.flowResult,c=>{I(!0,c)});const z=$(!1),N=$(!0),S=$(null);return ye(z,c=>{c?(S.value=l.value,l.value=o.flowResult):S.value&&(l.value=S.value,i.value=$t(S.value,o.outputsIndex,l.value.outputs.length>1?l.value.outputs[o.outputsIndex].comfy_node_id:l.value.outputs[0].comfy_node_id))}),(c,h)=>{const v=_e,u=Be("ImgComparisonSlider"),T=ln,r=de,k=Ye,R=xe,O=De;return d(),j("div",Bo,[rt(g(v,{class:"mb-2 rounded-lg cursor-pointer",height:t(n).outputMaxSize,width:t(n).outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(i).progress===100?t(i).task_id:e.flowResult.task_id,node_id:t(i).progress===100?t(i).outputs[0].comfy_node_id:e.flowResult.outputs[e.outputsIndex].comfy_node_id}),onClick:h[0]||(h[0]=D=>e.openImageModal(("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(i).task_id??e.flowResult.task_id,node_id:t(i).outputs[0].comfy_node_id??e.flowResult.outputs[e.outputsIndex].comfy_node_id})))},null,8,["height","width","src"]),[[xt,!t(N)]]),t(N)?(d(),_(u,{key:0,class:"mb-2 mx-auto outline-none w-fit rounded-lg"},{default:y(()=>{var D,oe,le;return[g(v,{slot:"first",height:t(n).outputMaxSize,width:t(n).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(z)?e.flowResult.task_id:t(l).task_id,node_id:t(z)?e.flowResult.outputs[e.outputsIndex].comfy_node_id:t(l).parent_task_node_id!==null?(D=t(l))==null?void 0:D.outputs[0].comfy_node_id:((oe=t(l))==null?void 0:oe.outputs[e.outputsIndex].comfy_node_id)??((le=t(l))==null?void 0:le.outputs[0].comfy_node_id)})},null,8,["height","width","src"]),t(i)&&t(i).progress===100?(d(),_(v,{key:0,slot:"second",height:t(n).outputMaxSize,width:t(n).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in c?c.outputResultSrc:t(me))({task_id:t(i).task_id,node_id:t(i).outputs[0].comfy_node_id})},null,8,["height","width","src"])):(d(),_(v,{key:1,slot:"second",height:t(n).outputMaxSize,width:t(n).outputMaxSize,fit:"cover",draggable:"false",src:`${("buildBackendUrl"in c?c.buildBackendUrl:t(ot))()}/vix_logo.png`},null,8,["height","width","src"]))]}),_:1})):F("",!0),w("div",No,[w("div",Lo,[w("div",Ao,[g(T,{id:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(N),"onUpdate:modelValue":h[1]||(h[1]=D=>Q(N)?N.value=D:null),size:"xs",class:"mr-2"},null,8,["id","modelValue"]),w("label",{class:"cursor-pointer select-none",for:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`}," Comparison ",8,qo)]),w("div",Eo,[g(T,{id:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(z),"onUpdate:modelValue":h[2]||(h[2]=D=>Q(z)?z.value=D:null),disabled:!t(N),size:"xs",class:"mr-2"},null,8,["id","modelValue","disabled"]),w("label",{class:"cursor-pointer select-none",for:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`}," Original ",8,Do)])]),t(N)?(d(),j("div",Wo,[g(r,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(z)||t(l).parent_task_id===null,onClick:x},null,8,["disabled"]),g(k,{items:m(t(l)),mode:"click",popper:{placement:"top"}},{default:y(()=>[g(r,{variant:"link",color:"white",size:"xs"},{default:y(()=>[E(" #"+W(t(z)?e.flowResult.task_id:t(l).task_id),1)]),_:1})]),_:1},8,["items"]),g(r,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(z)||!t(C),onClick:b},null,8,["disabled"]),g(R,{class:"mx-3",name:"i-heroicons-arrows-right-left-16-solid"}),g(r,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:!s(o.flowResult,t(i).parent_task_id,t(i).parent_task_node_id)||t(i).parent_task_id===Number(t(l).task_id)||t(i).parent_task_id===null,onClick:P},null,8,["disabled"]),g(k,{items:f(t(i)),mode:"click",popper:{placement:"top"}},{error:y(({item:D})=>[w("div",{class:"text-red-500 truncate",title:D.label},W(D.label),9,Ho)]),default:y(()=>[g(r,{class:Z({"text-blue-500":t(i).progress!==100&&t(i).error==="","text-red-500":t(i).error!==""}),variant:"link",color:"white",size:"xs"},{default:y(()=>[E(W(t(i).progress===100?"#"+t(i).task_id:Math.ceil(t(i).progress)+"%"),1)]),_:1},8,["class"])]),_:1},8,["items"]),g(r,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(i).child_tasks.length===0,onClick:U},null,8,["disabled"]),g(O,{class:"ml-3",text:"Reset comparison",popper:{placement:"top"}},{default:y(()=>[g(r,{icon:"i-heroicons-arrow-path-rounded-square-solid",size:"2xs",variant:"outline",color:"white",onClick:h[3]||(h[3]=()=>I(!1,e.flowResult))})]),_:1})])):F("",!0)])])}}}),Xo={class:"image-output"},Jo={class:"flex flex-col basis-full justify-between mx-2"},Qo=ee({__name:"Image",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const o=pe();return(n,a)=>{var f,x;const s=Go,l=_e,i=de,m=Fe;return d(),j("div",Xo,[e.flowResult.outputs.length===1?(d(),j(ue,{key:0},[(f=e.flowResult)!=null&&f.child_tasks&&((x=e.flowResult)==null?void 0:x.child_tasks.length)>0?(d(),_(s,{key:0,"flow-result":e.flowResult,"open-image-modal":e.openImageModal},null,8,["flow-result","open-image-modal"])):e.flowResult.outputs.length===1?(d(),_(l,{key:1,class:"mb-2 mx-auto rounded-lg cursor-pointer",height:t(o).$state.outputMaxSize,width:t(o).$state.outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in n?n.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id}),onClick:a[0]||(a[0]=b=>e.openImageModal(("outputResultSrc"in n?n.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})))},null,8,["height","width","src"])):F("",!0)],64)):e.flowResult.outputs.length>1?(d(),_(m,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((b,C)=>({task_id:e.flowResult.task_id,node_id:b.comfy_node_id,index:C})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(({item:b})=>{var C;return[w("div",Jo,[(C=e.flowResult)!=null&&C.child_tasks&&("hasChildTaskByParentTaskNodeId"in n?n.hasChildTaskByParentTaskNodeId:t(Ct))(e.flowResult,b.index,b.node_id)?(d(),_(s,{key:0,"flow-result":e.flowResult,"outputs-index":b.index,"open-image-modal":e.openImageModal},null,8,["flow-result","outputs-index","open-image-modal"])):(d(),_(l,{key:1,class:Z(`mb-2 h-100 max-h-[${t(o).$state.outputMaxSize}px] mx-auto rounded-lg cursor-pointer`),draggable:"false",height:t(o).$state.outputMaxSize,width:t(o).$state.outputMaxSize,fit:"cover",loading:"lazy",src:("outputResultSrc"in n?n.outputResultSrc:t(me))(b),onClick:P=>e.openImageModal(("outputResultSrc"in n?n.outputResultSrc:t(me))(b))},null,8,["class","height","width","src","onClick"])),g(i,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,b.index)}},{default:y(()=>a[1]||(a[1]=[E(" Send to flow ")])),_:2},1032,["onClick"])])]}),_:1},8,["items"])):F("",!0)])}}}),Ko={class:"video-output"},Yo=["width","height"],Zo=["src"],el={class:"flex flex-col basis-full justify-between mx-2"},tl=["width","height"],nl=["src"],ol=ee({__name:"Video",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const o=pe();return(n,a)=>{const s=de,l=Fe;return d(),j("div",Ko,[e.flowResult.outputs.length===1?(d(),j("video",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",style:{"max-height":"80vh"},width:t(o).$state.outputMaxSize,height:t(o).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in n?n.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,Zo)],8,Yo)):e.flowResult.outputs.length>1?(d(),_(l,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((i,m)=>({task_id:e.flowResult.task_id,node_id:i.comfy_node_id,index:m})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(({item:i})=>[w("div",el,[w("video",{controls:"",class:"mb-2 mx-auto rounded-lg",width:t(o).$state.outputMaxSize,height:t(o).$state.outputMaxSize},[w("source",{src:("outputResultSrc"in n?n.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,nl)],8,tl),g(s,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,i.index)}},{default:y(()=>a[0]||(a[0]=[E(" Send to flow ")])),_:2},1032,["onClick"])])]),_:1},8,["items"])):F("",!0)])}}}),ll={class:"audio-output"},al=["src"],sl={class:"flex flex-col basis-full justify-between mx-2"},il=["src"],rl=ee({__name:"Audio",props:{flowResult:{type:Object,required:!0}},setup(e){return(o,n)=>{const a=Fe;return d(),j("div",ll,[e.flowResult.outputs.length===1?(d(),j("audio",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in o?o.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,al)):e.flowResult.outputs.length>1?(d(),_(a,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((s,l)=>({task_id:e.flowResult.task_id,node_id:s.comfy_node_id,index:l})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(()=>[w("div",sl,[w("audio",{controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in o?o.outputResultSrc:t(me))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,il)])]),_:1},8,["items"])):F("",!0)])}}}),ul={class:"text-output"},dl={key:0,class:"mb-2 mx-auto rounded-lg text-md p-4 pr-8 border border-slate-500 relative"},cl=ee({__name:"Text",props:{flowResult:{type:Object,required:!0}},setup(e){const o=e,n=pe(),a=Me(),s=$(!1),l=$({});function i(m,f){const{$apiFetch:x}=Le(),b=me({task_id:m.task_id,node_id:f.comfy_node_id});return x(b).then(C=>{l.value[f.comfy_node_id]=C}).catch(C=>{console.error(C)}).finally(()=>{s.value=!1})}return Se(()=>{Promise.all(o.flowResult.outputs.filter(m=>m.type==="text").map(m=>i(o.flowResult,m)))}),(m,f)=>{const x=de,b=Fe;return d(),j("div",ul,[e.flowResult.outputs.length===1?(d(),j("div",dl,[t(s)?F("",!0):(d(),_(x,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:f[0]||(f[0]=()=>{("useCopyToClipboard"in m?m.useCopyToClipboard:t(qe))().copy(t(l)[e.flowResult.outputs[0].comfy_node_id]),t(a).add({title:"Clipboard",description:"Text copied to clipboard"})})})),w("p",null,W(t(s)?"Loading...":t(l)[e.flowResult.outputs[0].comfy_node_id]),1)])):e.flowResult.outputs.length>1?(d(),_(b,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((C,P)=>({task_id:e.flowResult.task_id,node_id:C.comfy_node_id,index:P})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:"",arrows:""},{default:y(({item:C})=>[w("div",{class:"mb-2 mx-2 rounded-lg text-md p-4 border border-slate-500 shadow-sm overflow-y-auto relative",style:wt({"max-height":Math.ceil(t(n).$state.outputMaxSize/2)+"px"})},[t(s)?F("",!0):(d(),_(x,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:()=>{("useCopyToClipboard"in m?m.useCopyToClipboard:t(qe))().copy(t(l)[C.node_id]),t(a).add({title:"Clipboard",description:"Text copied to clipboard"})}},null,8,["onClick"])),w("p",null,W(t(s)?"Loading...":t(l)[C.node_id]),1)],4)]),_:1},8,["items"])):F("",!0)])}}}),ml={class:"w-full h-full p-4"},fl={class:"mt-4 max-h-96 overflow-y-auto text-sm whitespace-pre-wrap"},pl=ee({__name:"Params",props:{flowResult:{type:Object,required:!0}},setup(e){const o=e,n=$(!1),a=L(()=>["#"+o.flowResult.task_id,...Object.keys(o.flowResult.input_params_mapped).filter(m=>o.flowResult.input_params_mapped[m].value&&o.flowResult.input_params_mapped[m].value!=="").map(m=>n.value&&o.flowResult.translated_input_params_mapped&&o.flowResult.translated_input_params_mapped[m]?`${o.flowResult.input_params_mapped[m].display_name}: ${o.flowResult.translated_input_params_mapped[m].value}`:`${o.flowResult.input_params_mapped[m].display_name}: ${o.flowResult.input_params_mapped[m].value}`)].join(" | ")+`${o.flowResult.execution_time?" | execution_time: "+o.flowResult.execution_time.toFixed(2)+"s":""}`);dt(()=>{o.flowResult.showInputFiles=!1,o.flowResult.showExecutionDetailsModal=!1});const s=L(()=>o.flowResult.execution_details&&o.flowResult.extra_flags!==null),l=L(()=>{const m={unload_models:o.flowResult.extra_flags.unload_models,max_memory_usage:o.flowResult.execution_details.max_memory_usage,disable_smart_memory:o.flowResult.execution_details.disable_smart_memory,vram_state:o.flowResult.execution_details.vram_state};return JSON.stringify(m,null,"	")});function i(){const m={extra_flags:o.flowResult.extra_flags,execution_details:o.flowResult.execution_details},f=new Blob([JSON.stringify(m,null,"	")],{type:"application/json"}),x=URL.createObjectURL(f),b=document.createElement("a");b.href=x,b.download=`${o.flowResult.task_id}_execution_details.json`,b.click(),window.URL.revokeObjectURL(x)}return(m,f)=>{const x=de,b=Ie,C=De,P=Ee,U=xe;return d(),j(ue,null,[t(s)?(d(),_(b,{key:0,modelValue:e.flowResult.showExecutionDetailsModal,"onUpdate:modelValue":f[2]||(f[2]=I=>e.flowResult.showExecutionDetailsModal=I)},{default:y(()=>[g(x,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:f[0]||(f[0]=()=>e.flowResult.showExecutionDetailsModal=!1)}),w("div",ml,[f[6]||(f[6]=w("h3",{class:"text-center font-bold"}," Execution details ",-1)),w("div",fl,W(t(l)),1),g(x,{class:"mt-3",icon:"i-heroicons-arrow-down-tray-20-solid",variant:"outline",size:"xs",color:"gray",onClick:f[1]||(f[1]=()=>i())},{default:y(()=>f[5]||(f[5]=[E(" Download raw details ")])),_:1})])]),_:1},8,["modelValue"])):F("",!0),e.flowResult.translated_input_params_mapped&&Object.keys(e.flowResult.translated_input_params_mapped).length>0?(d(),_(C,{key:1,text:t(n)?"Hide translated input params":"Show translated input params",popper:{placement:"top"}},{default:y(()=>[g(x,{class:"mb-2 mr-2",color:"white",size:"xs",variant:"outline",icon:"i-heroicons-language-solid",onClick:f[3]||(f[3]=()=>{n.value=!t(n)})})]),_:1},8,["text"])):F("",!0),(d(!0),j(ue,null,ge(t(a).split("|"),I=>(d(),_(P,{key:I,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer",variant:"soft",color:"gray",onClick:()=>{("useCopyToClipboard"in m?m.useCopyToClipboard:t(qe))().copy(I.split(":")[1].trim()),("useToast"in m?m.useToast:t(Me))().add({title:"Clipboard",description:`${I.split(":")[0].trim()} copied to clipboard`,timeout:2e3})}},{default:y(()=>[E(W(I),1)]),_:2},1032,["onClick"]))),128)),e.flowResult.input_files.length>0?(d(),_(P,{key:2,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer select-none",variant:"subtle",color:"sky",onClick:f[4]||(f[4]=()=>{e.flowResult.showInputFiles=!e.flowResult.showInputFiles})},{default:y(()=>[g(U,{name:e.flowResult.showInputFiles?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-1"},null,8,["name"]),g(U,{name:"i-heroicons-document-solid",class:"mr-1"}),E(" "+W(`input_files: ${e.flowResult.input_files.length}`),1)]),_:1})):F("",!0)],64)}}}),gl={key:0,class:Z("w-full p-1")},vl={class:"flex flex-col basis-full justify-between mx-2"},hl=ee({__name:"InputFiles",props:{flowResult:{type:Object,required:!0}},setup(e){const o=pe(),n=(i,m)=>`${_t()}/tasks/inputs?task_id=${i}&input_index=${m}`,a=$(!1),s=$(""),l=$(0);return(i,m)=>{var P,U;const f=_e,x=Fe,b=de,C=Ie;return e.flowResult.showInputFiles?(d(),j("div",gl,[((P=Object.keys(e.flowResult.input_files))==null?void 0:P.length)===1?(d(),_(f,{key:0,class:Z(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(o).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",src:n(e.flowResult.task_id,0),onClick:m[0]||(m[0]=()=>{s.value=n(e.flowResult.task_id,0),l.value=0,a.value=!0})},null,8,["class","src"])):F("",!0),((U=Object.keys(e.flowResult.input_files))==null?void 0:U.length)>1?(d(),_(x,{key:1,items:Object.keys(e.flowResult.input_files).map(I=>({task_id:e.flowResult.task_id,index:I})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 my-2"}},page:1,indicators:""},{default:y(({item:I})=>[w("div",vl,[g(f,{class:Z(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(o).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",draggable:"false",src:n(I.task_id,I.index),onClick:()=>{s.value=n(e.flowResult.task_id,I.index),l.value=I.index,a.value=!0}},null,8,["class","src","onClick"])])]),_:1},8,["items"])):F("",!0),g(C,{modelValue:t(a),"onUpdate:modelValue":m[3]||(m[3]=I=>Q(a)?a.value=I:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[g(b,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:m[1]||(m[1]=()=>a.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:m[2]||(m[2]=Ke(()=>a.value=!1,["left"]))},[t(s)?(d(),_(f,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(s)},null,8,["src"])):F("",!0)])]),_:1},8,["modelValue"])])):F("",!0)}}}),wl={class:"p-4"},yl={class:"flex justify-center mb-4"},bl={key:0,class:"text-sm text-slate-500 text-center mb-4"},kl={class:"text-md text-center text-red-500 mb-4"},xl={key:1},_l={class:"flex items-center justify-between"},$l=ee({__name:"SendToFlowModal",props:Ae({flowResult:{type:Object,required:!1,default:()=>null},outputImgSrc:{type:String,required:!0},outputParamIndex:{type:Number,required:!0},inputParamsMapped:{type:Object,required:!0},isChildTask:{type:Boolean,required:!1,default:!1},translatePrompt:{type:Boolean,required:!1,default:!1}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:Ae(["update:show"],["update:show"]),setup(e,{emit:o}){const n=e,a=je(e,"show"),s=pe(),l=L(()=>s.sub_flows.map(P=>({value:P.name,label:`${P.display_name} - ${P.description}`}))),i=$(l.value[0]||""),m=$(!1),f=o;function x(){console.debug("[Send to flow]: ",i.value);const P=s.sub_flows.find(I=>I.name===i.value.value&&I.display_name===i.value.label.split(" - ")[0]);if(console.debug("[Send to flow]: targetFlow",P),!P){Me().add({title:`Target sub-flow "${i.value.value}" not found`,description:"Please, verify the target sub-flow is installed and available and try again",timeout:5e3});return}const U=P.input_params.reduce((I,z)=>{const N={};return z.type==="text"?N[z.name]={value:z.default||"",type:z.type}:z.type==="number"?N[z.name]={value:z.default||0,type:z.type}:z.type==="image"?N[z.name]={value:JSON.stringify({task_id:n.flowResult.task_id,node_id:n.flowResult.outputs.length>1?n.flowResult.outputs[n.outputParamIndex].comfy_node_id:n.flowResult.outputs[0].comfy_node_id})||"",type:z.type}:z.type==="list"?N[z.name]={value:z.default||Object.keys(z.options)[0]||"",type:z.type,options:z.options}:z.type==="bool"?N[z.name]={value:z.default||!1,type:z.type}:["range","range_scale"].includes(z.type)&&(N[z.name]={value:z.default||0,type:z.type}),I.push(N),I},[]);console.debug("[Send to flow]: input_params_map",U),m.value=!0,s.runFlow(P,U,1,n.translatePrompt,b.value,b.value?Number(n.flowResult.task_id):null).finally(()=>{m.value=!1,f("update:show",!1)})}const b=$(!1),C=L(()=>{var P;return n.flowResult.progress===100&&((P=n.flowResult)==null?void 0:P.error)===""});return Qe(()=>{var U,I;const P=n.flowResult?((I=(U=n==null?void 0:n.flowResult)==null?void 0:U.outputs[n.outputParamIndex])==null?void 0:I.type)??"image":"image";s.fetchSubFlows(P).then(()=>{i.value=l.value[0]||""}),b.value=!1}),(P,U)=>{const I=_e,z=ct,N=Ze,S=Ge,c=de,h=Ie;return d(),_(h,{modelValue:a.value,"onUpdate:modelValue":U[2]||(U[2]=v=>a.value=v),class:"z-[90]",transition:!1},{default:y(()=>[w("div",wl,[U[4]||(U[4]=w("h2",{class:"text-lg text-center mb-4"},"Send to flow",-1)),w("div",yl,[t(C)?(d(),_(I,{key:0,src:e.outputImgSrc,class:"w-1/2 rounded-lg",draggable:!1},null,8,["src"])):(d(),_(z,{key:1,color:"orange",icon:"i-heroicons-exclamation-circle-solid",title:`Task is still running (${Math.ceil(e.flowResult.progress)}%, ${e.flowResult.execution_time.toFixed(2)}s)`,description:e.flowResult.error!==""?e.flowResult.error:""},null,8,["title","description"]))]),e.inputParamsMapped?(d(),j("p",bl,W(["#"+e.flowResult.task_id,...Object.keys(e.inputParamsMapped).filter(v=>e.inputParamsMapped[v].value!=="").map(v=>`${e.inputParamsMapped[v].display_name}: ${e.inputParamsMapped[v].value}`)].join(" | ")),1)):F("",!0),w("p",kl,[t(l).length>0?(d(),_(N,{key:0,modelValue:t(i),"onUpdate:modelValue":U[0]||(U[0]=v=>Q(i)?i.value=v:null),class:"w-full",size:"lg",options:t(l)},null,8,["modelValue","options"])):(d(),j("span",xl,"No sub-flows available"))]),e.isChildTask?(d(),_(z,{key:1,class:"mb-4",icon:"i-heroicons-exclamation-circle-solid",title:"Child task",description:"The latest child task is always used as input for sub-flow"})):F("",!0),w("div",_l,[g(S,{modelValue:t(b),"onUpdate:modelValue":U[1]||(U[1]=v=>Q(b)?b.value=v:null),label:"Bind as child task"},null,8,["modelValue"]),g(c,{icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",variant:"outline",loading:t(m),disabled:t(l).length===0||e.isChildTask&&!t(C),onClick:x},{default:y(()=>U[3]||(U[3]=[E(" Send ")])),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])}}}),Cl={class:"flex flex-col md:flex-row items-center justify-center mb-5 sticky top-1 z-[10]"},Sl={class:"flex items-center justify-center"},Il={class:"p-4"},Rl={class:"text-md text-center text-red-500 mb-4"},Ml={class:"flex justify-center"},Fl={key:0,class:"results overflow-auto"},Pl=["id"],Ul={class:"text-sm text-slate-500 text-center mb-1"},zl={class:"w-5/6 mx-auto flex flex-wrap items-center justify-center"},Vl={class:"w-full flex justify-center items-center"},Ol={key:1,class:"text-center text-slate-500"},jl=ee({__name:"Output",emits:["copy-prompt-inputs"],setup(e,{emit:o}){const n=pe(),a=L(()=>{var R;return n.flowResultsByName((R=n.currentFlow)==null?void 0:R.name).length>0||!1}),s=L(()=>{var R;return n.flowResultsByName((R=n.currentFlow)==null?void 0:R.name)||[]}),l=L(()=>n.$state.resultsPageSize);ye(s,()=>{s.value.length<=n.$state.resultsPageSize?n.$state.resultsPage=1:n.$state.resultsPage>Math.ceil(s.value.length/n.$state.resultsPageSize)&&(n.$state.resultsPage=Math.ceil(s.value.length/n.$state.resultsPageSize))}),ye(l,()=>{s.value.length<=n.$state.resultsPageSize?n.$state.resultsPage=1:n.$state.resultsPage>Math.ceil(s.value.length/n.$state.resultsPageSize)&&(n.$state.resultsPage=Math.ceil(s.value.length/n.$state.resultsPageSize)),n.saveUserOptions()}),dt(()=>{n.$state.flow_results_filter="",n.$state.resultsPage=1});const i=o;function m(R){i("copy-prompt-inputs",R.input_params_mapped)}function f(R){I.value=R,U.value=!0}const x=$(null),b=$(!1);window.addEventListener("scroll",()=>{var R;b.value=window.scrollY>(((R=x.value)==null?void 0:R.offsetTop)+window.screen.height||0)});const C=L(()=>n.$state.resultsPage);ye(C,()=>{const R=document.getElementById("output-container");R&&R.scrollIntoView({behavior:"smooth"})});const P=$(!1),U=$(!1),I=$(""),z=$(!1),N=$(!1),S=$(!1),c=$(""),h=$(null),v=$({}),u=$(0),T=$(!1);function r(R,O=0){if(R.child_tasks.length===0||!Ct(R,O,R.outputs[O].comfy_node_id))h.value=R,c.value=me({task_id:R.task_id,node_id:R.outputs[O].comfy_node_id}),v.value=R.input_params_mapped,T.value=!1;else{const D=$t(R,O,R.outputs[O].comfy_node_id);h.value=D,v.value=R.input_params_mapped,c.value=me({task_id:D.task_id,node_id:D.outputs[0].comfy_node_id}),T.value=!0}u.value=O,S.value=!0}function k(R){var le;const O=R.extra_flags!==null&&((le=R==null?void 0:R.extra_flags)==null?void 0:le.profiler_execution),D=[{label:"Comfy flow",labelClass:"text-blue-500 text-sm",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500 h-4 w-4",click:()=>{var ae;return n.downloadFlowComfy((ae=n.currentFlow)==null?void 0:ae.name,R.task_id)}}];O&&D.push({label:"Execution details",labelClass:"text-orange-500 text-sm",icon:"i-mdi-bug",iconClass:"bg-orange-500 h-4 w-4",click:()=>{R.execution_details?R.showExecutionDetailsModal=!0:n.fetchTaskHistoryItem(R.task_id).then(ae=>{R.execution_details=ae.execution_details,R.showExecutionDetailsModal=!0})}});const oe=[[{label:"Use params",labelClass:"text-cyan-500 text-sm",icon:"i-heroicons-document-duplicate-16-solid",iconClass:"bg-cyan-500 h-4 w-4",click:()=>m(R)}],D];return R.outputs.length===1&&R.outputs.every(ae=>ae.type==="image")&&oe.splice(1,0,[{label:"Send to flow",labelClass:"text-violet-500 text-sm",icon:"i-heroicons-arrow-uturn-up-solid",iconClass:"bg-violet-500 h-4 w-4",click:()=>{r(R)}}]),oe}return(R,O)=>{var G;const D=To,oe=xe,le=We,ae=on,he=an,X=de,ne=Ye,ce=Ee,we=Ie,K=Qo,J=ol,se=rl,fe=cl,A=pl,p=hl,M=$l,q=_e;return d(),j("div",{id:"output-container",ref_key:"outputContainer",ref:x,class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md my-10"},[g(D,{show:t(b),class:"fixed bottom-5 right-5",target:"output-container"},null,8,["show"]),w("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:O[0]||(O[0]=()=>{P.value=!t(P)})},[g(oe,{name:t(P)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),E(" Output ("+W(t(s).filter(V=>V.parent_task_id===null).length)+") ",1)]),t(P)?F("",!0):(d(),j(ue,{key:0},[w("div",Cl,[g(le,{modelValue:t(n).$state.flow_results_filter,"onUpdate:modelValue":O[1]||(O[1]=V=>t(n).$state.flow_results_filter=V),icon:"i-heroicons-magnifying-glass-20-solid",color:"white",class:"md:mr-3",label:"Filter by prompt",trailing:!0,placeholder:"Filter results by prompt"},null,8,["modelValue"]),t(s).filter(V=>V.parent_task_id===null).length>t(n).$state.resultsPageSize?(d(),_(ae,{key:0,modelValue:t(n).$state.resultsPage,"onUpdate:modelValue":O[2]||(O[2]=V=>t(n).$state.resultsPage=V),class:"my-1 md:my-0","page-count":t(n).$state.resultsPageSize,total:t(s).filter(V=>V.parent_task_id===null).length,"show-first":"","show-last":""},null,8,["modelValue","page-count","total"])):F("",!0),w("div",Sl,[g(he,{modelValue:t(n).resultsPageSize,"onUpdate:modelValue":O[3]||(O[3]=V=>t(n).resultsPageSize=V),class:"md:mx-3 w-fit mr-3",options:[5,10,20,50,100],label:"Results per page"},null,8,["modelValue"]),g(ne,{items:[[{label:"Delete all results",labelClass:"text-red-500",icon:"i-heroicons-trash",iconClass:"dark:text-red-500 text-red-500",click:()=>z.value=!0}]],mode:"click",label:"Options",popper:{placement:"bottom-end"}},{default:y(()=>[g(X,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])]),g(we,{modelValue:t(z),"onUpdate:modelValue":O[6]||(O[6]=V=>Q(z)?z.value=V:null),class:"z-[90]",transition:!1},{default:y(()=>[w("div",Il,[O[15]||(O[15]=w("p",{class:"text-lg text-center mb-4"},"Are you sure you want to delete all results?",-1)),w("p",Rl,[O[11]||(O[11]=E(" All history and images of ")),g(ce,{class:"mx-1",color:"orange",variant:"outline"},{default:y(()=>[E(W(t(n).currentFlow.display_name),1)]),_:1}),O[12]||(O[12]=E(" will be deleted. "))]),w("div",Ml,[g(X,{class:"mr-2",color:"red",variant:"outline",loading:t(N),onClick:O[4]||(O[4]=()=>{var V;N.value=!0,t(n).deleteFlowResults((V=t(n).currentFlow)==null?void 0:V.name).then(()=>{N.value=!1,z.value=!1})})},{default:y(()=>O[13]||(O[13]=[E(" Yes ")])),_:1},8,["loading"]),g(X,{variant:"outline",onClick:O[5]||(O[5]=()=>z.value=!1)},{default:y(()=>O[14]||(O[14]=[E("No")])),_:1})])])]),_:1},8,["modelValue"])]),t(a)?(d(),j("div",Fl,[(d(!0),j(ue,null,ge(t(n).flowResultsByNamePaginated((G=t(n).currentFlow)==null?void 0:G.name),V=>(d(),j("div",{id:"task_id_"+V.task_id,key:V.task_id,class:"flex flex-col justify-center mx-auto mb-5"},[V.outputs.some(H=>["image","image-animated"].includes(H.type))?(d(),_(K,{key:0,"flow-result":V,"handle-send-to-flow":r,"open-image-modal":f},null,8,["flow-result"])):V.outputs.some(H=>H.type==="video")?(d(),_(J,{key:1,"flow-result":V,"handle-send-to-flow":r,"open-image-modal":f},null,8,["flow-result"])):V.outputs.some(H=>H.type==="audio")?(d(),_(se,{key:2,"flow-result":V},null,8,["flow-result"])):V.outputs.some(H=>H.type==="text")?(d(),_(fe,{key:3,"flow-result":V},null,8,["flow-result"])):F("",!0),w("div",Ul,[w("div",zl,[g(A,{"flow-result":V},null,8,["flow-result"])])]),g(p,{"flow-result":V},null,8,["flow-result"]),w("div",Vl,[g(X,{class:"mr-3",color:"red",icon:"i-heroicons-trash",variant:"outline",size:"xs",onClick:()=>t(n).deleteFlowHistory(V.task_id)},{default:y(()=>O[16]||(O[16]=[E(" Delete ")])),_:2},1032,["onClick"]),g(ne,{items:k(V),mode:"click",popper:{placement:"bottom-start"}},{default:y(()=>[g(X,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid",size:"xs"})]),_:2},1032,["items"])])],8,Pl))),128)),g(M,{show:t(S),"onUpdate:show":O[7]||(O[7]=V=>Q(S)?S.value=V:null),"flow-result":t(h),"output-img-src":t(c),"output-param-index":t(u),"input-params-mapped":t(v),"is-child-task":t(T)},null,8,["show","flow-result","output-img-src","output-param-index","input-params-mapped","is-child-task"])])):(d(),j("p",Ol," No output results available "))],64)),g(we,{modelValue:t(U),"onUpdate:modelValue":O[10]||(O[10]=V=>Q(U)?U.value=V:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[g(X,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:O[8]||(O[8]=()=>U.value=!1)}),w("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:O[9]||(O[9]=Ke(()=>U.value=!1,["left"]))},[t(I)?(d(),_(q,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",src:t(I)},null,8,["src"])):F("",!0)])]),_:1},8,["modelValue"])],512)}}}),Tl=Yt("civitAiStore",{actions:{fetchFlowLoras(e,o,n=50,a=null){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:s}=Le();let i=`https://civitai.com/api/v1/models?baseModels=${e.lora_connect_points[Object.keys(e.lora_connect_points)[0]].base_model_type}&types=LORA&limit=${n}`;a&&(i=a);const m=`/other/proxy?target=${encodeURIComponent(i)}`;return s(m,{method:"GET",headers:{Authentication:"Bearer "+o,Accept:"application/json"}})},fetchFlowLorasByHash(e,o,n){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:a}=Le(),s=`https://civitai.com/api/v1/model-versions/by-hash/${n}`,l=`/other/proxy?target=${encodeURIComponent(s)}`;return a(l,{method:"GET",headers:{Authentication:"Bearer "+o,Accept:"application/json"}})}}}),Bl={class:"p-4 overflow-y-auto relative"},Nl={key:1},Ll={class:"flex flex-col justify-between w-full md:flex-row md:gap-4 md:items-center lg:items-start"},Al={class:"flex flex-col gap-2 lg:flex-row md:justify-end items-start w-full"},ql={class:"flex flex-col md:flex-row flex-wrap gap-2 justify-between items-center w-full px-4 py-3"},El={class:"flex items-center gap-1.5"},Dl={class:"flex gap-1.5 items-center"},Wl={class:"flex items-center h-5"},Hl=["checked","indeterminate","onChange"],Gl={key:0,class:"flex items-center h-5"},Xl=["checked","onChange"],Jl=["href"],Ql=["innerHTML"],Kl={class:"p-4 max-h-64 max-w-xl overflow-y-auto"},Yl={key:0},Zl={class:"flex items-center"},ea={class:"flex items-center"},ta={key:0,class:"flex justify-center space-x-2 w-full"},na={key:1,controls:"",width:256,height:256},oa=["src"],la={class:"flex justify-end"},aa=ee({__name:"LoraSelectorModal",props:Ae({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const o=e,n=je(e,"show"),a=Me(),s=pe(),l=kt(),i=Tl(),m=$(!1),f=$({items:[],metadata:{}}),x=L(()=>l.settingsMap.civitai_auth_token.value!==""),b=L(()=>l.settingsMap.civitai_auth_token.value||""),C=[{key:"name",label:"Name",sortable:!0,class:""},{key:"description",label:"Description",sortable:!1,class:""},{key:"trigger_words",label:"Trigger words",sortable:!1,class:""},{key:"nsfw",label:"NSFW",sortable:!1,class:""},{key:"statsDownloadCount",label:"Download count",sortable:!1,class:""},{key:"statsThumbsUpCount",label:"Thumbs up",sortable:!1,class:""},{key:"modelVersion",label:"Model version",sortable:!1,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}],P=$([]),U=$({openedRows:[],row:{}}),I=$(""),z=()=>{I.value=""},N=L(()=>{var p;let A=((p=f.value)==null?void 0:p.items)||[];return I.value&&(A=A.filter(M=>M.name.toLowerCase().includes(I.value.toLowerCase()))),A.forEach(M=>{!S.value[M.id]&&(M==null?void 0:M.modelVersions.length)>0&&(S.value[M.id]=M==null?void 0:M.modelVersions[0].name);const q=Object.keys(J.value);M.modelVersions.forEach(G=>{q.includes(G.files[0].hashes.SHA256.toLowerCase())&&J.value[G.files[0].hashes.SHA256.toLowerCase()]!==null&&(S.value[M.id]=G.name,M.currentFlowLora=!0,P.value.includes(M)||P.value.push(M))})}),A}),S=$({});function c(A){var p;return((p=A.modelVersions.find(M=>M.name===S.value[A.id]))==null?void 0:p.images)||A.modelVersions[0].images||[]}function h(A){var p;return((p=A.modelVersions.find(M=>M.name===S.value[A.id]))==null?void 0:p.trainedWords)||A.modelVersions[0].trainedWords||[]}const v=$(!0),u=$(""),T=$(o.flow.display_name),r=$(o.flow.description),k=$(o.flow.license),R=$(o.flow.required_memory_gb||0),O=$(o.flow.version);function D(){const A=Object.keys(o.flow.lora_connect_points)[0],M=o.flow.lora_connect_points[A].connected_loras.filter(V=>J.value[V.hash]!==null).map(V=>({display_name:V.display_name,model_url:V.url,strength_model:V.strength_model})),q={[A]:[]};v.value&&q[A].push(...M);const G=P.value.reduce((V,H)=>{const Y=H.modelVersions.find(ve=>ve.name===S.value[H.id]);if(!Y||J.value[Y.files[0].hashes.SHA256.toLowerCase()])return V;const ie={strength_model:1,model_url:Y.downloadUrl,display_name:H.name};return V.push(ie),V},[]);return q[A].push(...G),console.debug("[DEBUG] newFlowConnectionPoints: ",q),q}function oe(A){const p=A.modelVersions.find(G=>G.name===S.value[A.id]);if(!p)return;const M=p.files[0].hashes.SHA256.toLowerCase();J.value[M]&&(J.value[M]=null);const q=P.value.indexOf(A);q!==-1&&P.value.splice(q,1),A.currentFlowLora=!1}const le=L(()=>s.flows.find(A=>A.name===u.value)),ae=L(()=>/^[a-z0-9_-]+$/i.test(u.value)),he=L(()=>u.value!==""&&ae&&!le.value),X=L(()=>u.value===""?"Flow name is required.":ae.value?le.value?"Flow name already exists.":"":"Flow name can only contain letters, numbers, dashes and underscores."),ne=L(()=>P.value.filter(A=>!J.value[A.modelVersions[0].files[0].hashes.SHA256.toLowerCase()]).length!==0),ce=L(()=>ne.value&&he.value&&T.value!==""&&r.value!==""),we=L(()=>ne.value?he.value?T.value===""?"Please provide a display name.":r.value===""?"Please provide a description.":"":"Please provide a valid flow name.":"No LoRAs selected");function K(){if(P.value.length===0){a.add({title:"No LoRAs selected",description:"Please select at least one LoRA to apply and install."});return}const A={new_name:u.value,new_display_name:T.value,new_description:r.value,new_license:k.value,new_required_memory_gb:R.value,new_version:O.value,new_lora_connection_points:D()};console.debug("[DEBUG] Clone flow params: ",A),m.value=!0,s.cloneFlow(o.flow,A).then(()=>{s.fetchFlows();const p=St();a.add({title:"Flow clone applied",actions:[{label:"View flow",click:()=>{p.push("/workflows/"+u.value)}}]})}).catch(p=>{console.error("Error applying and installing flow: ",p.message||"Unknown error"),a.add({title:"Error applying and installing flow",description:"An error occurred while applying and installing the flow. See the console for more details."})}).finally(()=>{m.value=!1})}const J=$({});function se(){const A=o.flow.lora_connect_points[Object.keys(o.flow.lora_connect_points)[0]].connected_loras;console.debug("Flow LORAs: ",A),Promise.all(A.map(p=>{var M;return(M=i.fetchFlowLorasByHash(o.flow,b.value,p.hash))==null?void 0:M.then(q=>(p.hash in J.value||(J.value[p.hash]=q),q))})).then(()=>{console.debug("Fetched flow LORAs info: ",J.value)}).catch(p=>{console.error("Error fetching flow LORAs info: ",p),a.add({title:"Error fetching flow LORAs info",description:"An error occurred while fetching LoRAs info for the flow. See the console for more details."})})}function fe(A=!1){var M;if(!o.flow||!b.value)return;m.value=!0,A||se();let p=null;return A&&((M=f.value.metadata)!=null&&M.nextPage)&&(p=f.value.metadata.nextPage),i.fetchFlowLoras(o.flow,b.value,50,p).then(q=>{console.debug('Fetched flow "'+o.flow.name+'" loras: ',q);const G=o.flow.lora_connect_points[Object.keys(o.flow.lora_connect_points)[0]].base_model_type,V=q.items.reduce((H,Y)=>(Y.modelVersions=Y.modelVersions.filter(ie=>ie.baseModel===G),Y.modelVersions.length>0&&(f.value.items.find(ie=>ie.id===Y.id)||H.push(Y)),H),[]);return V.length===0&&a.add({title:"No more supported LoRAs",description:"No supported LoRAs available for the flow."}),f.value.items.push(...V),f.value.metadata=q.metadata,q}).catch(q=>{console.error('Error fetching flow "'+o.flow.name+'" loras: ',q),a.add({title:'Error fetching flow "'+o.flow.name+'" loras',description:"An error occurred while fetching LoRAs for the flow. See the console for more details."})}).finally(()=>{m.value=!1})}return(A,p)=>{const M=de,q=Zt,G=ct,V=We,H=He,Y=Ge,ie=De,ve=bt,Pe=Ee,be=xe,Ue=Ze,te=_e,zt=Fe,Vt=sn,Ot=It,jt=Ie;return d(),_(jt,{modelValue:n.value,"onUpdate:modelValue":p[15]||(p[15]=B=>n.value=B),fullscreen:""},{default:y(()=>[w("div",Bl,[g(M,{class:"absolute top-3 right-3",icon:"i-heroicons-x-mark",variant:"ghost",onClick:p[0]||(p[0]=()=>n.value=!1)}),p[22]||(p[22]=w("h2",{class:"text-xl font-bold"},"Modify flow",-1)),p[23]||(p[23]=w("p",{class:"text-sm text-slate-500 my-2"}," Select LoRAs to modify the flow. New Flow will be created and installed with selected LoRAs. ",-1)),t(x)?(d(),j("div",Nl,[w("div",Ll,[g(M,{class:"my-1",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",loading:t(m),onClick:p[1]||(p[1]=()=>{f.value={items:[],metadata:{}},J.value={},z(),fe()})},{default:y(()=>p[17]||(p[17]=[E(" Fetch LoRAs models from CivitAI ")])),_:1},8,["loading"]),w("div",Al,[g(H,{label:"New flow name",class:"flex justify-center flex-col w-full",error:t(X)},{default:y(()=>[g(V,{modelValue:t(u),"onUpdate:modelValue":p[2]||(p[2]=B=>Q(u)?u.value=B:null),type:"text",placeholder:"unique_flow_name",onInput:p[3]||(p[3]=B=>{B.target.value=B.target.value.toLowerCase(),u.value=B.target.value.toLowerCase()})},null,8,["modelValue"])]),_:1},8,["error"]),g(H,{label:"New display name",class:"flex justify-center flex-col w-full",error:t(T)!==""?"":"Display name is required."},{default:y(()=>[g(V,{modelValue:t(T),"onUpdate:modelValue":p[4]||(p[4]=B=>Q(T)?T.value=B:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),g(H,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:y(()=>[g(V,{modelValue:t(r),"onUpdate:modelValue":p[5]||(p[5]=B=>Q(r)?r.value=B:null),type:"text",placeholder:"Description"},null,8,["modelValue"])]),_:1}),g(H,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:y(()=>[g(V,{modelValue:t(k),"onUpdate:modelValue":p[6]||(p[6]=B=>Q(k)?k.value=B:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),g(H,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:y(()=>[g(V,{modelValue:t(R),"onUpdate:modelValue":p[7]||(p[7]=B=>Q(R)?R.value=B:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),g(H,{label:"Version",class:"flex justify-center flex-col w-full"},{default:y(()=>[g(V,{modelValue:t(O),"onUpdate:modelValue":p[8]||(p[8]=B=>Q(O)?O.value=B:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})])]),g(Ot,{class:"w-full",ui:{base:"",ring:"",divide:"divide-y divide-gray-200 dark:divide-gray-700",header:{padding:"px-4 py-5"},body:{padding:"",base:"divide-y divide-gray-200 dark:divide-gray-700"},footer:{padding:"p-4"}}},{footer:y(()=>[w("div",la,[g(M,{class:"mr-2",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",color:"blue",disabled:t(f).items.length===0||t(f).items.length>0&&!t(f).metadata.nextPage,loading:t(m),onClick:p[14]||(p[14]=()=>{fe(!0)})},{default:y(()=>p[21]||(p[21]=[E(" Load more ")])),_:1},8,["disabled","loading"])])]),default:y(()=>[w("div",ql,[w("div",El,[g(V,{modelValue:t(I),"onUpdate:modelValue":p[9]||(p[9]=B=>Q(I)?I.value=B:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:"Filter by name..."},null,8,["modelValue"])]),w("div",Dl,[t(ne)?(d(),_(Y,{key:0,modelValue:t(v),"onUpdate:modelValue":p[10]||(p[10]=B=>Q(v)?v.value=B:null),label:"Keep previous LoRAs",class:"mr-2"},null,8,["modelValue"])):F("",!0),t(ne)?(d(),_(M,{key:1,variant:"outline",icon:"i-heroicons-x-circle",color:"orange",class:"mr-2",onClick:p[11]||(p[11]=()=>t(P).splice(0))},{default:y(()=>p[18]||(p[18]=[E(" Clear selection ")])),_:1})):F("",!0),g(ie,{text:t(we)},{default:y(()=>[g(M,{variant:"outline",icon:"i-heroicons-check-16-solid",disabled:!t(ce),loading:t(m),onClick:K},{default:y(()=>p[19]||(p[19]=[E(" Apply and install ")])),_:1},8,["disabled","loading"])]),_:1},8,["text"])])]),g(Vt,{modelValue:t(P),"onUpdate:modelValue":p[12]||(p[12]=B=>Q(P)?P.value=B:null),expand:t(U),"onUpdate:expand":p[13]||(p[13]=B=>Q(U)?U.value=B:null),columns:C,rows:t(N),loading:t(m),ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10",tr:{base:"dark:hover:bg-slate-800"}}},{caption:y(()=>p[20]||(p[20]=[w("caption",{class:"text-slate-500 text-sm py-1"},"Only supported LORAs for the basic model type are listed",-1)])),"select-header":y(({indeterminate:B,checked:re,change:Te})=>[w("div",Wl,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:re,indeterminate:B&&t(ne),onChange:et=>Te(et.target.checked)},null,40,Hl)])]),"select-data":y(({checked:B,change:re,row:Te})=>[Te!=null&&Te.currentFlowLora?F("",!0):(d(),j("div",Gl,[w("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:B,onChange:et=>re(et.target.checked)},null,40,Xl)]))]),"name-data":y(({row:B})=>[w("a",{href:`https://civitai.com/models/${B.id}`,target:"_blank",class:"text-blue-500 underline"},W(B.name),9,Jl)]),"description-data":y(({row:B})=>[g(ve,null,{panel:y(()=>[w("div",{class:"model-description p-4 max-h-64 max-w-xl overflow-y-auto",innerHTML:B.description},null,8,Ql)]),default:y(()=>[g(M,{color:"white",label:"Description","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:2},1024)]),"trigger_words-data":y(({row:B})=>[g(ve,null,{panel:y(()=>[w("div",Kl,[h(B).length===0?(d(),j("p",Yl,"No trigger words available for this model version.")):(d(!0),j(ue,{key:1},ge(h(B),re=>(d(),_(Pe,{key:re,class:"flex flex-wrap gap-3 my-1 whitespace-normal",label:re,color:"white",variant:"outline"},null,8,["label"]))),128))])]),default:y(()=>[g(M,{color:"white",label:`Trigger words (${h(B).length})`,"trailing-icon":"i-heroicons-chevron-down-20-solid"},null,8,["label"])]),_:2},1024)]),"nsfw-data":y(({row:B})=>[g(ie,{text:`NSFW level: ${B.nsfwLevel}`,class:"pl-4"},{default:y(()=>[g(be,{name:B.nsfw?"i-heroicons-x-circle":"i-heroicons-check-circle",class:Z({"text-red-500":B.nsfw,"text-green-500":!B.nsfw})},null,8,["name","class"])]),_:2},1032,["text"])]),"statsThumbsUpCount-data":y(({row:B})=>[w("div",Zl,[g(be,{name:"i-heroicons-hand-thumb-up-solid",class:"text-green-500 mr-1"}),w("span",null,W(B.stats.thumbsUpCount),1)])]),"statsDownloadCount-data":y(({row:B})=>[w("div",ea,[g(be,{name:"i-heroicons-arrow-down-circle",class:"text-blue-500 mr-1"}),w("span",null,W(B.stats.downloadCount),1)])]),"modelVersion-data":y(({row:B})=>[g(Ue,{modelValue:t(S)[B.id],"onUpdate:modelValue":re=>t(S)[B.id]=re,options:B.modelVersions.map(re=>re.name)},null,8,["modelValue","onUpdate:modelValue","options"])]),"actions-data":y(({row:B})=>[B!=null&&B.currentFlowLora?(d(),_(ie,{key:1,text:"Remove previously selected LoRA"},{default:y(()=>[g(M,{icon:"i-heroicons-minus-16-solid",variant:"outline",color:"orange",onClick:re=>oe(B)},null,8,["onClick"])]),_:2},1024)):(d(),_(M,{key:0,icon:t(P).includes(B)?"i-heroicons-check-16-solid":"i-heroicons-plus-16-solid",variant:"outline",color:t(P).includes(B)?"green":"white",onClick:()=>{if(t(P).includes(B)){t(P).splice(t(P).indexOf(B),1);return}t(P).push(B)}},null,8,["icon","color","onClick"]))]),expand:y(({row:B})=>[c(B).length>0?(d(),j("div",ta,[g(zt,{class:"my-3",items:c(B).map(re=>({id:re.id,url:re.url,type:(re==null?void 0:re.type)||"image"})),ui:{item:"mx-1"}},{default:y(({item:re})=>[re.type==="image"?(d(),_(te,{key:0,src:re.url,height:256,width:256,loading:"lazy",draggable:"false"},null,8,["src"])):(d(),j("video",na,[w("source",{src:re.url},null,8,oa)]))]),_:2},1032,["items"])])):(d(),_(G,{key:1,title:"No images",description:"No images available for this model version.",variant:"soft",color:"amber"}))]),_:1},8,["modelValue","expand","rows","loading"])]),_:1})])):(d(),_(G,{key:0,class:"my-4",title:"CivitAI token missing",description:"Please add a CivitAI token in the settings to use this feature.",variant:"soft",color:"red"},{actions:y(()=>[g(q,{to:"/settings"},{default:y(()=>[g(M,{class:"lg:px-3 py-2",icon:"i-heroicons-arrow-top-right-on-square-16-solid",variant:"link",color:"white"},{default:y(()=>p[16]||(p[16]=[E(" Go to Settings ")])),_:1})]),_:1})]),_:1}))])]),_:1},8,["modelValue"])}}}),sa={class:"flex flex-col lg:flex-row flex-grow items-start w-full"},ia={class:"card-wrapper w-full lg:pr-5"},ra={key:0,class:"p-0 text-sm"},ua={class:"flex flex-row items-center text-slate-400 mb-2"},da={class:"flex flex-row flex-wrap items-center text-md mb-2"},ca=["href"],ma={class:"flex flex-row items-center text-md mb-2"},fa=["href"],pa={key:1},ga={class:"flex flex-row items-center text-md mb-2"},va={key:0},ha={class:"flex flex-row items-center text-md mb-2"},wa={key:0,class:"flex flex-row flex-wrap items-center text-md mb-2"},ya=["href"],ba={key:1},ka={class:"flex flex-row items-center mb-2"},xa={key:1,class:"flex flex-row flex-wrap items-center text-md"},_a={key:0,class:"flex justify-end"},$a={class:"flex flex-row items-center justify-center text-sm mr-2"},Ca={key:1},Sa={class:"text-sm flex justify-end"},Ia={class:"flex flex-row items-center justify-center text-sm mr-3"},Ra={key:0,class:"text-right"},Ma={class:"prompt-wrapper w-full"},Fa={class:"flex items-center justify-between"},Pa={class:"pb-2"},Ua={class:"flex justify-end items-center"},Ea=ee({__name:"[name]",setup(e){const o=en(),n=pe();n.setCurrentFlow(o.params.name);const a=L(()=>n.flowInstallingByName(o.params.name)),s=L(()=>{var v;return a.value&&((v=a.value)==null?void 0:v.progress)<100||!1}),l=$(!1),i=L(()=>{var v;return a.value?"error"in a.value&&((v=a.value)==null?void 0:v.error)!==""?`${a.value.progress.toFixed(0)}% Error setting up`:`${a.value.progress.toFixed(0)}% Setting up`:"Setup flow"}),m=$(!1),f=$(!1),x=$(!1),b=L(()=>{var u,T;const v=[[{label:"Delete flow",icon:"i-heroicons-trash",click:P}]];return((u=n==null?void 0:n.currentFlow)==null?void 0:u.new_version_available)!==""&&v[0].unshift({label:`Update to ${n.currentFlow.new_version_available}`,icon:"i-heroicons-arrow-path",click:()=>{n.updateFlow(n.currentFlow)}}),(T=n==null?void 0:n.currentFlow)!=null&&T.lora_connect_points&&Object.keys(n.currentFlow.lora_connect_points).length>0&&v[0].unshift({label:"Modify flow",icon:"i-heroicons-plus-circle",click:()=>{x.value=!0}}),v});function C(v,u=!1){m.value=!0,n.deleteFlow(v).then(()=>{u&&St().push("/")}).finally(()=>{m.value=!1,f.value=!1})}function P(){var u;const v=((u=n.currentFlow)==null?void 0:u.private)||!1;if(v){f.value=!0;return}C(n.currentFlow,v)}const U=$(!1),I=$(null),z=function(v){var u;(u=I.value)==null||u.copyPromptInputs(v)},N=ut(),S=L(()=>{var v;return(v=n.currentFlow)==null?void 0:v.models.filter(u=>u.installed).reduce((u,T)=>u+(T==null?void 0:T.file_size)||0,0)}),c=L(()=>{var v;return(v=n.currentFlow)==null?void 0:v.models.reduce((u,T)=>u+(T==null?void 0:T.file_size)||0,0)}),h=L(()=>!S.value&&!c.value?"":S.value===c.value?` - ${Ve(c.value)}`:` - ${Ve(S.value)} / ${Ve(c.value)}`);return(v,u)=>{const T=xe,r=De,k=Ee,R=de,O=Ye,D=It,oe=wo,le=jo,ae=jl,he=Mt,X=Ie,ne=aa,ce=tn;return d(),_(ce,null,{default:y(()=>{var we;return[!t(n).loading.flows_available&&!t(n).loading.flows_installed&&t(n).currentFlow&&!t(n).$state.loading.tasks_history?(d(),j(ue,{key:0},[w("div",sa,[w("div",ia,[g(D,{as:"div",class:"w-full mb-5"},nn({header:y(()=>{var K,J;return[w("h2",{class:"text-xl font-bold cursor-pointer select-none flex items-center",onClick:u[0]||(u[0]=()=>{U.value=!t(U)})},[(K=t(n).currentFlow)!=null&&K.private?(d(),_(r,{key:0,text:"This flow is local, manually added"},{default:y(()=>{var se;return[g(T,{name:"i-heroicons-lock-closed",class:Z(["mr-2",{"text-stone-500":!((se=t(n).currentFlow)!=null&&se.is_supported_by_workers)}])},null,8,["class"])]}),_:1})):F("",!0),g(T,{name:t(U)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),g(r,{text:(J=t(n).currentFlow)!=null&&J.is_supported_by_workers?"":"No workers capable of running this flow",popper:{placement:"top"}},{default:y(()=>{var se,fe;return[w("span",{class:Z({"text-stone-500":!((se=t(n).currentFlow)!=null&&se.is_supported_by_workers)})},W((fe=t(n).currentFlow)==null?void 0:fe.display_name),3)]}),_:1},8,["text"])])]}),default:y(()=>{var K,J,se,fe,A,p,M,q,G,V,H,Y,ie,ve,Pe,be,Ue;return[t(U)?F("",!0):(d(),j("div",ra,[w("p",ua,W((K=t(n).currentFlow)==null?void 0:K.description),1),w("p",da,[g(T,{name:"i-heroicons-user-16-solid",class:"mr-1"}),u[9]||(u[9]=w("b",null,"Author:",-1)),u[10]||(u[10]=E(" ")),w("a",{class:"hover:underline text-md",href:(J=t(n).currentFlow)==null?void 0:J.homepage,rel:"noopener",target:"_blank"},W((se=t(n).currentFlow)==null?void 0:se.author),9,ca)]),w("p",ma,[g(T,{name:"i-heroicons-document-text",class:"mr-1"}),(fe=t(n).currentFlow)!=null&&fe.documentation?(d(),j("a",{key:0,class:"hover:underline",href:(A=t(n).currentFlow)==null?void 0:A.documentation,rel:"noopener",target:"_blank"}," Documentation ",8,fa)):(d(),j("span",pa,"No documentation"))]),w("p",ga,[g(T,{name:"i-heroicons-clock",class:"mr-1"}),u[11]||(u[11]=w("b",null,"Version:",-1)),u[12]||(u[12]=E(" ")),w("span",null,W((p=t(n).currentFlow)==null?void 0:p.version),1),((M=t(n).currentFlow)==null?void 0:M.new_version_available)!==""?(d(),j("span",va," (new version available: "+W((q=t(n).currentFlow)==null?void 0:q.new_version_available)+") ",1)):F("",!0)]),w("p",ha,[g(T,{name:"i-heroicons-tag",class:"mr-1"}),u[13]||(u[13]=w("b",null,"Tags:",-1)),u[14]||(u[14]=E(" ")),((G=t(n).currentFlow)==null?void 0:G.tags.length)>0?(d(!0),j(ue,{key:0},ge((V=t(n).currentFlow)==null?void 0:V.tags,te=>(d(),_(k,{key:te,label:te,color:"white",variant:"solid",class:"m-1"},null,8,["label"]))),128)):(d(),_(k,{key:1,label:"No tags",color:"white",variant:"solid",class:"m-1"}))]),((Y=(H=t(n).currentFlow)==null?void 0:H.models)==null?void 0:Y.length)>0?(d(),j("p",wa,[g(T,{name:"i-heroicons-arrow-down-on-square-stack",class:"mr-1"}),g(r,{text:t(c)-t(S)>0?`${("formatBytes"in v?v.formatBytes:t(Ve))(t(c)-t(S))} to download`:"All models installed",popper:{placement:"top"}},{default:y(()=>{var te;return[w("b",null,"Models ("+W((te=t(n).currentFlow)==null?void 0:te.models.length)+W(t(h))+"):",1),u[15]||(u[15]=E(" "))]}),_:1},8,["text"]),(d(!0),j(ue,null,ge((ie=t(n).currentFlow)==null?void 0:ie.models,te=>(d(),_(k,{key:te.name,class:"m-1",color:"white",variant:"solid"},{default:y(()=>[g(r,{text:te.installed?"Model installed":"Model not installed"},{default:y(()=>[g(T,{name:te.installed?"i-heroicons-check-circle-20-solid":"i-heroicons-x-mark-20-solid",class:Z(te.installed?"text-green-500":"text-orange-500")},null,8,["name","class"])]),_:2},1032,["text"]),te.gated?(d(),_(r,{key:0,text:"Gated model, requires auth token for download",popper:{placement:"top"}},{default:y(()=>[g(T,{name:"i-heroicons-key",class:"mr-1"})]),_:1})):F("",!0),w("a",{class:"hover:underline underline-offset-4",href:te.homepage,rel:"noopener",target:"_blank"},W(te.name),9,ya),te.file_size?(d(),j("span",ba," ("+W(("formatBytes"in v?v.formatBytes:t(Ve))(te.file_size))+") ",1)):F("",!0)]),_:2},1024))),128))])):F("",!0),w("p",ka,[g(T,{name:"i-mdi-help-network-outline",class:"mr-1"}),u[18]||(u[18]=w("b",null,"Platforms:",-1)),u[19]||(u[19]=E(" ")),g(r,{text:"Linux"},{default:y(()=>[g(T,{name:"i-mdi-linux",class:"mr-1"})]),_:1}),g(r,{text:"Microsoft Windows"},{default:y(()=>[g(T,{name:"i-mdi-microsoft-windows",class:"mr-1"})]),_:1}),t(n).currentFlow.is_macos_supported?(d(),_(r,{key:0,text:"macOS"},{default:y(()=>[g(T,{name:"i-mdi-apple",class:"mr-1"})]),_:1})):F("",!0),(ve=t(n).currentFlow)!=null&&ve.required_memory_gb?(d(),_(r,{key:1,class:"flex flex-row items-center",text:"Required VRAM memory (GB)"},{default:y(()=>{var te;return[u[16]||(u[16]=E(" (")),g(T,{name:"i-mdi-memory",class:"mr-1"}),w("span",null,W((te=t(n).currentFlow)==null?void 0:te.required_memory_gb)+" GB",1),u[17]||(u[17]=E(") "))]}),_:1})):F("",!0)]),((be=(Pe=t(n).currentFlow)==null?void 0:Pe.requires)==null?void 0:be.length)>0?(d(),j("p",xa,[u[20]||(u[20]=w("b",null,"Requires:",-1)),u[21]||(u[21]=E(" ")),(d(!0),j(ue,null,ge((Ue=t(n).currentFlow)==null?void 0:Ue.requires,te=>(d(),_(k,{key:te,class:"m-1",color:"yellow",variant:"outline"},{default:y(()=>[E(W(te),1)]),_:2},1024))),128))])):F("",!0)]))]}),_:2},[t(U)?void 0:{name:"footer",fn:y(()=>{var K,J;return[t(N).isAdmin?(d(),j("div",_a,[w("div",$a,[g(T,{name:t(n).isFlowInstalled(t(o).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:Z({"text-green-500":t(n).isFlowInstalled(t(o).params.name),"text-red-500":!t(n).isFlowInstalled(t(o).params.name),"text-stone-500":t(n).isFlowInstalled(t(o).params.name)&&!((K=t(n).currentFlow)!=null&&K.is_supported_by_workers)})},W(t(n).isFlowInstalled(t(o).params.name)?(J=t(n).currentFlow)!=null&&J.is_supported_by_workers?"Installed":"Installed (no workers)":"Not installed"),3)]),t(n).isFlowInstalled(t(o).params.name)?F("",!0):(d(),_(r,{key:0,text:"Setup flow dependencies and configure it in ComfyUI",popper:{placement:"top"},"open-delay":500},{default:y(()=>[g(R,{icon:"i-heroicons-arrow-down-tray",class:"mx-3",color:"primary",variant:"outline",loading:t(s),onClick:u[1]||(u[1]=()=>t(n).setupFlow(t(n).currentFlow))},{default:y(()=>[E(W(t(i)),1)]),_:1},8,["loading"])]),_:1})),!t(n).isFlowInstalled(t(o).params.name)&&t(s)?(d(),_(r,{key:1,text:"Cancel flow installation",popper:{placement:"top"},"open-delay":500},{default:y(()=>[g(R,{icon:"i-heroicons-stop",variant:"outline",color:"orange",loading:t(l),onClick:u[2]||(u[2]=()=>{l.value=!0,t(n).cancelFlowSetup(t(n).currentFlow).then(()=>{l.value=!1})})},{default:y(()=>u[22]||(u[22]=[E(" Cancel ")])),_:1},8,["loading"])]),_:1})):F("",!0),t(n).isFlowInstalled(t(o).params.name)?(d(),_(O,{key:2,items:t(b),mode:"click",label:"Actions",popper:{placement:"bottom-end"}},{default:y(()=>[g(R,{color:"white",label:"Actions","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:1},8,["items"])):F("",!0)])):(d(),j("div",Ca,[w("div",Sa,[w("div",Ia,[g(T,{name:t(n).isFlowInstalled(t(o).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),w("span",{class:Z({"text-green-500":t(n).isFlowInstalled(t(o).params.name),"text-red-500":!t(n).isFlowInstalled(t(o).params.name)})},W(t(n).isFlowInstalled(t(o).params.name)?"Installed":"Not installed"),3)]),t(n).isFlowInstalled(t(o).params.name)?F("",!0):(d(),j("div",Ra,u[23]||(u[23]=[w("p",{class:"text-orange-500"},"Only admin can manage workflows.",-1),w("span",{class:"text-slate-500"},"Ask your admin to setup this workflow",-1)])))])]))]}),key:"0"}]),1024)]),w("div",Ma,[!t(m)&&t(n).isFlowInstalled(t(o).params.name)?(d(),_(oe,{key:0,ref_key:"workflowPrompt",ref:I},null,512)):F("",!0)])]),!t(m)&&t(n).isFlowInstalled(t(o).params.name)?(d(),_(le,{key:0})):F("",!0),!t(m)&&t(n).isFlowInstalled(t(o).params.name)||t(n).flowResultsByName(t(o).params.name).length>0?(d(),_(ae,{key:1,onCopyPromptInputs:u[3]||(u[3]=K=>z(K))})):F("",!0)],64)):(d(),_(he,{key:1,class:"mb-3"})),g(X,{modelValue:t(f),"onUpdate:modelValue":u[7]||(u[7]=K=>Q(f)?f.value=K:null),"prevent-close":""},{default:y(()=>[g(D,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:y(()=>[w("div",Fa,[u[24]||(u[24]=w("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Confirm workflow deletion ",-1)),g(R,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:u[4]||(u[4]=K=>f.value=!1)})])]),default:y(()=>{var K;return[w("p",Pa,[u[25]||(u[25]=E(" Are you sure you want to delete the ")),u[26]||(u[26]=w("b",null,"private",-1)),u[27]||(u[27]=E(" workflow ")),w("b",null,W((K=t(n).currentFlow)==null?void 0:K.display_name),1),u[28]||(u[28]=E("? "))]),w("div",Ua,[g(R,{icon:"i-heroicons-x-mark-16-solid",variant:"outline",color:"green",class:"mr-2",onClick:u[5]||(u[5]=J=>f.value=!1)},{default:y(()=>u[29]||(u[29]=[E(" Cancel ")])),_:1}),g(R,{icon:"i-heroicons-trash",variant:"outline",color:"red",onClick:u[6]||(u[6]=J=>{var se;return C(t(n).currentFlow,((se=t(n).currentFlow)==null?void 0:se.private)||!1)})},{default:y(()=>u[30]||(u[30]=[E(" Delete ")])),_:1})])]}),_:1})]),_:1},8,["modelValue"]),t(N).isAdmin&&((we=t(n))!=null&&we.currentFlow)?(d(),_(ne,{key:2,show:t(x),"onUpdate:show":u[8]||(u[8]=K=>Q(x)?x.value=K:null),flow:t(n).currentFlow},null,8,["show","flow"])):F("",!0)]}),_:1})}}});export{Ea as default};
