import{_ as he}from"./BE26q0B3.js";import{a as Se,_ as we}from"./bnTHHp41.js";import{_ as _e,o as l,c as f,a as r,z as T,A as c,t as v,l as B,b as h,B as E,F as z,r as K,i as D,k as ae,h as pe,C as se,d as _,f as me,D as Ce,E as ne,G as Be,H as le,I as S,J as re,K as te,L as x,M as ie,u as Ve,N as $e,O as Ae,P as Oe,x as N,n as ue,g as Re,y as Ue,w as p,m,Q as H,R as F,S as Ie,j as Te,T as De,p as je,v as de}from"./DvtFbjfT.js";import{a as fe,_ as Me}from"./BSSmDHIs.js";import{_ as ge}from"./BPWFUSM_.js";const Ee={wrapper:"relative overflow-x-auto",base:"min-w-full table-fixed",divide:"divide-y divide-gray-300 dark:divide-gray-700",thead:"relative",tbody:"divide-y divide-gray-200 dark:divide-gray-800",caption:"sr-only",tr:{base:"",selected:"bg-gray-50 dark:bg-gray-800/50",expanded:"bg-gray-50 dark:bg-gray-800/50",active:"hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer"},th:{base:"text-left rtl:text-right",padding:"px-4 py-3.5",color:"text-gray-900 dark:text-white",font:"font-semibold",size:"text-sm"},td:{base:"whitespace-nowrap",padding:"px-4 py-4",color:"text-gray-500 dark:text-gray-400",font:"",size:"text-sm"},checkbox:{padding:"ps-4"},loadingState:{wrapper:"flex flex-col items-center justify-center flex-1 px-6 py-14 sm:px-14",label:"text-sm text-center text-gray-900 dark:text-white",icon:"w-6 h-6 mx-auto text-gray-400 dark:text-gray-500 mb-4 animate-spin"},emptyState:{wrapper:"flex flex-col items-center justify-center flex-1 px-6 py-14 sm:px-14",label:"text-sm text-center text-gray-900 dark:text-white",icon:"w-6 h-6 mx-auto text-gray-400 dark:text-gray-500 mb-4"},expand:{icon:"transform transition-transform duration-200"},progress:{wrapper:"absolute inset-x-0 -bottom-[0.5px] p-0"},default:{sortAscIcon:"i-heroicons-bars-arrow-up-20-solid",sortDescIcon:"i-heroicons-bars-arrow-down-20-solid",sortButton:{icon:"i-heroicons-arrows-up-down-20-solid",trailing:!0,square:!0,color:"gray",variant:"ghost",class:"-m-1.5"},expandButton:{icon:"i-heroicons-chevron-down",color:"gray",variant:"ghost",size:"xs",class:"-my-1.5 align-middle"},checkbox:{color:"primary"},progress:{color:"primary",animation:"carousel"},loadingState:{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},emptyState:{icon:"i-heroicons-circle-stack-20-solid",label:"No items."}}};function Fe(e){return e?e[0].toUpperCase()+e.slice(1):""}const A=Be(le.ui.strategy,le.ui.table,Ee);function Ne(e,u){return JSON.stringify(e)===JSON.stringify(u)}function ce(e,u,O){return e===u?0:O==="asc"?e<u?-1:1:e>u?-1:1}const ze=me({components:{UIcon:pe,UButton:ae,UProgress:fe,UCheckbox:ge},inheritAttrs:!1,props:{modelValue:{type:Array,default:null},by:{type:[String,Function],default:()=>Ne},rows:{type:Array,default:()=>[]},columns:{type:Array,default:null},columnAttribute:{type:String,default:"label"},sort:{type:Object,default:()=>({})},sortMode:{type:String,default:"auto"},sortButton:{type:Object,default:()=>A.default.sortButton},sortAscIcon:{type:String,default:()=>A.default.sortAscIcon},sortDescIcon:{type:String,default:()=>A.default.sortDescIcon},expandButton:{type:Object,default:()=>A.default.expandButton},expand:{type:Object,default:()=>null},loading:{type:Boolean,default:!1},loadingState:{type:Object,default:()=>A.default.loadingState},emptyState:{type:Object,default:()=>A.default.emptyState},caption:{type:String,default:null},progress:{type:Object,default:()=>A.default.progress},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},multipleExpand:{type:Boolean,default:!0}},emits:["update:modelValue","update:sort","update:expand"],setup(e,{emit:u,attrs:O}){const{ui:V,attrs:R}=Ce("table",ne(e,"ui"),A,ne(e,"class")),j=S(()=>e.columns??Object.keys(e.rows[0]??{}).map(a=>({key:a,label:Fe(a),sortable:!1,class:void 0,sort:ce}))),i=re(e,"sort",u,{passive:!0,defaultValue:te({},e.sort,{column:null,direction:"asc"})}),b=re(e,"expand",u,{passive:!0,defaultValue:te({},e.expand,{openedRows:[],row:null})}),M={column:i.value.column,direction:null},$=S(()=>{var g;if(!((g=i.value)!=null&&g.column)||e.sortMode==="manual")return e.rows;const{column:a,direction:t}=i.value;return e.rows.slice().sort((ee,ye)=>{var oe;const ve=x(ee,a),be=x(ye,a);return(((oe=j.value.find(ke=>ke.key===a))==null?void 0:oe.sort)??ce)(ve,be,t)})}),o=S({get(){return e.modelValue},set(a){u("update:modelValue",a)}}),y=a=>new Set(a.map(t=>JSON.stringify(t))),d=S(()=>e.rows.length),U=S(()=>{const a=y(o.value),t=y(e.rows);return Array.from(a).filter(g=>t.has(g)).length}),C=S(()=>!o.value||!e.rows?!1:U.value>0&&U.value<d.value),I=S(()=>U.value===d.value),Q=S(()=>e.emptyState===null?null:{...V.value.default.emptyState,...e.emptyState}),W=S(()=>e.loadingState===null?null:{...V.value.default.loadingState,...e.loadingState});function k(a,t){if(typeof e.by=="string"){const g=s(e.by);return g(a)===g(t)}return e.by(a,t)}function s(a){return t=>x(t,a)}function n(a){return e.modelValue?o.value.some(t=>k(ie(t),ie(a))):!1}function w(a){if(i.value.column===a.key){const t=!a.direction||a.direction==="asc"?"desc":"asc";i.value.direction===t?i.value=te({},M,{column:null,direction:"asc"}):i.value={column:i.value.column,direction:i.value.direction==="asc"?"desc":"asc"}}else i.value={column:a.key,direction:a.direction||"asc"}}function L(a){O.onSelect&&O.onSelect(a)}function q(){const a=[...o.value];e.rows.forEach(t=>{n(t)||a.push(t)}),o.value=a}function P(a){a?q():o.value=[]}function X(a,t){if(a)o.value.push(t);else{const g=o.value.findIndex(ee=>k(ee,t));o.value.splice(g,1)}}function J(a,t,g=""){return x(a,t,g)}function G(a){var t;return(t=b.value)!=null&&t.openedRows?b.value.openedRows.some(g=>k(g,a)):!1}function Y(a){b.value={openedRows:G(a)?b.value.openedRows.filter(t=>!k(t,a)):e.multipleExpand?[...b.value.openedRows,a]:[a],row:a}}function Z(a){if(a.sortable){if(i.value.column!==a.key)return"none";if(i.value.direction==="asc")return"ascending";if(i.value.direction==="desc")return"descending"}}return{ui:V,attrs:R,sort:i,columns:j,rows:$,selected:o,indeterminate:C,emptyState:Q,loadingState:W,isAllRowChecked:I,onChangeCheckbox:X,isSelected:n,onSort:w,onSelect:L,onChange:P,getRowData:J,toggleOpened:Y,getAriaSort:Z,isExpanded:G}}}),We=["aria-sort"],Le={key:1},Pe={key:0},Je={key:0},Ge=["colspan"],xe={key:1},He=["colspan"],Ke=["onClick"],Qe={key:0},qe={colspan:"100%"};function Xe(e,u,O,V,R,j){const i=ge,b=ae,M=fe,$=pe;return l(),f("div",E({class:e.ui.wrapper},e.attrs),[r("table",{class:c([e.ui.base,e.ui.divide])},[e.$slots.caption||e.caption?T(e.$slots,"caption",{key:0},()=>[r("caption",{class:c(e.ui.caption)},v(e.caption),3)]):B("",!0),r("thead",{class:c(e.ui.thead)},[r("tr",{class:c(e.ui.tr.base)},[e.modelValue?(l(),f("th",{key:0,scope:"col",class:c(e.ui.checkbox.padding)},[h(i,E({"model-value":e.isAllRowChecked,indeterminate:e.indeterminate},e.ui.default.checkbox,{"aria-label":"Select all",onChange:e.onChange}),null,16,["model-value","indeterminate","onChange"])],2)):B("",!0),e.expand?(l(),f("th",{key:1,scope:"col",class:c(e.ui.tr.base)},u[0]||(u[0]=[r("span",{class:"sr-only"},"Expand",-1)]),2)):B("",!0),(l(!0),f(z,null,K(e.columns,(o,y)=>(l(),f("th",{key:y,scope:"col",class:c([e.ui.th.base,e.ui.th.padding,e.ui.th.color,e.ui.th.font,e.ui.th.size,o.class]),"aria-sort":e.getAriaSort(o)},[T(e.$slots,`${o.key}-header`,{column:o,sort:e.sort,onSort:e.onSort},()=>[o.sortable?(l(),D(b,E({key:0,ref_for:!0},{...e.ui.default.sortButton||{},...e.sortButton},{icon:!e.sort.column||e.sort.column!==o.key?e.sortButton.icon||e.ui.default.sortButton.icon:e.sort.direction==="asc"?e.sortAscIcon:e.sortDescIcon,label:o[e.columnAttribute],onClick:d=>e.onSort(o)}),null,16,["icon","label","onClick"])):(l(),f("span",Le,v(o[e.columnAttribute]),1))])],10,We))),128))],2),e.loading&&e.progress?(l(),f("tr",Pe,[r("td",{colspan:0,class:c(e.ui.progress.wrapper)},[h(M,E({...e.ui.default.progress||{},...e.progress},{size:"2xs"}),null,16)],2)])):B("",!0)],2),r("tbody",{class:c(e.ui.tbody)},[e.loadingState&&e.loading&&!e.rows.length?(l(),f("tr",Je,[r("td",{colspan:e.columns.length+(e.modelValue?1:0)+(e.expand?1:0)},[T(e.$slots,"loading-state",{},()=>[r("div",{class:c(e.ui.loadingState.wrapper)},[e.loadingState.icon?(l(),D($,{key:0,name:e.loadingState.icon,class:c(e.ui.loadingState.icon),"aria-hidden":"true"},null,8,["name","class"])):B("",!0),r("p",{class:c(e.ui.loadingState.label)},v(e.loadingState.label),3)],2)])],8,Ge)])):e.emptyState&&!e.rows.length?(l(),f("tr",xe,[r("td",{colspan:e.columns.length+(e.modelValue?1:0)+(e.expand?1:0)},[T(e.$slots,"empty-state",{},()=>[r("div",{class:c(e.ui.emptyState.wrapper)},[e.emptyState.icon?(l(),D($,{key:0,name:e.emptyState.icon,class:c(e.ui.emptyState.icon),"aria-hidden":"true"},null,8,["name","class"])):B("",!0),r("p",{class:c(e.ui.emptyState.label)},v(e.emptyState.label),3)],2)])],8,He)])):(l(!0),f(z,{key:2},K(e.rows,(o,y)=>(l(),f(z,{key:y},[r("tr",{class:c([e.ui.tr.base,e.isSelected(o)&&e.ui.tr.selected,e.isExpanded(o)&&e.ui.tr.expanded,e.$attrs.onSelect&&e.ui.tr.active,o==null?void 0:o.class]),onClick:()=>e.onSelect(o)},[e.modelValue?(l(),f("td",{key:0,class:c(e.ui.checkbox.padding)},[h(i,E({"model-value":e.isSelected(o),ref_for:!0},e.ui.default.checkbox,{"aria-label":"Select row",onChange:d=>e.onChangeCheckbox(d,o),onClickCapture:se(()=>e.onSelect(o),["stop"])}),null,16,["model-value","onChange","onClickCapture"])],2)):B("",!0),e.expand?(l(),f("td",{key:1,class:c([e.ui.td.base,e.ui.td.padding,e.ui.td.color,e.ui.td.font,e.ui.td.size])},[e.$slots["expand-action"]?T(e.$slots,"expand-action",{key:0,row:o,isExpanded:e.isExpanded(o),toggle:()=>e.toggleOpened(o)}):(l(),D(b,E({key:1,disabled:o.disabledExpand,ref_for:!0},{...e.ui.default.expandButton||{},...e.expandButton},{ui:{icon:{base:[e.ui.expand.icon,e.isExpanded(o)&&"rotate-180"].join(" ")}},onClickCapture:se(d=>e.toggleOpened(o),["stop"])}),null,16,["disabled","ui","onClickCapture"]))],2)):B("",!0),(l(!0),f(z,null,K(e.columns,(d,U)=>{var C;return l(),f("td",{key:U,class:c([e.ui.td.base,e.ui.td.padding,e.ui.td.color,e.ui.td.font,e.ui.td.size,d==null?void 0:d.rowClass,(C=o[d.key])==null?void 0:C.class])},[T(e.$slots,`${d.key}-data`,{column:d,row:o,index:y,getRowData:I=>e.getRowData(o,d.key,I)},()=>[_(v(e.getRowData(o,d.key)),1)])],2)}),128))],10,Ke),e.isExpanded(o)?(l(),f("tr",Qe,[r("td",qe,[T(e.$slots,"expand",{row:o,index:y})])])):B("",!0)],64))),128))],2)],2)],16)}const Ye=_e(ze,[["render",Xe]]),Ze={class:"flex flex-col md:flex-row"},et={class:"px-5 md:w-4/5"},tt={class:"flex flex-col lg:flex-row px-3 py-3.5 border-b border-gray-200 dark:border-gray-700"},at={class:"flex"},ot={key:0,class:"flex flex-col md:flex-row items-center"},st={key:0},nt={class:"p-4 flex flex-wrap max-w-64 max-h-60 overflow-y-auto"},pt=me({__name:"workers",setup(e){Ve({title:"Workers - Visionatrix",meta:[{name:"description",content:"Workers - Visionatrix"}]});const u=$e();Ae(()=>{u.startPolling()}),Oe(()=>{u.stopPolling()});const O=[{label:"Settings",icon:"i-heroicons-cog-6-tooth-20-solid",to:"/settings"},{label:"Workers information",icon:"i-heroicons-chart-bar-16-solid",to:"/settings/workers"}],V=[{id:"worker_status",label:"Worker status",sortable:!0},{id:"id",label:"ID"},{id:"worker_id",label:"Worker ID"},{id:"worker_version",label:"Worker version",sortable:!0},{id:"last_seen",label:"Last seen",sortable:!0},{id:"tasks_to_give",label:"Tasks to give",sortable:!1},{id:"os",label:"OS",sortable:!0},{id:"version",label:"Python Version",sortable:!0},{id:"device_name",label:"Device name"},{id:"device_type",label:"Device type",sortable:!0},{id:"vram_total",label:"VRAM total",sortable:!0},{id:"vram_free",label:"VRAM free",sortable:!0},{id:"torch_vram_total",label:"Torch VRAM total",sortable:!0},{id:"torch_vram_free",label:"Torch VRAM free",sortable:!0},{id:"ram_total",label:"RAM total",sortable:!0},{id:"ram_free",label:"RAM free",sortable:!0}],R=V.map(s=>({key:s.id,label:s.label,sortable:s.sortable||!1,class:""})),j=localStorage.getItem("selectedColumns");let i=null;if(j!==null){const s=JSON.parse(j);i=R.filter(n=>s.includes(n.key)),i.sort(M)}const b=N(i||[...R]);ue(b,s=>{localStorage.setItem("selectedColumns",JSON.stringify(Object.values(R).filter(n=>s.includes(n)).map(n=>n.key))),s.sort(M)});function M(s,n){return V.findIndex(w=>w.id===s.key)-V.findIndex(w=>w.id===n.key)}const $=Re(),o=S(()=>$.flows.map(s=>({label:s.display_name,value:s.name}))),y=N([]);Ue(()=>{if($.flows.length===0){$.fetchFlows().then(()=>{y.value=[...o.value]});return}y.value=[...o.value]});const d=N(!1);function U(){d.value=!0,Promise.all(k.value.map(s=>u.setTasksToGive(s.worker_id,y.value.map(n=>n.value)))).then(()=>{de().add({title:"Tasks to give updated",description:"Tasks to give updated successfully"}),k.value=[]}).catch(()=>{de().add({title:"Failed to update tasks to give",description:"Try again"})}).finally(()=>{d.value=!1,u.loadWorkers()})}const C=N(""),I=S(()=>u.$state.workers),Q=S(()=>I.value.filter(s=>Object.values(s).some(n=>String(n).toLowerCase().includes(C.value.toLowerCase()))));function W(s){return new Date().getTime()-new Date(s.last_seen).getTime()<=12e4?"Online":"Offline"}const k=N([]);return ue(I,s=>{if(k.value.length>0){const n=k.value.map(w=>w.id);k.value=s.filter(w=>n.includes(w.id))}}),(s,n)=>{const w=he,L=Se,q=we,P=ae,X=Me,J=Te,G=De,Y=Ie,Z=Ye,a=je;return l(),D(a,{class:"lg:h-dvh"},{default:p(()=>[r("div",Ze,[h(w,{links:O,class:"md:w-1/5"}),r("div",et,[n[6]||(n[6]=r("h2",{class:"mb-3 text-xl"},"Workers",-1)),r("div",tt,[r("div",at,[h(L,{modelValue:m(b),"onUpdate:modelValue":n[0]||(n[0]=t=>H(b)?b.value=t:null),class:"mr-3",options:m(R),multiple:""},null,8,["modelValue","options"]),h(q,{modelValue:m(C),"onUpdate:modelValue":n[1]||(n[1]=t=>H(C)?C.value=t:null),placeholder:"Filter workers..."},null,8,["modelValue"])]),m(k).length>=1?(l(),f("div",ot,[h(L,{modelValue:m(y),"onUpdate:modelValue":n[2]||(n[2]=t=>H(y)?y.value=t:null),class:"mr-3 my-3 lg:mx-3 lg:my-0 w-full max-w-64",options:m(o),multiple:""},{label:p(()=>n[4]||(n[4]=[r("span",null,"Tasks to give",-1)])),_:1},8,["modelValue","options"]),h(X,{text:"Flows available for worker to get tasks"},{default:p(()=>[h(P,{icon:"i-heroicons-check-16-solid",variant:"outline",color:"cyan",size:"sm",loading:m(d),onClick:U},{default:p(()=>n[5]||(n[5]=[_(" Update tasks to give ")])),_:1},8,["loading"])]),_:1})])):B("",!0)]),h(Z,{modelValue:m(k),"onUpdate:modelValue":n[3]||(n[3]=t=>H(k)?k.value=t:null),columns:m(b),rows:m(C)===""?m(I):m(Q),loading:m(u).$state.loading},{"worker_status-data":p(({row:t})=>[h(J,{variant:"solid",color:W(t)==="Online"?"green":"red"},{default:p(()=>[_(v(W(t)),1)]),_:2},1032,["color"])]),"tasks_to_give-data":p(({row:t})=>[t.tasks_to_give.length===0?(l(),f("span",st,"All")):(l(),D(Y,{key:1,popper:{placement:"bottom"}},{panel:p(()=>[r("div",nt,[(l(!0),f(z,null,K(t.tasks_to_give,g=>(l(),D(J,{key:g,class:"mr-2 mb-2",variant:"solid",color:"cyan"},{default:p(()=>[h(G,{class:"hover:underline",to:`/workflows/${g}`},{default:p(()=>[_(v(g),1)]),_:2},1032,["to"])]),_:2},1024))),128))])]),default:p(()=>[h(P,{icon:"i-heroicons-list-bullet-16-solid",variant:"outline",color:"gray",size:"sm"},{default:p(()=>[r("span",null,v(t.tasks_to_give.length)+" selected",1)]),_:2},1024)]),_:2},1024))]),"last_seen-data":p(({row:t})=>[_(v(new Date(t.last_seen).toLocaleString()),1)]),"vram_total-data":p(({row:t})=>[_(v(("formatBytes"in s?s.formatBytes:m(F))(t.vram_total)),1)]),"vram_free-data":p(({row:t})=>[_(v(("formatBytes"in s?s.formatBytes:m(F))(t.vram_free)),1)]),"torch_vram_total-data":p(({row:t})=>[_(v(("formatBytes"in s?s.formatBytes:m(F))(t.torch_vram_total)),1)]),"torch_vram_free-data":p(({row:t})=>[_(v(("formatBytes"in s?s.formatBytes:m(F))(t.torch_vram_free)),1)]),"ram_total-data":p(({row:t})=>[_(v(("formatBytes"in s?s.formatBytes:m(F))(t.ram_total)),1)]),"ram_free-data":p(({row:t})=>[_(v(("formatBytes"in s?s.formatBytes:m(F))(t.ram_free)),1)]),_:1},8,["modelValue","columns","rows","loading"])])])]),_:1})}}});export{pt as default};
