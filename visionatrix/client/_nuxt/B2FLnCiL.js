import{_ as pe}from"./Cobi2oTA.js";import{_ as ye}from"./l7OKUoiQ.js";import{_ as _e,o as u,c as h,a as y,F as J,r as te,q as D,b as c,w as n,s as j,i as C,h as oe,l as b,t as _,v as X,x as le,f as q,y as ge,z as Y,A as ve,B as Z,C as he,D as be,E as ke,G as se,H as Ue,I as p,d as m,m as e,J as R,K,k as ae,L as Ce,M as $,u as Ie,N as xe,O as H,j as we,p as Ve}from"./DwZFWn-9.js";import{_ as Be}from"./q3Klxvd6.js";import{_ as Fe}from"./qo7O9BdX.js";import{_ as ne}from"./BO86IR0a.js";import{_ as $e}from"./CD_0AzVB.js";import"./9K8xWkoQ.js";const Me={wrapper:"relative min-w-0",ol:"flex items-center gap-x-1.5",li:"flex items-center gap-x-1.5 text-gray-500 dark:text-gray-400 text-sm leading-6 min-w-0",base:"flex items-center gap-x-1.5 group font-semibold min-w-0",label:"block truncate",icon:{base:"flex-shrink-0 w-5 h-5",active:"",inactive:""},divider:{base:"flex-shrink-0 w-5 h-5 rtl:rotate-180"},active:"text-primary-500 dark:text-primary-400",inactive:" hover:text-gray-700 dark:hover:text-gray-200",default:{divider:"i-heroicons-chevron-right-20-solid"}},ee=ve(Z.ui.strategy,Z.ui.breadcrumb,Me),ze=q({components:{UIcon:oe,ULink:le},inheritAttrs:!1,props:{links:{type:Array,default:()=>[]},divider:{type:String,default:()=>ee.default.divider},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(s){const{ui:I,attrs:f}=ge("breadcrumb",Y(s,"ui"),ee,Y(s,"class"));return{ui:I,attrs:f,getULinkProps:ke,twMerge:be,twJoin:he}}}),Se={key:1,role:"presentation"};function De(s,I,f,k,x,U){const i=oe,g=le;return u(),h("nav",X({"aria-label":"Breadcrumb",class:s.ui.wrapper},s.attrs),[y("ol",{class:D(s.ui.ol)},[(u(!0),h(J,null,te(s.links,(o,r)=>(u(),h("li",{key:r,class:D(s.ui.li)},[c(g,X({as:"span",class:[s.ui.base,r===s.links.length-1?s.ui.active:o.to?s.ui.inactive:""],"aria-current":r===s.links.length-1?"page":void 0,ref_for:!0},s.getULinkProps(o),{onClick:o.click}),{default:n(()=>[j(s.$slots,"icon",{link:o,index:r,isActive:r===s.links.length-1},()=>[o.icon?(u(),C(i,{key:0,name:o.icon,class:D(s.twMerge(s.twJoin(s.ui.icon.base,r===s.links.length-1?s.ui.icon.active:o.to?s.ui.icon.inactive:""),o.iconClass))},null,8,["name","class"])):b("",!0)]),j(s.$slots,"default",{link:o,index:r,isActive:r===s.links.length-1},()=>[o.label?(u(),h("span",{key:0,class:D(s.twMerge(s.ui.label,o.labelClass))},_(o.label),3)):b("",!0)])]),_:2},1040,["class","aria-current","onClick"]),r<s.links.length-1?j(s.$slots,"divider",{key:0},()=>[s.divider?(u(),h(J,{key:0},[s.divider.startsWith("i-")?(u(),C(i,{key:0,name:s.divider,class:D(s.ui.divider.base),role:"presentation"},null,8,["name","class"])):(u(),h("span",Se,_(s.divider),1))],64)):b("",!0)]):b("",!0)],2))),128))],2)],16)}const Ee=_e(ze,[["render",De]]),Ae={class:"orphan-models"},Le={class:"text-md font-bold"},Oe={key:0,class:"text-red-500"},Re={key:0,class:"flex justify-end items-center space-x-2 mt-3"},Pe={class:"text-gray-500 text-sm"},Ge=["href"],Te={class:"p-4 flex flex-col space-y-2 max-h-60 overflow-y-auto"},Ne={key:2,class:"text-gray-500"},je=q({__name:"OrphanModels",setup(s){const I=se();Ue(()=>{f()});function f(){I.getOrphanModelsList().then(o=>{console.debug("[DEBUG] Orphan models: ",o),U.value=o})}const k=[{key:"path",label:"Path",sortable:!0,class:""},{key:"full_path",label:"Path",sortable:!0,class:""},{key:"size",label:"Size",sortable:!0,class:""},{key:"creation_time",label:"Created time",sortable:!0,class:""},{key:"res_model",label:"Model",sortable:!0,class:""},{key:"possible_flows",label:"Possible Flows",sortable:!0,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}];function x(){console.debug("[DEBUG] Deleting orphan models: ",i),g.value=!0,Promise.all(i.value.map(o=>I.deleteOrphanModel(o.full_path,o.creation_time))).then(()=>{f(),g.value=!1,i.value=i.value.filter(o=>o.full_path!==o.full_path)}).catch(o=>{console.error("[ERROR] Failed to delete orphan models: ",o),K().add({title:"Failed to delete orphan models",description:o.details}),g.value=!1})}const U=p([]),i=p([]),g=p(!1);return(o,r)=>{const M=ae,P=Ce,G=ne;return u(),h("div",Ae,[y("h3",Le,[r[2]||(r[2]=m(" Orphan models ")),e(U).length>0?(u(),h("span",Oe,"("+_(e(U).length)+", "+_(("formatBytes"in o?o.formatBytes:e(R))(e(U).reduce((a,v)=>a+v.size,0)))+")",1)):b("",!0)]),r[5]||(r[5]=y("p",{class:"text-gray-500 text-sm"}," Orphan models are models that are not associated with any model type. They are not used in any installed flow and can be deleted. ",-1)),e(i).length>0?(u(),h("div",Re,[y("span",Pe," Selected: "+_(e(i).length)+" ("+_(("formatBytes"in o?o.formatBytes:e(R))(e(i).reduce((a,v)=>a+v.size,0)))+") ",1),c(M,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:e(g),onClick:r[0]||(r[0]=()=>{x()})},{default:n(()=>r[3]||(r[3]=[m(" Delete selected ")])),_:1},8,["loading"])])):b("",!0),e(U).length>0?(u(),C(G,{key:1,modelValue:e(i),"onUpdate:modelValue":r[1]||(r[1]=a=>$(i)?i.value=a:null),rows:e(U),columns:k,style:{"max-height":"40vh"}},{"path-data":n(({row:a})=>[m(_(a.path),1)]),"full_path-data":n(({row:a})=>[m(_(a.full_path),1)]),"size-data":n(({row:a})=>[m(_(a.size?("formatBytes"in o?o.formatBytes:e(R))(a.size):"-"),1)]),"creation_time-data":n(({row:a})=>[m(_(a.creation_time?new Date(a.creation_time*1e3).toLocaleString():"-"),1)]),"res_model-data":n(({row:a})=>[y("a",{href:a.res_model.homepage,target:"_blank",class:"text-blue-500"},_(a.res_model.name),9,Ge)]),"possible_flows-data":n(({row:a})=>[c(P,null,{panel:n(()=>[y("div",Te,[(u(!0),h(J,null,te(a.possible_flows,v=>(u(),C(M,{key:v.id,to:`/workflows/${v==null?void 0:v.name}`,variant:"soft",color:"blue",target:"_blank"},{default:n(()=>[m(_(v.name),1)]),_:2},1032,["to"]))),128))])]),default:n(()=>[c(M,{icon:"i-heroicons-chevron-down-16-solid",variant:"outline",color:"blue"},{default:n(()=>[m(_(a.possible_flows.length),1)]),_:2},1024)]),_:2},1024)]),"actions-data":n(({row:a})=>[c(M,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:e(g),disabled:a.readonly===!0,onClick:()=>{console.debug("[DEBUG] Deleting orphan model: ",a),g.value=!0,e(I).deleteOrphanModel(a.full_path,a.creation_time).then(()=>{f()}).catch(v=>{console.error("[ERROR] Failed to delete orphan model: ",v),("useToast"in o?o.useToast:e(K))().add({title:"Failed to delete orphan model",description:v.details})}).finally(()=>{g.value=!1})}},{default:n(()=>r[4]||(r[4]=[m(" Delete ")])),_:2},1032,["loading","disabled","onClick"])]),_:1},8,["modelValue","rows"])):(u(),h("span",Ne,"No orphan models found."))])}}}),He={class:"flex flex-col md:flex-row"},Je={class:"px-5 pb-5 md:w-4/5"},Ke={key:0,class:"admin-settings mb-3"},qe={class:"mt-3 mb-5"},We={key:0},Qe={key:1},Xe={class:"flex flex-row w-full md:flex-col"},Ye={class:"flex mt-3"},Ze={class:"p-4 max-h-screen"},et=["onClick"],dt=q({__name:"comfyui",setup(s){Ie({title:"ComfyUI settings - Visionatrix",meta:[{name:"description",content:"ComfyUI settings - Visionatrix"}]});const I=xe(),f=se(),k=K(),x=p(!1),U=p(!1),i=p([]),g=p("../vix_models"),o=p(""),r=H(()=>i.value.length===0?[]:o.value===""?Object.keys(i.value).map(d=>{let t=0;return i.value[d].length>0&&(t=i.value[d].reduce((B,w)=>B+(w.total_size??0),0)),{full_path:d,total_size:t,create_time:null,is_default:null,readonly:null}}):i.value[o.value]??[]),M=H(()=>{const d=[{label:"Root",to:""}];if(o.value==="")return d;const t=o.value.split("/");let B="";return t.forEach(w=>{B+=w,d.push({label:w,to:B}),B+="/"}),d}),P=H(()=>{const d=[{key:"full_path",label:"Path",sortable:!0,class:""},{key:"total_size",label:"Size",sortable:!0,class:""}];return o.value!==""&&(d.push({key:"create_time",label:"Created time",sortable:!0,class:""}),d.push({key:"actions",label:"Actions",sortable:!1,class:""})),d});function G(d){d.full_path in i.value&&(o.value=d.full_path)}const a=p(!1);function v(){a.value=!0,f.performComfyUiAutoconfig(g.value).then(d=>{"folders"in d&&(console.debug("[DEBUG] ComfyUI folders: ",d.folders),i.value=d.folders,f.loadAllSettings(),k.add({title:"Autoconfig performed",description:"Autoconfig performed successfully"}))}).catch(d=>{k.add({title:"Error performing autoconfig",description:d.details})}).finally(()=>{a.value=!1})}const L=p(null),T=p(!1),E=p(""),z=p(!1),S=p(""),A=p(!1),N=p(!1),W=p(!1),O=p(!0);return(d,t)=>{const B=pe,w=ye,V=ae,Q=Be,ie=Fe,re=we,de=Ee,ue=ne,fe=$e,ce=je,me=Ve;return u(),C(me,{class:"lg:h-dvh"},{default:n(()=>[y("div",He,[c(B,{links:e(f).links,class:"md:w-1/5"},null,8,["links"]),y("div",Je,[e(I).isAdmin?(u(),h("div",Ke,[t[21]||(t[21]=y("h3",{class:"mb-3 text-xl font-bold"},"ComfyUI settings (global)",-1)),y("div",qe,[c(ie,{size:"md",class:"py-3",label:"ComfyUI models folder",description:"Relative or absolute path to the models folders"},{default:n(()=>[e(f).settingsMap.comfyui_folders.value===""?(u(),h("div",We,[t[13]||(t[13]=y("p",{class:"text-gray-500"},"No ComfyUI folders initialized.",-1)),c(w,{modelValue:e(g),"onUpdate:modelValue":t[0]||(t[0]=l=>$(g)?g.value=l:null),placeholder:"ComfyUI folder path",class:"w-fit mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",disabled:e(a),autocomplete:"off"},null,8,["modelValue","disabled"]),c(V,{class:"mt-3",icon:"i-heroicons-cog-6-tooth-20-solid",color:"orange",loading:e(a),onClick:v},{default:n(()=>t[12]||(t[12]=[m(" Perform autoconfig ")])),_:1},8,["loading"])])):b("",!0),e(T)?(u(),h("div",Qe,[y("div",Xe,[c(w,{ref_key:"newComfyUiFolderInput",ref:L,modelValue:e(S),"onUpdate:modelValue":t[1]||(t[1]=l=>$(S)?S.value=l:null),placeholder:"External folder to use for model types",class:"w-full mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",autocomplete:"off",disable:e(z)},null,8,["modelValue","disable"]),c(w,{modelValue:e(E),"onUpdate:modelValue":t[2]||(t[2]=l=>$(E)?E.value=l:null),placeholder:"Folder Name (model type, e.g. checkpoints, loras, vae)",class:"w-full mt-3",type:"text",size:"sm",icon:"i-heroicons-folder-16-solid",autocomplete:"off",disable:e(z)},null,8,["modelValue","disable"]),c(Q,{modelValue:e(A),"onUpdate:modelValue":t[3]||(t[3]=l=>$(A)?A.value=l:null),class:"mt-3",label:"Is default"},null,8,["modelValue"])]),y("div",Ye,[c(V,{class:"mr-2",color:"white",icon:"i-heroicons-x-mark",variant:"outline",disabled:e(z),onClick:t[4]||(t[4]=()=>{T.value=!1,S.value="",E.value="",A.value=!1})},{default:n(()=>t[14]||(t[14]=[m(" Cancel ")])),_:1},8,["disabled"]),c(V,{icon:"i-heroicons-check-16-solid",loading:e(z),onClick:t[5]||(t[5]=()=>{e(S)!==""&&(z.value=!0,e(f).addComfyUiFolder(e(E),e(S),e(A)).then(l=>{"folders"in l&&(console.debug("[DEBUG] ComfyUI folders: ",l.folders),i.value=l.folders,e(k).add({title:"ComfyUI folder added",description:"ComfyUI folder added successfully"}))}).catch(l=>{e(k).add({title:"Error adding ComfyUI folder",description:l.details})}).finally(()=>{z.value=!1}))})},{default:n(()=>t[15]||(t[15]=[m(" Add ")])),_:1},8,["loading"])])])):b("",!0),e(f).settingsMap.comfyui_folders.value!==""?(u(),C(V,{key:2,class:"mt-3",icon:"i-heroicons-folder-16-solid",color:"cyan",onClick:t[6]||(t[6]=()=>{e(f).getComfyUiFolderListing().then(l=>{console.debug("[DEBUG] ComfyUI folders: ",l),i.value=l.folders}),x.value=!0})},{default:n(()=>t[16]||(t[16]=[m(" Show ComfyUI folders ")])),_:1})):b("",!0),e(f).settingsMap.comfyui_folders.value!==""?(u(),C(V,{key:3,class:"mt-3 ml-2",color:"white",variant:"outline",icon:"i-heroicons-folder-plus-16-solid",onClick:t[7]||(t[7]=()=>{T.value=!0,d.$nextTick(()=>{e(L)&&e(L).$refs.input.focus()})})},{default:n(()=>t[17]||(t[17]=[m(" Add ComfyUI folder ")])),_:1})):b("",!0),e(f).settingsMap.comfyui_folders.value!==""?(u(),C(V,{key:4,class:"mt-3 ml-2",color:"red",variant:"outline",icon:"i-heroicons-trash-16-solid",onClick:t[8]||(t[8]=()=>{W.value=!0,e(f).saveGlobalSetting(e(f).settingsMap.comfyui_folders.key,"",e(f).settingsMap.comfyui_folders.sensitive).then(()=>{e(k).add({title:"ComfyUI folders reset",description:"ComfyUI folders reset successfully"}),e(f).settingsMap.comfyui_folders.value=""}).catch(l=>{e(k).add({title:"Error resetting ComfyUI folders",description:l.details})}).finally(()=>{W.value=!1})})},{default:n(()=>t[18]||(t[18]=[m(" Reset ComfyUI folders ")])),_:1})):b("",!0)]),_:1}),e(f).settingsMap.comfyui_folders.value!==""?(u(),C(fe,{key:0,modelValue:e(x),"onUpdate:modelValue":t[11]||(t[11]=l=>$(x)?x.value=l:null),class:"z-[90]",fullscreen:""},{default:n(()=>[c(V,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:t[9]||(t[9]=()=>x.value=!1)}),y("div",Ze,[t[20]||(t[20]=y("h3",{class:"text-xl text-center"},"ComfyUI folders",-1)),y("div",null,[c(Q,{modelValue:e(O),"onUpdate:modelValue":t[10]||(t[10]=l=>$(O)?O.value=l:null),class:"mt-3",label:"Hide empty folders"},null,8,["modelValue"])]),c(de,{links:e(M),class:"my-2"},{default:n(({link:l,isActive:F})=>[c(re,{color:F?"primary":"gray",class:"rounded-full truncate cursor-pointer select-none",onClick:()=>{o.value=l.to}},{default:n(()=>[m(_(l.label),1)]),_:2},1032,["color","onClick"])]),_:1},8,["links"]),c(ue,{loading:e(U),"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},rows:e(r).filter(l=>e(O)?l.total_size>0:!0),columns:e(P),style:{"max-height":"80vh"}},{"full_path-data":n(({row:l})=>[y("span",{class:D({"text-blue-500":l.full_path in e(i),"cursor-pointer":l.full_path in e(i)}),onClick:()=>G(l)},_(l.full_path),11,et)]),"total_size-data":n(({row:l})=>[m(_(l.total_size?("formatBytes"in d?d.formatBytes:e(R))(l.total_size):"-"),1)]),"create_time-data":n(({row:l})=>[m(_(l.create_time&&new Date(l.create_time).getTime()!==0?new Date(l.create_time).toLocaleString():"-"),1)]),"actions-data":n(({row:l})=>[c(V,{icon:"i-heroicons-trash-16-solid",variant:"outline",color:"red",loading:e(N),disabled:l.readonly===!0,onClick:()=>{N.value=!0,e(f).deleteComfyUiFolder(e(o),l.full_path).then(F=>{"folders"in F&&(console.debug("[DEBUG] ComfyUI folders: ",F.folders),i.value=F.folders,e(k).add({title:"ComfyUI folder removed",description:"ComfyUI folder removed successfully"}),e(i)[e(o)]||(o.value=""))}).catch(F=>{e(k).add({title:"Error removing ComfyUI folder",description:F.details})}).finally(()=>{N.value=!1})}},{default:n(()=>t[19]||(t[19]=[m(" Remove ")])),_:2},1032,["loading","disabled","onClick"])]),_:1},8,["loading","rows","columns"])])]),_:1},8,["modelValue"])):b("",!0)]),c(ce,{class:"mt-3"})])):b("",!0)])])]),_:1})}}});export{dt as default};
