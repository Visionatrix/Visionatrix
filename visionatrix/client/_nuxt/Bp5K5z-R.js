import{_ as I}from"./CdcNHNMB.js";import{_ as O}from"./CoPS4-uO.js";import{f as G,u as L,q as B,y as E,s as P,g as N,N as V,v as $,M as T,i as f,w as a,A as q,o as m,a as s,b as t,p as o,c as U,k as g,m as D,d as u,O as C}from"./SidhCDAO.js";import{_ as R}from"./IbXq_Slx.js";import{_ as H}from"./BiPqcjRV.js";import{_ as j}from"./BwJ2dk7r.js";import{_ as K}from"./fD9EDxaN.js";import{_ as J}from"./Dz1-33OA.js";const Q={class:"flex flex-col md:flex-row"},W={class:"px-5 pb-5 md:w-4/5"},X={key:0,class:"admin-settings mb-3"},Y={class:"flex items-center relative"},Z={class:"flex items-center relative"},ee={class:"flex items-center relative"},oe={class:"flex items-center"},le={class:"flex items-center relative"},te={class:"flex w-full items-center my-2"},ie={class:"flex w-full items-center my-2"},se={class:"flex items-center"},ae={class:"flex items-center"},ne={key:1,class:"mb-5 py-4"},re={class:"flex items-center space-x-3"},de={class:"user-settings mb-3"},ue={class:"flex items-center relative"},he=G({__name:"index",setup(pe){L({title:"Settings - Visionatrix",meta:[{name:"description",content:"Settings - Visionatrix"}]});const h=B(),l=E(),v=P();function z(){console.debug("Saving settings",l.settingsMap),Promise.all(Object.keys(l.settingsMap).map(r=>l.settingsMap[r].admin&&h.isAdmin?l.saveGlobalSetting(l.settingsMap[r].key,l.settingsMap[r].value,l.settingsMap[r].sensitive):l.saveUserSetting(l.settingsMap[r].key,l.settingsMap[r].value))).then(()=>{v.add({title:"Settings saved",description:"Settings saved successfully"})}).catch(r=>{v.add({title:"Error saving setting",description:r.message})})}const _=N(),w=V(null),x=V(!1);function S(){const r=w.value.$refs.input.files[0]||null;if(!r){v.add({title:"No file selected",description:"Please select a file to upload"});return}x.value=!0,_.uploadFlow(r).then(e=>{if(console.debug("uploadFlow",e),e&&"detail"in e&&(e==null?void 0:e.detail)!==""){v.add({title:"Error uploading flow",description:e.detail});return}else v.add({title:"Flow uploaded",description:"Flow uploaded successfully"});w.value.$refs.input.value=""}).catch(e=>{console.debug("uploadFlow error",e),v.add({title:"Error uploading flow",description:e.message})}).finally(()=>{x.value=!1})}$(()=>_.outputMaxSize,()=>{_.saveUserOptions()}),T(()=>{l.loadAllSettings()});const n=V({huggingface_auth_token:!1,civitai_auth_token:!1,google_api_key:!1,google_api_key_user:!1,google_proxy:!1});return(r,e)=>{const A=I,c=O,d=D,p=R,y=H,k=j,b=K,M=J,F=q;return m(),f(F,{class:"lg:h-dvh"},{default:a(()=>[s("div",Q,[t(A,{links:o(l).links,class:"md:w-1/5"},null,8,["links"]),s("div",W,[o(h).isAdmin?(m(),U("div",X,[e[31]||(e[31]=s("h3",{class:"mb-3 text-xl font-bold"},"Admin preferences (global settings)",-1)),t(p,{size:"md",class:"py-3",label:"Huggingface Auth token",description:"Bearer authentication token from your Huggingface account to allow downloading gated models with limited access."},{default:a(()=>[s("div",Y,[t(c,{modelValue:o(l).settingsMap.huggingface_auth_token.value,"onUpdate:modelValue":e[0]||(e[0]=i=>o(l).settingsMap.huggingface_auth_token.value=i),placeholder:"Huggingface Auth token",class:"w-full",type:o(n).huggingface_auth_token?"text":"password",icon:"i-heroicons-shield-check",size:"md",autocomplete:"off"},null,8,["modelValue","type"]),t(d,{icon:o(n).huggingface_auth_token?"i-heroicons-eye-slash-solid":"i-heroicons-eye-solid",variant:"ghost",color:"white",class:"ml-1 absolute right-1",onClick:e[1]||(e[1]=()=>{o(n).huggingface_auth_token=!o(n).huggingface_auth_token})},null,8,["icon"])])]),_:1}),t(p,{size:"md",class:"py-3",label:"CivitAI Auth Token",description:"Auth token for CivitAI flows and models."},{default:a(()=>[s("div",Z,[t(c,{modelValue:o(l).settingsMap.civitai_auth_token.value,"onUpdate:modelValue":e[2]||(e[2]=i=>o(l).settingsMap.civitai_auth_token.value=i),placeholder:"CivitAI Auth Token",class:"w-full",type:o(n).civitai_auth_token?"text":"password",icon:"i-heroicons-shield-check",size:"md",autocomplete:"off"},null,8,["modelValue","type"]),t(d,{icon:o(n).civitai_auth_token?"i-heroicons-eye-slash-solid":"i-heroicons-eye-solid",variant:"ghost",color:"white",class:"ml-1 absolute right-1",onClick:e[3]||(e[3]=()=>{o(n).civitai_auth_token=!o(n).civitai_auth_token})},null,8,["icon"])])]),_:1}),t(y,{color:"blue",variant:"soft",icon:"i-heroicons-exclamation-circle",title:"Note"},{description:a(()=>e[26]||(e[26]=[u(" Access tokens are required for gated models. More information can be found "),s("a",{class:"hover:underline font-bold",href:"https://visionatrix.github.io/VixFlowsDocs/FlowsDeveloping/gated_models/",target:"_blank"},"here",-1),u(". ")])),_:1}),t(k,{class:"mt-3",label:"Gemini"}),e[32]||(e[32]=s("p",{class:"text-slate text-sm text-orange-300 dark:text-orange-100 text-center"},"Can be used by flows and as a translation provider",-1)),t(p,{size:"md",class:"py-3",label:"Google API key"},{description:a(()=>e[27]||(e[27]=[u(" Global Google API key, required for Flows, e.g. where ComfyUI-Gemini Node is used. Instruction how to obtain key can be found "),s("a",{class:"hover:underline font-bold",href:"https://ai.google.dev/gemini-api/docs/api-key"},"here",-1),u(". ")])),default:a(()=>[s("div",ee,[t(c,{modelValue:o(l).settingsMap.google_api_key.value,"onUpdate:modelValue":e[4]||(e[4]=i=>o(l).settingsMap.google_api_key.value=i),placeholder:"Google API key",class:"w-full",type:o(n).google_api_key?"text":"password",icon:"i-heroicons-shield-check",size:"md",autocomplete:"off"},null,8,["modelValue","type"]),t(d,{icon:o(n).google_api_key?"i-heroicons-eye-slash-solid":"i-heroicons-eye-solid",variant:"ghost",color:"white",class:"ml-1 absolute right-1",onClick:e[5]||(e[5]=()=>{o(n).google_api_key=!o(n).google_api_key})},null,8,["icon"])])]),_:1}),t(p,{size:"md",class:"py-3",label:"Gemini model",description:"Override Gemini model to use."},{default:a(()=>[s("div",oe,[t(b,{modelValue:o(l).settingsMap.gemini_model.value,"onUpdate:modelValue":e[6]||(e[6]=i=>o(l).settingsMap.gemini_model.value=i),color:"white",variant:"outline",placeholder:"Select Gemini model",options:o(l).settingsMap.gemini_model.options},null,8,["modelValue","options"]),o(l).settingsMap.gemini_model.value?(m(),f(d,{key:0,icon:"i-heroicons-x-mark",variant:"outline",color:"white",class:"ml-2",onClick:e[7]||(e[7]=()=>o(l).settingsMap.gemini_model.value="")})):g("",!0)])]),_:1}),t(p,{size:"md",class:"py-3",label:"Proxy (for Google)"},{description:a(()=>e[28]||(e[28]=[u(" Proxy to access Gemini configuration "),s("a",{class:"hover:underline font-bold",href:"https://visionatrix.github.io/VixFlowsDocs/AdminManual/Installation/proxy_gemini/"},"string",-1),u(". ")])),default:a(()=>[s("div",le,[t(c,{modelValue:o(l).settingsMap.google_proxy.value,"onUpdate:modelValue":e[8]||(e[8]=i=>o(l).settingsMap.google_proxy.value=i),placeholder:"Proxy",class:"w-full",type:o(n).google_proxy?"text":"password",size:"md",icon:"i-heroicons-shield-check",autocomplete:"off"},null,8,["modelValue","type"]),t(d,{icon:o(n).google_proxy?"i-heroicons-eye-slash-solid":"i-heroicons-eye-solid",variant:"ghost",color:"white",class:"ml-1 absolute right-1",onClick:e[9]||(e[9]=()=>{o(n).google_proxy=!o(n).google_proxy})},null,8,["icon"])])]),_:1}),t(k,{class:"mt-3",label:"Ollama"}),e[33]||(e[33]=s("p",{class:"text-slate text-sm text-orange-300 dark:text-orange-100 text-center"},"Can be used by flows and as a translation provider",-1)),t(p,{size:"md",class:"py-3",label:"Ollama URL",description:"URL to server where Ollama is running."},{default:a(()=>[t(c,{modelValue:o(l).settingsMap.ollama_url.value,"onUpdate:modelValue":e[10]||(e[10]=i=>o(l).settingsMap.ollama_url.value=i),placeholder:"Ollama URL",class:"w-full",type:"text",size:"md",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(p,{size:"md",class:"py-3",label:"Ollama Vision Model",description:"Override Ollama Vision model used by default."},{default:a(()=>[o(l).ollamaFetchError!==""?(m(),f(y,{key:0,color:"red",variant:"soft",icon:"i-heroicons-exclamation-circle",title:"Error fetching Ollama models list. Try again later",description:o(l).ollamaFetchError},{actions:a(()=>[t(d,{icon:"i-heroicons-arrow-path-solid",variant:"outline",color:"white",onClick:e[11]||(e[11]=()=>o(l).getOllamaModelsList())},{default:a(()=>e[29]||(e[29]=[u(" Retry ")])),_:1})]),_:1},8,["description"])):g("",!0),s("div",te,[t(M,{modelValue:o(l).settingsMap.ollama_vision_model.value,"onUpdate:modelValue":e[12]||(e[12]=i=>o(l).settingsMap.ollama_vision_model.value=i),class:"w-full",options:o(l).settingsMap.ollama_vision_model.options.map(i=>(i.label=`${i.model} (${("formatBytes"in r?r.formatBytes:o(C))(i.size)})`,i)),"value-attribute":"model",loading:o(l).settingsMap.ollama_vision_model.loading,placeholder:"Ollama Vision Model"},null,8,["modelValue","options","loading"]),o(l).settingsMap.ollama_vision_model.value?(m(),f(d,{key:0,icon:"i-heroicons-x-mark",variant:"outline",color:"white",class:"ml-2",onClick:e[13]||(e[13]=()=>o(l).settingsMap.ollama_vision_model.value="")})):g("",!0)])]),_:1}),t(p,{size:"md",class:"py-3",label:"Ollama LLM Model",description:"Override Ollama LLM model used by default."},{default:a(()=>[o(l).ollamaFetchError!==""?(m(),f(y,{key:0,color:"red",variant:"soft",icon:"i-heroicons-exclamation-circle",title:"Error fetching Ollama models list. Try again later",description:o(l).ollamaFetchError},{actions:a(()=>[t(d,{icon:"i-heroicons-arrow-path-solid",variant:"outline",color:"white",onClick:e[14]||(e[14]=()=>o(l).getOllamaModelsList())},{default:a(()=>e[30]||(e[30]=[u(" Retry ")])),_:1})]),_:1},8,["description"])):g("",!0),s("div",ie,[t(M,{modelValue:o(l).settingsMap.ollama_llm_model.value,"onUpdate:modelValue":e[15]||(e[15]=i=>o(l).settingsMap.ollama_llm_model.value=i),class:"w-full",options:o(l).settingsMap.ollama_llm_model.options.map(i=>(i.label=`${i.model} (${("formatBytes"in r?r.formatBytes:o(C))(i.size)})`,i)),"value-attribute":"model",loading:o(l).settingsMap.ollama_llm_model.loading,placeholder:"Ollama LLM Model"},null,8,["modelValue","options","loading"]),o(l).settingsMap.ollama_llm_model.value?(m(),f(d,{key:0,icon:"i-heroicons-x-mark",variant:"outline",color:"white",class:"ml-2",onClick:e[16]||(e[16]=()=>o(l).settingsMap.ollama_llm_model.value="")})):g("",!0)])]),_:1}),t(p,{size:"md",class:"py-3",label:"Ollama Keepalive",description:"Keep models in memory for specified minutes (e.g. 0.5 for 30 seconds). 0 unloads immediately; negative numbers keep indefinitely"},{default:a(()=>[t(c,{modelValue:o(l).settingsMap.ollama_keepalive.value,"onUpdate:modelValue":e[17]||(e[17]=i=>o(l).settingsMap.ollama_keepalive.value=i),placeholder:"Ollama Keepalive",class:"w-fit",type:"number",size:"md",step:"0.1",autocomplete:"off",onChange:e[18]||(e[18]=()=>{o(l).settingsMap.ollama_keepalive.value=o(l).settingsMap.ollama_keepalive.value.toString()})},null,8,["modelValue"])]),_:1}),t(k,{class:"mt-3",label:"AI providers"}),t(p,{size:"md",class:"py-3",label:"Translations provider",description:"Prompt translations provider. Empty if not enabled."},{default:a(()=>[s("div",se,[t(b,{modelValue:o(l).settingsMap.translations_provider.value,"onUpdate:modelValue":e[19]||(e[19]=i=>o(l).settingsMap.translations_provider.value=i),color:"white",variant:"outline",placeholder:"Select translations provider",options:o(l).settingsMap.translations_provider.options},null,8,["modelValue","options"]),o(l).settingsMap.translations_provider.value?(m(),f(d,{key:0,icon:"i-heroicons-x-mark",variant:"outline",color:"white",class:"ml-2",onClick:e[20]||(e[20]=()=>o(l).settingsMap.translations_provider.value="")})):g("",!0)])]),_:1}),t(p,{size:"md",class:"py-3",label:"LLM provider",description:"LLM  provider. Empty if not enabled."},{default:a(()=>[s("div",ae,[t(b,{modelValue:o(l).settingsMap.llm_provider.value,"onUpdate:modelValue":e[21]||(e[21]=i=>o(l).settingsMap.llm_provider.value=i),color:"white",variant:"outline",placeholder:"Select LLM provider",options:o(l).settingsMap.llm_provider.options},null,8,["modelValue","options"]),o(l).settingsMap.llm_provider.value?(m(),f(d,{key:0,icon:"i-heroicons-x-mark",variant:"outline",color:"white",class:"ml-2",onClick:e[22]||(e[22]=()=>o(l).settingsMap.llm_provider.value="")})):g("",!0)])]),_:1})])):g("",!0),o(h).isAdmin?(m(),U("div",ne,[e[36]||(e[36]=s("h4",{class:"mb-3 font-bold"},"Upload Flow",-1)),e[37]||(e[37]=s("p",{class:"text-gray-400 text-sm mb-3"}," Upload a Visionatrix workflow file (.json) to add it to the available flows. Upon successful upload of a valid workflow file, the installation will start automatically. ",-1)),s("div",re,[t(c,{ref_key:"flowFileInput",ref:w,type:"file",accept:".json",class:"w-auto"},null,512),t(d,{icon:"i-heroicons-arrow-up-tray-16-solid",variant:"outline",loading:o(x),onClick:S},{default:a(()=>e[34]||(e[34]=[u(" Upload Flow ")])),_:1},8,["loading"])]),t(y,{class:"mt-3",color:"blue",variant:"soft",icon:"i-heroicons-exclamation-circle",title:"Note"},{description:a(()=>e[35]||(e[35]=[u(" Requires a Visionatrix-adapted ComfyUI workflow, not a standard ComfyUI workflow. Instructions for adapting a ComfyUI workflow for Visionatrix are available "),s("a",{class:"hover:underline font-bold",href:"https://visionatrix.github.io/VixFlowsDocs/FlowsDeveloping/comfyui_vix_migration/"},"here",-1),u(". Custom workflows may require manual installation of dependencies (e.g., custom nodes) before upload. ")])),_:1})])):g("",!0),s("div",de,[e[39]||(e[39]=s("h3",{class:"mb-3 text-xl font-bold"},"User preferences (overrides global)",-1)),t(p,{size:"md",class:"py-3",label:"Google API key"},{description:a(()=>e[38]||(e[38]=[u(" Google API key, required for Flows, e.g. where ComfyUI-Gemini Node is used. Instruction how to obtain key "),s("a",{class:"hover:underline font-bold",href:"https://ai.google.dev/gemini-api/docs/api-key"},"here",-1),u(". ")])),default:a(()=>[s("div",ue,[t(c,{modelValue:o(l).settingsMap.google_api_key_user.value,"onUpdate:modelValue":e[23]||(e[23]=i=>o(l).settingsMap.google_api_key_user.value=i),placeholder:"Google API key",class:"w-full",type:o(n).google_api_key_user?"text":"password",icon:"i-heroicons-shield-check",size:"md",autocomplete:"off"},null,8,["modelValue","type"]),t(d,{icon:o(n).google_api_key_user?"i-heroicons-eye-slash-solid":"i-heroicons-eye-solid",variant:"ghost",color:"white",class:"ml-1 absolute right-1",onClick:e[24]||(e[24]=()=>{o(n).google_api_key_user=!o(n).google_api_key_user})},null,8,["icon"])])]),_:1}),t(k,{class:"mt-3",label:"UI preferences"}),e[40]||(e[40]=s("p",{class:"text-slate text-sm text-orange-300 dark:text-orange-100 text-center"},"Stored in browser local storage",-1)),t(p,{size:"md",class:"py-3",label:"Outputs maximum image size",description:"To keep the output seamless, we limit the size of the outputs (512px by default)."},{default:a(()=>[t(M,{modelValue:o(_).$state.outputMaxSize,"onUpdate:modelValue":e[25]||(e[25]=i=>o(_).$state.outputMaxSize=i),options:["512","768","1024","1536","2048"]},null,8,["modelValue"])]),_:1})]),t(d,{icon:"i-heroicons-check-16-solid",onClick:z},{default:a(()=>e[41]||(e[41]=[u(" Save ")])),_:1})])])]),_:1})}}});export{he as default};
