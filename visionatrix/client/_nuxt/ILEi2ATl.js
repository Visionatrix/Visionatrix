import{B as rt,W as Bt,C as Ie,_ as ut,f as te,c as j,o as d,a as h,D as Oe,E as Re,n as le,H as dt,I as qe,N as $,X as ct,S as Me,v as ge,Y as Lt,x as L,K as Ze,J as Ve,Z as At,$ as qt,a0 as wt,a1 as st,a2 as Et,a3 as Dt,a4 as ht,a5 as Ee,a6 as xt,a7 as Wt,p as t,a8 as Ht,a9 as mt,aa as Gt,ab as _t,ac as Te,ad as Fe,g as me,M as et,T as $t,ae as Ae,i as S,k as R,w as y,b as m,F as ne,r as fe,m as ie,d as E,P as G,af as Xt,s as xe,ag as Jt,t as Q,ah as tt,Q as Ct,j as We,q as ft,z as Qt,O as je,h as _e,y as St,ai as It,l as He,aj as pt,ak as Kt,al as Yt,am as Zt,R as it,an as Mt,ao as Rt,ap as ce,aq as Ft,ar as el,G as tl,as as Ut,at as ll,A as ol,au as nl}from"./DwlIkt4G.js";import{b as lt,a as al,_ as Pt}from"./CLYfsUKB.js";import{u as zt,_ as Ne}from"./CpDxv-iy.js";import{_ as sl}from"./DCLZMqLy.js";import{_ as Be}from"./DBbeq2nF.js";import{_ as $e,a as il}from"./BIWbjSJ0.js";import{_ as ot}from"./CzF4x5ex.js";import{a as Ge,_ as Vt}from"./Dbm7pC5F.js";import{_ as gt}from"./C_O8Omup.js";import{_ as rl}from"./lZ_9sYDy.js";import{_ as ul}from"./D_jiIldE.js";const dl={wrapper:"relative",container:"relative w-full flex overflow-x-auto snap-x snap-mandatory scroll-smooth",item:"flex flex-none snap-center",arrows:{wrapper:"flex items-center justify-between"},indicators:{wrapper:"absolute flex items-center justify-center gap-3 bottom-4 inset-x-0",base:"rounded-full h-3 w-3",active:"bg-primary-500 dark:bg-primary-400",inactive:"bg-gray-100 dark:bg-gray-800"},default:{prevButton:{color:"black",class:"rtl:[&_span:first-child]:rotate-180 absolute start-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-left-20-solid"},nextButton:{color:"black",class:"rtl:[&_span:last-child]:rotate-180 absolute end-4 top-1/2 transform -translate-y-1/2 rounded-full",icon:"i-heroicons-chevron-right-20-solid"}}},cl={wrapper:"relative w-full flex items-center",base:"w-full absolute appearance-none cursor-pointer disabled:cursor-not-allowed disabled:bg-opacity-50 focus:outline-none peer group",rounded:"rounded-lg",background:"bg-transparent",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",progress:{base:"absolute pointer-events-none peer-disabled:bg-opacity-50",rounded:"rounded-s-lg",background:"bg-{color}-500 dark:bg-{color}-400",size:{"2xs":"h-px",xs:"h-0.5",sm:"h-1",md:"h-2",lg:"h-3",xl:"h-4","2xl":"h-5"}},thumb:{base:"[&::-webkit-slider-thumb]:relative [&::-moz-range-thumb]:relative [&::-webkit-slider-thumb]:z-[1] [&::-moz-range-thumb]:z-[1] [&::-webkit-slider-thumb]:appearance-none [&::-moz-range-thumb]:appearance-none [&::-webkit-slider-thumb]:rounded-full [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:border-0",color:"text-{color}-500 dark:text-{color}-400",background:"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:dark:bg-gray-900 [&::-moz-range-thumb]:bg-current",ring:"[&::-webkit-slider-thumb]:ring-2 [&::-webkit-slider-thumb]:ring-current",size:{"2xs":"[&::-webkit-slider-thumb]:h-1.5 [&::-moz-range-thumb]:h-1.5 [&::-webkit-slider-thumb]:w-1.5 [&::-moz-range-thumb]:w-1.5 [&::-webkit-slider-thumb]:mt-[-2.5px] [&::-moz-range-thumb]:mt-[-2.5px]",xs:"[&::-webkit-slider-thumb]:h-2 [&::-moz-range-thumb]:h-2 [&::-webkit-slider-thumb]:w-2 [&::-moz-range-thumb]:w-2 [&::-webkit-slider-thumb]:mt-[-3px] [&::-moz-range-thumb]:mt-[-3px]",sm:"[&::-webkit-slider-thumb]:h-3 [&::-moz-range-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-moz-range-thumb]:w-3 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",md:"[&::-webkit-slider-thumb]:h-4 [&::-moz-range-thumb]:h-4 [&::-webkit-slider-thumb]:w-4 [&::-moz-range-thumb]:w-4 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",lg:"[&::-webkit-slider-thumb]:h-5 [&::-moz-range-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 [&::-moz-range-thumb]:w-5 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1",xl:"[&::-webkit-slider-thumb]:h-6 [&::-moz-range-thumb]:h-6 [&::-webkit-slider-thumb]:w-6 [&::-moz-range-thumb]:w-6 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1","2xl":"[&::-webkit-slider-thumb]:h-7 [&::-moz-range-thumb]:h-7 [&::-webkit-slider-thumb]:w-7 [&::-moz-range-thumb]:w-7 [&::-webkit-slider-thumb]:-mt-1 [&::-moz-range-thumb]:-mt-1"}},track:{base:"[&::-webkit-slider-runnable-track]:group-disabled:bg-opacity-50 [&::-moz-range-track]:group-disabled:bg-opacity-50",background:"[&::-webkit-slider-runnable-track]:bg-gray-200 [&::-moz-range-track]:bg-gray-200 [&::-webkit-slider-runnable-track]:dark:bg-gray-700 [&::-moz-range-track]:dark:bg-gray-700",rounded:"[&::-webkit-slider-runnable-track]:rounded-lg [&::-moz-range-track]:rounded-lg",size:{"2xs":"[&::-webkit-slider-runnable-track]:h-px [&::-moz-range-track]:h-px",xs:"[&::-webkit-slider-runnable-track]:h-0.5 [&::-moz-range-track]:h-0.5",sm:"[&::-webkit-slider-runnable-track]:h-1 [&::-moz-range-track]:h-1",md:"[&::-webkit-slider-runnable-track]:h-2 [&::-moz-range-track]:h-2",lg:"[&::-webkit-slider-runnable-track]:h-3 [&::-moz-range-track]:h-3",xl:"[&::-webkit-slider-runnable-track]:h-4 [&::-moz-range-track]:h-4","2xl":"[&::-webkit-slider-runnable-track]:h-5 [&::-moz-range-track]:h-5"}},size:{"2xs":"h-1.5",xs:"h-2",sm:"h-3",md:"h-4",lg:"h-5",xl:"h-6","2xl":"h-7"},default:{size:"md",color:"primary"}},Se=rt(Ie.ui.strategy,Ie.ui.textarea,Bt),ml=te({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys(Se.size).includes(e)}},color:{type:String,default:()=>Se.default.color,validator(e){return[...Ie.ui.colors,...Object.keys(Se.color)].includes(e)}},variant:{type:String,default:()=>Se.default.variant,validator(e){return[...Object.keys(Se.variant),...Object.values(Se.color).flatMap(l=>Object.keys(l))].includes(e)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:l}){const{ui:o,attrs:i}=dt("textarea",qe(e,"ui"),Se,qe(e,"class")),{emitFormBlur:r,emitFormInput:a,inputId:u,color:c,size:p,name:_}=zt(e,Se),w=$(ct({},e.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),x=$(null),I=()=>{var v;e.autofocus&&((v=x.value)==null||v.focus())},F=()=>{if(e.autoresize){if(!x.value)return;x.value.rows=e.rows;const v=x.value.style.overflow;x.value.style.overflow="hidden";const C=window.getComputedStyle(x.value),q=Number.parseInt(C.paddingTop),B=Number.parseInt(C.paddingBottom),b=q+B,D=Number.parseInt(C.lineHeight),{scrollHeight:n}=x.value,s=(n-b)/D;s>e.rows&&(x.value.rows=e.maxrows?Math.min(s,e.maxrows):s),x.value.style.overflow=v}},k=v=>{w.value.trim&&(v=v.trim()),w.value.number&&(v=At(v)),w.value.nullify&&(v||(v=null)),l("update:modelValue",v),a()},U=v=>{F(),w.value.lazy||k(v.target.value)},O=v=>{const C=v.target.value;l("change",C),w.value.lazy&&k(C),w.value.trim&&(v.target.value=C.trim())},P=v=>{l("blur",v),r()};Me(()=>{setTimeout(()=>{I()},e.autofocusDelay)}),ge(()=>e.modelValue,()=>{Lt(F)}),Me(()=>{setTimeout(()=>{I(),F()},100)});const f=L(()=>{var C,q;const v=((q=(C=o.value.color)==null?void 0:C[c.value])==null?void 0:q[e.variant])||o.value.variant[e.variant];return Ze(Ve(o.value.base,o.value.form,o.value.rounded,o.value.placeholder,o.value.size[p.value],e.padded?o.value.padding[p.value]:"p-0",v==null?void 0:v.replaceAll("{color}",c.value),!e.resize&&"resize-none"),e.textareaClass)});return{ui:o,attrs:i,name:_,inputId:u,textarea:x,textareaClass:f,onInput:U,onChange:O,onBlur:P}}}),fl=["id","value","name","rows","required","disabled","placeholder"];function pl(e,l,o,i,r,a){return d(),j("div",{class:le(e.ui.wrapper)},[h("textarea",Re({id:e.inputId,ref:"textarea",value:e.modelValue,name:e.name,rows:e.rows,required:e.required,disabled:e.disabled,placeholder:e.placeholder,class:e.textareaClass},e.attrs,{onInput:l[0]||(l[0]=(...u)=>e.onInput&&e.onInput(...u)),onBlur:l[1]||(l[1]=(...u)=>e.onBlur&&e.onBlur(...u)),onChange:l[2]||(l[2]=(...u)=>e.onChange&&e.onChange(...u))}),null,16,fl),Oe(e.$slots,"default")],2)}const jt=ut(ml,[["render",pl]]);async function gl(e,l){return await vl(l).catch(i=>(console.error("Failed to get image meta for "+l,i+""),{width:0,height:0,ratio:0}))}async function vl(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((l,o)=>{const i=new Image;i.onload=()=>{const r={width:i.width,height:i.height,ratio:i.width/i.height};l(r)},i.onerror=r=>o(r),i.src=e})}function yt(e){return l=>l?e[l]||l:e.missingValue}function wl({formatter:e,keyMap:l,joinWith:o="/",valueMap:i}={}){e||(e=(a,u)=>`${a}=${u}`),l&&typeof l!="function"&&(l=yt(l));const r=i||{};return Object.keys(r).forEach(a=>{typeof r[a]!="function"&&(r[a]=yt(r[a]))}),(a={})=>Object.entries(a).filter(([c,p])=>typeof p<"u").map(([c,p])=>{const _=r[c];return typeof _=="function"&&(p=_(a[c])),c=typeof l=="function"?l(c):c,e(c,p)}).join(o)}function ke(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return Number.parseInt(e,10)}function hl(e=""){if(e===void 0||!e.length)return[];const l=new Set;for(const o of e.split(" ")){const i=Number.parseInt(o.replace("x",""));i&&l.add(i)}return Array.from(l)}function yl(e){if(e.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function bl(e){const l={};if(typeof e=="string")for(const o of e.split(/[\s,]+/).filter(i=>i)){const i=o.split(":");i.length!==2?l["1px"]=i[0].trim():l[i[0].trim()]=i[1].trim()}else Object.assign(l,e);return l}function kl(e){const l={options:e},o=(r,a={})=>Ot(l,r,a),i=(r,a={},u={})=>o(r,{...u,modifiers:ct(a,u.modifiers||{})}).url;for(const r in e.presets)i[r]=(a,u,c)=>i(a,u,{...e.presets[r],...c});return i.options=e,i.getImage=o,i.getMeta=(r,a)=>xl(l,r,a),i.getSizes=(r,a)=>Cl(l,r,a),l.$img=i,i}async function xl(e,l,o){const i=Ot(e,l,{...o});return typeof i.getMeta=="function"?await i.getMeta():await gl(e,i.url)}function Ot(e,l,o){var _,w;if(l&&typeof l!="string")throw new TypeError(`input must be a string (received ${typeof l}: ${JSON.stringify(l)})`);if(!l||l.startsWith("data:"))return{url:l};const{provider:i,defaults:r}=_l(e,o.provider||e.options.provider),a=$l(e,o.preset);if(l=wt(l)?l:qt(l),!i.supportsAlias){for(const x in e.options.alias)if(l.startsWith(x)){const I=e.options.alias[x];I&&(l=st(I,l.slice(x.length)))}}if(i.validateDomains&&wt(l)){const x=Et(l).host;if(!e.options.domains.find(I=>I===x))return{url:l}}const u=ct(o,a,r);u.modifiers={...u.modifiers};const c=u.modifiers.format;(_=u.modifiers)!=null&&_.width&&(u.modifiers.width=ke(u.modifiers.width)),(w=u.modifiers)!=null&&w.height&&(u.modifiers.height=ke(u.modifiers.height));const p=i.getImage(l,u,e);return p.format=p.format||c||"",p}function _l(e,l){const o=e.options.providers[l];if(!o)throw new Error("Unknown provider: "+l);return o}function $l(e,l){if(!l)return{};if(!e.options.presets[l])throw new Error("Unknown preset: "+l);return e.options.presets[l]}function Cl(e,l,o){var k,U,O,P,f;const i=ke((k=o.modifiers)==null?void 0:k.width),r=ke((U=o.modifiers)==null?void 0:U.height),a=bl(o.sizes),u=(O=o.densities)!=null&&O.trim()?hl(o.densities.trim()):e.options.densities;yl(u);const c=i&&r?r/i:0,p=[],_=[];if(Object.keys(a).length>=1){for(const v in a){const C=bt(v,String(a[v]),r,c,e);if(C!==void 0){p.push({size:C.size,screenMaxWidth:C.screenMaxWidth,media:`(max-width: ${C.screenMaxWidth}px)`});for(const q of u)_.push({width:C._cWidth*q,src:kt(e,l,o,C,q)})}}Sl(p)}else for(const v of u){const C=Object.keys(a)[0];let q=C?bt(C,String(a[C]),r,c,e):void 0;q===void 0&&(q={size:"",screenMaxWidth:0,_cWidth:(P=o.modifiers)==null?void 0:P.width,_cHeight:(f=o.modifiers)==null?void 0:f.height}),_.push({width:v,src:kt(e,l,o,q,v)})}Il(_);const w=_[_.length-1],x=p.length?p.map(v=>`${v.media?v.media+" ":""}${v.size}`).join(", "):void 0,I=x?"w":"x",F=_.map(v=>`${v.src} ${v.width}${I}`).join(", ");return{sizes:x,srcset:F,src:w==null?void 0:w.src}}function bt(e,l,o,i,r){const a=r.options.screens&&r.options.screens[e]||Number.parseInt(e),u=l.endsWith("vw");if(!u&&/^\d+$/.test(l)&&(l=l+"px"),!u&&!l.endsWith("px"))return;let c=Number.parseInt(l);if(!a||!c)return;u&&(c=Math.round(c/100*a));const p=i?Math.round(c*i):o;return{size:l,screenMaxWidth:a,_cWidth:c,_cHeight:p}}function kt(e,l,o,i,r){return e.$img(l,{...o.modifiers,width:i._cWidth?i._cWidth*r:void 0,height:i._cHeight?i._cHeight*r:void 0},o)}function Sl(e){var o;e.sort((i,r)=>i.screenMaxWidth-r.screenMaxWidth);let l=null;for(let i=e.length-1;i>=0;i--){const r=e[i];r.media===l&&e.splice(i,1),l=r.media}for(let i=0;i<e.length;i++)e[i].media=((o=e[i+1])==null?void 0:o.media)||""}function Il(e){e.sort((o,i)=>o.width-i.width);let l=null;for(let o=e.length-1;o>=0;o--){const i=e[o];i.width===l&&e.splice(o,1),l=i.width}}const Ml=wl({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,l)=>ht(e)+"_"+ht(l)}),Rl=(e,{modifiers:l={},baseURL:o}={},i)=>{l.width&&l.height&&(l.resize=`${l.width}x${l.height}`,delete l.width,delete l.height);const r=Ml(l)||"_";return o||(o=st(i.options.nuxt.baseURL,"/_ipx")),{url:st(o,r,Dt(e))}},Fl=!0,Ul=!0,Pl=Object.freeze(Object.defineProperty({__proto__:null,getImage:Rl,supportsAlias:Ul,validateDomains:Fl},Symbol.toStringTag,{value:"Module"})),Tt={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};Tt.providers={ipxStatic:{provider:Pl,defaults:{}}};const vt=()=>{const e=xt(),l=Ee();return l.$img||l._img||(l._img=kl({...Tt,nuxt:{baseURL:e.app.baseURL},runtimeConfig:e}))};function zl(e){var l;(l=performance==null?void 0:performance.mark)==null||l.call(performance,"mark_feature_usage",{detail:{feature:e}})}const Vl={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},jl=e=>{const l=L(()=>({provider:e.provider,preset:e.preset})),o=L(()=>({width:ke(e.width),height:ke(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding,nonce:e.nonce})),i=vt(),r=L(()=>({...e.modifiers,width:ke(e.width),height:ke(e.height),format:e.format,quality:e.quality||i.options.quality,background:e.background,fit:e.fit}));return{options:l,attrs:o,modifiers:r}},Ol={...Vl,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},Tl=["src"],Ce=te({__name:"NuxtImg",props:Ol,emits:["load","error"],setup(e,{emit:l}){const o=e,i=Wt(),r=l,a=!1,u=vt(),c=jl(o),p=$(!1),_=$(),w=L(()=>u.getSizes(o.src,{...c.options.value,sizes:o.sizes,densities:o.densities,modifiers:{...c.modifiers.value,width:ke(o.width),height:ke(o.height)}})),x=L(()=>{const P={...c.attrs.value,"data-nuxt-img":""};return(!o.placeholder||p.value)&&(P.sizes=w.value.sizes,P.srcset=w.value.srcset),P}),I=L(()=>{let P=o.placeholder;if(P===""&&(P=!0),!P||p.value)return!1;if(typeof P=="string")return P;const f=Array.isArray(P)?P:typeof P=="number"?[P,P]:[10,10];return u(o.src,{...c.modifiers.value,width:f[0],height:f[1],quality:f[2]||50,blur:f[3]||3},c.options.value)}),F=L(()=>o.sizes?w.value.src:u(o.src,c.modifiers.value,c.options.value)),k=L(()=>I.value?I.value:F.value),O=Ee().isHydrating;return Me(()=>{if(I.value||o.custom){const P=new Image;F.value&&(P.src=F.value),o.sizes&&(P.sizes=w.value.sizes||"",P.srcset=w.value.srcset),P.onload=f=>{p.value=!0,r("load",f)},P.onerror=f=>{r("error",f)},zl("nuxt-image");return}_.value&&(_.value.complete&&O&&(_.value.getAttribute("data-error")?r("error",new Event("error")):r("load",new Event("load"))),_.value.onload=P=>{r("load",P)},_.value.onerror=P=>{r("error",P)})}),(P,f)=>P.custom?Oe(P.$slots,"default",Ht(Re({key:1},{...t(a)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...x.value,...t(i)},isLoaded:p.value,src:k.value}))):(d(),j("img",Re({key:0,ref_key:"imgEl",ref:_,class:o.placeholder&&!p.value?o.placeholderClass:void 0},{...t(a)?{onerror:"this.setAttribute('data-error', 1)"}:{},...x.value,...t(i)},{src:k.value}),null,16,Tl))}}),Ye=rt(Ie.ui.strategy,Ie.ui.range,cl),Nl=te({inheritAttrs:!1,props:{modelValue:{type:Number,default:0},id:{type:String,default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},size:{type:String,default:null,validator(e){return Object.keys(Ye.size).includes(e)}},color:{type:String,default:()=>Ye.default.color,validator(e){return Ie.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:l}){const{ui:o,attrs:i}=dt("range",qe(e,"ui"),Ye),{emitFormChange:r,inputId:a,color:u,size:c,name:p}=zt(e,Ye),_=L({get(){return e.modelValue},set(P){l("update:modelValue",P)}}),w=P=>{l("change",P.target.value),r()},x=L(()=>Ze(Ve(o.value.wrapper,o.value.size[c.value]),e.class)),I=L(()=>Ze(Ve(o.value.base,o.value.background,o.value.rounded,u.value&&o.value.ring.replaceAll("{color}",u.value),o.value.size[c.value]),e.inputClass)),F=L(()=>Ve(o.value.thumb.base,u.value&&o.value.thumb.color.replaceAll("{color}",u.value),o.value.thumb.ring,o.value.thumb.background,o.value.thumb.size[c.value])),k=L(()=>Ve(o.value.track.base,o.value.track.background,o.value.track.rounded,o.value.track.size[c.value])),U=L(()=>Ve(o.value.progress.base,o.value.progress.rounded,u.value&&o.value.progress.background.replaceAll("{color}",u.value),o.value.progress.size[c.value])),O=L(()=>{const{modelValue:P,min:f,max:v}=e;return{width:`${(Math.max(f,Math.min(P,v))-f)/(v-f)*100}%`}});return{ui:o,attrs:i,name:p,inputId:a,value:_,wrapperClass:x,inputClass:I,thumbClass:F,trackClass:k,progressClass:U,progressStyle:O,onChange:w}}}),Bl=["id","name","min","max","disabled","step"];function Ll(e,l,o,i,r,a){return d(),j("div",{class:le(e.wrapperClass)},[mt(h("input",Re({id:e.inputId,ref:"input","onUpdate:modelValue":l[0]||(l[0]=u=>e.value=u),name:e.name,min:e.min,max:e.max,disabled:e.disabled,step:e.step,type:"range",class:[e.inputClass,e.thumbClass,e.trackClass]},e.attrs,{onChange:l[1]||(l[1]=(...u)=>e.onChange&&e.onChange(...u))}),null,16,Bl),[[Gt,e.value,void 0,{number:!0}]]),h("span",{class:le(e.progressClass),style:_t(e.progressStyle)},null,6)],2)}const Nt=ut(Nl,[["render",Ll]]),Al={class:"image-mask flex flex-col w-full"},ql={class:"canvas flex flex-col items-center justify-center mb-3 w-full"},El={class:"preview-over-original relative"},Dl={class:"actions flex items-center justify-center mb-3 mx-auto"},Wl={class:"options w-full max-w-[320px]"},Hl=te({__name:"ImageInpaint",props:Te({imageSrc:{type:String,required:!0}},{imageInpaintMask:{default:"",type:String},imageInpaintMaskModifiers:{},imageInpaintMaskData:{default:{},type:Object},imageInpaintMaskDataModifiers:{}}),emits:["update:imageInpaintMask","update:imageInpaintMaskData"],setup(e){const l=e,o=Fe(e,"imageInpaintMask"),i=Fe(e,"imageInpaintMaskData"),r=me(),a=$(null),u=$(null),c=$(null),p=$(null),_=$(30),w=$([]),x=$({width:r.$state.outputMaxSize,height:r.$state.outputMaxSize}),I=$(null),F=$({x:0,y:0}),k=$({x:0,y:0,radius:_.value,fill:"rgba(255, 255, 255, 0.5)",stroke:null,strokeWidth:0,visible:!1}),U=$(5),O=$(!1),P=$([]),f=$([]);function v(){if(!a.value||!c.value){console.error("Could not get stage, image layer, or mask layer");return}const g=a.value.getNode(),M=p.value?p.value.width:g.width(),A=p.value?p.value.height:g.height(),X=document.createElement("canvas");X.width=M,X.height=A;const V=X.getContext("2d");if(!V){console.error("Could not get 2d context for mask canvas");return}V.fillStyle="black",V.fillRect(0,0,M,A);const J=M/g.width(),W=A/g.height();V.fillStyle="white",w.value.forEach(pe=>{V.beginPath(),V.arc(pe.x*J,pe.y*W,pe.radius*Math.max(J,W),0,Math.PI*2,!0),V.closePath(),V.fill()});const Y=X.toDataURL("image/png",1);Y?(s(),o.value=Y,k.value.visible=!1,O.value=!1):console.error("Could not get data URI for masked image")}function C(g){const M=a.value.getNode();if(g.type.startsWith("touch")){const A=g.evt.touches[0]||g.evt.changedTouches[0];return{x:A.clientX-M.getContainer().offsetLeft,y:A.clientY-M.getContainer().offsetTop}}return M.getPointerPosition()}function q(g){g.type==="mousedown"&&g.evt.button!==0||(O.value=!0,F.value=C(g),n(),B(F.value))}function B(g){const M={x:g.x,y:g.y,radius:_.value,fill:"rgba(255, 255, 255, 1)"};w.value=w.value.filter(A=>!(b({x:A.x,y:A.y},g)+A.radius<=M.radius)),w.value.push(M)}function b(g,M){return Math.sqrt(Math.pow(M.x-g.x,2)+Math.pow(M.y-g.y,2))}function D(g){if(g.type.startsWith("touch")&&g.evt.preventDefault(),we(g),!O.value)return;const M=C(g);b(F.value,C(g))>=U.value&&(B(M),F.value=M)}function n(){P.value.push([...w.value]),f.value=[]}function s(){i.value={circles:[...w.value],brushRadius:_.value,undoStack:P.value,redoStack:f.value}}function z(){i.value!==null&&(w.value=i.value.circles||[],_.value=i.value.brushRadius||30,P.value=i.value.undoStack||[],f.value=i.value.redoStack||[])}function H(){P.value.length!==0&&(f.value.push([...w.value]),w.value=P.value.pop()||[])}function K(){f.value.length!==0&&(P.value.push([...w.value]),w.value=f.value.pop()||[])}function Z(){O.value=!1}function re(){o.value=""}function de(){n(),w.value=[],o.value=""}const ae=L(()=>P.value.length>0),ee=L(()=>f.value.length>0);function we(g){const M=C(g);k.value.x=M.x,k.value.y=M.y}function he(){k.value.visible=!1,O.value=!1}function ue(){k.value.visible=!0,k.value.radius=_.value}function ye(){const g=new Image;g.src=l.imageSrc,g.onload=()=>{p.value=g,ve(),T()}}function ve(){if(!p.value)return;const g=window.innerWidth,M=window.innerHeight,A=p.value.width/p.value.height;let X,V;const J=Math.min(g*.9,1200),W=Math.min(M*.8,r.outputMaxSize);A>J/W?(X=J,V=X/A):(V=W,X=V*A),x.value={width:Math.floor(X),height:Math.floor(V)},T()}function T(){const g=x.value.width,M=x.value.height,A=p.value.width,X=p.value.height,V=g/A,J=M/X,W=Math.min(V,J);I.value={x:0,y:0,width:A*W,height:X*W}}return et(()=>{ye(),z()}),Me(()=>{if(a.value){const g=a.value.getNode();g.on("touchstart",q),g.on("touchmove",D),g.on("touchend",Z),g.on("touchcancel",he)}}),$t(()=>{if(a.value){const g=a.value.getNode();g.off("touchstart"),g.off("touchmove"),g.off("touchend"),g.off("touchcancel")}s()}),(g,M)=>{const A=Ce,X=Ae("v-image"),V=Ae("v-layer"),J=Ae("v-circle"),W=Ae("v-stage"),Y=ie,pe=Nt,Pe=Be;return d(),j("div",Al,[h("div",ql,[M[1]||(M[1]=h("p",{class:"text-sm my-2 text-slate-500"},"Select the target area for image inpaint",-1)),h("div",El,[e.imageSrc&&e.imageSrc!==""&&o.value!==""?(d(),S(A,{key:0,src:e.imageSrc,fit:"inside",width:t(x).width,height:t(x).height,draggable:"false",class:le({absolute:o.value!==""})},null,8,["src","width","height","class"])):R("",!0),o.value?(d(),S(A,{key:1,src:o.value,fit:"inside",width:t(x).width,height:t(x).height,draggable:"false",class:"opacity-50"},null,8,["src","width","height"])):R("",!0)]),o.value===""?(d(),S(W,{key:0,ref_key:"stageRef",ref:a,config:t(x),onMousedown:q,onMousemove:D,onMouseup:Z,onMouseleave:he,onMouseenter:ue},{default:y(()=>[m(V,{ref_key:"imageLayerRef",ref:u},{default:y(()=>[m(X,{image:t(p),config:t(x)},null,8,["image","config"])]),_:1},512),m(V,{ref_key:"maskLayerRef",ref:c},{default:y(()=>[(d(!0),j(ne,null,fe(t(w),(be,ze)=>(d(),S(J,{key:ze,config:be},null,8,["config"]))),128)),t(k).visible?(d(),S(J,{key:0,config:t(k)},null,8,["config"])):R("",!0)]),_:1},512)]),_:1},8,["config"])):R("",!0)]),h("div",Dl,[m(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-clipboard-document-check-16-solid",variant:"soft",disabled:t(w).length===0||o.value!=="",onClick:v},{default:y(()=>M[2]||(M[2]=[E(" Apply ")])),_:1},8,["disabled"]),m(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-left-16-solid",variant:"soft",color:"cyan",disabled:!t(ae)||o.value!=="",onClick:H},null,8,["disabled"]),m(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-uturn-right-16-solid",variant:"soft",color:"cyan",disabled:!t(ee)||o.value!=="",onClick:K},null,8,["disabled"]),m(Y,{class:"mr-2",size:"xs",icon:"i-heroicons-arrow-turn-up-left-20-solid",variant:"soft",disabled:t(w).length===0&&o.value==="",color:"red",onClick:de},{default:y(()=>M[3]||(M[3]=[E(" Reset ")])),_:1},8,["disabled"]),m(Y,{size:"xs",icon:"i-heroicons-pencil-solid",variant:"soft",disabled:o.value==="",color:"orange",onClick:re},{default:y(()=>M[4]||(M[4]=[E(" Edit ")])),_:1},8,["disabled"])]),h("div",Wl,[m(Pe,{class:"mb-3 text-sm",hint:`value: ${t(_)}`,label:"Brush radius"},{default:y(()=>[m(pe,{modelValue:t(_),"onUpdate:modelValue":M[0]||(M[0]=be=>G(_)?_.value=be:null),min:1,max:100,size:"sm",class:"my-2",disabled:o.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["hint"])])])}}});function De(e={}){const{copy:l,isSupported:o}=Xt(),i=xe();function r(a,u={},c={}){o&&l(a).then(()=>{!u.title&&!u.description||i.add({...u,...e})},function(p){i.add({...c,description:c.description||p.message,...e})})}return{copy:r}}const Gl="0.05";function Xl(e,l){const o=parseFloat(e);if(isNaN(o))return e;const i=o+l;return i<0?"0":String(Number(i.toFixed(10)))}function Jl(e,l){let o=l,i=l,r=0,a=0;for(;o>=0&&(o--,!(e[o]==="("&&r===a));)e[o]==="("&&r++,e[o]===")"&&a++;if(o<0)return!1;for(r=0,a=0;i<e.length&&!(e[i]===")"&&r===a);)e[i]==="("&&r++,e[i]===")"&&a++,i++;return i===e.length?!1:{start:o+1,end:i}}function Ql(e){const l=/^\((.*)\)$/,o=e.match(l),i=/:([+-]?(\d*\.)?\d+([eE][+-]?\d+)?)/,r=e.match(i);return o&&!r?`(${o[1]}:1.0)`:e}function Kl(e){const l=e.composedPath()[0],o=parseFloat(Gl);if(l.tagName!=="TEXTAREA"||!(e.key==="ArrowUp"||e.key==="ArrowDown")||!e.ctrlKey&&!e.metaKey)return;e.preventDefault();let i=l.selectionStart,r=l.selectionEnd,a=l.value.substring(i,r);if(!a){const p=Jl(l.value,i);if(p)i=p.start,r=p.end,a=l.value.substring(i,r);else{const _=" .,\\/!?%^*;:{}=-_`~()\r\n	";for(;!_.includes(l.value[i-1])&&i>0;)i--;for(;!_.includes(l.value[r])&&r<l.value.length;)r++;if(a=l.value.substring(i,r),!a)return}}a[a.length-1]===" "&&(a=a.substring(0,a.length-1),r-=1),l.value[i-1]==="("&&l.value[r]===")"&&(i-=1,r+=1,a=l.value.substring(i,r)),(a[0]!=="("||a[a.length-1]!==")")&&(a=`(${a})`),a=Ql(a);const u=e.key==="ArrowUp"?o:-o,c=a.replace(/\((.*):(\d+(?:\.\d+)?)\)/,(p,_,w)=>(w=Xl(w,u),Number(w)==1?_:`(${_}:${w})`));return l.setRangeText(c,i,r,"select"),l.value}const Yl={key:0,class:"text-red-300"},Zl={class:"flex items-center"},eo={class:"p-2 max-w-48 max-h-48 not-italic"},to={class:"block font-medium text-gray-700 dark:text-gray-200"},lo={key:0,class:"flex items-center"},oo={key:2,class:"flex flex-row flex-grow items-center justify-between"},no={key:3,class:"flex flex-row flex-grow items-center"},ao={class:"sm:inline"},so={class:"preview-over-original relative"},io={key:1,class:"text-red-300 text-sm"},ro=te({__name:"InputParam",props:{inputParam:{type:Object,required:!0},index:{type:Number,required:!0},inputParamsMap:{type:Array,required:!0},advanced:{type:Boolean,default:!1}},setup(e){const l=e,o=xt(),i=Jt(),r=L(()=>i.selectedFiles[l.inputParam.name]?i.selectedFiles[l.inputParam.name]:null),a=L(()=>{var s;return r.value?`${window.location.origin}/index.php/core/preview?fileId=${(s=r.value)==null?void 0:s.id}&mimeFallback=true&a=1`:""}),u=L(()=>r.value?r.value.source:"");ge(r,n=>{n?(l.inputParamsMap[l.index][l.inputParam.name].value=n,l.inputParamsMap[l.index][l.inputParam.name].image_preview_url=u.value,l.inputParamsMap[l.index][l.inputParam.name].nc_file=!0):(l.inputParamsMap[l.index][l.inputParam.name].value=null,l.inputParamsMap[l.index][l.inputParam.name].image_preview_url="",l.inputParamsMap[l.index][l.inputParam.name].nc_file=!1)});const c=$(!1),p=$(null),_=$(""),w=$({width:0,height:0}),x=$(""),I=$({}),F=$(null),k=l.inputParamsMap[l.index][l.inputParam.name].source_input_name,U=l.inputParamsMap.findIndex(n=>{if(Object.keys(n)[0]===l.inputParamsMap[l.index][l.inputParam.name].source_input_name)return!0});function O(){try{const n=l.inputParamsMap.find(s=>{const z=Object.keys(s)[0];if(z===k)return s[z]});q(n[k].value)}catch{w.value.width=0,w.value.height=0}}Me(()=>{l.inputParam.type==="range_scale"&&O(),l.inputParam.type==="image-mask"&&ge(x,n=>{const s=new File([x.value],`image-mask-${l.inputParam.name}.png`,{type:"image/png"});l.inputParamsMap[l.index][l.inputParam.name].value=s,l.inputParamsMap[l.index][l.inputParam.name].mask_applied=n!==""})}),l.inputParam.type==="range_scale"&&ge(l.inputParamsMap,()=>{O()});function P(n){return n?URL.createObjectURL(n):""}function f(){URL.revokeObjectURL(_.value),_.value="",p.value&&(p.value.$refs.input.value=""),l.inputParamsMap[l.index][l.inputParam.name].value=null,l.inputParamsMap[l.index][l.inputParam.name].image_preview_url=""}function v(){URL.revokeObjectURL(x.value),x.value="",I.value={},l.inputParamsMap[l.index][l.inputParam.name].value=null,l.inputParamsMap[l.index][l.inputParam.name].mask_applied=!1}const C=L(()=>l.inputParam.type!=="bool"?l.inputParam.display_name:"");function q(n){if(!(n instanceof File)){w.value.width=0,w.value.height=0;return}const s=URL.createObjectURL(n),z=new Image;z.onload=function(){w.value.width=z.naturalWidth,w.value.height=z.naturalHeight,URL.revokeObjectURL(z.src)},z.src=s}const B=L(()=>{if(l.inputParam.type==="range_scale"){const n=l.inputParamsMap[l.index][l.inputParam.name].value;return`value: ${n}x (${w.value.width}x${w.value.height} -> ${(w.value.width*n).toFixed(0)}x${(w.value.height*n).toFixed(0)})`}return["range","range_scale"].includes(l.inputParam.type)?`value: ${l.inputParamsMap[l.index][l.inputParam.name].value}`:""}),b=$(null);function D(n){const s=Kl(n);s&&(l.inputParamsMap[l.index][l.inputParam.name].value=s)}return Me(()=>{l.inputParam.type==="text"&&b.value&&b.value.$refs.textarea.addEventListener("keydown",D),l.inputParam.type==="image-mask"&&(F.value=l.inputParamsMap[U][k],ge(l.inputParamsMap[U][k],n=>{x.value="",I.value={},F.value=n}))}),$t(()=>{URL.revokeObjectURL(_.value),URL.revokeObjectURL(x.value),i.removeSelectedFile(l.inputParam.name),l.inputParam.type==="text"&&b.value&&b.value.$refs.textarea.removeEventListener("keydown",D)}),(n,s)=>{var T,g;const z=ie,H=We,K=Ct,Z=jt,re=Ne,de=sl,ae=Ce,ee=Hl,we=$e,he=ot,ue=Ge,ye=Nt,ve=Be;return(((T=e.inputParam)==null?void 0:T.advanced)||!1)===e.advanced?(d(),S(ve,{key:0,class:le(["mb-3",{italic:(g=e.inputParam)==null?void 0:g.dynamic_lora}]),help:t(B)},{hint:y(()=>[e.inputParam.optional?R("",!0):(d(),j("span",Yl,"required"))]),label:y(()=>{var M;return[h("div",Zl,[(M=e.inputParam)!=null&&M.dynamic_lora&&e.inputParam.trigger_words.length>0?(d(),S(K,{key:0},{panel:y(()=>[h("div",eo,[s[20]||(s[20]=h("h4",{class:"mb-2 text-center"},"Trigger words",-1)),(d(!0),j(ne,null,fe(e.inputParam.trigger_words,A=>(d(),S(H,{key:A,color:"violet",class:"mr-1 cursor-pointer",onClick:()=>{("useCopyToClipboard"in n?n.useCopyToClipboard:t(De))().copy(A),("useToast"in n?n.useToast:t(xe))().add({title:"Clipboard",description:"Trigger word copied to clipboard",timeout:2e3})}},{default:y(()=>[E(Q(A),1)]),_:2},1032,["onClick"]))),128))])]),default:y(()=>[m(z,{icon:"i-heroicons-information-circle",variant:"ghost",size:"xs",color:"gray",class:"mr-2"})]),_:1})):R("",!0),h("label",to,Q(t(C)),1)])]}),default:y(()=>{var M,A,X,V,J;return[e.inputParam.type==="text"?(d(),S(Z,{key:0,ref_key:"textareaInput",ref:b,size:"md",placeholder:e.inputParam.display_name,required:!e.inputParam.optional,resize:!0,label:e.inputParam.display_name,value:e.inputParamsMap[e.index][e.inputParam.name].value,autoresize:"",variant:"outline",onInput:s[0]||(s[0]=W=>{const Y=W.target;e.inputParamsMap[e.index][e.inputParam.name].value=Y.value})},null,8,["placeholder","required","label","value"])):R("",!0),e.inputParam.type==="number"?(d(),j(ne,{key:1},[e.inputParam.name==="seed"?(d(),j("div",lo,[e.inputParam.type==="number"?(d(),S(re,{key:0,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[1]||(s[1]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"])):R("",!0),m(z,{icon:"i-heroicons-arrow-path",color:"violet",variant:"outline",size:"xs",class:"ml-2",onClick:s[2]||(s[2]=()=>{e.inputParamsMap[e.index][e.inputParam.name].value=Math.floor(Math.random()*1e7)})})])):(d(),S(re,{key:1,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[3]||(s[3]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),type:"number",label:e.inputParam.display_name,required:!e.inputParam.optional,max:e.inputParam.max||100,min:e.inputParam.min||0,variant:"outline"},null,8,["modelValue","label","required","max","min"]))],64)):R("",!0),e.inputParam.type==="image"?(d(),j("div",oo,[m(re,{ref_key:"imageInput",ref:p,type:"file",accept:"image/*",class:"w-full",variant:"outline",color:"gray",disabled:t(r)!==null,label:e.inputParam.display_name,onChange:s[4]||(s[4]=W=>{console.debug("files",W);const Y=W==null?void 0:W[0];e.inputParamsMap[e.index][e.inputParam.name].value=Y,_.value=P(Y),e.inputParamsMap[e.index][e.inputParam.name].image_preview_url=t(_),t(r)!==null&&t(i).removeSelectedFile(e.inputParam.name),console.debug("inputParamsMap",e.inputParamsMap)})},null,8,["disabled","label"]),t(o).app.isNextcloudIntegration?(d(),S(de,{key:0,class:"mx-2",orientation:"vertical",label:"OR"})):R("",!0),t(o).app.isNextcloudIntegration?(d(),S(z,{key:1,icon:"i-heroicons-cloud-arrow-down",variant:"outline",color:"blue",disabled:t(r)!==null||t(_)!=="",title:t(r)!==null?t(r).attributes.filename:"Choose from Nextcloud",onClick:s[5]||(s[5]=()=>{t(i).openNextcloudFilePicker(e.inputParam.name)})},{default:y(()=>s[21]||(s[21]=[E(" Choose from Nextcloud ")])),_:1},8,["disabled","title"])):R("",!0),t(a)!==""?(d(),j(ne,{key:2},[m(ae,{src:t(a),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:s[6]||(s[6]=()=>{c.value=!0})},null,8,["src"]),m(z,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:s[7]||(s[7]=()=>{t(i).removeSelectedFile(e.inputParam.name),t(_)!==""&&f()})})],64)):t(_)!==""?(d(),j(ne,{key:3},[m(ae,{src:t(x)?t(x):t(_),class:"h-10 rounded-lg cursor-pointer ml-2",onClick:s[8]||(s[8]=()=>{c.value=!0})},null,8,["src"]),m(z,{icon:"i-heroicons-x-mark",variant:"outline",class:"ml-2",onClick:f})],64)):R("",!0)])):R("",!0),e.inputParam.type==="image-mask"?(d(),j("div",no,[t(F)?(d(),S(z,{key:0,icon:"i-heroicons-paint-brush-16-solid",class:"mr-2",color:"violet",variant:"outline",size:"xs",disabled:!((M=t(F))!=null&&M.value),onClick:s[9]||(s[9]=()=>{c.value=!0})},{default:y(()=>[h("span",ao,Q(t(x)!==""?"Edit mask":"Draw mask"),1)]),_:1},8,["disabled"])):R("",!0),h("div",so,[t(F)&&((A=t(F))!=null&&A.value)?(d(),S(ae,{key:0,src:(X=t(F))==null?void 0:X.image_preview_url,class:le(["h-10 rounded-lg cursor-pointer",{absolute:t(x)!==""}]),onClick:s[10]||(s[10]=()=>{c.value=!0})},null,8,["src","class"])):R("",!0),t(x)?(d(),S(ae,{key:1,src:t(x),class:"h-10 rounded-lg cursor-pointer opacity-50",onClick:s[11]||(s[11]=()=>{c.value=!0})},null,8,["src"])):R("",!0)]),!t(F)||t(F)&&!((V=t(F))!=null&&V.value)?(d(),j("span",io," Select source image ")):R("",!0),t(x)?(d(),S(z,{key:2,icon:"i-heroicons-x-mark",variant:"outline",color:"violet",class:"ml-2",onClick:v})):R("",!0)])):R("",!0),e.inputParam.type==="image"||e.inputParam.type==="image-mask"?(d(),S(we,{key:4,modelValue:t(c),"onUpdate:modelValue":s[16]||(s[16]=W=>G(c)?c.value=W:null),class:"z-[90] overflow-y-auto",transition:!1,fullscreen:""},{default:y(()=>{var W;return[m(z,{class:"absolute top-4 right-4 z-[100]",icon:"i-heroicons-x-mark",variant:"ghost",onClick:s[12]||(s[12]=()=>c.value=!1)}),e.inputParam.type==="image"?(d(),j("div",{key:0,class:"flex items-center justify-center w-full h-full p-4",onClick:s[13]||(s[13]=tt(()=>c.value=!1,["left"]))},[t(_)!==""?(d(),S(ae,{key:0,class:"lg:h-full",fit:"contain",src:t(_)},null,8,["src"])):R("",!0),t(a)!==""?(d(),S(ae,{key:1,class:"lg:h-full",fit:"inside",src:t(u)},null,8,["src"])):R("",!0)])):(d(),S(ee,{key:1,ref:"imageInpaint","image-inpaint-mask":t(x),"onUpdate:imageInpaintMask":s[14]||(s[14]=Y=>G(x)?x.value=Y:null),"image-inpaint-mask-data":t(I),"onUpdate:imageInpaintMaskData":s[15]||(s[15]=Y=>G(I)?I.value=Y:null),class:"flex items-center justify-center w-full h-full p-4","image-src":(W=t(F))==null?void 0:W.image_preview_url},null,8,["image-inpaint-mask","image-inpaint-mask-data","image-src"]))]}),_:1},8,["modelValue"])):R("",!0),e.inputParam.type==="list"?(d(),S(he,{key:5,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[17]||(s[17]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),placeholder:e.inputParam.display_name,options:Object.keys(e.inputParam.options)},null,8,["modelValue","placeholder","options"])):R("",!0),e.inputParam.type==="bool"?(d(),S(ue,{key:6,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[18]||(s[18]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),label:(J=e.inputParam)==null?void 0:J.display_name},null,8,["modelValue","label"])):R("",!0),["range","range_scale"].includes(e.inputParam.type)?(d(),S(ye,{key:7,modelValue:e.inputParamsMap[e.index][e.inputParam.name].value,"onUpdate:modelValue":s[19]||(s[19]=W=>e.inputParamsMap[e.index][e.inputParam.name].value=W),label:e.inputParam.display_name,size:"sm",min:e.inputParam.min,max:e.inputParam.max,step:e.inputParam.step},null,8,["modelValue","label","min","max","step"])):R("",!0)]}),_:1},8,["class","help"])):R("",!0)}}}),uo={key:0,class:"heading"},co={key:1},mo={key:0,class:"max-h-96 overflow-y-auto mt-5"},fo={class:"heading"},po={key:0,class:"p-4"},go={key:0,class:"flex items-center w-full max-w-xs"},vo=te({__name:"InputParams",props:Te({inputParamsMap:{type:Array,required:!0},additionalInputParamsMap:{type:Array,required:!1,default:[]},advanced:{type:Boolean,default:!1}},{profilingOptions:{default:{},type:Object},profilingOptionsModifiers:{},profilingEnabled:{default:!1,type:Boolean},profilingEnabledModifiers:{}}),emits:["update:profilingOptions","update:profilingEnabled"],setup(e){const l=e,o=me(),i=ft(),r=Qt(),a=$(!l.advanced),u=Fe(e,"profilingOptions"),c=Fe(e,"profilingEnabled"),p=$(!0),_=L(()=>r.workers.map(w=>({value:w.worker_id,label:`${w.worker_id} (type: ${w.device_type}, vram_total: ${je(w.vram_total)})`})));return et(()=>{var x;if(!i.isAdmin)return;const w=localStorage.getItem(`profilingOptions_${(x=o.currentFlow)==null?void 0:x.name}`);w&&(u.value=JSON.parse(w)),r.fetchWorkersInfo().then(()=>{r.workers.find(F=>{var k;return F.worker_id===((k=u.value["X-WORKER-ID"])==null?void 0:k.value)})||(u.value["X-WORKER-ID"]=null)})}),(w,x)=>{const I=_e,F=ro,k=Ge,U=ot,O=ie,P=Ne,f=Be;return d(),j(ne,null,[e.advanced?(d(),j("div",uo,[h("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:x[0]||(x[0]=()=>{a.value=!t(a)})},[m(I,{name:t(a)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",class:"mr-2"},null,8,["name"]),x[3]||(x[3]=E(" Advanced options "))])])):R("",!0),t(a)?(d(),j("div",co,[(d(!0),j(ne,null,fe(t(o).currentFlow.input_params,(v,C)=>(d(),S(F,{key:C,"input-params-map":e.inputParamsMap,index:C,"input-param":v,advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),(d(!0),j(ne,null,fe(e.additionalInputParamsMap,(v,C)=>(d(),S(F,{key:Object.keys(v)[0],"input-params-map":e.additionalInputParamsMap,index:C,"input-param":v[Object.keys(v)[0]],advanced:e.advanced},null,8,["input-params-map","index","input-param","advanced"]))),128)),t(i).isAdmin&&e.advanced?(d(),j("div",mo,[h("div",fo,[h("h4",{class:"text-md font-bold cursor-pointer select-none flex items-center mb-3",onClick:x[1]||(x[1]=()=>{p.value=!t(p)})},[m(I,{name:t(p)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),m(I,{name:"i-mdi-bug-outline",class:"mr-2"}),x[4]||(x[4]=E(" Execution settings "))])]),t(p)?R("",!0):(d(),j("div",po,[m(k,{modelValue:c.value,"onUpdate:modelValue":x[2]||(x[2]=v=>c.value=v),label:"Enable Execution settings",class:"mb-3"},null,8,["modelValue"]),(d(!0),j(ne,null,fe(Object.keys(u.value),v=>(d(),S(f,{key:v,label:v},{default:y(()=>[v==="X-WORKER-ID"?(d(),j("div",go,[m(U,{modelValue:u.value[v],"onUpdate:modelValue":C=>u.value[v]=C,options:t(_),placeholder:"Select worker",class:"w-full my-3"},null,8,["modelValue","onUpdate:modelValue","options"]),m(O,{icon:"i-heroicons-x-mark",variant:"outline",size:"sm",color:"orange",class:"ml-2",onClick:()=>u.value[v]=null},null,8,["onClick"]),m(O,{icon:"i-heroicons-arrow-path-solid",variant:"outline",size:"sm",color:"blue",class:"ml-2",onClick:()=>{t(r).fetchWorkersInfo().then(()=>{u.value[v]=t(_).find(C=>{var q;return C.value===((q=u.value[v])==null?void 0:q.value)})})}},null,8,["onClick"])])):(d(),S(P,{key:1,modelValue:u.value[v],"onUpdate:modelValue":C=>u.value[v]=C,placeholder:"Enter value",class:"my-3"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))]))])):R("",!0)])):R("",!0)],64)}}}),wo={key:0,id:"prompt",class:"w-full my-10 lg:my-0 p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg"},ho={class:"action flex items-center justify-end"},yo=te({__name:"Prompt",setup(e,{expose:l}){var q,B,b,D;const o=me(),i=ft();let r=localStorage.getItem(`input_params_map_${(q=o.currentFlow)==null?void 0:q.name}`);if(r){const n=JSON.parse(r);"flow_version"in n&&n.flow_version.split(".")[0]===((B=o.currentFlow)==null?void 0:B.version.split(".")[0])?r=n:(r=null,localStorage.removeItem(`input_params_map_${(b=o.currentFlow)==null?void 0:b.name}`))}const a=$(((D=o.currentFlow)==null?void 0:D.input_params.map(n=>{var s;if(n.type==="text")return{[n.name]:{value:r!==null&&r[n.name]?r[n.name]:n.default||"",type:n.type,optional:n.optional,advanced:n.advanced||!1,default:n.default||"",translatable:n.translatable||!1,dynamic_lora:n.dynamic_lora||!1,trigger_words:n.trigger_words||[]}};if(n.type==="number")return{[n.name]:{value:r!==null&&r[n.name]?r[n.name]:n.default||0,type:n.type,optional:n.optional,advanced:n.advanced||!1,default:n.default||0,dynamic_lora:n.dynamic_lora||!1,trigger_words:n.trigger_words||[]}};if(n.type==="image")return{[n.name]:{value:null,type:n.type,optional:n.optional,advanced:n.advanced||!1,dynamic_lora:n.dynamic_lora||!1,trigger_words:n.trigger_words||[]}};if(n.type==="image-mask")return{[n.name]:{value:null,type:n.type,optional:n.optional,advanced:n.advanced||!1,source_input_name:n.source_input_name||null,dynamic_lora:n.dynamic_lora||!1,trigger_words:n.trigger_words||[]}};if(n.type==="list")return{[n.name]:{value:r!==null&&r[n.name]?r[n.name]:n.default||Object.keys(n.options)[0]||"",type:n.type,optional:n.optional,options:n.options,advanced:n.advanced||!1,default:Object.keys(n.options)[0]||"",dynamic_lora:n.dynamic_lora||!1,trigger_words:n.trigger_words||[]}};if(n.type==="bool")return{[n.name]:{value:r!==null&&r[n.name]?r[n.name]:n.default||!1,type:n.type,optional:n.optional,advanced:n.advanced||!1,default:n.default||!1,dynamic_lora:n.dynamic_lora||!1,trigger_words:n.trigger_words||[]}};if(["range","range_scale"].includes(n.type)){const z={value:r!==null&&r[n.name]?r[n.name]:n.default||0,type:n.type,optional:n.optional,advanced:n.advanced||!1,min:n.min||0,max:n.max||100,step:n.step||1,default:n.default||0,dynamic_lora:n.dynamic_lora||!1,trigger_words:n.trigger_words||[]};if(n.type==="range_scale"&&(z.source_input_name=n.source_input_name||null,z.source_input_name===null||z.source_input_name==="")){const H=(s=o.currentFlow)==null?void 0:s.input_params.find(K=>K.type==="image"&&!K.optional);H&&(z.source_input_name=H.name)}return{[n.name]:z}}}))||[]),u=$([]);o.currentFlow.is_seed_supported&&u.value.push({seed:{name:"seed",display_name:"Random seed",value:Math.floor(Math.random()*1e7),type:"number",optional:!0,advanced:!0,min:0,max:1e7}});const c=St(),p=$(o.currentFlow.is_translations_supported&&c.settingsMap.translations_provider.value.trim()!==""),_=$(o.currentFlow.is_surprise_me_supported&&c.settingsMap.llm_provider.value.trim()!==""),w=$(p.value);et(()=>{const n=localStorage.getItem("translatePrompt");n&&(w.value=JSON.parse(n))}),ge(w,n=>{localStorage.setItem("translatePrompt",JSON.stringify(n))});function x(n){console.debug("Copy prompt inputs",n),Object.keys(n).forEach(z=>{const H=a.value.findIndex(K=>Object.keys(K)[0]===z);H!==-1&&(a.value[H][z].value=n[z].value)});const s=document.getElementById("prompt");s&&s.scrollIntoView({behavior:"smooth"})}l({copyPromptInputs:x}),a.value.forEach(n=>{const s=Object.keys(n)[0];["image","image-mask"].includes(n[s].type)||ge(()=>n[s].value,()=>{var H,K;const z={};a.value.forEach(Z=>{const re=Object.keys(Z)[0];z[re]=Z[re].value}),localStorage.setItem(`input_params_map_${(H=o.currentFlow)==null?void 0:H.name}`,JSON.stringify({...z,flow_version:(K=o.currentFlow)==null?void 0:K.version}))})});const I=L(()=>a.value.filter(n=>{const s=Object.keys(n)[0];return!["image","image-mask"].includes(n[s].type)}).some(n=>{const s=Object.keys(n)[0];return n[s].value!==n[s].default}));function F(){a.value.forEach(n=>{const s=Object.keys(n)[0];n[s].type==="text"?n[s].value=n[s].default||"":n[s].type==="number"?n[s].value=n[s].default||n[s].min||0:n[s].type==="list"?n[s].value=Object.keys(n[s].options)[0]||"":n[s].type==="bool"?n[s].value=n[s].default||!1:["range","range_scale"].includes(n[s].type)&&(n[s].value=n[s].default||n[s].min||0)})}const k=$(!1),U=$(1),O=$(!1),P=L(()=>a.value.every(n=>{var H,K,Z,re;const s=Object.keys(n)[0];if(n[s].optional)return!0;const z=n[s].value;if(n[s].type==="text")return z!=="";if(n[s].type==="number")return z>=n[s].min&&z<=n[s].max;if(n[s].type==="list")return z!==""&&Object.keys(n[s].options).includes(z);if(n[s].type==="bool")return!0;if(n[s].type==="range")return z>=n[s].min&&z<=n[s].max;if(n[s].type==="range_scale")return z>=n[s].min&&z<=n[s].max;if(n[s].type==="image")return(H=n[s])!=null&&H.nc_file?!0:z instanceof File&&z.size>0;if(n[s].type==="image-mask")return(K=n[s])!=null&&K.nc_file?((Z=n[s])==null?void 0:Z.mask_applied)||!1:z instanceof File&&z.size>0&&(((re=n[s])==null?void 0:re.mask_applied)||!1)})),f=$({"X-WORKER-UNLOAD-MODELS":1,"X-WORKER-EXECUTION-PROFILER":1,"X-WORKER-ID":null}),v=$(!1);ge(()=>f.value,()=>{var n;i.isAdmin&&localStorage.setItem(`profilingOptions_${(n=o.currentFlow)==null?void 0:n.name}`,JSON.stringify(f.value))},{deep:!0});function C(n=!1){k.value=!0;let s={};i.isAdmin&&v&&(s=Object.fromEntries(Object.entries(f).filter(([z,H])=>H!==null).map(([z,H])=>z==="X-WORKER-ID"?[z,H==null?void 0:H.value]:[z,H]))),o.runFlow(o.currentFlow,[...a.value,...u.value],U.value,p.value&&w.value,!1,null,n,s).finally(()=>{k.value=!1;const z=u.value.find(H=>Object.keys(H)[0]==="seed");z.seed.value=Number(z.seed.value)+U.value+1})}return(n,s)=>{const z=_e,H=vo,K=Ne,Z=Be,re=Ge,de=ie,ae=He;return t(o).currentFlow?(d(),j("div",wo,[h("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:s[0]||(s[0]=()=>{O.value=!t(O)})},[m(z,{name:t(O)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),s[11]||(s[11]=E(" Prompt "))]),mt(h("div",null,[m(H,{"input-params-map":t(a),"onUpdate:inputParamsMap":s[1]||(s[1]=ee=>G(a)?a.value=ee:null),"additional-input-params-map":t(u),"onUpdate:additionalInputParamsMap":s[2]||(s[2]=ee=>G(u)?u.value=ee:null),advanced:!1},null,8,["input-params-map","additional-input-params-map"]),t(u).length>0?(d(),S(H,{key:0,"input-params-map":t(a),"onUpdate:inputParamsMap":s[3]||(s[3]=ee=>G(a)?a.value=ee:null),"additional-input-params-map":t(u),"onUpdate:additionalInputParamsMap":s[4]||(s[4]=ee=>G(u)?u.value=ee:null),"profiling-options":t(f),"onUpdate:profilingOptions":s[5]||(s[5]=ee=>G(f)?f.value=ee:null),"profiling-enabled":t(v),"onUpdate:profilingEnabled":s[6]||(s[6]=ee=>G(v)?v.value=ee:null),advanced:!0},null,8,["input-params-map","additional-input-params-map","profiling-options","profiling-enabled"])):R("",!0),t(o).currentFlow.is_count_supported?(d(),S(Z,{key:1,label:"Number of results"},{default:y(()=>[m(K,{modelValue:t(U),"onUpdate:modelValue":s[7]||(s[7]=ee=>G(U)?U.value=ee:null),type:"number",min:"1",max:"50",label:"Batch size",class:"mb-3 max-w-fit flex justify-end"},null,8,["modelValue"])]),_:1})):R("",!0),t(p)?(d(),S(Z,{key:2,class:"my-3 flex justify-end"},{default:y(()=>[m(re,{modelValue:t(w),"onUpdate:modelValue":s[8]||(s[8]=ee=>G(w)?w.value=ee:null),label:"Translate prompt"},null,8,["modelValue"])]),_:1})):R("",!0),h("div",{class:le(["flex flex-col md:flex-row",{"justify-between":t(I),"justify-end":!t(I)}])},[t(I)?(d(),S(ae,{key:0,text:"Reset input params values to defaults"},{default:y(()=>[m(de,{icon:"i-heroicons-arrow-path-rounded-square",variant:"ghost",color:"amber",onClick:F},{default:y(()=>s[12]||(s[12]=[E(" Reset params ")])),_:1})]),_:1})):R("",!0),h("div",ho,[t(_)?(d(),S(ae,{key:0,text:"Randomize prompt based on your input"},{default:y(()=>[m(de,{class:"mr-2",icon:"i-heroicons-gift",variant:"soft",color:"blue",loading:t(k),onClick:s[9]||(s[9]=()=>C(!0))},{default:y(()=>s[13]||(s[13]=[E(" Surprise me ")])),_:1},8,["loading"])]),_:1})):R("",!0),m(de,{icon:"i-heroicons-sparkles-16-solid",variant:"outline",loading:t(k),disabled:!t(P),onClick:s[10]||(s[10]=()=>C(!1))},{default:y(()=>s[14]||(s[14]=[E(" Run prompt ")])),_:1},8,["loading","disabled"])])],2)],512),[[It,!t(O)]])])):R("",!0)}}}),bo=e=>{const l=$(0);function o(a){e.value.style.scrollSnapType="none",e.value.style.scrollBehavior="auto",l.value=a.pageX,window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)}function i(){e.value.style.removeProperty("scroll-behavior"),e.value.style.removeProperty("scroll-snap-type"),e.value.style.removeProperty("pointer-events"),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)}function r(a){a.preventDefault(),e.value.style.pointerEvents="none";const u=a.pageX-l.value;l.value=a.pageX,e.value.scrollBy(-u,0)}Me(()=>{e.value&&e.value.addEventListener("mousedown",o)}),pt(()=>{e.value&&e.value.removeEventListener("mousedown",o)})},at=rt(Ie.ui.strategy,Ie.ui.carousel,dl),ko=te({components:{UButton:ie},inheritAttrs:!1,props:{items:{type:Array,default:()=>[]},arrows:{type:Boolean,default:!1},indicators:{type:Boolean,default:!1},dir:{type:String,default:"ltr"},prevButton:{type:Object,default:()=>at.default.prevButton},nextButton:{type:Object,default:()=>at.default.nextButton},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:void 0}},setup(e,{expose:l}){const{ui:o,attrs:i}=dt("carousel",qe(e,"ui"),at,qe(e,"class")),r=$(),a=$(0),{x:u}=Kt(r,{behavior:"smooth"}),{width:c}=Yt(r);bo(r),Zt(r,O=>{var f,v;const[P]=O;a.value=((v=(f=P==null?void 0:P.target)==null?void 0:f.firstElementChild)==null?void 0:v.clientWidth)||0});const p=L(()=>e.dir==="rtl"),_=L(()=>a.value?p.value?Math.round(-u.value/a.value)+1:Math.round(u.value/a.value)+1:0),w=L(()=>{if(!a.value)return 0;const O=Math.round(c.value/a.value);return e.items.length<=O?0:e.items.length-O+1}),x=L(()=>_.value<=1),I=L(()=>_.value===w.value);function F(){u.value+=p.value?-a.value:a.value}function k(){u.value-=p.value?-a.value:a.value}function U(O){u.value=(O-1)*a.value*(p.value?-1:1)}return l({pages:w,page:_,prev:k,next:F,select:U}),{ui:o,attrs:i,isFirst:x,isLast:I,carouselRef:r,pages:w,currentPage:_,onClickNext:F,onClickPrev:k,onClick:U,twMerge:Ze}}}),xo=["dir"],_o=["role"],$o=["aria-selected","aria-label","onClick"];function Co(e,l,o,i,r,a){const u=ie;return d(),j("div",Re({class:e.ui.wrapper},e.attrs,{dir:e.dir}),[h("div",{ref:"carouselRef",class:le([e.ui.container,"no-scrollbar"])},[(d(!0),j(ne,null,fe(e.items,(c,p)=>(d(),j("div",{key:p,class:le(e.ui.item),role:e.indicators?"tabpanel":null},[Oe(e.$slots,"default",{item:c,index:p},void 0,!0)],10,_o))),128))],2),e.arrows?(d(),j("div",{key:0,class:le(e.ui.arrows.wrapper)},[Oe(e.$slots,"prev",{onClick:e.onClickPrev,disabled:e.isFirst},()=>{var c;return[e.prevButton?(d(),S(u,Re({key:0,disabled:e.isFirst},{...e.ui.default.prevButton,...e.prevButton},{class:e.twMerge(e.ui.default.prevButton.class,(c=e.prevButton)==null?void 0:c.class),"aria-label":"Prev",onClick:e.onClickPrev}),null,16,["disabled","class","onClick"])):R("",!0)]},!0),Oe(e.$slots,"next",{onClick:e.onClickNext,disabled:e.isLast},()=>{var c;return[e.nextButton?(d(),S(u,Re({key:0,disabled:e.isLast},{...e.ui.default.nextButton,...e.nextButton},{class:e.twMerge(e.ui.default.nextButton.class,(c=e.nextButton)==null?void 0:c.class),"aria-label":"Next",onClick:e.onClickNext}),null,16,["disabled","class","onClick"])):R("",!0)]},!0)],2)):R("",!0),e.indicators?(d(),j("div",{key:1,role:"tablist",class:le(e.ui.indicators.wrapper)},[(d(!0),j(ne,null,fe(e.pages,c=>Oe(e.$slots,"indicator",{key:c,onClick:e.onClick,active:c===e.currentPage,page:c},()=>[h("button",{type:"button",role:"tab","aria-selected":c===e.currentPage,class:le([e.ui.indicators.base,c===e.currentPage?e.ui.indicators.active:e.ui.indicators.inactive]),"aria-label":`set slide ${c}`,onClick:p=>e.onClick(c)},null,10,$o)],!0)),128))],2)):R("",!0)],16,xo)}const Ue=ut(ko,[["render",Co],["__scopeId","data-v-a3da86ff"]]),So={class:"flex flex-col basis-full"},Io=te({__name:"InputFiles",props:{running:{type:Object,required:!0}},setup(e){const l=vt(),o=function(c,p){return`${Mt()}/tasks/inputs?task_id=${c}&input_index=${p}`},i=$(!1),r=$(""),a=$(0),u=$(!0);return(c,p)=>{var k,U,O,P,f;const _=_e,w=Ce,x=Ue,I=ie,F=$e;return e.running&&e.running.input_files&&((k=Object.keys(e.running.input_files))==null?void 0:k.length)>0?(d(),j("div",{key:0,class:le(["ml-2 mt-2 mb-5",{"mb-10":((U=Object.keys(e.running.input_files))==null?void 0:U.length)>1&&!t(u)}])},[h("h4",{class:"mb-3 font-bold cursor-pointer select-none flex items-center text-sm",onClick:p[0]||(p[0]=()=>u.value=!t(u))},[m(_,{name:t(u)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),h("span",null," Input files ("+Q((O=Object.keys(e.running.input_files))==null?void 0:O.length)+") ",1)]),t(u)?R("",!0):(d(),j(ne,{key:0},[((P=Object.keys(e.running.input_files))==null?void 0:P.length)===1?(d(),S(w,{key:0,class:"mb-5 rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(l)(`${("buildBackendUrl"in c?c.buildBackendUrl:t(it))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:o(e.running.task_id,0),onClick:p[1]||(p[1]=()=>{r.value=o(e.running.task_id,0),a.value=0,i.value=!0})},null,8,["placeholder","src"])):R("",!0),((f=Object.keys(e.running.input_files))==null?void 0:f.length)>1?(d(),S(x,{key:1,items:Object.keys(e.running.input_files).map(v=>({task_id:e.running.task_id,index:v})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:""},{default:y(({item:v})=>[h("div",So,[m(w,{class:"rounded-lg cursor-pointer",fit:"outside",loading:"lazy",placeholder:t(l)(`${("buildBackendUrl"in c?c.buildBackendUrl:t(it))()}/vix_logo.png`,{f:"png",blur:3,q:50}),src:o(v.task_id,v.index),onClick:()=>{r.value=o(e.running.task_id,v.index),a.value=v.index,i.value=!0}},null,8,["placeholder","src","onClick"])])]),_:1},8,["items"])):R("",!0),m(F,{modelValue:t(i),"onUpdate:modelValue":p[4]||(p[4]=v=>G(i)?i.value=v:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[m(I,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:p[2]||(p[2]=()=>i.value=!1)}),h("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:p[3]||(p[3]=tt(()=>i.value=!1,["left"]))},[t(r)?(d(),S(w,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(r)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])],64))],2)):R("",!0)}}}),Mo=te({__name:"ErrorAlert",props:{running:{type:Object,required:!0}},setup(e){const l=me(),o=$(!1);return(i,r)=>{const a=gt;return d(),S(a,{class:"mb-5",icon:"i-heroicons-exclamation-circle-16-solid",color:"red",variant:"soft",title:"Task failed",description:e.running.error,actions:[{variant:"outline",color:"yellow",label:"Restart",loading:t(o),icon:"i-heroicons-arrow-path",click:()=>{o.value=!0,t(l).restartFlow(e.running).finally(()=>{o.value=!1})}}]},null,8,["description","actions"])}}}),Ro={class:"mb-5"},Fo={class:"text-sm mb-5 text-slate-500"},Uo={class:"flex justify-between"},Po=te({__name:"Item",props:{running:{type:Object,required:!0}},setup(e){const l=me(),o=$(!1),i=$(!1);function r(a){return[[{label:"Comfy flow",labelClass:"text-blue-500",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500",click:()=>{var u;return l.downloadFlowComfy((u=l.currentFlow)==null?void 0:u.name,a.task_id)}}],[{label:`Raise priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-up",iconClass:"bg-gray-500",disabled:a.priority===15||a.progress>0,click:()=>{i.value=!0,l.raiseQueuePriority(a).finally(()=>{i.value=!1})}},{label:`Lower priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-down",iconClass:"bg-gray-500",disabled:a.priority===0||a.progress>0,click:()=>{i.value=!0,l.lowerQueuePriority(a).finally(()=>{i.value=!1})}},{label:`Reset priority ${a.priority>0?`(${a.priority})`:""}`,labelClass:"text-gray-500",icon:"i-heroicons-arrow-path-rounded-square-solid",iconClass:"bg-gray-500",disabled:a.priority===0||a.progress>0,click:()=>{i.value=!0,l.resetQueuePriority(a).finally(()=>{i.value=!1})}}]]}return(a,u)=>{var I,F;const c=Vt,p=Io,_=Mo,w=ie,x=lt;return d(),j("div",Ro,[m(c,{class:"mb-3",value:(I=e.running)==null?void 0:I.progress,indicator:"",color:e.running.error?"red":"green"},null,8,["value","color"]),h("p",Fo,Q([`${(F=e.running)!=null&&F.priority&&e.running.priority>0?"["+e.running.priority+"] ":""}#${e.running.task_id}`,...Object.keys(e.running.input_params_mapped).filter(k=>e.running.input_params_mapped[k].value&&e.running.input_params_mapped[k].value!=="").map(k=>`${e.running.input_params_mapped[k].display_name}: ${e.running.input_params_mapped[k].value}`)].join(" | ")+`${e.running.execution_time?" | execution_time: "+e.running.execution_time.toFixed(2)+"s":""}`),1),m(p,{running:e.running},null,8,["running"]),e.running.error?(d(),S(_,{key:0,running:e.running},null,8,["running"])):R("",!0),h("div",Uo,[m(w,{icon:e.running.progress>=0&&e.running.progress<100?"i-heroicons-stop":"i-heroicons-minus-circle",color:e.running.error?"red":"orange",variant:"outline",loading:t(o),onClick:u[0]||(u[0]=()=>{o.value=!0,t(l).cancelRunningFlow(e.running).finally(()=>{o.value=!1})})},{default:y(()=>[E(Q(e.running.progress>=0&&e.running.progress<100?"Cancel":"Remove"),1)]),_:1},8,["icon","color","loading"]),m(x,{items:r(e.running),mode:"click",popper:{placement:"bottom-end"}},{default:y(()=>[m(w,{color:"blue",variant:"outline",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])])])}}}),zo={class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md mt-5 mb-10"},Vo={class:"flex items-center justify-between mb-2"},jo={key:0},Oo={key:1,class:"text-red-400"},To=te({__name:"Queue",setup(e){const l=me(),o=$(!0),i=$(!1);return(r,a)=>{var _,w,x,I,F,k,U,O,P;const u=_e,c=ie,p=Po;return d(),j("div",zo,[h("div",Vo,[h("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center",onClick:a[0]||(a[0]=()=>{o.value=!t(o)})},[m(u,{name:t(o)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),h("span",null," Queue ("+Q(t(l).flowsRunningByName((_=t(l).currentFlow)==null?void 0:_.name).length)+") ",1),t(l).flowsRunningByName((w=t(l).currentFlow)==null?void 0:w.name).length>0?(d(),j("span",jo,"  - "+Q(`${((I=t(l).flowsRunningByName((x=t(l).currentFlow)==null?void 0:x.name).filter(f=>f.progress>0)[0])==null?void 0:I.progress.toFixed(0))??0}%`),1)):R("",!0),t(l).flowsRunningByNameWithErrors((F=t(l))==null?void 0:F.currentFlow.name).length>0?(d(),j("span",Oo,"  ("+Q(t(l).flowsRunningByNameWithErrors((k=t(l).currentFlow)==null?void 0:k.name).length)+") ",1)):R("",!0)]),(U=t(l).currentFlow)!=null&&U.name&&t(l).flowsRunningByName((O=t(l).currentFlow)==null?void 0:O.name).length>0?(d(),S(c,{key:0,icon:"i-heroicons-stop",color:"orange",variant:"outline",loading:t(i),onClick:a[1]||(a[1]=()=>{var f;i.value=!0,t(l).cancelRunningFlows((f=t(l).currentFlow)==null?void 0:f.name).finally(()=>{i.value=!1})})},{default:y(()=>a[2]||(a[2]=[E(" Cancel all ")])),_:1},8,["loading"])):R("",!0)]),t(o)?R("",!0):(d(!0),j(ne,{key:0},fe(t(l).flowsRunningByName((P=t(l).currentFlow)==null?void 0:P.name),f=>(d(),S(p,{key:f.task_id,running:f},null,8,["running"]))),128))])}}}),No=te({__name:"ScrollToTop",props:{show:{type:Boolean,required:!0},target:{type:String,required:!0}},setup(e){const l=e;function o(){const i=document.getElementById(l.target);i&&i.scrollIntoView({behavior:"smooth"})}return(i,r)=>{const a=ie;return e.show?(d(),S(a,{key:0,icon:"i-heroicons-arrow-small-up",color:"black",variant:"outline",onClick:o})):R("",!0)}}}),Bo={class:"flex flex-col items-center mb-2 max-w-fit mx-auto z-0"},Lo={class:"text-slate-500 text-center text-sm w-full mx-auto flex flex-wrap items-center justify-center md:justify-between"},Ao={class:"toggles py-2"},qo={class:"mr-2 inline-flex items-center text-sm"},Eo=["for"],Do={class:"mr-2 inline-flex items-center text-sm"},Wo=["for"],Ho={key:0,class:"flex items-center"},Go=["title"],Xo=te({__name:"Child",props:{flowResult:{type:Object,required:!0},outputsIndex:{type:Number,required:!1,default:()=>0},openImageModal:{type:Function,required:!0}},setup(e){const l=e,o=me(),i=(f,v=null,C=!1)=>{if(f.child_tasks.length===0)return f;const q=f.child_tasks.findIndex(B=>B.parent_task_node_id===v);return q!==-1?(C||(a.value=f),i(f.child_tasks[q],f.child_tasks[q].outputs[0].comfy_node_id,C)):f};function r(f,v,C=null){if(C!==null&&f.parent_task_node_id===C||Number(f.task_id)===v)return f;for(let q=0;q<f.child_tasks.length;q++)for(let B=0;B<f.child_tasks[q].outputs.length;B++){const b=r(f.child_tasks[q],v,f.child_tasks[q].outputs[B].comfy_node_id);if(b!==null)return b}return null}const a=$(l.flowResult),u=$(i(l.flowResult,l.flowResult.outputs[l.outputsIndex].comfy_node_id,!1));function c(f){var v;return[[{label:`${(v=o.flowByName((f==null?void 0:f.flow_name)??(f==null?void 0:f.name)))==null?void 0:v.display_name}#${f.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",click:()=>{l.openImageModal(ce({task_id:f.task_id,node_id:f.outputs.length>1?f.outputs[l.outputsIndex].comfy_node_id:f.outputs[0].comfy_node_id}))}}]]}function p(f){var C;const v=[[{label:`${(C=o.flowByName((f==null?void 0:f.flow_name)??(f==null?void 0:f.name)))==null?void 0:C.display_name}#${f.task_id}`,disabled:!0}],[{label:"View image",icon:"i-heroicons-eye",disabled:f.progress<100||f.error!=="",click:()=>{l.openImageModal(ce({task_id:f.task_id,node_id:f.outputs.length>1?f.outputs[l.outputsIndex].comfy_node_id:f.outputs[0].comfy_node_id}))}},{label:f.progress<100?"Cancel":"Delete",labelClass:f.progress<100?"text-orange-500":"text-red-500",icon:f.progress<100?"i-heroicons-stop":"i-heroicons-trash",iconClass:f.progress<100?"bg-orange-500":"bg-red-500",click:()=>{o.deleteFlowHistory(f.task_id).then(()=>{const q=r(l.flowResult,f.parent_task_id,f.parent_task_node_id);q&&(q.child_tasks=q.child_tasks.filter(B=>Number(B.task_id)!==Number(f.task_id))),k(!1,l.flowResult)})}}]];return f.progress<100&&(v[0][1]={label:`Progress: ${Math.ceil(f.progress)}% (${f.execution_time.toFixed(2)}s)`,labelClass:"text-blue-500",disabled:!0}),f.error!==""&&v[0].push({label:`Error: ${f.error}`,labelClass:"text-red-500",slot:"error",click:()=>{De().copy(f.error),xe().add({title:"Clipboard",description:`Task #${f.task_id} error copied to clipboard`,timeout:2e3})}}),v}function _(){const f=a.value.parent_task_id;if(!f)return;const v=r(l.flowResult,f,a.value.parent_task_node_id);v&&(a.value=v)}function w(){if(a.value.child_tasks.length===0)return;const f=a.value.outputs.length>1?a.value.outputs[l.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id,v=a.value.child_tasks.find(C=>C.parent_task_node_id===f);v&&(a.value=v)}const x=L(()=>{if(a.value.child_tasks.length===0)return;const f=a.value.outputs.length>1?a.value.outputs[l.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id;return a.value.child_tasks.find(C=>C.parent_task_node_id===f).task_id!==u.value.task_id});function I(){const f=u.value.parent_task_id;if(!f)return;const v=r(l.flowResult,f,u.value.parent_task_node_id);v&&(u.value=v)}function F(){if(u.value.child_tasks.length===0)return;const f=Number(u.value.outputs[0].comfy_node_id),v=u.value.child_tasks.find(C=>Number(C.parent_task_node_id)===f);v&&(u.value=v)}function k(f=!1,v=null){f||(a.value=v),u.value=i(v,v==null?void 0:v.outputs[l.outputsIndex].comfy_node_id,f),U.value=!1}ge(l.flowResult,f=>{k(!0,f)});const U=$(!1),O=$(!0),P=$(null);return ge(U,f=>{f?(P.value=a.value,a.value=l.flowResult):P.value&&(a.value=P.value,u.value=Rt(P.value,l.outputsIndex,a.value.outputs.length>1?a.value.outputs[l.outputsIndex].comfy_node_id:a.value.outputs[0].comfy_node_id))}),(f,v)=>{const C=Ce,q=Ae("ImgComparisonSlider"),B=il,b=ie,D=lt,n=_e,s=He;return d(),j("div",Bo,[mt(m(C,{class:"mb-2 rounded-lg cursor-pointer",height:t(o).outputMaxSize,width:t(o).outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in f?f.outputResultSrc:t(ce))({task_id:t(u).progress===100?t(u).task_id:e.flowResult.task_id,node_id:t(u).progress===100?t(u).outputs[0].comfy_node_id:e.flowResult.outputs[e.outputsIndex].comfy_node_id}),onClick:v[0]||(v[0]=z=>e.openImageModal(("outputResultSrc"in f?f.outputResultSrc:t(ce))({task_id:t(u).task_id??e.flowResult.task_id,node_id:t(u).outputs[0].comfy_node_id??e.flowResult.outputs[e.outputsIndex].comfy_node_id})))},null,8,["height","width","src"]),[[It,!t(O)]]),t(O)?(d(),S(q,{key:0,class:"mb-2 mx-auto outline-none w-fit rounded-lg"},{default:y(()=>{var z,H,K;return[m(C,{slot:"first",height:t(o).outputMaxSize,width:t(o).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in f?f.outputResultSrc:t(ce))({task_id:t(U)?e.flowResult.task_id:t(a).task_id,node_id:t(U)?e.flowResult.outputs[e.outputsIndex].comfy_node_id:t(a).parent_task_node_id!==null?(z=t(a))==null?void 0:z.outputs[0].comfy_node_id:((H=t(a))==null?void 0:H.outputs[e.outputsIndex].comfy_node_id)??((K=t(a))==null?void 0:K.outputs[0].comfy_node_id)})},null,8,["height","width","src"]),t(u)&&t(u).progress===100?(d(),S(C,{key:0,slot:"second",height:t(o).outputMaxSize,width:t(o).outputMaxSize,fit:"cover",draggable:"false",src:("outputResultSrc"in f?f.outputResultSrc:t(ce))({task_id:t(u).task_id,node_id:t(u).outputs[0].comfy_node_id})},null,8,["height","width","src"])):(d(),S(C,{key:1,slot:"second",height:t(o).outputMaxSize,width:t(o).outputMaxSize,fit:"cover",draggable:"false",src:`${("buildBackendUrl"in f?f.buildBackendUrl:t(it))()}/vix_logo.png`},null,8,["height","width","src"]))]}),_:1})):R("",!0),h("div",Lo,[h("div",Ao,[h("div",qo,[m(B,{id:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(O),"onUpdate:modelValue":v[1]||(v[1]=z=>G(O)?O.value=z:null),size:"xs",class:"mr-2"},null,8,["id","modelValue"]),h("label",{class:"cursor-pointer select-none",for:`toggle-compare-${e.flowResult.task_id}-${e.outputsIndex}`}," Comparison ",8,Eo)]),h("div",Do,[m(B,{id:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`,modelValue:t(U),"onUpdate:modelValue":v[2]||(v[2]=z=>G(U)?U.value=z:null),disabled:!t(O),size:"xs",class:"mr-2"},null,8,["id","modelValue","disabled"]),h("label",{class:"cursor-pointer select-none",for:`toggle-original-${e.flowResult.task_id}-${e.outputsIndex}`}," Original ",8,Wo)])]),t(O)?(d(),j("div",Ho,[m(b,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(U)||t(a).parent_task_id===null,onClick:_},null,8,["disabled"]),m(D,{items:c(t(a)),mode:"click",popper:{placement:"top"}},{default:y(()=>[m(b,{variant:"link",color:"white",size:"xs"},{default:y(()=>[E(" #"+Q(t(U)?e.flowResult.task_id:t(a).task_id),1)]),_:1})]),_:1},8,["items"]),m(b,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(U)||!t(x),onClick:w},null,8,["disabled"]),m(n,{class:"mx-3",name:"i-heroicons-arrows-right-left-16-solid"}),m(b,{icon:"i-heroicons-arrow-small-left-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:!r(l.flowResult,t(u).parent_task_id,t(u).parent_task_node_id)||t(u).parent_task_id===Number(t(a).task_id)||t(u).parent_task_id===null,onClick:I},null,8,["disabled"]),m(D,{items:p(t(u)),mode:"click",popper:{placement:"top"}},{error:y(({item:z})=>[h("div",{class:"text-red-500 truncate",title:z.label},Q(z.label),9,Go)]),default:y(()=>[m(b,{class:le({"text-blue-500":t(u).progress!==100&&t(u).error==="","text-red-500":t(u).error!==""}),variant:"link",color:"white",size:"xs"},{default:y(()=>[E(Q(t(u).progress===100?"#"+t(u).task_id:Math.ceil(t(u).progress)+"%"),1)]),_:1},8,["class"])]),_:1},8,["items"]),m(b,{icon:"i-heroicons-arrow-small-right-20-solid",size:"2xs",variant:"soft",color:"cyan",disabled:t(u).child_tasks.length===0,onClick:F},null,8,["disabled"]),m(s,{class:"ml-3",text:"Reset comparison",popper:{placement:"top"}},{default:y(()=>[m(b,{icon:"i-heroicons-arrow-path-rounded-square-solid",size:"2xs",variant:"outline",color:"white",onClick:v[3]||(v[3]=()=>k(!1,e.flowResult))})]),_:1})])):R("",!0)])])}}}),Jo={class:"image-output"},Qo={class:"flex flex-col basis-full justify-between mx-2"},Ko=te({__name:"Image",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const l=me();return(o,i)=>{var p,_;const r=Xo,a=Ce,u=ie,c=Ue;return d(),j("div",Jo,[e.flowResult.outputs.length===1?(d(),j(ne,{key:0},[(p=e.flowResult)!=null&&p.child_tasks&&((_=e.flowResult)==null?void 0:_.child_tasks.length)>0?(d(),S(r,{key:0,"flow-result":e.flowResult,"open-image-modal":e.openImageModal},null,8,["flow-result","open-image-modal"])):e.flowResult.outputs.length===1?(d(),S(a,{key:1,class:"mb-2 mx-auto rounded-lg cursor-pointer",height:t(l).$state.outputMaxSize,width:t(l).$state.outputMaxSize,draggable:"false",fit:"cover",loading:"lazy",src:("outputResultSrc"in o?o.outputResultSrc:t(ce))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id}),onClick:i[0]||(i[0]=w=>e.openImageModal(("outputResultSrc"in o?o.outputResultSrc:t(ce))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})))},null,8,["height","width","src"])):R("",!0)],64)):e.flowResult.outputs.length>1?(d(),S(c,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((w,x)=>({task_id:e.flowResult.task_id,node_id:w.comfy_node_id,index:x})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(({item:w})=>{var x;return[h("div",Qo,[(x=e.flowResult)!=null&&x.child_tasks&&("hasChildTaskByParentTaskNodeId"in o?o.hasChildTaskByParentTaskNodeId:t(Ft))(e.flowResult,w.index,w.node_id)?(d(),S(r,{key:0,"flow-result":e.flowResult,"outputs-index":w.index,"open-image-modal":e.openImageModal},null,8,["flow-result","outputs-index","open-image-modal"])):(d(),S(a,{key:1,class:le(`mb-2 h-100 max-h-[${t(l).$state.outputMaxSize}px] mx-auto rounded-lg cursor-pointer`),draggable:"false",height:t(l).$state.outputMaxSize,width:t(l).$state.outputMaxSize,fit:"cover",loading:"lazy",src:("outputResultSrc"in o?o.outputResultSrc:t(ce))(w),onClick:I=>e.openImageModal(("outputResultSrc"in o?o.outputResultSrc:t(ce))(w))},null,8,["class","height","width","src","onClick"])),m(u,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,w.index)}},{default:y(()=>i[1]||(i[1]=[E(" Send to flow ")])),_:2},1032,["onClick"])])]}),_:1},8,["items"])):R("",!0)])}}}),Yo={class:"video-output"},Zo=["width","height"],en=["src"],tn={class:"flex flex-col basis-full justify-between mx-2"},ln=["width","height"],on=["src"],nn=te({__name:"Video",props:{flowResult:{type:Object,required:!0},handleSendToFlow:{type:Function,required:!0},openImageModal:{type:Function,required:!0}},setup(e){const l=me();return(o,i)=>{const r=ie,a=Ue;return d(),j("div",Yo,[e.flowResult.outputs.length===1?(d(),j("video",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",style:{"max-height":"80vh"},width:t(l).$state.outputMaxSize,height:t(l).$state.outputMaxSize},[h("source",{src:("outputResultSrc"in o?o.outputResultSrc:t(ce))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,en)],8,Zo)):e.flowResult.outputs.length>1?(d(),S(a,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((u,c)=>({task_id:e.flowResult.task_id,node_id:u.comfy_node_id,index:c})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(({item:u})=>[h("div",tn,[h("video",{controls:"",class:"mb-2 mx-auto rounded-lg",width:t(l).$state.outputMaxSize,height:t(l).$state.outputMaxSize},[h("source",{src:("outputResultSrc"in o?o.outputResultSrc:t(ce))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,on)],8,ln),m(r,{class:"mt-2 w-fit mx-auto",icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",size:"xs",variant:"outline",onClick:()=>{e.handleSendToFlow(e.flowResult,u.index)}},{default:y(()=>i[0]||(i[0]=[E(" Send to flow ")])),_:2},1032,["onClick"])])]),_:1},8,["items"])):R("",!0)])}}}),an={class:"audio-output"},sn=["src"],rn={class:"flex flex-col basis-full justify-between mx-2"},un=["src"],dn=te({__name:"Audio",props:{flowResult:{type:Object,required:!0}},setup(e){return(l,o)=>{const i=Ue;return d(),j("div",an,[e.flowResult.outputs.length===1?(d(),j("audio",{key:0,controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in l?l.outputResultSrc:t(ce))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,sn)):e.flowResult.outputs.length>1?(d(),S(i,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((r,a)=>({task_id:e.flowResult.task_id,node_id:r.comfy_node_id,index:a})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4 md:hidden"}},page:1,indicators:""},{default:y(()=>[h("div",rn,[h("audio",{controls:"",class:"mb-2 mx-auto rounded-lg",src:("outputResultSrc"in l?l.outputResultSrc:t(ce))({task_id:e.flowResult.task_id,node_id:e.flowResult.outputs[0].comfy_node_id})},null,8,un)])]),_:1},8,["items"])):R("",!0)])}}}),cn={class:"text-output"},mn={key:0,class:"mb-2 mx-auto rounded-lg text-md p-4 pr-8 border border-slate-500 relative"},fn=te({__name:"Text",props:{flowResult:{type:Object,required:!0}},setup(e){const l=e,o=me(),i=xe(),r=$(!1),a=$({});function u(c,p){const{$apiFetch:_}=Ee(),w=ce({task_id:c.task_id,node_id:p.comfy_node_id});return _(w).then(x=>{a.value[p.comfy_node_id]=x}).catch(x=>{console.error(x)}).finally(()=>{r.value=!1})}return Me(()=>{Promise.all(l.flowResult.outputs.filter(c=>c.type==="text").map(c=>u(l.flowResult,c)))}),(c,p)=>{const _=ie,w=Ue;return d(),j("div",cn,[e.flowResult.outputs.length===1?(d(),j("div",mn,[t(r)?R("",!0):(d(),S(_,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:p[0]||(p[0]=()=>{("useCopyToClipboard"in c?c.useCopyToClipboard:t(De))().copy(t(a)[e.flowResult.outputs[0].comfy_node_id]),t(i).add({title:"Clipboard",description:"Text copied to clipboard"})})})),h("p",null,Q(t(r)?"Loading...":t(a)[e.flowResult.outputs[0].comfy_node_id]),1)])):e.flowResult.outputs.length>1?(d(),S(w,{key:1,class:"mb-3 rounded-lg overflow-hidden",items:e.flowResult.outputs.map((x,I)=>({task_id:e.flowResult.task_id,node_id:x.comfy_node_id,index:I})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 mt-4"}},page:1,indicators:"",arrows:""},{default:y(({item:x})=>[h("div",{class:"mb-2 mx-2 rounded-lg text-md p-4 border border-slate-500 shadow-sm overflow-y-auto relative",style:_t({"max-height":Math.ceil(t(o).$state.outputMaxSize/2)+"px"})},[t(r)?R("",!0):(d(),S(_,{key:0,variant:"outline",class:"absolute top-2 right-2 z-10",icon:"i-mdi-content-copy",size:"xs",color:"white",onClick:()=>{("useCopyToClipboard"in c?c.useCopyToClipboard:t(De))().copy(t(a)[x.node_id]),t(i).add({title:"Clipboard",description:"Text copied to clipboard"})}},null,8,["onClick"])),h("p",null,Q(t(r)?"Loading...":t(a)[x.node_id]),1)],4)]),_:1},8,["items"])):R("",!0)])}}}),pn={class:"w-full h-full p-4"},gn={class:"mt-4 max-h-96 overflow-y-auto text-sm whitespace-pre-wrap"},vn=te({__name:"Params",props:{flowResult:{type:Object,required:!0}},setup(e){const l=e,o=$(!1),i=L(()=>["#"+l.flowResult.task_id,...Object.keys(l.flowResult.input_params_mapped).filter(c=>l.flowResult.input_params_mapped[c].value&&l.flowResult.input_params_mapped[c].value!=="").map(c=>o.value&&l.flowResult.translated_input_params_mapped&&l.flowResult.translated_input_params_mapped[c]?`${l.flowResult.input_params_mapped[c].display_name}: ${l.flowResult.translated_input_params_mapped[c].value}`:`${l.flowResult.input_params_mapped[c].display_name}: ${l.flowResult.input_params_mapped[c].value}`)].join(" | ")+`${l.flowResult.execution_time?" | execution_time: "+l.flowResult.execution_time.toFixed(2)+"s":""}`);pt(()=>{l.flowResult.showInputFiles=!1,l.flowResult.showExecutionDetailsModal=!1});const r=L(()=>l.flowResult.execution_details&&l.flowResult.extra_flags!==null),a=L(()=>{const c={unload_models:l.flowResult.extra_flags.unload_models,max_memory_usage:l.flowResult.execution_details.max_memory_usage,disable_smart_memory:l.flowResult.execution_details.disable_smart_memory,vram_state:l.flowResult.execution_details.vram_state};return JSON.stringify(c,null,"	")});function u(){const c={extra_flags:l.flowResult.extra_flags,execution_details:l.flowResult.execution_details},p=new Blob([JSON.stringify(c,null,"	")],{type:"application/json"}),_=URL.createObjectURL(p),w=document.createElement("a");w.href=_,w.download=`${l.flowResult.task_id}_execution_details.json`,w.click(),window.URL.revokeObjectURL(_)}return(c,p)=>{const _=ie,w=$e,x=He,I=We,F=_e;return d(),j(ne,null,[t(r)?(d(),S(w,{key:0,modelValue:e.flowResult.showExecutionDetailsModal,"onUpdate:modelValue":p[2]||(p[2]=k=>e.flowResult.showExecutionDetailsModal=k)},{default:y(()=>[m(_,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:p[0]||(p[0]=()=>e.flowResult.showExecutionDetailsModal=!1)}),h("div",pn,[p[6]||(p[6]=h("h3",{class:"text-center font-bold"}," Execution details ",-1)),h("div",gn,Q(t(a)),1),m(_,{class:"mt-3",icon:"i-heroicons-arrow-down-tray-20-solid",variant:"outline",size:"xs",color:"gray",onClick:p[1]||(p[1]=()=>u())},{default:y(()=>p[5]||(p[5]=[E(" Download raw details ")])),_:1})])]),_:1},8,["modelValue"])):R("",!0),e.flowResult.translated_input_params_mapped&&Object.keys(e.flowResult.translated_input_params_mapped).length>0?(d(),S(x,{key:1,text:t(o)?"Hide translated input params":"Show translated input params",popper:{placement:"top"}},{default:y(()=>[m(_,{class:"mb-2 mr-2",color:"white",size:"xs",variant:"outline",icon:"i-heroicons-language-solid",onClick:p[3]||(p[3]=()=>{o.value=!t(o)})})]),_:1},8,["text"])):R("",!0),(d(!0),j(ne,null,fe(t(i).split("|"),k=>(d(),S(I,{key:k,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer",variant:"soft",color:"gray",onClick:()=>{const U=("useCopyToClipboard"in c?c.useCopyToClipboard:t(De))(),O=k.indexOf(":"),P=k.substring(O+1).trim();U.copy(P),("useToast"in c?c.useToast:t(xe))().add({title:"Clipboard",description:`${k.split(":")[0].trim()} copied to clipboard`,timeout:2e3})}},{default:y(()=>[E(Q(k),1)]),_:2},1032,["onClick"]))),128)),e.flowResult.input_files.length>0?(d(),S(I,{key:2,class:"mr-2 mb-2 last:mr-0 hover:cursor-pointer select-none",variant:"subtle",color:"sky",onClick:p[4]||(p[4]=()=>{e.flowResult.showInputFiles=!e.flowResult.showInputFiles})},{default:y(()=>[m(F,{name:e.flowResult.showInputFiles?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-1"},null,8,["name"]),m(F,{name:"i-heroicons-document-solid",class:"mr-1"}),E(" "+Q(`input_files: ${e.flowResult.input_files.length}`),1)]),_:1})):R("",!0)],64)}}}),wn={key:0,class:le("w-full p-1")},hn={class:"flex flex-col basis-full justify-between mx-2"},yn=te({__name:"InputFiles",props:{flowResult:{type:Object,required:!0}},setup(e){const l=me(),o=(u,c)=>`${Mt()}/tasks/inputs?task_id=${u}&input_index=${c}`,i=$(!1),r=$(""),a=$(0);return(u,c)=>{var I,F;const p=Ce,_=Ue,w=ie,x=$e;return e.flowResult.showInputFiles?(d(),j("div",wn,[((I=Object.keys(e.flowResult.input_files))==null?void 0:I.length)===1?(d(),S(p,{key:0,class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(l).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",src:o(e.flowResult.task_id,0),onClick:c[0]||(c[0]=()=>{r.value=o(e.flowResult.task_id,0),a.value=0,i.value=!0})},null,8,["class","src"])):R("",!0),((F=Object.keys(e.flowResult.input_files))==null?void 0:F.length)>1?(d(),S(_,{key:1,items:Object.keys(e.flowResult.input_files).map(k=>({task_id:e.flowResult.task_id,index:k})),ui:{item:"basis-full md:basis-1/2",indicators:{wrapper:"relative bottom-0 my-2"}},page:1,indicators:""},{default:y(({item:k})=>[h("div",hn,[m(p,{class:le(`mb-5 mx-auto rounded-lg cursor-pointer max-h-[${t(l).$state.outputMaxSize}px] w-auto`),fit:"outside",loading:"lazy",draggable:"false",src:o(k.task_id,k.index),onClick:()=>{r.value=o(e.flowResult.task_id,k.index),a.value=k.index,i.value=!0}},null,8,["class","src","onClick"])])]),_:1},8,["items"])):R("",!0),m(x,{modelValue:t(i),"onUpdate:modelValue":c[3]||(c[3]=k=>G(i)?i.value=k:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[m(w,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:c[1]||(c[1]=()=>i.value=!1)}),h("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:c[2]||(c[2]=tt(()=>i.value=!1,["left"]))},[t(r)?(d(),S(p,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",placeholder:"/vix_logo.png",src:t(r)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])])):R("",!0)}}}),bn={class:"p-4"},kn={class:"flex justify-center mb-4"},xn={key:0,class:"text-sm text-slate-500 text-center mb-4"},_n={class:"text-md text-center text-red-500 mb-4"},$n={key:1},Cn={class:"flex items-center justify-between"},Sn=te({__name:"SendToFlowModal",props:Te({flowResult:{type:Object,required:!1,default:()=>null},outputImgSrc:{type:String,required:!0},outputParamIndex:{type:Number,required:!0},inputParamsMapped:{type:Object,required:!0},isChildTask:{type:Boolean,required:!1,default:!1},translatePrompt:{type:Boolean,required:!1,default:!1}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:Te(["update:show"],["update:show"]),setup(e,{emit:l}){const o=e,i=Fe(e,"show"),r=me(),a=L(()=>r.sub_flows.map(I=>({value:I.name,label:`${I.display_name} - ${I.description}`}))),u=$(a.value[0]||""),c=$(!1),p=l;function _(){console.debug("[Send to flow]: ",u.value);const I=r.sub_flows.find(k=>k.name===u.value.value&&k.display_name===u.value.label.split(" - ")[0]);if(console.debug("[Send to flow]: targetFlow",I),!I){xe().add({title:`Target sub-flow "${u.value.value}" not found`,description:"Please, verify the target sub-flow is installed and available and try again",timeout:5e3});return}const F=I.input_params.reduce((k,U)=>{const O={};return U.type==="text"?O[U.name]={value:U.default||"",type:U.type}:U.type==="number"?O[U.name]={value:U.default||0,type:U.type}:U.type==="image"?O[U.name]={value:JSON.stringify({task_id:o.flowResult.task_id,node_id:o.flowResult.outputs.length>1?o.flowResult.outputs[o.outputParamIndex].comfy_node_id:o.flowResult.outputs[0].comfy_node_id})||"",type:U.type}:U.type==="list"?O[U.name]={value:U.default||Object.keys(U.options)[0]||"",type:U.type,options:U.options}:U.type==="bool"?O[U.name]={value:U.default||!1,type:U.type}:["range","range_scale"].includes(U.type)&&(O[U.name]={value:U.default||0,type:U.type}),k.push(O),k},[]);console.debug("[Send to flow]: input_params_map",F),c.value=!0,r.runFlow(I,F,1,o.translatePrompt,w.value,w.value?Number(o.flowResult.task_id):null).finally(()=>{c.value=!1,p("update:show",!1)})}const w=$(!1),x=L(()=>{var I;return o.flowResult.progress===100&&((I=o.flowResult)==null?void 0:I.error)===""});return et(()=>{var F,k;const I=o.flowResult?((k=(F=o==null?void 0:o.flowResult)==null?void 0:F.outputs[o.outputParamIndex])==null?void 0:k.type)??"image":"image";r.fetchSubFlows(I).then(()=>{u.value=a.value[0]||""}),w.value=!1}),(I,F)=>{const k=Ce,U=gt,O=ot,P=Ge,f=ie,v=$e;return d(),S(v,{modelValue:i.value,"onUpdate:modelValue":F[2]||(F[2]=C=>i.value=C),class:"z-[90]",transition:!1},{default:y(()=>[h("div",bn,[F[4]||(F[4]=h("h2",{class:"text-lg text-center mb-4"},"Send to flow",-1)),h("div",kn,[t(x)?(d(),S(k,{key:0,src:e.outputImgSrc,class:"w-1/2 rounded-lg",draggable:!1},null,8,["src"])):(d(),S(U,{key:1,color:"orange",icon:"i-heroicons-exclamation-circle-solid",title:`Task is still running (${Math.ceil(e.flowResult.progress)}%, ${e.flowResult.execution_time.toFixed(2)}s)`,description:e.flowResult.error!==""?e.flowResult.error:""},null,8,["title","description"]))]),e.inputParamsMapped?(d(),j("p",xn,Q(["#"+e.flowResult.task_id,...Object.keys(e.inputParamsMapped).filter(C=>e.inputParamsMapped[C].value!=="").map(C=>`${e.inputParamsMapped[C].display_name}: ${e.inputParamsMapped[C].value}`)].join(" | ")),1)):R("",!0),h("p",_n,[t(a).length>0?(d(),S(O,{key:0,modelValue:t(u),"onUpdate:modelValue":F[0]||(F[0]=C=>G(u)?u.value=C:null),class:"w-full",size:"lg",options:t(a)},null,8,["modelValue","options"])):(d(),j("span",$n,"No sub-flows available"))]),e.isChildTask?(d(),S(U,{key:1,class:"mb-4",icon:"i-heroicons-exclamation-circle-solid",title:"Child task",description:"The latest child task is always used as input for sub-flow"})):R("",!0),h("div",Cn,[m(P,{modelValue:t(w),"onUpdate:modelValue":F[1]||(F[1]=C=>G(w)?w.value=C:null),label:"Bind as child task"},null,8,["modelValue"]),m(f,{icon:"i-heroicons-arrow-uturn-up-solid",color:"violet",variant:"outline",loading:t(c),disabled:t(a).length===0||e.isChildTask&&!t(x),onClick:_},{default:y(()=>F[3]||(F[3]=[E(" Send ")])),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])}}}),In={class:"flex flex-col md:flex-row items-center justify-center mb-5 sticky top-1 z-[10]"},Mn={class:"flex items-center justify-center"},Rn={class:"p-4"},Fn={class:"text-md text-center text-red-500 mb-4"},Un={class:"flex justify-center"},Pn={key:0,class:"results overflow-auto"},zn=["id"],Vn={class:"text-sm text-slate-500 text-center mb-1"},jn={class:"w-5/6 mx-auto flex flex-wrap items-center justify-center"},On={class:"w-full flex justify-center items-center"},Tn={key:1,class:"text-center text-slate-500"},Nn=te({__name:"Output",emits:["copy-prompt-inputs"],setup(e,{emit:l}){const o=me(),i=L(()=>{var n;return o.flowResultsByName((n=o.currentFlow)==null?void 0:n.name).length>0||!1}),r=L(()=>{var n;return o.flowResultsByName((n=o.currentFlow)==null?void 0:n.name)||[]}),a=L(()=>o.$state.resultsPageSize);ge(r,()=>{r.value.length<=o.$state.resultsPageSize?o.$state.resultsPage=1:o.$state.resultsPage>Math.ceil(r.value.length/o.$state.resultsPageSize)&&(o.$state.resultsPage=Math.ceil(r.value.length/o.$state.resultsPageSize))}),ge(a,()=>{r.value.length<=o.$state.resultsPageSize?o.$state.resultsPage=1:o.$state.resultsPage>Math.ceil(r.value.length/o.$state.resultsPageSize)&&(o.$state.resultsPage=Math.ceil(r.value.length/o.$state.resultsPageSize)),o.saveUserOptions()}),pt(()=>{o.$state.flow_results_filter="",o.$state.resultsPage=1});const u=l;function c(n){u("copy-prompt-inputs",n.input_params_mapped)}function p(n){k.value=n,F.value=!0}const _=$(null),w=$(!1);window.addEventListener("scroll",()=>{var n;w.value=window.scrollY>(((n=_.value)==null?void 0:n.offsetTop)+window.screen.height||0)});const x=L(()=>o.$state.resultsPage);ge(x,()=>{const n=document.getElementById("output-container");n&&n.scrollIntoView({behavior:"smooth"})});const I=$(!1),F=$(!1),k=$(""),U=$(!1),O=$(!1),P=$(!1),f=$(""),v=$(null),C=$({}),q=$(0),B=$(!1);function b(n,s=0){if(n.child_tasks.length===0||!Ft(n,s,n.outputs[s].comfy_node_id))v.value=n,f.value=ce({task_id:n.task_id,node_id:n.outputs[s].comfy_node_id}),C.value=n.input_params_mapped,B.value=!1;else{const z=Rt(n,s,n.outputs[s].comfy_node_id);v.value=z,C.value=n.input_params_mapped,f.value=ce({task_id:z.task_id,node_id:z.outputs[0].comfy_node_id}),B.value=!0}q.value=s,P.value=!0}function D(n){var K;const s=n.extra_flags!==null&&((K=n==null?void 0:n.extra_flags)==null?void 0:K.profiler_execution),z=[{label:"Comfy flow",labelClass:"text-blue-500 text-sm",icon:"i-heroicons-arrow-down-tray",iconClass:"bg-blue-500 h-4 w-4",click:()=>{var Z;return o.downloadFlowComfy((Z=o.currentFlow)==null?void 0:Z.name,n.task_id)}}];s&&z.push({label:"Execution details",labelClass:"text-orange-500 text-sm",icon:"i-mdi-bug",iconClass:"bg-orange-500 h-4 w-4",click:()=>{n.execution_details?n.showExecutionDetailsModal=!0:o.fetchTaskHistoryItem(n.task_id).then(Z=>{n.execution_details=Z.execution_details,n.showExecutionDetailsModal=!0})}});const H=[[{label:"Use params",labelClass:"text-cyan-500 text-sm",icon:"i-heroicons-document-duplicate-16-solid",iconClass:"bg-cyan-500 h-4 w-4",click:()=>c(n)}],z];return n.outputs.length===1&&n.outputs.every(Z=>Z.type==="image")&&H.splice(1,0,[{label:"Send to flow",labelClass:"text-violet-500 text-sm",icon:"i-heroicons-arrow-uturn-up-solid",iconClass:"bg-violet-500 h-4 w-4",click:()=>{b(n)}}]),H}return(n,s)=>{var X;const z=No,H=_e,K=Ne,Z=al,re=rl,de=ie,ae=lt,ee=We,we=$e,he=Ko,ue=nn,ye=dn,ve=fn,T=vn,g=yn,M=Sn,A=Ce;return d(),j("div",{id:"output-container",ref_key:"outputContainer",ref:_,class:"w-full p-4 ring-1 ring-gray-200 dark:ring-gray-800 rounded-lg shadow-md my-10"},[m(z,{show:t(w),class:"fixed bottom-5 right-5",target:"output-container"},null,8,["show"]),h("h2",{class:"text-lg font-bold cursor-pointer select-none flex items-center mb-3",onClick:s[0]||(s[0]=()=>{I.value=!t(I)})},[m(H,{name:t(I)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),E(" Output ("+Q(t(r).filter(V=>V.parent_task_id===null).length)+") ",1)]),t(I)?R("",!0):(d(),j(ne,{key:0},[h("div",In,[m(K,{modelValue:t(o).$state.flow_results_filter,"onUpdate:modelValue":s[1]||(s[1]=V=>t(o).$state.flow_results_filter=V),icon:"i-heroicons-magnifying-glass-20-solid",color:"white",class:"md:mr-3",label:"Filter by prompt",trailing:!0,placeholder:"Filter results by prompt"},null,8,["modelValue"]),t(r).filter(V=>V.parent_task_id===null).length>t(o).$state.resultsPageSize?(d(),S(Z,{key:0,modelValue:t(o).$state.resultsPage,"onUpdate:modelValue":s[2]||(s[2]=V=>t(o).$state.resultsPage=V),class:"my-1 md:my-0","page-count":t(o).$state.resultsPageSize,total:t(r).filter(V=>V.parent_task_id===null).length,"show-first":"","show-last":""},null,8,["modelValue","page-count","total"])):R("",!0),h("div",Mn,[m(re,{modelValue:t(o).resultsPageSize,"onUpdate:modelValue":s[3]||(s[3]=V=>t(o).resultsPageSize=V),class:"md:mx-3 w-fit mr-3",options:[5,10,20,50,100],label:"Results per page"},null,8,["modelValue"]),m(ae,{items:[[{label:"Delete all results",labelClass:"text-red-500",icon:"i-heroicons-trash",iconClass:"dark:text-red-500 text-red-500",click:()=>U.value=!0}]],mode:"click",label:"Options",popper:{placement:"bottom-end"}},{default:y(()=>[m(de,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid"})]),_:1},8,["items"])]),m(we,{modelValue:t(U),"onUpdate:modelValue":s[6]||(s[6]=V=>G(U)?U.value=V:null),class:"z-[90]",transition:!1},{default:y(()=>[h("div",Rn,[s[15]||(s[15]=h("p",{class:"text-lg text-center mb-4"},"Are you sure you want to delete all results?",-1)),h("p",Fn,[s[11]||(s[11]=E(" All history and images of ")),m(ee,{class:"mx-1",color:"orange",variant:"outline"},{default:y(()=>[E(Q(t(o).currentFlow.display_name),1)]),_:1}),s[12]||(s[12]=E(" will be deleted. "))]),h("div",Un,[m(de,{class:"mr-2",color:"red",variant:"outline",loading:t(O),onClick:s[4]||(s[4]=()=>{var V;O.value=!0,t(o).deleteFlowResults((V=t(o).currentFlow)==null?void 0:V.name).then(()=>{O.value=!1,U.value=!1})})},{default:y(()=>s[13]||(s[13]=[E(" Yes ")])),_:1},8,["loading"]),m(de,{variant:"outline",onClick:s[5]||(s[5]=()=>U.value=!1)},{default:y(()=>s[14]||(s[14]=[E("No")])),_:1})])])]),_:1},8,["modelValue"])]),t(i)?(d(),j("div",Pn,[(d(!0),j(ne,null,fe(t(o).flowResultsByNamePaginated((X=t(o).currentFlow)==null?void 0:X.name),V=>(d(),j("div",{id:"task_id_"+V.task_id,key:V.task_id,class:"flex flex-col justify-center mx-auto mb-5"},[V.outputs.some(J=>["image","image-animated"].includes(J.type))?(d(),S(he,{key:0,"flow-result":V,"handle-send-to-flow":b,"open-image-modal":p},null,8,["flow-result"])):V.outputs.some(J=>J.type==="video")?(d(),S(ue,{key:1,"flow-result":V,"handle-send-to-flow":b,"open-image-modal":p},null,8,["flow-result"])):V.outputs.some(J=>J.type==="audio")?(d(),S(ye,{key:2,"flow-result":V},null,8,["flow-result"])):V.outputs.some(J=>J.type==="text")?(d(),S(ve,{key:3,"flow-result":V},null,8,["flow-result"])):R("",!0),h("div",Vn,[h("div",jn,[m(T,{"flow-result":V},null,8,["flow-result"])])]),m(g,{"flow-result":V},null,8,["flow-result"]),h("div",On,[m(de,{class:"mr-3",color:"red",icon:"i-heroicons-trash",variant:"outline",size:"xs",onClick:()=>t(o).deleteFlowHistory(V.task_id)},{default:y(()=>s[16]||(s[16]=[E(" Delete ")])),_:2},1032,["onClick"]),m(ae,{items:D(V),mode:"click",popper:{placement:"bottom-start"}},{default:y(()=>[m(de,{color:"white",icon:"i-heroicons-ellipsis-vertical-16-solid",size:"xs"})]),_:2},1032,["items"])])],8,zn))),128)),m(M,{show:t(P),"onUpdate:show":s[7]||(s[7]=V=>G(P)?P.value=V:null),"flow-result":t(v),"output-img-src":t(f),"output-param-index":t(q),"input-params-mapped":t(C),"is-child-task":t(B)},null,8,["show","flow-result","output-img-src","output-param-index","input-params-mapped","is-child-task"])])):(d(),j("p",Tn," No output results available "))],64)),m(we,{modelValue:t(F),"onUpdate:modelValue":s[10]||(s[10]=V=>G(F)?F.value=V:null),class:"z-[90]",transition:!1,fullscreen:""},{default:y(()=>[m(de,{class:"absolute top-4 right-4",icon:"i-heroicons-x-mark",variant:"ghost",onClick:s[8]||(s[8]=()=>F.value=!1)}),h("div",{class:"flex items-center justify-center w-full h-full p-4",onClick:s[9]||(s[9]=tt(()=>F.value=!1,["left"]))},[t(k)?(d(),S(A,{key:0,class:"lg:h-full",fit:"inside",loading:"lazy",src:t(k)},null,8,["src"])):R("",!0)])]),_:1},8,["modelValue"])],512)}}}),Bn=el("civitAiStore",{actions:{fetchFlowLoras(e,l,o=50,i=null){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:r}=Ee();let u=`https://civitai.com/api/v1/models?baseModels=${e.lora_connect_points[Object.keys(e.lora_connect_points)[0]].base_model_type}&types=LORA&limit=${o}`;i&&(i.includes(window.location.hostname)&&(i=i.replace(window.location.hostname,"civitai.com")),u=i);const c=`/other/proxy?target=${encodeURIComponent(u)}`;return r(c,{method:"GET",headers:{Authentication:"Bearer "+l,Accept:"application/json"}})},fetchFlowLorasByHash(e,l,o){if(!e.lora_connect_points||Object.keys(e.lora_connect_points).length!==1){console.debug("Flow does not have lora_connect_points or has more than one, skipping fetching loras");return}const{$apiFetch:i}=Ee(),r=`https://civitai.com/api/v1/model-versions/by-hash/${o}`,a=`/other/proxy?target=${encodeURIComponent(r)}`;return i(a,{method:"GET",headers:{Authentication:"Bearer "+l,Accept:"application/json"}})}}}),Ln={class:"p-4 overflow-y-auto relative"},An={key:1},qn={class:"flex flex-col justify-between w-full md:flex-row md:gap-4 md:items-center lg:items-start"},En={class:"flex flex-col gap-2 lg:flex-row md:justify-end items-start w-full"},Dn={class:"flex flex-col md:flex-row flex-wrap gap-2 justify-between items-center w-full px-4 py-3"},Wn={class:"flex items-center gap-1.5"},Hn={class:"flex gap-1.5 items-center"},Gn={class:"flex items-center h-5"},Xn=["checked","indeterminate","onChange"],Jn={key:0,class:"flex items-center h-5"},Qn=["checked","onChange"],Kn=["href"],Yn=["innerHTML"],Zn={class:"p-4 max-h-64 max-w-xl overflow-y-auto"},ea={key:0},ta={class:"flex items-center"},la={class:"flex items-center"},oa={key:0,class:"flex justify-center space-x-2 w-full"},na={key:1,controls:"",width:256,height:256},aa=["src"],sa={class:"flex justify-end"},ia=te({__name:"LoraSelectorModal",props:Te({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const l=e,o=Fe(e,"show"),i=xe(),r=me(),a=St(),u=Bn(),c=$(!1),p=$({items:[],metadata:{}}),_=L(()=>a.settingsMap.civitai_auth_token.value!==""),w=L(()=>a.settingsMap.civitai_auth_token.value||""),x=[{key:"name",label:"Name",sortable:!0,class:""},{key:"description",label:"Description",sortable:!1,class:""},{key:"trigger_words",label:"Trigger words",sortable:!1,class:""},{key:"nsfw",label:"NSFW",sortable:!1,class:""},{key:"statsDownloadCount",label:"Download count",sortable:!1,class:""},{key:"statsThumbsUpCount",label:"Thumbs up",sortable:!1,class:""},{key:"modelVersion",label:"Model version",sortable:!1,class:""},{key:"actions",label:"Actions",sortable:!1,class:""}],I=$([]),F=$({openedRows:[],row:{}}),k=$(""),U=()=>{k.value=""},O=L(()=>{var g;let T=((g=p.value)==null?void 0:g.items)||[];return k.value&&(T=T.filter(M=>M.name.toLowerCase().includes(k.value.toLowerCase()))),T.forEach(M=>{!P.value[M.id]&&(M==null?void 0:M.modelVersions.length)>0&&(P.value[M.id]=M==null?void 0:M.modelVersions[0].name);const A=Object.keys(ue.value);M.modelVersions.forEach(X=>{A.includes(X.files[0].hashes.SHA256.toLowerCase())&&ue.value[X.files[0].hashes.SHA256.toLowerCase()]!==null&&(P.value[M.id]=X.name,M.currentFlowLora=!0,I.value.includes(M)||I.value.push(M))})}),T}),P=$({});function f(T){var g;return((g=T.modelVersions.find(M=>M.name===P.value[T.id]))==null?void 0:g.images)||T.modelVersions[0].images||[]}function v(T){var g;return((g=T.modelVersions.find(M=>M.name===P.value[T.id]))==null?void 0:g.trainedWords)||T.modelVersions[0].trainedWords||[]}const C=$(!0),q=$(""),B=$(l.flow.display_name),b=$(l.flow.description),D=$(l.flow.license),n=$(l.flow.required_memory_gb||0),s=$(l.flow.version);function z(){const T=Object.keys(l.flow.lora_connect_points)[0],M=l.flow.lora_connect_points[T].connected_loras.filter(V=>ue.value[V.hash]!==null).map(V=>({display_name:V.display_name,model_url:V.url,strength_model:V.strength_model})),A={[T]:[]};C.value&&A[T].push(...M);const X=I.value.reduce((V,J)=>{const W=J.modelVersions.find(pe=>pe.name===P.value[J.id]);if(!W||ue.value[W.files[0].hashes.SHA256.toLowerCase()])return V;const Y={strength_model:1,model_url:W.downloadUrl,display_name:J.name};return V.push(Y),V},[]);return A[T].push(...X),console.debug("[DEBUG] newFlowConnectionPoints: ",A),A}function H(T){const g=T.modelVersions.find(X=>X.name===P.value[T.id]);if(!g)return;const M=g.files[0].hashes.SHA256.toLowerCase();ue.value[M]&&(ue.value[M]=null);const A=I.value.indexOf(T);A!==-1&&I.value.splice(A,1),T.currentFlowLora=!1}const K=L(()=>r.flows.find(T=>T.name===q.value)),Z=L(()=>/^[a-z0-9_-]+$/i.test(q.value)),re=L(()=>q.value!==""&&Z&&!K.value),de=L(()=>q.value===""?"Flow name is required.":Z.value?K.value?"Flow name already exists.":"":"Flow name can only contain letters, numbers, dashes and underscores."),ae=L(()=>I.value.filter(T=>!ue.value[T.modelVersions[0].files[0].hashes.SHA256.toLowerCase()]).length!==0),ee=L(()=>ae.value&&re.value&&B.value!==""&&b.value!==""),we=L(()=>ae.value?re.value?B.value===""?"Please provide a display name.":b.value===""?"Please provide a description.":"":"Please provide a valid flow name.":"No LoRAs selected");function he(){if(I.value.length===0){i.add({title:"No LoRAs selected",description:"Please select at least one LoRA to apply and install."});return}const T={new_name:q.value,new_display_name:B.value,new_description:b.value,new_license:D.value,new_required_memory_gb:n.value,new_version:s.value,new_lora_connection_points:z()};console.debug("[DEBUG] Clone flow params: ",T),c.value=!0,r.cloneFlow(l.flow,T).then(()=>{r.fetchFlows();const g=Ut();i.add({title:"Flow clone applied",actions:[{label:"View flow",click:()=>{g.push("/workflows/"+q.value)}}]})}).catch(g=>{console.error("Error applying and installing flow: ",g.message||"Unknown error"),i.add({title:"Error applying and installing flow",description:"An error occurred while applying and installing the flow. See the console for more details."})}).finally(()=>{c.value=!1})}const ue=$({});function ye(){const T=l.flow.lora_connect_points[Object.keys(l.flow.lora_connect_points)[0]].connected_loras;console.debug("Flow LORAs: ",T),Promise.all(T.map(g=>{var M;return(M=u.fetchFlowLorasByHash(l.flow,w.value,g.hash))==null?void 0:M.then(A=>(g.hash in ue.value||(ue.value[g.hash]=A),A))})).then(()=>{console.debug("Fetched flow LORAs info: ",ue.value)}).catch(g=>{console.error("Error fetching flow LORAs info: ",g),i.add({title:"Error fetching flow LORAs info",description:"An error occurred while fetching LoRAs info for the flow. See the console for more details."})})}function ve(T=!1){var M;if(!l.flow||!w.value)return;c.value=!0,T||ye();let g=null;return T&&((M=p.value.metadata)!=null&&M.nextPage)&&(g=p.value.metadata.nextPage),u.fetchFlowLoras(l.flow,w.value,50,g).then(A=>{console.debug('Fetched flow "'+l.flow.name+'" loras: ',A);const X=l.flow.lora_connect_points[Object.keys(l.flow.lora_connect_points)[0]].base_model_type,V=A.items.reduce((J,W)=>(W.modelVersions=W.modelVersions.filter(Y=>Y.baseModel===X),W.modelVersions.length>0&&(p.value.items.find(Y=>Y.id===W.id)||J.push(W)),J),[]);return V.length===0&&i.add({title:"No more supported LoRAs",description:"No supported LoRAs available for the flow."}),p.value.items.push(...V),p.value.metadata=A.metadata,A}).catch(A=>{console.error('Error fetching flow "'+l.flow.name+'" loras: ',A),i.add({title:'Error fetching flow "'+l.flow.name+'" loras',description:"An error occurred while fetching LoRAs for the flow. See the console for more details."})}).finally(()=>{c.value=!1})}return(T,g)=>{const M=ie,A=tl,X=gt,V=Ne,J=Be,W=Ge,Y=He,pe=Ct,Pe=We,be=_e,ze=ot,Xe=Ce,Je=Ue,Qe=ul,Ke=Pt,oe=$e;return d(),S(oe,{modelValue:o.value,"onUpdate:modelValue":g[15]||(g[15]=N=>o.value=N),fullscreen:""},{default:y(()=>[h("div",Ln,[m(M,{class:"absolute top-3 right-3",icon:"i-heroicons-x-mark",variant:"ghost",onClick:g[0]||(g[0]=()=>o.value=!1)}),g[22]||(g[22]=h("h2",{class:"text-xl font-bold"},"Modify flow",-1)),g[23]||(g[23]=h("p",{class:"text-sm text-slate-500 my-2"}," Select LoRAs to modify the flow. New Flow will be created and installed with selected LoRAs. ",-1)),t(_)?(d(),j("div",An,[h("div",qn,[m(M,{class:"my-1",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",loading:t(c),onClick:g[1]||(g[1]=()=>{p.value={items:[],metadata:{}},ue.value={},U(),ve()})},{default:y(()=>g[17]||(g[17]=[E(" Fetch LoRAs models from CivitAI ")])),_:1},8,["loading"]),h("div",En,[m(J,{label:"New flow name",class:"flex justify-center flex-col w-full",error:t(de)},{default:y(()=>[m(V,{modelValue:t(q),"onUpdate:modelValue":g[2]||(g[2]=N=>G(q)?q.value=N:null),type:"text",placeholder:"unique_flow_name",onInput:g[3]||(g[3]=N=>{N.target.value=N.target.value.toLowerCase(),q.value=N.target.value.toLowerCase()})},null,8,["modelValue"])]),_:1},8,["error"]),m(J,{label:"New display name",class:"flex justify-center flex-col w-full",error:t(B)!==""?"":"Display name is required."},{default:y(()=>[m(V,{modelValue:t(B),"onUpdate:modelValue":g[4]||(g[4]=N=>G(B)?B.value=N:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),m(J,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(V,{modelValue:t(b),"onUpdate:modelValue":g[5]||(g[5]=N=>G(b)?b.value=N:null),type:"text",placeholder:"Description"},null,8,["modelValue"])]),_:1}),m(J,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(V,{modelValue:t(D),"onUpdate:modelValue":g[6]||(g[6]=N=>G(D)?D.value=N:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),m(J,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(V,{modelValue:t(n),"onUpdate:modelValue":g[7]||(g[7]=N=>G(n)?n.value=N:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),m(J,{label:"Version",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(V,{modelValue:t(s),"onUpdate:modelValue":g[8]||(g[8]=N=>G(s)?s.value=N:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})])]),m(Ke,{class:"w-full",ui:{base:"",ring:"",divide:"divide-y divide-gray-200 dark:divide-gray-700",header:{padding:"px-4 py-5"},body:{padding:"",base:"divide-y divide-gray-200 dark:divide-gray-700"},footer:{padding:"p-4"}}},{footer:y(()=>[h("div",sa,[m(M,{class:"mr-2",variant:"outline",icon:"i-heroicons-arrow-down-on-square-stack",color:"blue",disabled:t(p).items.length===0||t(p).items.length>0&&!t(p).metadata.nextPage,loading:t(c),onClick:g[14]||(g[14]=()=>{ve(!0)})},{default:y(()=>g[21]||(g[21]=[E(" Load more ")])),_:1},8,["disabled","loading"])])]),default:y(()=>[h("div",Dn,[h("div",Wn,[m(V,{modelValue:t(k),"onUpdate:modelValue":g[9]||(g[9]=N=>G(k)?k.value=N:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:"Filter by name..."},null,8,["modelValue"])]),h("div",Hn,[t(ae)?(d(),S(W,{key:0,modelValue:t(C),"onUpdate:modelValue":g[10]||(g[10]=N=>G(C)?C.value=N:null),label:"Keep previous LoRAs",class:"mr-2"},null,8,["modelValue"])):R("",!0),t(ae)?(d(),S(M,{key:1,variant:"outline",icon:"i-heroicons-x-circle",color:"orange",class:"mr-2",onClick:g[11]||(g[11]=()=>t(I).splice(0))},{default:y(()=>g[18]||(g[18]=[E(" Clear selection ")])),_:1})):R("",!0),m(Y,{text:t(we)},{default:y(()=>[m(M,{variant:"outline",icon:"i-heroicons-check-16-solid",disabled:!t(ee),loading:t(c),onClick:he},{default:y(()=>g[19]||(g[19]=[E(" Apply and install ")])),_:1},8,["disabled","loading"])]),_:1},8,["text"])])]),m(Qe,{modelValue:t(I),"onUpdate:modelValue":g[12]||(g[12]=N=>G(I)?I.value=N:null),expand:t(F),"onUpdate:expand":g[13]||(g[13]=N=>G(F)?F.value=N:null),columns:x,rows:t(O),loading:t(c),ui:{thead:"sticky top-0 dark:bg-gray-800 bg-white z-10",tr:{base:"dark:hover:bg-slate-800"}}},{caption:y(()=>g[20]||(g[20]=[h("caption",{class:"text-slate-500 text-sm py-1"},"Only supported LORAs for the basic model type are listed",-1)])),"select-header":y(({indeterminate:N,checked:se,change:Le})=>[h("div",Gn,[h("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:se,indeterminate:N&&t(ae),onChange:nt=>Le(nt.target.checked)},null,40,Xn)])]),"select-data":y(({checked:N,change:se,row:Le})=>[Le!=null&&Le.currentFlowLora?R("",!0):(d(),j("div",Jn,[h("input",{type:"checkbox",class:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent dark:indeterminate:bg-current dark:indeterminate:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent form-checkbox rounded bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 focus-visible:ring-2 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 text-primary-500 dark:text-primary-400","aria-label":"Select row",checked:N,onChange:nt=>se(nt.target.checked)},null,40,Qn)]))]),"name-data":y(({row:N})=>[h("a",{href:`https://civitai.com/models/${N.id}`,target:"_blank",class:"text-blue-500 underline"},Q(N.name),9,Kn)]),"description-data":y(({row:N})=>[m(pe,null,{panel:y(()=>[h("div",{class:"model-description p-4 max-h-64 max-w-xl overflow-y-auto",innerHTML:N.description},null,8,Yn)]),default:y(()=>[m(M,{color:"white",label:"Description","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:2},1024)]),"trigger_words-data":y(({row:N})=>[m(pe,null,{panel:y(()=>[h("div",Zn,[v(N).length===0?(d(),j("p",ea,"No trigger words available for this model version.")):(d(!0),j(ne,{key:1},fe(v(N),se=>(d(),S(Pe,{key:se,class:"flex flex-wrap gap-3 my-1 whitespace-normal",label:se,color:"white",variant:"outline"},null,8,["label"]))),128))])]),default:y(()=>[m(M,{color:"white",label:`Trigger words (${v(N).length})`,"trailing-icon":"i-heroicons-chevron-down-20-solid"},null,8,["label"])]),_:2},1024)]),"nsfw-data":y(({row:N})=>[m(Y,{text:`NSFW level: ${N.nsfwLevel}`,class:"pl-4"},{default:y(()=>[m(be,{name:N.nsfw?"i-heroicons-x-circle":"i-heroicons-check-circle",class:le({"text-red-500":N.nsfw,"text-green-500":!N.nsfw})},null,8,["name","class"])]),_:2},1032,["text"])]),"statsThumbsUpCount-data":y(({row:N})=>[h("div",ta,[m(be,{name:"i-heroicons-hand-thumb-up-solid",class:"text-green-500 mr-1"}),h("span",null,Q(N.stats.thumbsUpCount),1)])]),"statsDownloadCount-data":y(({row:N})=>[h("div",la,[m(be,{name:"i-heroicons-arrow-down-circle",class:"text-blue-500 mr-1"}),h("span",null,Q(N.stats.downloadCount),1)])]),"modelVersion-data":y(({row:N})=>[m(ze,{modelValue:t(P)[N.id],"onUpdate:modelValue":se=>t(P)[N.id]=se,options:N.modelVersions.map(se=>se.name)},null,8,["modelValue","onUpdate:modelValue","options"])]),"actions-data":y(({row:N})=>[N!=null&&N.currentFlowLora?(d(),S(Y,{key:1,text:"Remove previously selected LoRA"},{default:y(()=>[m(M,{icon:"i-heroicons-minus-16-solid",variant:"outline",color:"orange",onClick:se=>H(N)},null,8,["onClick"])]),_:2},1024)):(d(),S(M,{key:0,icon:t(I).includes(N)?"i-heroicons-check-16-solid":"i-heroicons-plus-16-solid",variant:"outline",color:t(I).includes(N)?"green":"white",onClick:()=>{if(t(I).includes(N)){t(I).splice(t(I).indexOf(N),1);return}t(I).push(N)}},null,8,["icon","color","onClick"]))]),expand:y(({row:N})=>[f(N).length>0?(d(),j("div",oa,[m(Je,{class:"my-3",items:f(N).map(se=>({id:se.id,url:se.url,type:(se==null?void 0:se.type)||"image"})),ui:{item:"mx-1"}},{default:y(({item:se})=>[se.type==="image"?(d(),S(Xe,{key:0,src:se.url,height:256,width:256,loading:"lazy",draggable:"false"},null,8,["src"])):(d(),j("video",na,[h("source",{src:se.url},null,8,aa)]))]),_:2},1032,["items"])])):(d(),S(X,{key:1,title:"No images",description:"No images available for this model version.",variant:"soft",color:"amber"}))]),_:1},8,["modelValue","expand","rows","loading"])]),_:1})])):(d(),S(X,{key:0,class:"my-4",title:"CivitAI token missing",description:"Please add a CivitAI token in the settings to use this feature.",variant:"soft",color:"red"},{actions:y(()=>[m(A,{to:"/settings"},{default:y(()=>[m(M,{class:"lg:px-3 py-2",icon:"i-heroicons-arrow-top-right-on-square-16-solid",variant:"link",color:"white"},{default:y(()=>g[16]||(g[16]=[E(" Go to Settings ")])),_:1})]),_:1})]),_:1}))])]),_:1},8,["modelValue"])}}}),ra={class:"p-4 overflow-y-auto relative"},ua={class:"flex flex-col gap-2 mt-3"},da={class:"flex justify-end mt-3"},ca=te({__name:"EditMetadataModal",props:Te({flow:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const l=e,o=Fe(e,"show"),i=me(),r=xe(),a=$(!1),u=$(l.flow.display_name),c=$(l.flow.description),p=$(l.flow.license),_=$(l.flow.required_memory_gb||0),w=$(l.flow.version),x=L(()=>u.value!==""&&c.value!=="");function I(){a.value=!0,i.updateFlowMetadata(l.flow,{display_name:u.value,description:c.value,license:p.value,required_memory_gb:_.value,version:w.value}).then(()=>{o.value=!1,r.add({title:"Flow metadata updated",description:"Flow metadata has been updated successfully."})}).catch(F=>{console.debug("Failed to update flow metadata:",F),r.add({title:"Flow metadata update failed",description:(F==null?void 0:F.details)??"Failed to update flow metadata. Please try again."})}).finally(()=>{a.value=!1})}return(F,k)=>{const U=Ne,O=Be,P=jt,f=ie,v=$e;return d(),S(v,{modelValue:o.value,"onUpdate:modelValue":k[6]||(k[6]=C=>o.value=C)},{default:y(()=>[h("div",ra,[k[9]||(k[9]=h("h2",{class:"font-bold"},"Edit flow metadata",-1)),h("div",ua,[m(O,{label:"New display name",class:"flex justify-center flex-col w-full",error:t(u)!==""?"":"Display name is required."},{default:y(()=>[m(U,{modelValue:t(u),"onUpdate:modelValue":k[0]||(k[0]=C=>G(u)?u.value=C:null),type:"text",placeholder:"Display name"},null,8,["modelValue"])]),_:1},8,["error"]),m(O,{label:"New flow description",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(P,{modelValue:t(c),"onUpdate:modelValue":k[1]||(k[1]=C=>G(c)?c.value=C:null),placeholder:"Description"},null,8,["modelValue"])]),_:1}),m(O,{label:"License (optional)",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(U,{modelValue:t(p),"onUpdate:modelValue":k[2]||(k[2]=C=>G(p)?p.value=C:null),type:"text",placeholder:"License"},null,8,["modelValue"])]),_:1}),m(O,{label:"Required memory (GB)",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(U,{modelValue:t(_),"onUpdate:modelValue":k[3]||(k[3]=C=>G(_)?_.value=C:null),type:"text",placeholder:"Required memory (GB)"},null,8,["modelValue"])]),_:1}),m(O,{label:"Version",class:"flex justify-center flex-col w-full"},{default:y(()=>[m(U,{modelValue:t(w),"onUpdate:modelValue":k[4]||(k[4]=C=>G(w)?w.value=C:null),type:"text",placeholder:"Version"},null,8,["modelValue"])]),_:1})]),h("div",da,[m(f,{class:"mr-2",variant:"soft",color:"white",onClick:k[5]||(k[5]=C=>o.value=!1)},{default:y(()=>k[7]||(k[7]=[E(" Cancel ")])),_:1}),m(f,{variant:"soft",color:"primary",loading:t(a),disabled:!t(x),onClick:I},{default:y(()=>k[8]||(k[8]=[E(" Save ")])),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue"])}}}),ma={class:"flex flex-col lg:flex-row flex-grow items-start w-full"},fa={class:"card-wrapper w-full lg:pr-5"},pa={key:0,class:"p-0 text-sm"},ga={class:"flex flex-row items-center text-slate-400 mb-2"},va={class:"flex flex-row flex-wrap items-center text-md mb-2"},wa=["href"],ha={class:"flex flex-row items-center text-md mb-2"},ya=["href"],ba={key:1},ka={class:"flex flex-row items-center text-md mb-2"},xa={key:0},_a={class:"flex flex-row items-center text-md mb-2"},$a={key:0,class:"flex flex-row flex-wrap items-center text-md mb-2"},Ca=["href"],Sa={key:1},Ia={class:"flex flex-row items-center mb-2"},Ma={key:1,class:"flex flex-row flex-wrap items-center text-md"},Ra={key:0,class:"flex justify-end"},Fa={class:"flex flex-row items-center justify-center text-sm mr-2"},Ua={key:1},Pa={class:"text-sm flex justify-end"},za={class:"flex flex-row items-center justify-center text-sm mr-3"},Va={key:0,class:"text-right"},ja={class:"prompt-wrapper w-full"},Oa={class:"flex items-center justify-between"},Ta={class:"pb-2"},Na={class:"flex justify-end items-center"},Qa=te({__name:"[name]",setup(e){const l=ll(),o=me(),i=xe();o.setCurrentFlow(l.params.name);const r=L(()=>o.flowInstallingByName(l.params.name)),a=L(()=>{var B;return r.value&&((B=r.value)==null?void 0:B.progress)<100||!1}),u=$(!1),c=L(()=>{var B;return r.value?"error"in r.value&&((B=r.value)==null?void 0:B.error)!==""?`${r.value.progress.toFixed(0)}% Error setting up`:`${r.value.progress.toFixed(0)}% Setting up`:"Setup flow"}),p=$(!1),_=$(!1),w=$(!1),x=$(!1),I=L(()=>{var b,D;const B=[[{label:"Export flow",icon:"i-heroicons-arrow-down-on-square-stack",click:()=>{o.fetchFlowDetails(o.currentFlow).then(n=>{console.debug("[DEBUG] Flow details for export: ",n);const s=new Blob([JSON.stringify(n==null?void 0:n.flow_comfy)],{type:"application/json"}),z=window.URL.createObjectURL(s),H=document.createElement("a");H.href=z,H.download=`${o.currentFlow.name}.json`,H.click(),window.URL.revokeObjectURL(z)}).catch(n=>{console.debug("Failed to fetch flow details for export: ",n),i.add({title:"Failed to export flow",description:(n==null?void 0:n.details)||"Failed to fetch flow details for export"})})}}],[{label:"Delete flow",icon:"i-heroicons-trash",click:k}]];return f.isAdmin&&B[0].unshift({label:"Edit metadata",icon:"i-heroicons-pencil-square",click:()=>{x.value=!0}}),((b=o==null?void 0:o.currentFlow)==null?void 0:b.new_version_available)!==""&&B[0].unshift({label:`Update to ${o.currentFlow.new_version_available}`,icon:"i-heroicons-arrow-path",click:()=>{o.updateFlow(o.currentFlow)}}),(D=o==null?void 0:o.currentFlow)!=null&&D.lora_connect_points&&Object.keys(o.currentFlow.lora_connect_points).length>0&&B[0].unshift({label:"Modify flow",icon:"i-heroicons-plus-circle",click:()=>{w.value=!0}}),B});function F(B,b=!1){p.value=!0,o.deleteFlow(B).then(()=>{b&&Ut().push("/")}).finally(()=>{p.value=!1,_.value=!1})}function k(){var b;const B=((b=o.currentFlow)==null?void 0:b.private)||!1;if(B){_.value=!0;return}F(o.currentFlow,B)}const U=$(!1),O=$(null),P=function(B){var b;(b=O.value)==null||b.copyPromptInputs(B)},f=ft(),v=L(()=>{var B;return(B=o.currentFlow)==null?void 0:B.models.filter(b=>b.installed).reduce((b,D)=>b+(D==null?void 0:D.file_size)||0,0)}),C=L(()=>{var B;return(B=o.currentFlow)==null?void 0:B.models.reduce((b,D)=>b+(D==null?void 0:D.file_size)||0,0)}),q=L(()=>!v.value&&!C.value?"":v.value===C.value?` - ${je(C.value)}`:` - ${je(v.value)} / ${je(C.value)}`);return(B,b)=>{const D=_e,n=He,s=We,z=ie,H=lt,K=Pt,Z=yo,re=To,de=Nn,ae=Vt,ee=$e,we=ia,he=ca,ue=ol;return d(),S(ue,null,{default:y(()=>{var ye,ve;return[!t(o).loading.flows_available&&!t(o).loading.flows_installed&&t(o).currentFlow&&!t(o).$state.loading.tasks_history?(d(),j(ne,{key:0},[h("div",ma,[h("div",fa,[m(K,{as:"div",class:"w-full mb-5"},nl({header:y(()=>{var T,g;return[h("h2",{class:"text-xl font-bold cursor-pointer select-none flex items-center",onClick:b[0]||(b[0]=()=>{U.value=!t(U)})},[(T=t(o).currentFlow)!=null&&T.private?(d(),S(n,{key:0,text:"This flow is local, manually added"},{default:y(()=>{var M;return[m(D,{name:"i-heroicons-lock-closed",class:le(["mr-2",{"text-stone-500":!((M=t(o).currentFlow)!=null&&M.is_supported_by_workers)}])},null,8,["class"])]}),_:1})):R("",!0),m(D,{name:t(U)?"i-heroicons-chevron-down":"i-heroicons-chevron-up",class:"mr-2"},null,8,["name"]),m(n,{text:(g=t(o).currentFlow)!=null&&g.is_supported_by_workers?"":"No workers capable of running this flow",popper:{placement:"top"}},{default:y(()=>{var M,A;return[h("span",{class:le({"text-stone-500":!((M=t(o).currentFlow)!=null&&M.is_supported_by_workers)})},Q((A=t(o).currentFlow)==null?void 0:A.display_name),3)]}),_:1},8,["text"])])]}),default:y(()=>{var T,g,M,A,X,V,J,W,Y,pe,Pe,be,ze,Xe,Je,Qe,Ke;return[t(U)?R("",!0):(d(),j("div",pa,[h("p",ga,Q((T=t(o).currentFlow)==null?void 0:T.description),1),h("p",va,[m(D,{name:"i-heroicons-user-16-solid",class:"mr-1"}),b[10]||(b[10]=h("b",null,"Author:",-1)),b[11]||(b[11]=E("  ")),h("a",{class:"hover:underline text-md",href:(g=t(o).currentFlow)==null?void 0:g.homepage,rel:"noopener",target:"_blank"},Q((M=t(o).currentFlow)==null?void 0:M.author),9,wa)]),h("p",ha,[m(D,{name:"i-heroicons-document-text",class:"mr-1"}),(A=t(o).currentFlow)!=null&&A.documentation?(d(),j("a",{key:0,class:"hover:underline",href:(X=t(o).currentFlow)==null?void 0:X.documentation,rel:"noopener",target:"_blank"}," Documentation ",8,ya)):(d(),j("span",ba,"No documentation"))]),h("p",ka,[m(D,{name:"i-heroicons-clock",class:"mr-1"}),b[12]||(b[12]=h("b",null,"Version:",-1)),b[13]||(b[13]=E("  ")),h("span",null,Q((V=t(o).currentFlow)==null?void 0:V.version),1),((J=t(o).currentFlow)==null?void 0:J.new_version_available)!==""?(d(),j("span",xa,"  (new version available: "+Q((W=t(o).currentFlow)==null?void 0:W.new_version_available)+") ",1)):R("",!0)]),h("p",_a,[m(D,{name:"i-heroicons-tag",class:"mr-1"}),b[14]||(b[14]=h("b",null,"Tags:",-1)),b[15]||(b[15]=E("  ")),((Y=t(o).currentFlow)==null?void 0:Y.tags.length)>0?(d(!0),j(ne,{key:0},fe((pe=t(o).currentFlow)==null?void 0:pe.tags,oe=>(d(),S(s,{key:oe,label:oe,color:"white",variant:"solid",class:"m-1"},null,8,["label"]))),128)):(d(),S(s,{key:1,label:"No tags",color:"white",variant:"solid",class:"m-1"}))]),((be=(Pe=t(o).currentFlow)==null?void 0:Pe.models)==null?void 0:be.length)>0?(d(),j("p",$a,[m(D,{name:"i-heroicons-arrow-down-on-square-stack",class:"mr-1"}),m(n,{text:t(C)-t(v)>0?`${("formatBytes"in B?B.formatBytes:t(je))(t(C)-t(v))} to download`:"All models installed",popper:{placement:"top"}},{default:y(()=>{var oe;return[h("b",null,"Models ("+Q((oe=t(o).currentFlow)==null?void 0:oe.models.length)+Q(t(q))+"):",1),b[16]||(b[16]=E("  "))]}),_:1},8,["text"]),(d(!0),j(ne,null,fe((ze=t(o).currentFlow)==null?void 0:ze.models,oe=>(d(),S(s,{key:oe.name,class:"m-1",color:"white",variant:"solid"},{default:y(()=>[m(n,{text:oe.installed?"Model installed":"Model not installed"},{default:y(()=>[m(D,{name:oe.installed?"i-heroicons-check-circle-20-solid":"i-heroicons-x-mark-20-solid",class:le(oe.installed?"text-green-500":"text-orange-500")},null,8,["name","class"])]),_:2},1032,["text"]),oe.gated?(d(),S(n,{key:0,text:"Gated model, requires auth token for download",popper:{placement:"top"}},{default:y(()=>[m(D,{name:"i-heroicons-key",class:"mr-1"})]),_:1})):R("",!0),h("a",{class:"hover:underline underline-offset-4",href:oe.homepage,rel:"noopener",target:"_blank"},Q(oe.name),9,Ca),oe.file_size?(d(),j("span",Sa," ("+Q(("formatBytes"in B?B.formatBytes:t(je))(oe.file_size))+") ",1)):R("",!0)]),_:2},1024))),128))])):R("",!0),h("p",Ia,[m(D,{name:"i-mdi-help-network-outline",class:"mr-1"}),b[19]||(b[19]=h("b",null,"Platforms:",-1)),b[20]||(b[20]=E("  ")),m(n,{text:"Linux"},{default:y(()=>[m(D,{name:"i-mdi-linux",class:"mr-1"})]),_:1}),m(n,{text:"Microsoft Windows"},{default:y(()=>[m(D,{name:"i-mdi-microsoft-windows",class:"mr-1"})]),_:1}),t(o).currentFlow.is_macos_supported?(d(),S(n,{key:0,text:"macOS"},{default:y(()=>[m(D,{name:"i-mdi-apple",class:"mr-1"})]),_:1})):R("",!0),(Xe=t(o).currentFlow)!=null&&Xe.required_memory_gb?(d(),S(n,{key:1,class:"flex flex-row items-center",text:"Required VRAM memory (GB)"},{default:y(()=>{var oe;return[b[17]||(b[17]=E(" (")),m(D,{name:"i-mdi-memory",class:"mr-1"}),h("span",null,Q((oe=t(o).currentFlow)==null?void 0:oe.required_memory_gb)+" GB",1),b[18]||(b[18]=E(") "))]}),_:1})):R("",!0)]),((Qe=(Je=t(o).currentFlow)==null?void 0:Je.requires)==null?void 0:Qe.length)>0?(d(),j("p",Ma,[b[21]||(b[21]=h("b",null,"Requires:",-1)),b[22]||(b[22]=E("  ")),(d(!0),j(ne,null,fe((Ke=t(o).currentFlow)==null?void 0:Ke.requires,oe=>(d(),S(s,{key:oe,class:"m-1",color:"yellow",variant:"outline"},{default:y(()=>[E(Q(oe),1)]),_:2},1024))),128))])):R("",!0)]))]}),_:2},[t(U)?void 0:{name:"footer",fn:y(()=>{var T,g;return[t(f).isAdmin?(d(),j("div",Ra,[h("div",Fa,[m(D,{name:t(o).isFlowInstalled(t(l).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),h("span",{class:le({"text-green-500":t(o).isFlowInstalled(t(l).params.name),"text-red-500":!t(o).isFlowInstalled(t(l).params.name),"text-stone-500":t(o).isFlowInstalled(t(l).params.name)&&!((T=t(o).currentFlow)!=null&&T.is_supported_by_workers)})},Q(t(o).isFlowInstalled(t(l).params.name)?(g=t(o).currentFlow)!=null&&g.is_supported_by_workers?"Installed":"Installed (no workers)":"Not installed"),3)]),t(o).isFlowInstalled(t(l).params.name)?R("",!0):(d(),S(n,{key:0,text:"Setup flow dependencies and configure it in ComfyUI",popper:{placement:"top"},"open-delay":500},{default:y(()=>[m(z,{icon:"i-heroicons-arrow-down-tray",class:"mx-3",color:"primary",variant:"outline",loading:t(a),onClick:b[1]||(b[1]=()=>t(o).setupFlow(t(o).currentFlow))},{default:y(()=>[E(Q(t(c)),1)]),_:1},8,["loading"])]),_:1})),!t(o).isFlowInstalled(t(l).params.name)&&t(a)?(d(),S(n,{key:1,text:"Cancel flow installation",popper:{placement:"top"},"open-delay":500},{default:y(()=>[m(z,{icon:"i-heroicons-stop",variant:"outline",color:"orange",loading:t(u),onClick:b[2]||(b[2]=()=>{u.value=!0,t(o).cancelFlowSetup(t(o).currentFlow).then(()=>{u.value=!1})})},{default:y(()=>b[23]||(b[23]=[E(" Cancel ")])),_:1},8,["loading"])]),_:1})):R("",!0),t(o).isFlowInstalled(t(l).params.name)?(d(),S(H,{key:2,items:t(I),mode:"click",label:"Actions",popper:{placement:"bottom-end"}},{default:y(()=>[m(z,{color:"white",label:"Actions","trailing-icon":"i-heroicons-chevron-down-20-solid"})]),_:1},8,["items"])):R("",!0)])):(d(),j("div",Ua,[h("div",Pa,[h("div",za,[m(D,{name:t(o).isFlowInstalled(t(l).params.name)?"i-heroicons-check-badge":"i-heroicons-x-mark",class:"mx-1"},null,8,["name"]),h("span",{class:le({"text-green-500":t(o).isFlowInstalled(t(l).params.name),"text-red-500":!t(o).isFlowInstalled(t(l).params.name)})},Q(t(o).isFlowInstalled(t(l).params.name)?"Installed":"Not installed"),3)]),t(o).isFlowInstalled(t(l).params.name)?R("",!0):(d(),j("div",Va,b[24]||(b[24]=[h("p",{class:"text-orange-500"},"Only admin can manage workflows.",-1),h("span",{class:"text-slate-500"},"Ask your admin to setup this workflow",-1)])))])]))]}),key:"0"}]),1024)]),h("div",ja,[!t(p)&&t(o).isFlowInstalled(t(l).params.name)?(d(),S(Z,{key:0,ref_key:"workflowPrompt",ref:O},null,512)):R("",!0)])]),!t(p)&&t(o).isFlowInstalled(t(l).params.name)?(d(),S(re,{key:0})):R("",!0),!t(p)&&t(o).isFlowInstalled(t(l).params.name)||t(o).flowResultsByName(t(l).params.name).length>0?(d(),S(de,{key:1,onCopyPromptInputs:b[3]||(b[3]=T=>P(T))})):R("",!0)],64)):(d(),S(ae,{key:1,class:"mb-3"})),m(ee,{modelValue:t(_),"onUpdate:modelValue":b[7]||(b[7]=T=>G(_)?_.value=T:null),"prevent-close":""},{default:y(()=>[m(K,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:y(()=>[h("div",Oa,[b[25]||(b[25]=h("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Confirm workflow deletion ",-1)),m(z,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:b[4]||(b[4]=T=>_.value=!1)})])]),default:y(()=>{var T;return[h("p",Ta,[b[26]||(b[26]=E(" Are you sure you want to delete the ")),b[27]||(b[27]=h("b",null,"private",-1)),b[28]||(b[28]=E(" workflow ")),h("b",null,Q((T=t(o).currentFlow)==null?void 0:T.display_name),1),b[29]||(b[29]=E("? "))]),h("div",Na,[m(z,{icon:"i-heroicons-x-mark-16-solid",variant:"outline",color:"green",class:"mr-2",onClick:b[5]||(b[5]=g=>_.value=!1)},{default:y(()=>b[30]||(b[30]=[E(" Cancel ")])),_:1}),m(z,{icon:"i-heroicons-trash",variant:"outline",color:"red",onClick:b[6]||(b[6]=g=>{var M;return F(t(o).currentFlow,((M=t(o).currentFlow)==null?void 0:M.private)||!1)})},{default:y(()=>b[31]||(b[31]=[E(" Delete ")])),_:1})])]}),_:1})]),_:1},8,["modelValue"]),t(f).isAdmin&&((ye=t(o))!=null&&ye.currentFlow)?(d(),S(we,{key:2,show:t(w),"onUpdate:show":b[8]||(b[8]=T=>G(w)?w.value=T:null),flow:t(o).currentFlow},null,8,["show","flow"])):R("",!0),t(f).isAdmin&&((ve=t(o))!=null&&ve.currentFlow)?(d(),S(he,{key:3,show:t(x),"onUpdate:show":b[9]||(b[9]=T=>G(x)?x.value=T:null),flow:t(o).currentFlow},null,8,["show","flow"])):R("",!0)]}),_:1})}}});export{Qa as default};
